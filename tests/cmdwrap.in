#!/bin/sh
#
# cmdwrap - run a command with a prepared environment
# Parameters: command_to_run command_parameters
#
# This script acts as a general-purpose command wrapper. Before executing the
# given command, it sets up the necessary environment variables (such as library
# paths and other runtime settings).
#
# This was written to help run the OpenAFS test suite.
#
# License: MIT

TEST_COMMAND="$1"
NEWLIB_PATH="@TOP_OBJDIR@/lib"

# Linux, HP-UX (64bit), Solaris, BSD
if [ -z "$LD_LIBRARY_PATH" ] ; then
    LD_LIBRARY_PATH="$NEWLIB_PATH"
else
    LD_LIBRARY_PATH="$NEWLIB_PATH:$LD_LIBRARY_PATH"
fi
export LD_LIBRARY_PATH

# Mac OS X
if [ -z "$DYLD_LIBRARY_PATH" ] ; then
    DYLD_LIBRARY_PATH="$NEWLIB_PATH"
else
    DYLD_LIBRARY_PATH="$NEWLIB_PATH:$DYLD_LIBRARY_PATH"
fi
export DYLD_LIBRARY_PATH

# HP-UX (32bit)
if [ -z "$SHLIB_PATH" ] ; then
    SHLIB_PATH="$NEWLIB_PATH"
else
    SHLIB_PATH="$NEWLIB_PATH:$SHLIB_PATH"
fi
export SHLIB_PATH

# AIX
if [ -z "$LIBPATH" ] ; then
    LIBPATH="$NEWLIB_PATH"
else
    LIBPATH="$NEWLIB_PATH:$LIBPATH"
fi
export LIBPATH

shift
exec "$TEST_COMMAND" "$@"
