<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3//EN">
<HTML><HEAD>
<TITLE>管理の手引き</TITLE>
<!-- Begin Header Records  ========================================== -->
<!-- E:\IDWB\TEMP\idwt2118\AUAGD000.SCR converted by idb2h R4.2 (359) -->
<!-- ID Workbench Version (OS2) on 24 Dec 1999 at 12:07:32            -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Shift_JIS">
<META HTTP-EQUIV="updated" CONTENT="Fri, 24 Dec 1999 12:07:30">
<META HTTP-EQUIV="review" CONTENT="Sun, 24 Dec 2000 12:07:30">
<META HTTP-EQUIV="expires" CONTENT="Mon, 24 Dec 2001 12:07:30">
</HEAD><BODY>
<!-- (C) IBM Corporation 2000. All Rights Reserved    --> 
<BODY bgcolor="ffffff"> 
<!-- End Header Records  ============================================ -->
<A NAME="Top_Of_Page"></A>
<H1>管理の手引き</H1>
<HR><H1><A NAME="HDRWQ229" HREF="auagd002.htm#ToC_201">ボリュームの管理</A></H1>
<P>この章では、ファイル・サーバー・マシンに保管されているボリュームを管理する方法について説明します。このボリュームは、AFS 内の指定管理ユニットであるため、その管理は管理者の仕事の大部分を占めます。
<HR><H2><A NAME="HDRWQ230" HREF="auagd002.htm#ToC_202">命令の一覧</A></H2>
<P>本章では、次に示されるコマンドを使用したタスクの実行方法について説明します。
<BR>
<TABLE WIDTH="100%">
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">読み取り / 書き込みボリュームの作成
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos create</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">読み取り専用ボリュームの作成
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos addsite</B> <B>および</B> <B>vos release</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">バックアップ・ボリュームの作成
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos backup</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">多くのバックアップ・ボリュームの同時作成
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos backupsys</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">VLDB 項目の検査
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos listvldb</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">ボリューム・ヘッダーの検査
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos listvol</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">VLDB 項目およびボリューム・ヘッダーの検査
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos examine</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">ボリューム名の表示
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>fs listquota</B> <B>または</B> <B>fs examine</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">ボリューム ID 番号の表示
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>fs examine</B> <B>または</B> <B>vos examine</B> <B>または</B> <B>vos listvol</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">使用可能なパーティションのサイズおよびスペースの表示
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos partinfo</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">ボリュームの位置表示
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>fs whereis</B> <B>または</B> <B>vos examine</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">マウント・ポイントの作成
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>fs mkmount</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">マウント・ポイントの取り外し
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>fs rmmount</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">マウント・ポイントの表示
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>fs lsmount</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">読み取り / 書き込みボリュームの移動
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos move</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">ボリューム・ヘッダーとの VLDB の同期化
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos syncvldb</B> <B>および</B> <B>vos syncserv</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">ボリューム割り当て量の設定
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>fs setvol</B> <B>または</B> <B>fs setquota</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">ボリューム割り当て量の表示
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>fs quota</B> <B>または</B> <B>fs listquota</B> <B>または</B> <B>fs examine</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">ボリュームの現行サイズ表示
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>fs listquota</B> <B>または</B> <B>fs examine</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">マシン / パーティション上のボリュームのリスト表示
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos listvol</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">読み取り / 書き込みボリュームの削除
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos remove</B> <B>および</B> <B>fs rmmount</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">読み取り専用ボリュームの削除
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos remove</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">バックアップ・ボリュームの削除
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos remove</B> <B>および</B> <B>fs rmmount</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">ボリュームの削除。VLDB 変更なし。
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos zap</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">読み取り専用サイト定義の削除
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos remsite</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">VLDB 項目の削除。ボリューム変更なし。
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos delentry</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">ボリュームのダンプ
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos dump</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">ダンプ済みボリュームの復元
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos restore</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">ボリュームの名前変更
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos rename</B>、<B>fs rmmount</B>
<B>および</B> <B>fs mkmount</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">ボリュームのロック解除
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos unlock</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">複数ボリュームのロック解除
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos unlockvldb</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="58%">ボリュームのロック
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="42%"><B>vos lock</B>
</TD></TR></TABLE>
<HR><H2><A NAME="HDRWQ263" HREF="auagd002.htm#ToC_203">ボリュームについて</A></H2>
<A NAME="IDX6425"></A>
<P>AFS <I>ボリューム</I> は、ディスク・スペースの論理装置で、
AFS ディレクトリー内のファイル用のコンテナーのように機能し、ファイル・サーバー・マシンの 1 つのパーティション上にそれらのすべてのファイルを保持します。ボリュームの内容をセルのファイル・ツリー内に表示させて、ユーザーがアクセスできるようにするには、
AFS ファイル・スペース内のディレクトリーの位置にそのボリュームを取り付けます。ファイル・スペース内のボリュームとそのロケーション間の関連は、
<I>マウント・ポイント</I> と呼ばれます。また、AFS の内部の動作により、それは標準ディレクトリー要素と全く同じように見え、同じように機能します。したがって、ユーザーは標準 UNIX ディレクトリーの内容にアクセスして操作するのと同じように、ボリュームの内容にアクセスし操作することができます。ボリュームおよびディレクトリー間の関連についての詳細は、
<A HREF="#HDRWQ269">ボリュームの取り付けについて</A> を参照してください。
<P>ボリュームは、AFS の基本記憶機構および管理ユニットであるため、管理者は日常的な活動のなかで、ボリュームを操作することがよくあります。ボリュームを使用してジョブを容易にする方法については、
<A HREF="#HDRWQ265">ボリュームを使用して AFS 効率性を向上させる方法</A> を参照してください。
<P><H3><A NAME="HDRWQ264" HREF="auagd002.htm#ToC_204">3 つのタイプのボリューム</A></H3>
<P>AFS には、以下に示す 3 つのタイプのボリュームがあります。
<UL>
<LI>単一の <I>読み取り / 書き込み</I> バージョンのボリュームは、ファイルおよびディレクトリーの変更可能なバージョンを格納します。
<A NAME="IDX6426"></A>
<P>
このバージョンは、<I>読み取り / 書き込みソース</I> と呼ばれます。
<I>複製</I>と呼ばれるコピー手順によって別の 2 つのタイプのボリュームが、そこから派生するからです。読み取り / 書き込みボリュームの作成に関する説明は、<A HREF="#HDRWQ271">読み取り / 書き込みボリュームの作成</A> を参照してください
</LI><LI><I>読み取り専用</I> ボリュームは、読み取り / 書き込みソース・ボリュームのコピーで、複数の<I>サイト</I>で存在する可能性があります
(サイトは、特定のファイル・サーバー・マシン上の特定のパーティションです)。
<A NAME="IDX6427"></A>
<A NAME="IDX6428"></A>
<A NAME="IDX6429"></A>
<P>
複数のサイトに同じデータを配置することは、<I>複写</I>と呼ばれます。詳細は、<A HREF="#HDRWQ265">ボリュームを使用して AFS 効率性を向上させる方法</A> を参照してください。名前のとおり、読み取り専用ボリュームの内容は、読み取り / 書き込みソースが変更されるときに自動的に変更されませんが、管理者が <B>vos release</B> コマンドを発行するときのみ変更されます。
AFS ファイル・スペースの一貫したビューを保持するには、読み取り専用ボリュームのすべてのコピーがお互いに一致、かつ、それらの読み取り / 書き込みソースと一致しなければなりません。すべての読み取り専用ボリュームは、読み取り / 書き込みソースの名前に <B>.readonly</B> の拡張子が付いた同じ名前を共用します。読み取り専用ボリュームの作成に関する説明は、<A HREF="#HDRWQ278">ボリュームの複写 (読み取り専用ボリュームの作成)</A> を参照してください。
</LI><LI><I>バックアップ</I>・ボリュームは、読み取り / 書き込みソース・ボリュームの複製で、ソースと同じサイトに格納されています。
<A NAME="IDX6430"></A>
<P>
バックアップ・バージョンは、特定の時間の読み取り / 書き込みソースの状態を記録します。これは、間違って変更または削除したデータを回復することができるため便利です
(詳細は、<A HREF="#HDRWQ265">ボリュームを使用して AFS 効率性を向上させる方法</A> を参照してください)。バックアップ・ボリューム名は、読み取り / 書き込みソースの名前に <B>.backup</B> 拡張子を付けたものです。バックアップ・ボリュームの作成に関する説明は、<A HREF="#HDRWQ287">バックアップ・ボリュームの作成</A> を参照してください。
<P>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">通常、ボリュームのバックアップ・バージョンの作成は、ボリュームをテープにバックアップするプロセスのステージの 1 つですが、バックアップ・ボリュームは、AFS バックアップ・システムを使用してテープに転送されるボリュームのバックアップと同じではありません。
AFS バックアップ・システムを使用したボリュームのバックアップについては、<A HREF="auagd012.htm#HDRWQ412">データのバックアップ</A> を参照してください。
</TD></TR></TABLE>
</LI></UL>
<P>既述のとおり、3 つのタイプのボリュームは互いに関連しています。読み取り専用およびバックアップのボリュームは、どちらも複製という処理を介して読み取り / 書き込みボリュームから派生しています。作成時点での読み取り専用およびバックアップのボリュームは、読み取り / 書き込みソースの同一コピーです。
<P><H3><A NAME="HDRWQ265" HREF="auagd002.htm#ToC_205">ボリュームを使用して AFS 効率性を向上させる方法</A></H3>
<A NAME="IDX6431"></A>
<P>ボリュームを使用して、セルの管理を容易にし、効率的にするには、次の 3 つの方法があります。
<UL>
<LI>ボリュームは、パーティションよりも小さいと定義されるため、同じマシンでも異なるマシンでもパーティション間で移動することが簡単です。
<A NAME="IDX6432"></A>
<P>
おそらく、ボリュームを移動させる最も一般的な理由は、ファイル・サーバー・マシンの間でのロードのバランスを取るためか、または、特定のマシン上でより大きなディスク容量を利用するためだと思われます。移動過程によって数秒の間だけボリュームの内容は使用不能になるため、ユーザーが内容にアクセスするのを中断させることなく、必要なだけ何度もボリュームを移動させることができます。ボリューム・ロケーション・データベース (VLDB) 内のボリューム・ロケーションの自動トラッキング機能により、アクセスは透過的のまま残ります。ボリュームの移動に関する説明は、
<A HREF="#HDRWQ312">ボリュームの移動</A> を参照してください。
</LI><LI>ボリュームは、AFS の複写ユニットです。
<A NAME="IDX6433"></A>
<A NAME="IDX6434"></A>
<P>
<I>複写</I> とは、読み取り / 書き込みソースから読み取り専用の複製を作成すること、および 1 つまたはそれ以上のサイトへ複製を配布することを指します。複写によって、一般的なファイルに対する要求を複数のマシンによって埋めることができるため、システム効率が向上します。また、複写によって、マシンやサーバー・プロセスの障害が起きた場合にもデータを使用可能にしておけるため、システムの信頼性も高まります。通常、あまり変更しない一般的なアプリケーション・プログラムおよび他のファイルを含むボリュームが複製には最適な候補ですが、どの読み取り / 書き込みボリュームでも複製することができます。
<A HREF="#HDRWQ278">ボリュームの複写 (読み取り専用ボリュームの作成)</A> を参照してください。
</LI><LI>ボリュームは、AFS のバックアップ・ユニットであり、2 つの意味があります。
<A NAME="IDX6435"></A>
<P>
バックアップ・ボリューム・バージョンを作成すると、指定時間に読み取り / 書き込みソース・ボリュームの状態を保存することができます。
AFS ファイル・スペースにバックアップ・バージョンを取り付けると、ユーザーは管理者の援助なしで誤って変更または削除したデータを復元することができ、これによってより重要なジョブを実行する余裕ができます。
1 日に 1 回ユーザー・ボリュームの新規バックアップ・バージョンを作成する
(おそらく以前のバックアップに上書きする) 場合、ユーザーは常に前日のバージョンのファイルを検索することができます。これについての詳細は、<A HREF="#HDRWQ287">バックアップ・ボリュームの作成</A> を参照してください。
<P>
<P>バックアップはまた、AFS バックアップ・システムを使用して、テープ上または特別なバックアップ・データ内にボリュームの内容の永久版を保存する場合にも当てはまります。
<A HREF="auagd011.htm#HDRWQ334">AFS バックアップ・システムの構成</A> および <A HREF="auagd012.htm#HDRWQ383">AFS データのバックアップと復元</A>を参照してください。
</LI></UL>
<P><H3><A NAME="HDRWQ266" HREF="auagd002.htm#ToC_206">VLDB のボリューム情報</A></H3>
<P>ボリューム・ロケーション・データベース (VLDB) には、セル内のすべてのボリュームに関する項目が含まれています。おそらく、項目の内で最も重要な情報は、ボリュームの位置であり、これは AFS データへの透過的アクセスへの鍵となるものです。ユーザーがファイルをオープンしたら、キャッシュ・マネージャーは、
VLDB を保守するボリューム・ロケーション (VL) サーバーに相談して、そのファイルを含むボリュームを格納するファイル・サーバー・マシンのリストを探します。次に、キャッシュ・マネージャーは、関連するファイル・サーバー・マシンのうちの 1 つで実行されているファイル・サーバーからファイルを要求します。このファイル・ロケーションの手順は、ファイルのパス名しか知る必要のないユーザーには見えません。
<A NAME="IDX6436"></A>
<A NAME="IDX6437"></A>
<A NAME="IDX6438"></A>
<P>読み取り / 書き込みボリュームの VLDB ボリューム項目には、読み取り専用およびバックアップ・バージョンに関する持続情報も含まれますが、独自の VLDB 項目自体は含まれません (まれに例外として、読み取り / 書き込みソースが削除されたために、読み取り専用ボリュームが独自の VLDB 項目を持つ場合があります)。ボリュームの VLDB 項目は、ボリューム名、バージョン (読み取り / 書き込み、読み取り専用、バックアップ、および releaseClone) ごとの固有なボリューム ID 番号、読み取り / 書き込みバージョンまたは読み取り専用バージョンを収納するサイト数カウント、およびサイトのリストを記録します。
<P>1 つまたは複数のボリュームの VLDB 項目を表示するには、
<A HREF="#HDRWQ304">VLDB 項目の表示</A> で説明する <B>vos listvldb</B> コマンドを使用します。ボリューム・ヘッダーとともに単一のボリュームの VLDB 項目を表示するには、
<A HREF="#HDRWQ308">1 つのボリュームの VLDB 項目およびボリューム・ヘッダーの表示</A> で説明する <B>vos examine</B> コマンドを使用します
(ボリューム・ヘッダーについての説明は、以下のセクションを参照してください)。
<P><H3><A NAME="HDRWQ267" HREF="auagd002.htm#ToC_207">ボリューム・ヘッダーの情報</A></H3>
<A NAME="IDX6439"></A>
<A NAME="IDX6440"></A>
<P>すべてのバージョンのボリュームが 1 つの VLDB 項目を共有するのに対し、AFS サーバー・パーティション上の各ボリュームは、独自の <I>ボリューム・ヘッダー</I>を保持しています。これは、ボリューム内のファイルおよびディレクトリーを、それらを保管するパーティション上の物理メモリー・アドレスへマップさせるデータ構造です。ボリューム・ヘッダーは、ボリュームの内容を論理装置へ結合するため、隣接するメモリー・ブロックに内容を保管する必要はありません。ボリューム・ヘッダーはまた、ボリュームについての情報を記録します。たとえば、名前、ボリューム ID番号、タイプ、サイズ、状態 (オンライン、オフライン、またはビジー)、スペース割り当て量、作成日付および最終変更日付のタイム・スタンプ、およびその終日のアクセス数を記録し、いくつかの VLDB 項目 と重複するボリュームもあります。
<P>1 つまたは複数のパーティション上でボリューム・ヘッダーを表示するには、
<A HREF="#HDRWQ306">ボリューム・ヘッダーの表示</A> で説明する <B>vos listvol</B> コマンドを使用します。ボリューム・ヘッダーとともに単一のボリュームの VLDB 項目を表示するには、<A HREF="#HDRWQ308">1 つのボリュームの VLDB 項目およびボリューム・ヘッダーの表示</A> で説明する <B>vos examine</B> コマンドを使用します。
<P><H3><A NAME="HDRWQ268" HREF="auagd002.htm#ToC_208">VLDB およびボリューム・ヘッダーの同期化を保持する</A></H3>
<A NAME="IDX6441"></A>
<A NAME="IDX6442"></A>
<A NAME="IDX6443"></A>
<A NAME="IDX6444"></A>
<A NAME="IDX6445"></A>
<A NAME="IDX6446"></A>
<P>VLDB の情報が、(ボリューム・ヘッダーに記録された) サーバー上の実際のボリュームの状況に、可能な限り長時間対応することが重要です。
VLDB 内のボリューム位置情報が誤っていると、キャッシュ・マネージャーはその内容が見つけられずアクセスできません。ボリュームの状況を変更する <B>vos</B> コマンドを発行する度に、ボリューム・サーバーと VL サーバーは、ボリューム・ヘッダーおよび VLDB の同期化を維持するために協力します。まれに、<B>vos</B> 操作が早期に停止する場合などに、ヘッダーおよび VLDB が分かれてしまう可能性があります。再び同期化させるための詳細は、<A HREF="#HDRWQ313">VLDB およびボリューム・ヘッダーの同期化</A> を参照してください。
<P><H3><A NAME="HDRWQ269" HREF="auagd002.htm#ToC_209">ボリュームの取り付けについて</A></H3>
<A NAME="IDX6447"></A>
<A NAME="IDX6448"></A>
<A NAME="IDX6449"></A>
<P>ボリュームの内容をセルのファイル・ツリー内に表示させて、ユーザーがアクセスできるようにするには、AFS ファイル・スペース内のディレクトリーの位置に、そのボリュームを取り付けます。ファイル・スペース内のボリュームとそのロケーション間の関連は、
<I>マウント・ポイント</I> と呼ばれます。
AFS マウント・ポイントは、通常の UNIX ファイル・システム・ディレクトリーのように見え、そのように機能します。しかし、構造的にはむしろ記号のリンクであり、ディレクトリーに関連するボリューム名をキャッシュ・マネージャーに伝える働きをします。キャッシュ・マネージャーがその解釈方法を知っているというだけの理由で、マウント・ポイントは、ディレクトリーのように見えそのように作用します。
<P>アプリケーション・プログラムが要求するファイルをキャッシュ・マネージャーが検索しなければならない、という一般的な場合について考慮します。キャッシュ・マネージャーは、ファイルの完全なパス名を考慮し、
AFS ルート ( <B>/afs</B> ディレクトリーに取り付けられた規則)
からスタートしてそのファイルまで横断します。横断中に、キャッシュ・マネージャーがマウント・ポイントに出会う ( <I>交差する</I>) と、そのマウント・ポイントを読み取って、そのディレクトリー・ロケーションに取り付けられたボリューム名を入手します。ボリューム・ロケーション (VL) サーバーからボリュームの位置情報を入手したら、キャッシュ・マネージャーは、指示されたボリュームを取り出して、そのルート・ディレクトリーをオープンします。ボリュームの <I>ルート・ディレクトリー</I> は、ボリューム内に常駐するすべてのファイル、サブディレクトリー、およびマウント・ポイントをリストします。キャッシュ・マネージャーは、パス名の次のエレメントをリストするルート・ディレクトリーを走査します。キャッシュ・マネージャーは、出会う他のマウント・ポイントの解釈を続ける方法を使用して要求されたファイルを格納するボリュームに達するまでそのパスを走査し続けます。
<A NAME="IDX6450"></A>
<A NAME="IDX6451"></A>
<P>マウント・ポイントは、ボリュームが異なる多くのファイル・サーバー・マシン上に常駐する場合でも、単一のシームレス・ファイル・ツリーのような錯覚を起こさせる AFS ファイル・スペースを接続するグルーのような役割を果たします。ボリュームがディレクトリー位置に取り付けられると、その内容を表示して、アクセスすることができます。ボリュームが取り付けられない場合、その内容には全くアクセスすることができません。
<P>ボリュームを、ファイル・ツリー内の 1 つ以上の位置に取り付けることができますが、これは次の 2 つの理由でお勧めできません。まず、ファイル・スペースの階層特性が変更してしまいます。次に、ファイルに達するために従うパス名について、キャッシュ・マネージャーが混乱する可能性があります
(たとえば、<B>pwd</B> コマンドから予想できない出力を起こす原因となります)。しかし、複数のディレクトリーでボリュームを取り付けた場合、ボリュームのルート・ディレクトリーに関連付けられたアクセス制御リスト (ACL) は、そのすべてのマウント・ポイントに適用されます。
<A NAME="IDX6452"></A>
<A NAME="IDX6453"></A>
<P>マウント・ポイントには幾つかのタイプがあります。キャッシュ・マネージャーは、各タイプを異なる目的に適するものとして、異なる方法で処理します。
<A HREF="#HDRWQ294">ボリュームの取り付け</A> を参照してください。
<P><H3><A NAME="HDRWQ270" HREF="auagd002.htm#ToC_210">ボリューム名について</A></H3>
<A NAME="IDX6454"></A>
<A NAME="IDX6455"></A>
<P>読み取り / 書き込みボリューム名の長さは、最大 22 文字までとします。ボリューム・サーバーは、読み取り専用およびバックアップのボリュームそれぞれに <B>.readonly</B> および <B>.backup</B> の拡張子を自動的に追加します。たとえその拡張子が適切な場合であっても、拡張子を明示的にボリューム名に追加してはいけません。
<P>規則として、ボリューム名は収納するデータのタイプを示します。たとえば、すべてのユーザー・ボリューム名を <B>user</B>.<VAR>username</VAR>
(<VAR>username</VAR> はユーザーのログイン名) とすることは規則です。同様に、多くのセルはシステム・タイプ・コードから開始する名前を持つボリュームにシステム・バイナリーを入れることを選択します。その他の命名規則のリストについては、
<A HREF="auagd007.htm#HDRWQ45">管理を簡単にするためのボリュームの作成</A> を参照してください。
<A NAME="IDX6456"></A>
<A NAME="IDX6457"></A>
<HR><H2><A NAME="HDRWQ271" HREF="auagd002.htm#ToC_211">読み取り / 書き込みボリュームの作成</A></H2>
<A NAME="IDX6458"></A>
<A NAME="IDX6459"></A>
<A NAME="IDX6460"></A>
<P>読み取り / 書き込みボリュームは、最も基本的なボリューム・タイプです。読み取り専用またはバックアップ・バージョンを作成するには、このボリュームがすでに存在していなければなりません。
<B>vos create</B>コマンドを発行して読み取り / 書き込みボリュームを作成したら、
VL サーバーはボリューム用の VLDB 項目を作成します。この項目では、ユーザーが指定する名前を記録し、読み取り / 書き込みボリューム ID番号を割り当て、次の 2 つの連続するボリューム ID 番号を、後に作成される可能性のある読み取り専用およびバックアップの各バージョン用に予約します。同時に、ボリューム・サーバーは、ユーザーが指示するサイトにボリューム・ヘッダーを作成し、ボリュームのルート・ディレクトリーの名前を記録するためにディスク上にスペースを割り振ります。ボリュームを取り付けるために <B>fs mkmount</B> コマンドを発行したら、その名前が埋められます。この名前はマウント・ポイント名と一致します。ボリューム・ヘッダーには、以下のものも記録されます。
<UL>
<LI>ボリュームのルート・ディレクトリーに関連付けられた初期の ACL。デフォルトでは、その ACL は、7 つの AFS アクセス権すべてを
<B>system:administrators</B> グループに許可します。ボリュームを取り付けたら、<B>fs setacl</B> コマンドを使用して、
<B>system:administrators</B> グループの他の項目の追加および項目の削除または変更を行うことができます。<A HREF="auagd020.htm#HDRWQ789">ACL 項目の設定</A>を参照してください。
<A NAME="IDX6461"></A>
<A NAME="IDX6462"></A>
</LI><LI>ボリュームがファイル・サーバー・パーティション上で使用できるディスク・スペースの量を制限するスペース割り当て量。デフォルトは 5000 K バイト・ブロックですが、<B>-maxquota</B> 引き数から <B>vos create</B> コマンドを使用して、異なる割り当て量を設定することができます。
<P>
<P>作成後に割り当て量を変更するには、<A HREF="#HDRWQ320">ボリューム割り当て量および現行サイズの設定および表示</A> で説明する
<B>fs setquota</B> コマンドを使用します。
<A NAME="IDX6463"></A>
<A NAME="IDX6464"></A>
</LI></UL>
<P><H3><A NAME="Header_212" HREF="auagd002.htm#ToC_212">読み取り / 書き込みボリュームの作成 (取り付け)</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>ボリュームを取り付ける予定のディレクトリーの ACL 上に <B>a</B> (<B>管理</B>)、
<B>i</B> (<B>挿入</B>)、および <B>l</B> (<B>ルックアップ</B>) アクセス権があることを検証します。必要に応じて、<B>fs listacl</B> コマンドを発行します。これについては、<A HREF="auagd020.htm#HDRWQ788">ACL の表示</A> で詳しく説明しています。
<P>
<PRE>   % <B>fs listacl</B> [&lt;<VAR>dir/file path</VAR>>]
</PRE>
<P>
<P><B>system:administrators</B> グループのメンバーは、<B>a</B> (<B>管理</B>)、および、デフォルトで <B>l</B> (<B>検索</B>) アクセス権を、常にすべての ACL に暗黙的に持っています。また、必要に応じて <B>fs setacl</B> コマンドを使用して、他の権限を付与することができます。
<A NAME="IDX6465"></A>
<A NAME="IDX6466"></A>
</LI><LI><A NAME="LIWQ272"></A>新規ボリュームに対してサイト (ファイル・サーバー・マシン上のディスク・パーティション) を選択します。サイトがボリュームを格納するのに十分な空きスペースがあることを検証するには (現在、または割り当て量全体を使用するほど成長した場合) 、
<B>vos partinfo</B> コマンドを発行します。
<P>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">このコマンドの出力に含まれる区画関連の統計は、標準 UNIX の <B>df</B> コマンドの出力に含まれる対応する値と常に一致するとは限りません。キャッシュ・マネージャーは 5 分間隔でファイル・マネージャーをポーリングして区画情報を得るので、このコマンドによって報告される統計は 5 分前のものである可能性があります。また、オペレーティング・システムによっては、<B>df</B> コマンドの区画サイズ報告には、このコマンドによる計算には含まれない予約済みのスペースが含まれるので、約 10% 大きくなることがあります。
</TD></TR></TABLE>
<P>
<PRE>   % <B>vos partinfo</B> &lt;<VAR>machine name</VAR>> [&lt;<VAR>partition name</VAR>>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>p
</B><DD>は、<B>partinfo</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>区画サイズおよび使用量を表示するファイル・サーバー・マシンを指定します。
<P><DT><B><VAR>partition name</VAR>
</B><DD>区画サイズおよび使用量を表示するパーティションの名前です。これを省略すると、出力はマシンのすべてのパーティションで使用可能なサイズおよびスペースを表示します。
</DL>
</LI><LI><A NAME="LIWQ273"></A><A HREF="#HDRWQ270">ボリューム名について</A> を参照してボリューム名を選択します。
<A NAME="IDX6467"></A>
<A NAME="IDX6468"></A>
</LI><LI><A NAME="LIWQ274"></A><B>vos create</B> コマンドを発行して、ボリュームを作成します。
<P>
<PRE>   
   % <B>vos create</B> &lt;<VAR>machine name</VAR>> &lt;<VAR>partition name</VAR>> &lt;<VAR>volume name</VAR>>  \
                [<B>-maxquota</B> &lt;<VAR>initial quota (KB)</VAR>>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>cr
</B><DD><B>create</B> の受け入れ可能な最も短い省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>ボリュームを配置するファイル・サーバー・マシンを指定します。
<P><DT><B><VAR>partition name</VAR>
</B><DD>ボリュームを配置するディスク・パーティションを指定します。
<P><DT><B><VAR>volume name</VAR>
</B><DD>ボリューム名。長さは 22 文字の英数字および句読文字までとします。セルには、ユーザー名がストリング <B>user</B> で始まる、または名前の部分を分離させるのにピリオドを使用するといった、ボリュームの命名規則がある場合があります。
<P><DT><B>-maxquota
</B><DD>ボリュームの割り当て量を K バイト・ブロックの数として設定します。この引き数を省略すると、割り当て量は 5000 K バイト・ブロックに設定されます。
</DL>
<A NAME="IDX6469"></A>
<A NAME="IDX6470"></A>
<A NAME="IDX6471"></A>
<A NAME="IDX6472"></A>
</LI><LI><A NAME="LIWQ275"></A><B> (オプション)</B> <B>fs mkmount</B> コマンドを発行して、ボリュームをファイル・スペースに取り付けます。完全な構文は、<A HREF="#HDRWQ298">正規または読み取り / 書き込みの各マウント・ポイントの作成</A> を参照してください。
<P>
<PRE>   
   % <B>fs mkmount</B> &lt;<VAR>directory</VAR>> &lt;<VAR>volume name</VAR>> 
   
</PRE>
</LI><LI><B>(オプション)</B> <B>fs lsmount</B> コマンドを発行して、マウント・ポイントが正しいボリュームを参照しているか検証します。詳細な説明が <A HREF="#HDRWQ297">マウント・ポイントの表示方法</A> に示されています。
<P>
<PRE>   
   % <B>fs lsmount</B> &lt;<VAR>directory</VAR>>
   
</PRE>
</LI><LI><B>(オプション)</B>。<B>fs setvol</B> コマンドを、<B>-offlinemsg</B> 引き数を併用して発行し、ボリューム・ヘッダー内のボリュームに関する補助情報を記録します。たとえば、ボリュームの所有者またはファイル・スペース内の取り付け場所を記録することができます。この情報を表示するには、<B>fs examine</B> コマンドを使用します。
<P>
<PRE>   % <B>fs setvol</B> &lt;<VAR>dir/file path</VAR>> <B>-offlinemsg</B> &lt;<VAR>offline message</VAR>>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>sv
</B><DD>は、<B>setvol</B> の受け入れ可能な別名です
(<B>setv</B> は受け入れ可能な最も短い省略形です)。
<P><DT><B><VAR>dir/file path</VAR>
</B><DD>メッセージに関連するボリュームのマウント・ポイントを指定します。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。
<P>
<P>マウント・ポイントへの読み取り / 書き込みパスを指定し、読み取りボリュームの変更時に生じる障害を回避してください。通例、読み取り / 書き込みパスを指定するには、パス名の第 2 レベルのセル名の前にピリオドを挿入します (たとえば <B>/afs/.abc.com</B>)。ファイル・スペースにおける読み取り / 書き込みおよび読み取り専用パスの概念の詳細は、<A HREF="#HDRWQ295">マウント・ポイント横断の規則</A> を参照してください。
<P><DT><B>-offlinemsg
</B><DD>ボリューム・ヘッダーに記録する補助情報を、最大 128 文字まで指定します。
</DL>
</LI></OL>
<HR><H2><A NAME="HDRWQ276" HREF="auagd002.htm#ToC_213">複製について</A></H2>
<A NAME="IDX6473"></A>
<A NAME="IDX6474"></A>
<A NAME="IDX6475"></A>
<A NAME="IDX6476"></A>
<P>バックアップまたは読み取り専用のボリュームを作成するには、ボリューム・サーバーは、まず、読み取り / 書き込みソース・ファイルを <I>複製して</I>、
<I>複製</I> を作成します。ボリューム・サーバーは、ユーザーが <B>vos backup</B> または <B>vos backupsys</B> の各コマンド (バックアップ・ボリューム用)、もしくは <B>vos release</B> コマンド (読み取り専用ボリューム用) を発行するときに自動的に複製を作成します。ユーザー側では特別な処置は必要ありません。
<P>複製は、読み取り / 書き込みソース・ボリューム内のデータのコピーではなく、読み取り / 書き込みボリュームの <I>vnode インデックス</I> のコピーです。
vnode インデックスは、ボリューム内のファイルおよびディレクトリーと、パーティション上でそのデータが常駐する物理ディスク・ブロックとの間のポインター表です。複製から、次の方法でバックアップおよび読み取り専用の各ボリュームが作成されます。
<UL>
<LI>読み取り / 書き込みソース (
<I>読み取り専用複製</I>とも呼ばれる) と同じパーティションを使用する読み取り専用ボリューム、およびバックアップ・ボリュームは、ボリューム・ヘッダーを複製へ付加することによって作成されます。これらのボリュームは、複製部分 (vnode 索引) が読み取り / 書き込みボリュームと全く同じファイルを指しているために、最初はほとんどディスク・スペースを消費しません。詳細は、<A HREF="#FIGWQ277">図 1</A> を参照してください。読み取り / 書き込みソース・ボリュームと同じパーティションに複製があれば、ファイル共用が可能です。読み取り / 書き込みボリューム内のファイルが削除される場合、バックアップまたは読み取り専用の複製がまだそれを指しているため、読み取り / 書き込みボリュームはパーティションから実際には除去されません。同じように、読み取り / 書き込みボリューム内のファイルが変更される場合、複製がまだそれを指しているため元のファイル全体がディスク上に保存されます。そして、読み取り / 書き込みボリュームの vnode 索引は、変更済みファイルの新規スペースを指すように変更されます。これが実行されると、増大して実ディスク・スペースを使用するように、バックアップまたは読み取り専用のボリュームに指示されます。
</LI><LI>読み取り / 書き込みソースと同じサイトを使用しない読み取り専用ボリュームは、複製および読み取り / 書き込みソース・ボリューム内のすべてのデータのコピーです。これは、読み取り専用ボリュームが作成された時点で読み取り / 書き込みボリュームが行ったディスク・スペースと同じ量を使用します。
</LI></UL>
<P><B><A NAME="FIGWQ277" HREF="auagd003.htm#FT_FIGWQ277">図 1. 読み取り / 書き込みソースと複製ボリュームとの間のファイル共用</A></B><BR>
<TABLE BORDER ><TR><TD><BR>
<B><BR><IMG SRC="vnode.gif" ALT="読み取り / 書き込みソースと複製ボリュームとの間のファイル共用"><BR></B><BR>
</TD></TR></TABLE>
<A NAME="IDX6477"></A>
<A NAME="IDX6478"></A>
<A NAME="IDX6479"></A>
<A NAME="IDX6480"></A>
<A NAME="IDX6481"></A>
<A NAME="IDX6482"></A>
<A NAME="IDX6483"></A>
<HR><H2><A NAME="HDRWQ278" HREF="auagd002.htm#ToC_214">ボリュームの複写 (読み取り専用ボリュームの作成)</A></H2>
<P><I>複写</I>とは、読み取り / 書き込みボリュームの読み取り専用コピーを作成し、そのコピーを 1 つまたは複数の追加のファイル・サーバー・マシンへ配布するということを指します。複写によって、ボリュームの内容が複数のファイル・サーバー・マシン上でアクセス可能になるため、データ使用可能性が向上します。また、ネットワーク上およびファイル・サーバー上でロードを削減することによってシステム効率性が上がります。クライアント・マシンのサーバー設定の変更ランクにより、キャッシュ・マネージャーが、最も近いファイル・サーバー・マシン上に保管されたボリュームのコピーにアクセスする場合、ネットワーク・ロードは削減されます。読み取り / 書き込みボリュームから取り出されたファイルごとに 1 つのコールバックを発するのとは異なり、ファイル・サーバーは、読み取り専用ボリュームから取り出されたすべてのデータにただ 1 つのコールバックを発するため、ファイル・サーバー上のロードは削減されます。ボリュームは管理者の処置に応答する場合以外は変更されないため、単一のコールバックは読み取り専用ボリューム全体にとって重要です。それに対して、それぞれの読み取り / 書き込みファイルは任意の時間に変更される可能性があります。
<A NAME="IDX6484"></A>
<A NAME="IDX6485"></A>
<A NAME="IDX6486"></A>
<A NAME="IDX6487"></A>
<A NAME="IDX6488"></A>
<P>ボリュームを複写するには、2 つのコマンドを発行する必要があります。最初に、<B>vos addsite</B> コマンドを使用して、
1 つまたは複数の読み取り専用サイト定義をボリュームの VLDB 項目へ追加します
(<I>サイト</I>は、ファイル・サーバー・マシン上の特定部分です)。次に、<B>vos release</B> コマンドを発行して、読み取り / 書き込みソース・ボリュームの複製を作成し、定義されたサイトに複製を配布します。読み取り専用サイトに対して 1 度だけ <B>vos addsite</B> を発行しますが、読み取り / 書き込みボリューム内容が変更されたために読み取り専用ボリュームを更新したいときは、その都度、<B>vos release</B> コマンドを再発行しなければなりません。
<P>ファイル・システムの一貫したビューを表示するには、読み取り専用サイトへ更新したボリューム内容のリリースがアトミックでなければなりません。つまり、すべての読み取り専用サイトがボリュームの新規バージョンを受け取るか、すべてのサイトが現在保持するバージョンを維持する必要があります。
<B>vos release</B> コマンドは、ボリュームの読み取り専用バージョンのすべてのコピーがお互いに一致し、かつ、読み取り / 書き込みソースと一致することを保証するように設計されています。マシンまたはサーバーのプロセス停止などの問題によってリリース操作が正常に完了しない場合は、
AFS は 2 つのマシンを使用してユーザーに警告を出します。
<A NAME="IDX6489"></A>
<A NAME="IDX6490"></A>
<A NAME="IDX6491"></A>
<A NAME="IDX6492"></A>
<A NAME="IDX6493"></A>
<A NAME="IDX6494"></A>
<A NAME="IDX6495"></A>
<A NAME="IDX6496"></A>
<A NAME="IDX6497"></A>
<A NAME="IDX6498"></A>
<A NAME="IDX6499"></A>
<A NAME="IDX6500"></A>
<A NAME="IDX6501"></A>
<A NAME="IDX6502"></A>
<P>最初に、コマンド・インタープリターは、新規ボリューム・バージョンを受け取らなかったそれぞれの読み取り専用サイトを指名している標準エラー・ストリーム上で、エラー・メッセージを生成します。次に、リリース操作中に、ボリューム・ロケーション (VL)・サーバーは、サイトが新規ボリューム・バージョンを持っているかどうかを示すフラグ (<TT>New release</TT> および <TT>Old release</TT>) を使用して、
VLDB 項目内のサイト定義をマークします。操作が完了してもフラグが残される場合は、成功しなかったということです。キャッシュ・マネージャーは、<TT>Old release</TT> フラグでマークされた読み取り専用サイトにアクセスすることを拒否します。このフラグは、<TT>New release</TT> フラグでマークされたサイトよりも大きなロードが必要になる可能性があるためです。失敗の原因を調査して取り除き、エラーなしでリリースを完了するために、必要なだけ何度でも <B>vos release</B> コマンドを発行することが大切です。
<P>失敗したリリース操作の後にボリュームの VLDB 項目内に残されるサイト・フラグのパターンは、操作が失敗したポイントを決定する助けとなります。
VLDB 項目を表示するには、<B>vos examine</B> または <B>vos listvldb</B> コマンドを使用します。
VL サーバーは、ボリューム・サーバーの操作と調和して、以下のようにフラグを設定します。
<OL TYPE=1>
<LI>操作が始まる前に、VL サーバーは、VLDB 項目内の読み取り / 書き込みサイトの定義上に <TT>New release</TT> フラグを、読み取り専用サイトの定義上には <TT>Old release</TT> フラグを設定します (最後のリリース操作以来、読み取り専用サイトが定義されておらず実ボリュームがない場合、そのサイト・フラグは <TT>Not released</TT> になります)。
</LI><LI>必要ならば、ボリューム・サーバーは、ReleaseClone と呼ばれる読み取り / 書き込みソースの一時的なコピー (<I>複製</I>) を作成します (ボリューム・サーバーが新規の ReleaseClone を作成または作成しない場合の説明は、以下を参照してください)。そして、ReleaseClone に独自のボリューム ID 番号を割り当てます。この番号は、VL サーバーがソース・ボリュームの VLDB 項目の <TT>RClone</TT>フィールドに記録します。
</LI><LI>ボリューム・サーバーは、VLDB 項目で定義されたそれぞれの読み取り専用サイトへ ReleaseClone のコピーを配布します。サイトが正常に新規複製を受け取ったら、VL サーバーは VLDB 項目内のサイトのフラグを <TT>New release</TT> に設定します。
</LI><LI>すべての読み取り専用コピーが正常にリリースされたら、VL サーバーは、すべての <TT>New release</TT> サイト・フラグを消去します。
ReleaseClone は必要なくなるため、ボリューム・サーバーはこれを削除し、その ID を VLDB 項目から消去します。
</LI></OL>
<P>デフォルトでは、ボリューム・サーバーは、新規の ReleaseClone を作成する必要があるかどうかを、以下のように自動的に判別します。
<UL>
<LI>VLDB 項目内のサイト定義上にフラグ (<TT>New release</TT>、<TT>Old release</TT>、または <TT>Not released</TT>) がない場合は、直前の <B>vos release</B> コマンドは正常に完了し、すべての読み取り専用サイトが現在同じボリュームを持っています。ボリューム・サーバーは、読み取り / 書き込みボリュームが変更されたために、現行の <B>vos release</B> コマンドが発行されたと推論します。ボリューム・サーバーは新規の ReleaseClone を作成し、すべての読み取り専用サイトへそれを配布します。
</LI><LI>VLDB 項目内の任意のサイト定義がフラグでマークされている場合は、直前のリリース操作が正常に完了しなかったか、または最後のリリース以来新規の読み取り専用サイトが定義されていたかのどちらかを意味します。この場合、ボリューム・サーバーは新規の ReleaseClone を作成しません。その代わりに、既存の ReleaseClone を <TT>Old release</TT> または <TT>Not released</TT> フラグでマークされたサイトへ配布します。既に述べたとおり、VL サーバーは、サイトが ReleaseClone を受け取ったら、それぞれの VLDB サイト定義を <TT>New release</TT> フラグでマークします。そして、すべてのサイトが正常にそれを受け取ったら、すべてのフラグを消去します。
</LI></UL>
<P>デフォルトの動作を上書きして、ボリューム・サーバーに強制的に新規の ReleaseClone を作成させ、読み取り専用サイトへリリースさせるには、<B>-f</B> フラグを組み込みます。これは、たとえば、直前の操作で既存の ReleaseClone が作成されてから、読み取り / 書き込みサイトのデータが変更された場合などに適します。
<P><H3><A NAME="HDRWQ279" HREF="auagd002.htm#ToC_215">効果的な読み取り専用ボリュームの使用</A></H3>
<A NAME="IDX6503"></A>
<A NAME="IDX6504"></A>
<A NAME="IDX6505"></A>
<A NAME="IDX6506"></A>
<P>最も効率を高めるためには、以下の 2 つの基準を満たすボリュームのみを複製します。
<UL>
<LI>内容が頻繁に使用されているボリューム。たとえば、テキスト・エディターまたはその他のアプリケーション・プログラム用のバイナリー・ファイルを収納するボリューム、およびユーザーのホーム・ディレクトリーへ導くパスなどの、頻繁に横断があるディレクトリー・パスに沿って取り付けたボリュームなどです。単一のファイル・サーバーで簡単にすべての要求に応じられるくらい要求が少ないボリュームを複製することは、ディスク・スペースを非効率に使用することになります。
</LI><LI>内容が頻繁に変更されないボリューム。すでに述べたとおり、ファイル・システムが一貫性を保つには、読み取り専用ボリュームの内容がお互いに一致し、かつ、それらの読み取り / 書き込みソースと一致する必要があります。読み取り / 書き込みボリュームが変更されるたびに、
<B>vos release</B> コマンドを使用して読み取り専用ボリュームを更新する必要があります。このように、読み取り / 書き込みボリュームが頻繁に変更される場合には、時間がかかり、また忘れやすくなります。
</LI></UL>
<A NAME="IDX6507"></A>
<A NAME="IDX6508"></A>
<P>明示的に読み取り専用ボリュームを取り付ける (<B>.readonly</B> 拡張子の付いたボリュームのマウント・ポイントを作成する) ことは、普通は不要であり適当ではありません。キャッシュ・マネージャーには、可能な場合にいつでも複製したボリュームの読み取り専用バージョンにアクセスできる組み込まれたバイアスがあります。
<A HREF="#HDRWQ295">マウント・ポイント横断の規則</A> で説明するとおり、キャッシュ・マネージャーはマウント・ポイントに出会うとその中のボリューム名を読み取り、そのボリュームを収納するサイトのリストを求めて VL サーバーと交信します。通常、マウント・ポイントが読み取り専用ボリューム内に常駐し読み取り / 書き込みボリュームを指定すると
(<B>.readonly</B> または <B>.backup</B> の拡張子の付かない名前)、キャッシュ・マネージャーは常に、そのボリュームの読み取り専用コピーにアクセスしようと試みます。このため、普通、読み取り専用ボリュームにアクセスするために、キャッシュ・マネージャーを明示的にそのボリュームを取り付けるよう強制しなければならない理由はありません。
<P>次にあげるいくつかの理由で、読み取り専用ボリュームを読み取り / 書き込みサイトに配置することは有益です。まず、読み取り / 書き込みサイトの読み取り専用ボリュームは、すべてのデータのコピーではなく 1 つの複製であるため、ディスク・スペースを少ししか必要としません
(<A HREF="#HDRWQ276">複製について</A> を参照)。読み取り / 書き込みボリューム内で多数のファイルが削除され変更された場合にのみ、読み取り専用コピーは多くのディスク・スペースをとります。しかし、複写した読み取り / 書き込みボリューム内に変更を行う場合は、それを再複製することが適切な処置であるため、こういうケースはあまり起こりません。読み取り専用ボリュームを読み取り / 書き込みサイトに配置するもう 1 つの理由は、すべての読み取り専用コピーがアクセス不能になった場合に、キャッシュ・マネージャーは、複写したボリュームの読み取り / 書き込みバージョンにアクセスしようと試みないからです。読み取り / 書き込みボリュームを収納しているファイル・サーバー・マシンが唯一のアクセス可能マシンである場合、キャッシュ・マネージャーは、読み取り / 書き込みサイトに読み取り専用コピーがある場合にのみ、データにアクセスすることができます。
<P>定義する読み取り専用サイト数は、いくつかの要因によって決まります。おそらく、主なトレードオフは、ボリューム内容の要求レベルと、ボリュームの複数のコピー用に使用しようとしているディスク・スペースの量との間にあります。もちろん、定義しようとする読み取り専用サイトにはそれぞれ、ボリュームを収納するために使用できる十分なスペースがなければなりません。ボリュームの読み取り専用コピーの制限数は、
<I>AFS Release Notes</I> で定義されるボリュームの VLDB 項目内のサイト定義最大数によって決まります。ボリュームの読み取り / 書き込みおよびバックアップのバージョンを収容するサイトは 1 つのサイトとして数えられ、読み取り専用サイトはそれぞれが追加のサイトとして数えられます
(読み取り / 書き込みサイトと同じファイル・サーバー・マシンおよびパーティション上に定義された読み取り専用サイトでも別々のサイトとして数えます)。また、ボリューム・サーバーは、ファイル・サーバー・マシンごとにボリュームの読み取り専用コピーを 1 つしか許可しないということに注意してください。
<P><H3><A NAME="Header_216" HREF="auagd002.htm#ToC_216">複写シナリオ</A></H3>
<A NAME="IDX6509"></A>
<A NAME="IDX6510"></A>
<A NAME="IDX6511"></A>
<P>次のセクションでは、読み取り専用サイトが現在定義されていないボリュームを複写する方法について説明します。しかし、その他の共通な場合にもこの説明を使用できます。
<UL>
<LI>新規の複製をすでに存在するサイトへリリースする場合、
<A HREF="#LIWQ282">2</A> のステップをスキップしても構いません。スキップしても <B>vos examine</B> コマンドを発行することは有益ですが、希望する読み取り専用サイトが定義されていることを確かめるようにしてください。
</LI><LI>新規の読み取り専用サイトを既存のサイトに追加する場合は、すべてのステップを実行してください。<A HREF="#LIWQ283">3</A> のステップでは、新規のサイトにのみ <B>vos addsite</B> コマンドを発行します。
</LI><LI>サイトを定義しても複製のリリースは行いたくない場合、
<A HREF="#LIWQ283">3</A> のステップの後に停止して、準備が整えば継続します。
</LI><LI>残りのサイトに新規の複製をリリースする前に 1 つ以上のサイトを除去する場合、
<A HREF="#HDRWQ321">ボリュームおよびそのマウント・ポイントの除去</A> のサイトの除去についての指示に従い、
<A HREF="#LIWQ284">4</A> のステップから開始します。
</LI></UL>
<P><H3><A NAME="HDRWQ280" HREF="auagd002.htm#ToC_217">読み取り / 書き込みボリュームの複写 (読み取り専用ボリュームの作成)</A></H3>
<A NAME="IDX6512"></A>
<A NAME="IDX6513"></A>
<OL TYPE=1>
<LI><A NAME="LIWQ281"></A>ユーザーが、<B>/usr/afs/etc/UserList</B>ファイルにリストされているかどうかを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><A NAME="LIWQ282"></A>ボリュームを複写する 1 つまたは複数のサイトを選択します。以下に示すとおり、考慮すべきいくつかの要因があります。
<UL>
<LI>すでに定義しているサイト数。既述のとおり、通常は読み取り / 書き込みサイトにおいて読み取り専用サイトを定義することが適切です。また、ボリューム・サーバーは、ファイル・サーバー・マシンごとにボリュームの読み取り専用コピーを 1 つしか許可しないということに注意してください。ボリュームの現行サイトを表示するには、
<B>vos examine</B> コマンドを発行します。これについては、
<A HREF="#HDRWQ307">1 つのボリュームの VLDB 項目およびボリューム・ヘッダーの表示</A> で詳しく説明されています。
<P>
<PRE>   
   % <B>vos examine</B> &lt;<VAR>volume name or ID</VAR>>
    
</PRE>
<P>
<P>出力の最終行は、VLDB からのボリュームのサイト定義を表示します。
</LI><LI>セル内の任意のファイル・サーバー・マシンを、読み取り専用ボリュームのみを収容するためのものにするかどうか。一般的に、非常に大きなセルのみがこのようなサーバー・マシンを使用します。
</LI><LI>ボリュームを収容するだけの十分な空きスペースがサイトにあるかどうか。読み取り専用ボリュームは、読み取り / 書き込みバージョンと同じ量のスペースを必要とします (読み取り専用ボリュームが読み取り / 書き込みサイトにない場合)。
<B>vos examine</B> コマンドによる最初の出力行では、読み取り / 書き込みボリュームの現行サイズを K バイト・ブロック単位で示します。出力例は <A HREF="#HDRWQ307">1 つのボリュームの VLDB 項目およびボリューム・ヘッダーの表示</A> に示されています。
<P>
<P>ファイル・サーバー・マシンのパーティション上で使用可能なスペース容量を表示するには、
<B>vos partinfo</B> コマンドを使用します。このコマンドの完全な説明は、<A HREF="#HDRWQ271">読み取り / 書き込みボリュームの作成</A> を参照してください。
<P>
<PRE>   
   % <B>vos partinfo</B> &lt;<VAR>machine name</VAR>> [&lt;<VAR>partition name</VAR>>]
   
</PRE>
</LI></UL>
<A NAME="IDX6514"></A>
<A NAME="IDX6515"></A>
<A NAME="IDX6516"></A>
<A NAME="IDX6517"></A>
<A NAME="IDX6518"></A>
<A NAME="IDX6519"></A>
</LI><LI><A NAME="LIWQ283"></A><B>vos addsite</B> コマンドを発行して、
VLDB 内にそれぞれ新規の読み取り専用サイトを定義します。
<P>
<PRE>   
   % <B>vos addsite</B> &lt;<VAR>machine name</VAR>> &lt;<VAR>partition name</VAR>> &lt;<VAR>volume name or ID</VAR>>
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>ad
</B><DD>は、<B>addsite</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>新規のサイトに対するファイル・サーバー・マシンを定義します。
<P><DT><B><VAR>partition name</VAR>
</B><DD>マシン <VAR>machine name</VAR> 上のディスク・パーティションの名前です。
<P><DT><B><VAR>volume name or ID</VAR>
</B><DD>複写する読み取り / 書き込みボリュームを、その完全名またはボリューム ID 番号によって識別します。
</DL>
</LI><LI><A NAME="LIWQ284"></A><B>(オプション)</B>
<B>fs</B> プロセス (ボリューム・サーバーに組み込み) が、読み取り専用サイトを定義したそれぞれのファイル・サーバー・マシン上で正常に機能しているかどうか、および <B>vlserver</B> プロセス (ボリューム・ロケーション・サーバー)
が各データベース・サーバー・マシン上で正しく機能しているかどうかを検査します。これらが機能していることが認識されると、リリースの失敗を引き起こす可能性がある 2 つの要因が除かれます。このボリューム用の読み取り専用サイトを収容する各ファイル・サーバー・マシン上、および各データベース・サーバー・マシン上で <B>bos status</B> コマンドを発行します。このコマンドについての詳細は、<A HREF="auagd009.htm#HDRWQ205">BosConfig ファイルのプロセス状況および情報の表示</A> を参照してください。
<P>
<PRE>   
   % <B>bos status</B> &lt;<VAR>machine name</VAR>> <B>fs vlserver</B>
   
</PRE>
<A NAME="IDX6520"></A>
<A NAME="IDX6521"></A>
<A NAME="IDX6522"></A>
<A NAME="IDX6523"></A>
</LI><LI><A NAME="LIWQ285"></A><B>vos release</B> コマンドを発行して、読み取り / 書き込みソース・ボリュームを複製し、それぞれの読み取り専用サイトへ複製を配布します。
<P>
<PRE>   
   % <B>vos release</B> &lt;<VAR>volume name or ID</VAR>> [<B>-f</B>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>rel
</B><DD>は、<B>release</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>volume name or ID</VAR>
</B><DD>複製する読み取り / 書き込みボリュームを、その完全名またはボリューム ID 番号によって識別します。読み取り専用バージョンは、
<B>.readonly</B> 拡張子が付いた同じ名前が付きます。すべての読み取り専用コピーは、同じ読み取り専用ボリューム ID 番号を共用します。
<P><DT><B>-f
</B><DD>完全に新規の複製を作成しリリースします。
</DL>
</LI><LI><A NAME="LIWQ286"></A><B>(オプション)</B>
<B>vos examine</B> コマンドを発行して、VLDB 項目内のサイト定義が、
<TT>Old release</TT> または <TT>New release</TT> のフラグでマークされていないことを検査します。このコマンドについての詳細は、<A HREF="#HDRWQ307">1 つのボリュームの VLDB 項目およびボリューム・ヘッダーの表示</A> を参照してください
<P>
<PRE>   
   % <B>vos examine</B> &lt;<VAR>volume name or ID</VAR>>
   
</PRE>
</LI></OL>
<P><A HREF="#LIWQ286">6</A> のステップからの出力にフラグが表示される場合、ボリューム・サーバーがリリース操作中にエラー・メッセージを出さなくなり、フラグが表示されなくなるまで、
<A HREF="#LIWQ284">4</A> のステップおよび <A HREF="#LIWQ285">5</A> を繰り返します。ネットワーク、マシン、またはサーバー・プロセス障害のために、読み取り / 書き込みサイトまたは読み取り専用サイトがアクセス不能だと分かっている場合には、
<B>vos release</B> コマンドを発行しないでください。
<HR><H2><A NAME="HDRWQ287" HREF="auagd002.htm#ToC_218">バックアップ・ボリュームの作成</A></H2>
<A NAME="IDX6524"></A>
<A NAME="IDX6525"></A>
<A NAME="IDX6526"></A>
<A NAME="IDX6527"></A>
<A NAME="IDX6528"></A>
<P><I>バックアップ・ボリューム</I>は、読み取り / 書き込みソースと同じサイトに常駐する複製です (複製の概念については、
<A HREF="#HDRWQ276">複製について</A> を参照)。ボリュームのバックアップ・バージョンを作成することには、次の 2 つの目的があります。
<UL>
<LI>規則では、AFS バックアップ・システムを使用してテープに記録するために、ボリューム内容をダンプすることが最初のステップです。ダンプ処理中には、ボリュームにアクセスできません。したがって、読み取り / 書き込みボリュームをダンプするのではなく、バックアップ・バージョンを作成してそれをダンプします。通常、ユーザーはバックアップ・バージョンにアクセスしないため、ダンプによって妨害されることはありません。詳しくは、<A HREF="auagd012.htm#HDRWQ412">データのバックアップ</A> を参照してください。
</LI><LI>誤って削除または変更してしまったデータ自体を復元することができるため、より重要なタスクが処理できるようになります。バックアップ・バージョンは、バックアップ作成時の読み取り / 書き込みソースの状態を取り込み、その内容を変更することはできません。バックアップ作成時の状態にファイルを復元することができるように、ファイル・スペースにバックアップ・バージョンを取り付けます。詳細は、<A HREF="#HDRWQ290">ユーザーが使用可能なバックアップ・ボリューム</A>を参照してください。
</LI></UL>
<A NAME="IDX6529"></A>
<A NAME="IDX6530"></A>
<A NAME="IDX6531"></A>
<P><H3><A NAME="HDRWQ288" HREF="auagd002.htm#ToC_219">複数のボリュームを同時にバックアップする</A></H3>
<P><B>vos backupsys</B> コマンドにより、多数の読み取り / 書き込みボリュームのバックアップ・バージョンが一度に作成できます。このコマンドは、
AFS バックアップ・システムを使用してテープに記録する大規模なバックアップを準備する場合に役立ちます。
<P>VLDB にリストされた読み取り / 書き込みボリュームを複製するには、すべてのコマンド・オプションを省略してください。また、さまざまなグループのボリュームを複製するには、コマンド・オプションを結合してください。オプションでは、ボリュームを選択するために 2 つある基本的基準のうちの 1 つを使用します。つまり、ロケーション
(<B>-server</B> および <B>-partition</B>引き数)、または指定文字ストリングのセットのうちの 1 つの指定文字ストリングによるボリューム名の表示
(<B>-prefix</B>、<B>-exclude</B>、および <B>-xprefix</B> オプション)です。
<P>1 つのファイル・サーバー・マシン上にあるボリュームのみを複製するには、<B>-server</B> 引き数を組み込みます。1 つのパーティション上にあるボリュームのみを複製するには、<B>-server</B> および <B>-partition</B> 引き数を組み合わせます。また、<B>-partition</B> 引き数だけを使用して、すべてのファイル・サーバー・マシン上の指示されたパーティションに常駐するボリュームを複製することもできます。これらの引き数は、名前に基づいてボリュームを選択する引き数と結合することができます。
<P>名前に含まれる文字ストリングに基づいてボリュームを選択するには、以下に指示する方法で <B>-prefix</B>、
<B>-exclude</B>、および <B>-xprefix</B> の各オプション
(<B>-server</B> および
<B>-partition</B> 引き数を使用または不使用) を結合します。
<UL>
<LI>指定した文字ストリング (<B>user.</B> で始まる、または <B>afs</B> を含むなど)のセットのうちの 1 つが名前に含まれているすべての読み取り / 書き込みボリュームを指定ロケーションで複製する場合は、<B>-prefix</B> 引き数を使用、または <B>-xprefix</B> および <B>-exclude</B>オプションを結合します。
</LI><LI>指定した文字ストリングのセットのうちの 1 つが名前に含まれていないすべての読み取り / 書き込みボリュームを指定ロケーションで複製するには、
<B>-xprefix</B> 引き数を使用、または <B>-prefix</B> および <B>-exclude</B> オプションを結合します。
</LI><LI>指定した文字ストリングのセットの 1 つが名前に含まれ、指定した文字ストリングとは異なるセットの 1 つが名前に含まれていないすべての読み取り / 書き込みボリュームを、指定した位置において複製するには、
<B>-prefix</B> および <B>-xprefix</B> 引き数を結合します。このコマンドにより、<B>-prefix</B> 引き数に一致するすべてのボリュームのリストが作成され、そのリストから <B>-xprefix</B> 引き数に一致するボリュームが取り除かれます。効果的な結果を得るには、<B>-xprefix</B> 引き数によって指定されるストリングが、
<B>-prefix</B> 引き数によって指定されるボリュームのサブセットを指定する必要があります。
<P>
<P><B>-exclude</B> フラグが <B>-prefix</B> および <B>-xprefix</B> 引き数と結合する場合、コマンドは、<B>-prefix</B> 引き数と一致しないすべてのボリュームのリストを作成し、そのリストに <B>-xprefix</B> 引き数と一致するすべてのボリュームを追加します。
<B>-exclude</B> フラグが使用されていない場合、結果は、
<B>-xprefix</B> 引き数によって指定されるストリングが、
<B>-prefix</B> 引き数によって指定されるボリュームのサブセットを指定している場合にのみ有効です。
</LI></UL>
<P><B>-prefix</B> および <B>-xprefix</B> の引き数は両方とも、複数の値を受け入れます。これらの値は、互いに共通元を持たないボリュームのグループを定義するために使用できます。それぞれの値は、以下の 2 つのタイプのうちのいずれかです。
<OL TYPE=1>
<LI>簡単な文字ストリング。ストリングで始まる名前を持つボリュームと突き合わせます。すべての文字は、文字どおり解釈されます (つまり、ピリオドなど、コマンド・シェルへの特別な意味を持つ可能性のある文字は、文字どおりの意味しか持ちません）。
</LI><LI>正規の式。式を含む名前を持つボリュームと突き合わせます。式の先頭に脱字記号 ( <B>^</B> ) を置き、単一引用符 (<B>'</B> <B>'</B>) でストリング全体を囲みます。正規の式についての説明は、この解説ページの範囲外です。
UNIX 解説書ページの <B>regexp(5)</B> または (簡単な説明の場合は) <A HREF="auagd011.htm#HDRWQ365">ボリューム・セットおよびボリューム項目の定義および表示</A> を参照してください。たとえば、以下の式は、名前に <B>aix</B> を含むストリングを持つボリュームを見つける場合の例です。
<P>
<PRE>   <B>-prefix  '^.*aix'</B>
</PRE>
</LI></OL>
<P>実際には複製を行わずに、複製するボリュームのリストを表示するには、
<B>-dryrun</B> フラグを組み込みます。ボリューム選択の際に使用されている基準の要約文を表示するには、
<B>-verbose</B> フラグを組み込みます。
<P>単一のボリュームをバックアップするには、単一のボリュームを検索するためにさらに高い能率の技法を用いる <B>vos backup</B>コマンドを使用します。
<A NAME="IDX6532"></A>
<A NAME="IDX6533"></A>
<A NAME="IDX6534"></A>
<A NAME="IDX6535"></A>
<A NAME="IDX6536"></A>
<A NAME="IDX6537"></A>
<P><H3><A NAME="HDRWQ289" HREF="auagd002.htm#ToC_220">バックアップ・ボリュームを自動的に作成する</A></H3>
<P>ほとんどのセルにとって、関連ボリュームの新規のバックアップ・バージョンを毎日作成することが最適の方法です。バックアップ・バージョンの作成には、使用頻度が少ないときが最適です。これは、バックアップ操作によって、読み取り / 書き込みボリュームが一時的に使用不可になるためです。
<P>必要な <B>vos backupsys</B> または <B>vos backup</B> コマンドをコンソールで発行するか、ファイル・サーバー上の <B>BosConfig</B> ファイルに <B>cron</B> 項目を作成することができます。これによって、管理者はバックアップ操作を開始する必要がなくなります。
<P>次のコマンド例では、
<B>backupusers</B> という<B>cron</B> プロセスを、
<B>fs3.abc.com</B> マシン上の <B>/usr/afs/local/BosConfig</B> ファイルに作成します。このプロセスは、毎日午前 1 時に実行され、
<B>user</B> というストリングで始まる名前が付いたセルに、すべてのボリュームのバックアップ・バージョンが作成されます。
<B>-localauth</B> フラグによって、未認証でもプロセスは特権の
<B>vos backupsys</B> コマンドを呼び出すことができます。
<B>-cmd</B> 引き数には、
<B>vos</B> バイナリー用の完全なパス名を指定することに注意してください。これは、BOS サーバー (ローカルなスーパーユーザー <B>root</B> として稼働) の PATH 環境変数に、通常 AFS バイナリーへのパスが含まれないためです。
<PRE>   
   % <B>bos  create fs3.abc.com backupusers cron</B>  \
     <B>-cmd "/usr/afs/bin/vos backupsys  -prefix user -localauth" "1:00"</B>
    
</PRE>
<A NAME="IDX6538"></A>
<A NAME="IDX6539"></A>
<A NAME="IDX6540"></A>
<P><H3><A NAME="HDRWQ290" HREF="auagd002.htm#ToC_221">ユーザーが使用可能なバックアップ・ボリューム</A></H3>
<P>既述のとおり、バックアップ・ボリュームは、その作成時における読み取り / 書き込みソースの状態を保存します。多くのセルはバックアップ・ボリュームの取り付けを選択します。これによって、管理者からヘルプを要求しなくても、最終バックアップを作成してから誤って削除または変更したデータにもアクセスでき、それを復元することができます。ユーザー・ボリュームのバックアップ・バージョンを取り付ける最も正しい位置は、ユーザーのホーム・ディレクトリーのサブディレクトリーです。このディレクトリーに対する適切な名前は、<B>OldFiles</B> および <B>Backup</B> などです。サブディレクトリーは、バックアップが作成された時点で、同じ相対的位置にすべてのファイルおよびサブディレクトリーを持つユーザーのホーム・ディレクトリーのように見えます。
<P>ユーザーのバックアップ・ボリュームを作成して取り付ける場合、その存在をユーザーに知らせます。バックアップ・ボリュームを使用可能にするかどうかはオプションであるため、
<I>AFS 使用者の手引き</I> では、バックアップ・ボリュームについて記載していません。新規のバックアップを作成する頻度をユーザーに説明して、回復できる範囲が分かるようにします。また、バックアップ・ボリュームのデータが変更できないことについても念を押しておく必要があります。ただし、標準 UNIX <B>cp</B> コマンドを使用してデータをホーム・ボリュームにコピーして、そこで変更することは可能です。また、バックアップ・ボリュームのデータが、読み取り / 書き込みボリューム割り当て量に不利に作用したりしないことを、ユーザーに再度確認します。
<P><H3><A NAME="HDRWQ291" HREF="auagd002.htm#ToC_222">バックアップ・ボリュームの作成および取り付け</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>ボリュームを取り付けるディレクトリーの ACL 上に <B>挿入</B> (<B>i</B>) および <B>管理</B> (<B>a</B>) アクセス権があることを検証します。必要に応じて、<B>fs listacl</B> コマンドを発行します。これについては、<A HREF="auagd020.htm#HDRWQ788">ACL の表示</A> で詳しく説明しています。
<P>
<PRE>   % <B>fs listacl</B> [&lt;<VAR>dir/file path</VAR>>]
</PRE>
<P>
<P><B>system:administrators</B> グループのメンバーは、<B>a</B> (<B>管理</B>)、および、デフォルトで <B>l</B> (<B>検索</B>) アクセス権を、常にすべての ACL に暗黙的に持っています。また、必要に応じて <B>fs setacl</B> コマンドを使用して、他の権限を付与することができます。
<A NAME="IDX6541"></A>
<A NAME="IDX6542"></A>
</LI><LI><A NAME="LIWQ292"></A><B>vos backup</B> コマンドを発行して、読み取り / 書き込みボリュームのバックアップ・バージョンを作成します。表示されるメッセージが、バックアップ操作の成功を確認します。
<P>
<PRE>   
   % <B>vos backup</B> &lt;<VAR>volume name or ID</VAR>>
   Created backup volume for <VAR>volume name or ID</VAR>
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>backup
</B><DD>完全な形式で入力する必要があります。
<P><DT><B><VAR>volume name or ID</VAR>
</B><DD>バックアップする読み取り / 書き込みボリュームを、その完全名またはボリューム ID 番号によって識別します。バックアップ・ボリュームは、同じ名前に
<B>.backup</B> 拡張子を付けたものです。これには、独自のボリューム ID番号が付いています。
</DL>
<A NAME="IDX6543"></A>
<A NAME="IDX6544"></A>
</LI><LI><A NAME="LIWQ293"></A><B> (オプション)</B> <B>fs mkmount</B>コマンドを発行して、バックアップ・ボリュームを取り付けます。このステップはオプションであり、ボリュームが取り付けられていない場合には、キャッシュ・マネージャーはボリュームの内容にアクセスできません。
<P>
<PRE>   
   % <B>fs mkmount</B> &lt;<VAR>directory</VAR>> &lt;<VAR>volume name</VAR>><B>.backup</B>
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>mk
</B><DD>は、<B>mkmount</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>directory</VAR>
</B><DD>作成するマウント・ポイントを指定します。前もって同じ名前のファイルまたはディレクトリーを作成してはなりません。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。ユーザー・ボリュームのバックアップ・バージョンを取り付ける位置は、通常、ユーザーのホーム・ディレクトリーです。
<P><DT><B><VAR>volume name</VAR><B>.backup</B>
</B><DD>バックアップ・ボリュームのフルネームです。
</DL>
</LI><LI><B>(オプション)</B> <B>fs lsmount</B> コマンドを発行して、マウント・ポイントが正しいボリュームを参照しているか検証します。詳細な説明が <A HREF="#HDRWQ297">マウント・ポイントの表示方法</A> に示されています。
<P>
<PRE>   
   % <B>fs lsmount</B> &lt;<VAR>directory</VAR>>
   
</PRE>
</LI></OL>
<A NAME="IDX6545"></A>
<A NAME="IDX6546"></A>
<P><H3><A NAME="Header_223" HREF="auagd002.htm#ToC_223">複数のバックアップ・ボリュームの同時作成</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>vos backupsys</B> コマンドを発行して、同じ接頭部またはサイトを共用するすべての読み取り / 書き込みボリュームのバックアップ・バージョンを作成します。
3 つの引き数を結合した場合の影響については、<A HREF="#HDRWQ288">複数のボリュームを同時にバックアップする</A>で説明しています。
<P>
<PRE>   % <B>vos backupsys</B> [<B>-prefix</B> &lt;<VAR> common prefix on volume(s)</VAR>><SUP>+</SUP>]   \
        [<B>-server</B> &lt;<VAR>machine name</VAR>>] [<B>-partition</B> &lt;<VAR>partition name</VAR>>]  \
        [<B>-exclude</B>]   [<B>-xprefix</B> &lt;<VAR> negative prefix on volume(s)</VAR>><SUP>+</SUP>] 
        [<B>-dryrun</B>]  [<B>-verbose</B>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>backups
</B><DD>は、<B>backupsys</B> の受け入れ可能な省略形です。
<P><DT><B>-prefix
</B><DD>任意の長さの 1 つまたは複数の簡単な文字ストリングまたは正規式を指定します。名前にストリングが含まれるボリュームは、複製するボリュームのリストに配置されます。適切な場合は、フィールド区切り記号 (ピリオドなど) を含めます。この引き数は、<B>-server</B>、<B>-partition</B>、<B>-exclude</B>、および <B>-xprefix</B> オプションの組み合わせと結合することができます。
<P><DT><B>-server
</B><DD>バックアップするボリュームを格納するファイル・サーバー・マシンを指定します。この引き数は、<B>-prefix</B>、<B>-partition</B>、
<B>-exclude</B>、および <B>-xprefix</B> オプションの組み合わせと結合することができます。
<P><DT><B>-partition
</B><DD>バックアップするボリュームを格納するパーティションを指定します。この引き数は、<B>-prefix</B>、<B>-server</B>、
<B>-exclude</B>、および <B>-xprefix</B> オプションの組み合わせと結合することができます。
<P><DT><B>-exclude
</B><DD><B>-prefix</B> 引き数によって示されるボリュームを除くすべてのボリュームがバックアップされることを示します。
<B>-prefix</B> 引き数は、これとともに使用する必要があります。これは、<B>-prefix</B>、<B>-server</B>、および <B>-partition</B> の引き数の組み合わせと結合、または、
<B>-prefix</B> および <B>-xprefix</B> の引き数両方と結合することができますが、
<B>-xprefix</B> 引き数だけと結合することはできません。
<P><DT><B>-xprefix
</B><DD>任意の長さの 1 つまたは複数の簡単な文字ストリングまたは正規式を指定します。名前にストリングが含まれないボリュームは、複製するボリュームのリストに配置されます。これは、<B>-prefix</B>、<B>-server</B>、および <B>-partition</B> の引き数の組み合わせと結合できます。さらに、<B>-prefix</B> および <B>-exclude</B> のオプションとも結合できますが、
<B>-exclude</B> フラグのみとは結合できません。
<P><DT><B>-dryrun
</B><DD>実際には複製を行わずに、複製されるボリュームのリストを標準出力ストリーム上に表示します。
<P><DT><B>-verbose
</B><DD><B>-dryrun</B> フラグと結合すると、標準出力ストリーム上に、ボリューム選択の際に使用される基準を要約した文を表示します。
-dryrun フラグと結合しない場合は、各ボリュームの複製操作をトレースします。
</DL>
</LI></OL>
<HR><H2><A NAME="HDRWQ294" HREF="auagd002.htm#ToC_224">ボリュームの取り付け</A></H2>
<A NAME="IDX6547"></A>
<P><A HREF="#HDRWQ269">ボリュームの取り付けについて</A> で説明するとおり、マウント・ポイントによって、
AFS ファイル・スペース内で AFS ボリュームの内容が見え、アクセス可能になります。このセクションでは、キャッシュ・マネージャーがファイル・スペースを横断するときのマウント・ポイントの取扱方法について詳しく説明します。このセクションには、3 つのタイプのマウント・ポイントについての説明、それらの目的と識別方法、およびマウント・ポイントの作成、除去、検査に関する指示が含まれています。
<P><H3><A NAME="HDRWQ295" HREF="auagd002.htm#ToC_225">マウント・ポイント横断の規則</A></H3>
<P>キャッシュ・マネージャーは、次の 3 つの基本規則を守りながら AFS ファイル・スペースを走査し、マウント・ポイントに遭遇します。
<UL>
<LI><B>規則 1:</B> 指定されている場合はバックアップおよび読み取り専用ボリュームにアクセスする
<P>
<P>キャッシュ・マネージャーは、<B>.readonly</B> または <B>.backup</B> 拡張子が付いたボリュームを指定するマウント・ポイントに出会うと、そのタイプのボリュームにのみアクセスします。マウント・ポイントに <B>.backup</B> または <B>.readonly</B> 拡張子が付いている場合、キャッシュ・マネージャーは規則 2 および 3 を使用します。
<P>
<P>たとえば、マウント・ポイントがバックアップ・バージョンを指定している場合は、キャッシュ・マネージャーは読み取り / 書き込みバージョンにアクセスすることはありません。指定されたバージョンがアクセス不能の場合、キャッシュ・マネージャーはエラーを報告します。
</LI><LI><B>規則 2:</B> 可能であれば読み取り専用パスをたどる。
<P>
<P>マウント・ポイントが読み取り専用ボリュームに常駐し、そのマウント・ポイントが参照するボリュームが複写されている場合、キャッシュ・マネージャーはそのボリュームの読み取り専用コピーにアクセスしようとします。参照されたボリュームが複写されていない場合は、キャッシュ・マネージャーは読み取り / 書き込みコピーにアクセスします。したがってキャッシュ・マネージャーは、ファイル・スペースでは<I>読み取り専用パス</I> を優先するといわれ、読み取り専用ボリュームが使用可能であれば、それにアクセスします。
<P>
<P>キャッシュ・マネージャーはまず最初に読み取り専用パスからスタートします。それは、キャッシュ・マネージャーは常に <B>root.afs</B> ボリュームの読み取り専用のコピーが存在する場合はそれにアクセスするからです。このボリュームはセルの AFS ファイル・スペースのルート (通例 <B>/afs</B> という名前) に取り付けられます。すなわち、<B>root.afs</B> ボリュームが複写されていると、キャッシュ・マネージャーは、読み取り / 書き込みコピーではなく、読み取り専用コピーにアクセスしようとします。したがって、この規則は、各ボリュームが続けて複写される限り、キャッシュ・マネージャーを読み取り専用パスに保持します。これが言外に意味するところは、<B>root.afs</B> および <B>root.cell</B> ボリュームは、AFS ファイル・スペースのそれらのボリュームの下にマウントされた複写されたボリュームにキャッシュ・マネージャーがアクセスするためには、複写されなければならないということです。ボリュームは <B>/afs</B> および <B>/afs/</B><VAR>cellname</VAR> ディレクトリーにそれぞれマウントされるのが通例です。
</LI><LI><B>規則 3:</B> 一度読み取り / 書き込みパス上にくれば、そこに留まる。
<P>
<P>マウント・ポイントが読み取り / 書き込みボリュームに常駐し、ボリューム名が <B>.readonly</B> または <B>.backup</B> 拡張子を持っていない場合、キャッシュ・マネージャーは、そのボリュームの読み取り / 書き込みバージョンだけにアクセスしようとします。読み取り / 書き込みバージョンがアクセス不可の場合、読み取り専用バージョンがたとえアクセス可能であっても、そのアクセス試行は失敗し、エラーが発生します。このような状態の場合、キャッシュ・マネージャーは<I>読み取り / 書き込みパス</I>上にいるといわれ、マウント・ポイントが明示的に <B>.readonly</B> 拡張子を持つボリュームを指定しない限り、読み取り専用パスに切り換わることはできません。
(セルラー・マウント・ポイントは、この規則の重要な例外です。これについては以下で説明します。)
</LI></UL>
<P><H3><A NAME="HDRWQ296" HREF="auagd002.htm#ToC_226">3 つのタイプのマウント・ポイント</A></H3>
<P>AFS は、キャッシュ・マネージャーのマウント・ポイントの取扱方法に応じて、目的別に適切な 3 つのタイプマウント・ポイントを使用します。
<UL>
<LI>キャッシュ・マネージャーが<I>正規</I>マウント・ポイントと交差する場合、キャッシュ・マネージャーは既述の 3 つのマウント・ポイント規則のすべてに従います。
<A NAME="IDX6548"></A>
<A NAME="IDX6549"></A>
<P>
<P>
<P>AFS は、ファイル・スペース内のマウント・ポイントの大部分が正規である場合に、最大の力を発揮します。これは、マウント・ポイント横断規則によって、複写および非複写のボリューム双方が最大限に使用されるためです。
1 つの複写ボリュームに複数の読み取り専用コピーが存在する可能性があるため、キャッシュ・マネージャーが単一の読み取り / 書き込みバージョンよりも読み取り専用コピーの 1 つにアクセスすることは意味がとおります。そして、第 2 の規則でこれを実行します。ボリュームが複写されておらず、使用可能なタイプが読み取り / 書き込みボリュームただ 1 つである場合は、第 3 の規則により、キャッシュ・マネージャーはそのボリュームにアクセスします。言い換えると、正規マウント・ポイントは、キャッシュ・マネージャーに、読み取り専用ボリュームにアクセスするようにいつも強制するわけではありません
(これは明示的に「読み取り専用マウント・ポイント」ではありません)。
<P>
<P>正規マウント・ポイントを作成するには、
<A HREF="#HDRWQ298">正規または読み取り / 書き込みの各マウント・ポイントの作成</A> の説明に従って、
<B>fs mkmount</B> コマンドを使用してください。
<P>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">正規マウント・ポイントが指名する複写ボリュームの読み取り専用バージョンに、キャッシュ・マネージャーがアクセスできるようにするためには、パス名でそのポイントより上に取り付けられるすべてのボリュームも複写されていなければなりません。これは、キャッシュ・マネージャーが、ターゲットのボリュームへの読み取り専用パス上に残ることができる唯一の方法です。
</TD></TR></TABLE>
</LI><LI>キャッシュ・マネージャーが <I>読み取り / 書き込み</I>マウント・ポイントと交差する場合、そのマウント・ポイントで指名されたボリューム・バージョンのみにアクセスしようと試みます。ボリューム名が、
<B>.readonly</B> または <B>.backup</B> 拡張子を持たない基本 (読み取り / 書き込み) 形式である場合、キャッシュ・マネージャーは、ボリュームの読み取り / 書き込みバージョンが複写されていてもそれにアクセスします。言い換えれば、キャッシュ・マネージャーは読み取り / 書き込みマウント・ポイントと交差する場合は、第 2 のマウント・ポイント横断規則を無視し、ファイル・スペースを通じて読み取り / 書き込みパスへ切り替えます。
<A NAME="IDX6550"></A>
<A NAME="IDX6551"></A>
<P>
<P>
<P>規則として、セルのファイル・スペースごとにただ 1 つの読み取り / 書き込みマウント・ポイントを作成します。このマウント・ポイントを使用して、
AFS ファイル・スペースのルート (規則では <B>/afs/.</B><VAR>cellname</VAR>) のすぐ下に、そのセルの <B>root.cell</B> ボリュームを取り付けます。示されるとおり、読み取り / 書き込みマウント・ポイント名の先頭にピリオドを付けることが規則です
(たとえば、<B>/afs/.abc.com</B>)。ピリオドによって、読み取り / 書き込みマウント・ポイントを、同じレベルにある <B>root.cell</B> ボリューム用の正規マウント・ポイントと区別します。これは、同じボリューム用に 2 つのマウント・ポイントを作成するのが規則である唯一の場合です。読み取り / 書き込みマウント・ポイント用のこの命名規則の望ましい副次作用は、
<B>-a</B> フラグが含まれていない場合には UNIX <B>ls</B> コマンドの出力内に表示されず、これを必要としない正規ユーザーから本質的に隠すということです。
<P>
<P>ファイル・スペースでのこのポイントに単一の読み取り / 書き込みマウント・ポイントが存在することによって、必要な場合にはすべてのボリュームの読み取り / 書き込みバージョンへのアクセスが提供されます。これは、そのマウント・ポイントがキャッシュ・マネージャーをファイル・スペース上部の読み取り / 書き込みパス上に置くためです。同様に、<B>root.cell</B> ボリュームの正規マウント・ポイントは、大抵の時間キャッシュ・マネージャーを読み取り専用パス上に置きます。
<P>
<P>読み取り専用またはバックアップのボリューム用に読み取り / 書き込みマウント・ポイントを使用することは受け入れられますが、必要ではありません。マウント・ポイント横断規則の第 1 の規則では、正規のマウント・ポイント内のボリューム名に <B>.readonly</B> または
<B>.backup</B> 拡張子が付く場合は、キャッシュ・マネージャーはそれらにアクセスするように指定されています。
<P>
<P>読み取り / 書き込みマウント・ポイントを作成するには、<A HREF="#HDRWQ298">正規または読み取り / 書き込みの各マウント・ポイントの作成</A>で説明する <B>fs mkmount</B>
コマンド上で <B>-rw</B> フラグを使用します。
</LI><LI>キャッシュ・マネージャーが <I>セルラー</I>・マウント・ポイントと交差する場合、指定されたセル内に示されるボリュームにアクセスします。このセルは通常は外部セルです。
(マウント・ポイントがボリュームとともにセルを指定しない場合、キャッシュ・マネージャーは、マウント・ポイントが常駐するセル内のボリュームにアクセスします。)
正規のセルラー・マウント・ポイントと交差すると、キャッシュ・マネージャーはマウント・ポイント横断規則の第 3 の規則を無視します。つまり、マウント・ポイントを収容するボリュームが読み取り / 書き込みボリュームであっても、ボリュームの読み取り専用バージョンが複写されていればそれにアクセスします。
<P>
<P>この振る舞いを回避するために、読み取り / 書き込みセルラー・マウント・ポイントを作成することは適切でありません。これは、読み取り / 書き込みパスを横断すると外部セルのファイル・サーバー・マシン上に不公平なロードがかかるためです。つまり、ファイル・サーバーは、読み取り専用ボリュームに必要となる単一のコールバックではなく、読み取り / 書き込みボリュームから取り出したファイルごとにコールバックを発行する必要があります。どのような場合でも、通常、セルの固有の管理者だけが複写ボリュームの読み取り / 書き込みバージョンにアクセスする必要があります。
<A NAME="IDX6552"></A>
<A NAME="IDX6553"></A>
<A NAME="IDX6554"></A>
<P>
<P>
<P>規則として、セルのファイル・スペース内の第 2 レベルのみにおいてセルラー・マウント・ポイントを作成し、そのマウント・ポイントを使用して、
AFS ファイル・スペース・ルートのすぐ下 (規則では <B>/afs/</B><VAR>foreign_cellname</VAR>)
の外部セルの <B>root.cell</B> ボリュームを取り付けます。ボリュームのルート・ディレクトリーの ACL 上に必要なアクセス権がユーザーにあり、ローカルのクライアント・マシンの <B>/usr/vice/etc/CellServDB</B> ファイルごとに外部セルの入り口が 1 つあると想定すると、ローカル・ユーザーは、マウント・ポイントを使用して、外部セルのファイル・スペースにアクセスすることができます。これについての詳細は、<A HREF="auagd015.htm#HDRWQ553">データベース・サーバー・マシンの情報を保持する</A> を参照してください。
<P>
<P>セルラー・マウント・ポイントをファイル・スペース内のほかのレベルで作成し、
<B>root.cell</B> ボリューム以外の外部ボリュームを取り付けることは通常適切ではありません。キャッシュ・マネージャーが 1 つのパス名でさまざまなポイントにおいてセルからセルへ切り替えると、ユーザーに混乱をきたす可能性があります。
<P>
<P>正規のセルラー・マウント・ポイントを作成するには、
<B>-cell</B> 引き数を使用してセル名を指定します。詳細は、<A HREF="#HDRWQ299">セルラー・マウント・ポイントを作成する方法</A> を参照してください。
</LI></UL>
<P>マウント・ポイントを検査するには、<A HREF="#HDRWQ297">マウント・ポイントの表示方法</A> で説明する <B>fs lsmount</B> コマンドを使用します。コマンドの出力では、正規、読み取り / 書き込み、およびセルラー・マウント・ポイントを識別するために独特な表記を使用します。マウント・ポイントを削除するには、
<A HREF="#HDRWQ301">マウント・ポイントを除去する方法</A> で説明する
<B>fs rmmount</B> コマンドを使用します。
<P><H3><A NAME="Header_227" HREF="auagd002.htm#ToC_227">外部セルでのマウント・ポイントの作成</A></H3>
<P>マウント・ポイントを外部セルのファイル・スペースに作成する (外部ボリュームをローカル・セルに取り付けるのと反対) には、基本的にマウント・ポイントをローカル・ファイル・スペースに作成する場合と同じ方法を使用します。これらの違いは、
<B>fs mkmount</B> コマンドの <VAR>directory</VAR> 引き数がローカル・セルではなく外部セル内のパス名を指定すること、および、マウント・ポイントを作成する場所である外部ディレクトリーの ACL 上に必要なアクセス権がなければならないということです。
<B>fs mkmount</B> コマンドの <B>-cell</B> 引き数は、マウント・ポイントを作成するためのセルではなく、ボリュームが常駐するセルを常に指定します。
<P><H3><A NAME="HDRWQ297" HREF="auagd002.htm#ToC_228">マウント・ポイントの表示方法</A></H3>
<A NAME="IDX6555"></A>
<A NAME="IDX6556"></A>
<A NAME="IDX6557"></A>
<A NAME="IDX6558"></A>
<A NAME="IDX6559"></A>
<A NAME="IDX6560"></A>
<OL TYPE=1>
<LI><B>fs lsmount</B> コマンドを発行します。
<P>
<PRE>   
   % <B>fs lsmount</B> &lt;<VAR>directory</VAR>>
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>ls
</B><DD>は、<B>lsmount</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>directory</VAR>
</B><DD>表示させるマウント・ポイントを指定します。
</DL>
</LI></OL>
<P>指定したディレクトリーがマウント・ポイントである場合は、以下の形式で出力されます。
<PRE>   '<VAR>directory</VAR>' is a mount point for volume '<VAR>volume name</VAR>'
   
</PRE>
<P>正規マウント・ポイントの場合は、以下のコマンド例のように、
<VAR>volume name</VAR> ストリングの前に番号記号 (<TT>#</TT>) が表示されます。以下は、<B>abc.com</B> セル内のクライアント・マシン上で発行されたコマンド例です。
<PRE>   
   % <B>fs lsmount /afs/abc.com/usr/terry</B>
   '/afs/abc.com/usr/terry' is a mount point for volume '#user.terry'
      
</PRE>
<P>読み取り / 書き込みマウント・ポイントの場合は、以下のコマンド例のように、
<VAR>volume name</VAR> ストリングの前にパーセント記号 (<TT>%</TT>) が表示されます。以下は、<B>abc.com</B> セル内のクライアント・マシン上で発行されたコマンド例です。セルの管理者は、読み取り / 書き込みマウント・ポイント名の前にピリオドを置く規則に従っています。
<PRE>   
   % <B>fs lsmount /afs/.abc.com </B>
   '/afs/.abc.com' is a mount point for volume '%root.cell'
   
</PRE>
<P>セルラー・マウント・ポイントの場合は、セル名およびコロン (<TT>:</TT>) が、番号記号またはパーセント記号の後、かつ、
<VAR>volume name</VAR> ストリングの前に置かれます。以下は、
<B>abc.com</B> セル内のクライアント・マシン上で発行されたコマンド例です。
<PRE>   
    % <B>fs lsmount /afs/ghi.gov </B>
   '/afs/ghi.gov' is a mount point for volume '#ghi.gov:root.cell'
   
</PRE>
<P>マウント・ポイントへつながる記号リンクの場合、
<B>abc.com</B> セル内のクライアント・マシン上で発行された以下のコマンド例で示される形式で出力されます。
<PRE>   
   % <B>fs lsmount /afs/abc</B>
   '/afs/abc' is a symbolic link, leading to a mount point for volume '#root.cell'
   
</PRE>
<P>ディレクトリーがマウント・ポイントではない、または AFS にない場合、その出力は以下のようになります。
<PRE>   '<VAR>directory</VAR>' is not a mount point.
   
</PRE>
<P>出力が混同している場合は、マウント・ポイントがローカル・キャッシュ内で破壊された可能性があります。
<A HREF="auagd015.htm#HDRWQ560">1 つ以上のマウント・ポイントをフラッシュする</A> を参照して、
<B>fs flushmount</B> コマンドを使用してください。これによって、キャッシュ・マネージャーはマウント・ポイントを再び取って来るよう強制されます。
<P><H3><A NAME="HDRWQ298" HREF="auagd002.htm#ToC_229">正規または読み取り / 書き込みの各マウント・ポイントの作成</A></H3>
<A NAME="IDX6561"></A>
<A NAME="IDX6562"></A>
<A NAME="IDX6563"></A>
<A NAME="IDX6564"></A>
<A NAME="IDX6565"></A>
<A NAME="IDX6566"></A>
<OL TYPE=1>
<LI>マウント・ポイントを配置するディレクトリーの ACL 上に <B>i</B> (<B>挿入</B>) および <B>a</B> (<B>管理</B>)アクセス権があることを検査します。必要に応じて、<B>fs listacl</B> コマンドを発行します。これについては、<A HREF="auagd020.htm#HDRWQ788">ACL の表示</A> で詳しく説明しています。
<P>
<PRE>   % <B>fs listacl</B> [&lt;<VAR>dir/file path</VAR>>]
</PRE>
</LI><LI>マウント・ポイントを作成するには、<B>fs mkmount</B>コマンドを発行します。読み取り / 書き込みマウント・ポイントを作成するには、<B>-rw</B>フラグを組み込みます。
<P>
<PRE>   
   % <B>fs mkmount</B> &lt;<VAR>directory</VAR>> &lt;<VAR>volume name</VAR>> [<B>-rw</B>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>mk
</B><DD>は、<B>mkmount</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>directory</VAR>
</B><DD>作成するマウント・ポイントを指定します。同じ名前のファイルまたはディレクトリーが存在してはいけません。部分的なパス名は、現行作業ディレクトリーに対する相対として解釈されます。
<P>
<P>マウント・ポイントへの読み取り / 書き込みパスを指定します。こうすると、読み取り専用ボリューム内に新規マウント・ポイントを作成しようとする際に生じる障害を回避することができます。規則では、パス名の第 2 レベルでセル名の前にピリオドを置いて、読み取り / 書き込みパスを示します (たとえば、<B>/afs/.abc.com</B>)。読み取り / 書き込みパスおよび読み取り専用パスの概念についての詳細は、
<A HREF="#HDRWQ295">マウント・ポイント横断の規則</A> を参照してください。
<P><DT><B><VAR>volume name</VAR>
</B><DD>バックアップ・ボリュームまたは読取専用ボリューム用の <B>.backup</B> または <B>.readonly</B> の拡張子付きのボリュームの完全名を指定します。
<P><DT><B>-rw
</B><DD>読み取り / 書き込みマウント・ポイントを作成します。
</DL>
</LI></OL>
<P><H3><A NAME="HDRWQ299" HREF="auagd002.htm#ToC_230">セルラー・マウント・ポイントを作成する方法</A></H3>
<A NAME="IDX6567"></A>
<A NAME="IDX6568"></A>
<A NAME="IDX6569"></A>
<OL TYPE=1>
<LI>マウント・ポイントを配置するディレクトリーの ACL 上に <B>i</B> (<B>挿入</B>) および <B>a</B> (<B>管理</B>)アクセス権があることを検査します。必要に応じて、<B>fs listacl</B> コマンドを発行します。これについては、<A HREF="auagd020.htm#HDRWQ788">ACL の表示</A> で詳しく説明しています。
<P>
<PRE>   % <B>fs listacl</B> [&lt;<VAR>dir/file path</VAR>>]
</PRE>
</LI><LI><A NAME="LIWQ300"></A>ファイル・スペースの第 2 レベルで 1 つまたは複数の外部セルの <B>root.cell</B> ボリュームを取り付ける場合に、ユーザーのセルの <B>root.afs</B> ボリュームが複写されていると、
ACL によってユーザーに <B>i</B> および <B>a</B> のアクセス権が与えられるディレクトリー内に、
<B>root.afs</B> ボリュームの読み取り / 書き込みバージョン用の一時的なマウント・ポイントを作成する必要があります。次のコマンドにより、ユーザーのセルの <B>/afs/.</B><VAR>cellname</VAR> ディレクトリー
(ユーザーのセル内の読み取り / 書き込みパスへの入り口地点) に、
<B>new_cells</B> と呼ばれるマウント・ポイントが作成されます。
<P>
<P><VAR>cellname</VAR> に、ユーザーのセル名を代入します。
<P>
<PRE>   
   % <B>cd /afs/.</B><VAR>cellname</VAR>
   
   % <B>fs  mkmount  new_cells  root.afs</B>
 
   % <B>cd  new_cells</B>
   
</PRE>
</LI><LI>セルラー・マウント・ポイントを作成するには、<B>-cell</B> 引き数とともに <B>fs mkmount</B> コマンドを使用します。それぞれのセルラー・マウント・ポイントごとにコマンドを繰り返します。
<P>
<PRE>   
   % <B>fs mkmount</B> &lt;<VAR>directory</VAR>> &lt;<VAR>volume name</VAR>> <B>-cell</B> &lt;<VAR>cell name</VAR>>
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>mk
</B><DD>は、<B>mkmount</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>directory</VAR>
</B><DD>作成するマウント・ポイントを指定します。同じ名前のファイルまたはディレクトリーが存在してはいけません。部分的なパス名は、現行作業ディレクトリーに対する相対として解釈されます。外部セルの <B>root.cell</B> ボリュームを取り付ける場合、この引き数の標準値は、セルの完全なインターネット・ドメイン名です。
<P><DT><B><VAR>volume name</VAR>
</B><DD>ボリュームの完全名を指定します。通常、セルラー・マウント・ポイントには <B>root.cell</B> です。
<P><DT><B>-cell
</B><DD>ボリュームが常駐するセルの完全なインターネット・ドメイン名を指定します。
</DL>
</LI><LI><A HREF="#LIWQ300">2</A> のステップの指示を実行したら、
<B>vos release</B> コマンドを発行して、新規バージョンの <B>root.afs</B> ボリュームをその読み取り専用サイトへリリースします。
(このコマンドは、ユーザーのセルの <B>/usr/afs/etc/UserList</B> ファイルに、ユーザーがリストされていなければなりません。必要な場合には、
<B>bos listusers</B> コマンドを発行して検査します。このコマンドの詳細は、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A> を参照してください。)
<P>
<P>また、ローカル・キャッシュ・マネージャーに <B>root.afs</B> ボリュームの新規複製へアクセスさせるには、
<B>fs checkvolumes</B> コマンドを発行します。場合に応じて、一時的な <B>new_cells</B> マウント・ポイントを、
<B>/afs/.</B><VAR>cellname</VAR> ディレクトリーから除去することもできます。
<P>
<PRE>     
   % <B>vos release root.afs</B>
   
   % <B>fs checkvolumes</B>
   
   % <B>cd /afs/.</B><VAR>cellname</VAR>
    
   % <B>fs rmmount new_cells</B>
   
   
</PRE>
<P>
<P>新規に取り付けた外部セルに顧客ユーザーがアクセスするには、クライアント・マシンごとのローカルな <B>/usr/vice/etc/CellServDB</B> ファイル内でセル用の項目も作成しなければなりません。そして、マシンをリブートするか、または <B>fs newcell</B> コマンドを使用してその項目を直接そのカーネル・メモリーへ挿入してください。詳細は、<A HREF="auagd015.htm#HDRWQ553">データベース・サーバー・マシンの情報を保持する</A> を参照してください。
</LI></OL>
<P><H3><A NAME="HDRWQ301" HREF="auagd002.htm#ToC_231">マウント・ポイントを除去する方法</A></H3>
<A NAME="IDX6570"></A>
<A NAME="IDX6571"></A>
<A NAME="IDX6572"></A>
<A NAME="IDX6573"></A>
<A NAME="IDX6574"></A>
<OL TYPE=1>
<LI>マウント・ポイントを除去する先のディレクトリーの ACL 上に <B>d</B> (<B>削除</B>) アクセス許可があることを検証します。必要に応じて、<B>fs listacl</B> コマンドを発行します。これについては、<A HREF="auagd020.htm#HDRWQ788">ACL の表示</A> で詳しく説明しています。
<P>
<PRE>   % <B>fs listacl</B> [&lt;<VAR>dir/file path</VAR>>]
</PRE>
<P>
<P><B>system:administrators</B> グループのメンバーは、<B>a</B> (<B>管理</B>)、および、デフォルトで <B>l</B> (<B>検索</B>) アクセス権を、常にすべての ACL に暗黙的に持っています。また、必要に応じて <B>fs setacl</B> コマンドを使用して、他の権限を付与することができます。
</LI><LI><B>fs rmmount</B> コマンドを発行し、マウント・ポイントを除去します。ボリュームはまだ存在しますが、これが唯一のマウント・ポイントである場合、その内容はアクセス不能です。
<P>
<PRE>   
   % <B>fs rmmount</B> &lt;<VAR>directory</VAR>>
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>rm
</B><DD>は、<B>rmmount</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>directory</VAR>
</B><DD>削除するマウント・ポイントを指定します。部分的なパス名は、現行作業ディレクトリーに対する相対として解釈されます。
<P>
<P>マウント・ポイントへの読み取り / 書き込みパスを指定します。こうすると、読み取り専用ボリュームからマウント・ポイントを削除しようとする際に生じる障害を回避することができます。規則では、パス名の第 2 レベルでセル名の前にピリオドを置いて、読み取り / 書き込みパスを示します (たとえば、<B>/afs/.abc.com</B>)。読み取り / 書き込みパスおよび読み取り専用パスの概念についての詳細は、
<A HREF="#HDRWQ295">マウント・ポイント横断の規則</A> を参照してください。
</DL>
</LI></OL>
<HR><H2><A NAME="HDRWQ302" HREF="auagd002.htm#ToC_232">ボリュームについての情報を表示する</A></H2>
<A NAME="IDX6575"></A>
<A NAME="IDX6576"></A>
<P>このセクションでは、ボリュームについての情報を表示する方法を説明します。ボリューム名またはボリューム ID 番号が分かる場合は、その VLDB 項目またはボリューム・ヘッダー、もしくはその両方を表示させるコマンドがあります。指定したファイルまたはディレクトリーを含むボリュームの名前または位置を表示するには、他のコマンドを使用します。
<P>ボリューム割り当て量を表示させるには、<A HREF="#HDRWQ320">ボリューム割り当て量および現行サイズの設定および表示</A> の詳細を参照してください。
<P><H3><A NAME="HDRWQ303" HREF="auagd002.htm#ToC_233">VLDB 項目の表示</A></H3>
<A NAME="IDX6577"></A>
<A NAME="IDX6578"></A>
<A NAME="IDX6579"></A>
<A NAME="IDX6580"></A>
<P><B>vos listvldb</B> コマンドは、提供する引き数の組み合わせによって示されたボリュームに対する VLDB 項目を表示します。最も包括的なものから、最も包括的でないものまでを含む可能性をここにリストします。
<UL>
<LI>VLDB の各項目を表示するには、引き数を提供しません。このプロセスは、項目の数に応じて、出力生成までに非常に長い時間がかかることがあります。
</LI><LI>ボリュームのサイトとして特定のファイル・サーバー・マシンについて言及する各 VLDB 項目を表示するには、
<B>-server</B> が付いたマシン名を指定します。
</LI><LI>ボリュームのサイトとして任意のファイル・サーバー・マシン上の特定のパーティションについて言及する各 VLDB 項目を表示するには、
<B>-partition</B> が付いたパーティション名を指定します。
</LI><LI>ボリュームのサイトとして特定のファイル・サーバー・マシン上の特定のパーティションについて言及する各 VLDB 項目を表示するには、
<B>-server</B> および <B>-partition</B> を結合します。
</LI><LI>単一の VLDB 項目を表示するには、<B>-name</B> 引き数を使用してボリューム名または ID 番号を指定します。
</LI><LI>ロックされた VLDB 項目を持つボリュームのみに対する VLDB 項目を表示するには、上記で説明した任意のサイト定義によって <B>-locked</B> フラグを使用します。
</LI></UL>
<A NAME="IDX6581"></A>
<A NAME="IDX6582"></A>
<P><H3><A NAME="HDRWQ304" HREF="auagd002.htm#ToC_234">VLDB 項目の表示</A></H3>
<OL TYPE=1>
<LI><B>vos listvldb</B> コマンドを発行します。
<P>
<PRE>   
   % <B>vos listvldb</B>  [<B>-name</B> &lt;<VAR>volume name or ID</VAR>>] [<B>-server</B> &lt;<VAR>machine name</VAR>>] \
                  [<B>-partition</B> &lt;<VAR>partition name</VAR>>] [<B>-locked</B>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>listvl
</B><DD>は、<B>listvldb</B> の受け入れ可能な省略形です。
<P><DT><B>-name
</B><DD>1 つのボリュームを、その完全名またはボリューム ID 番号によって識別します。この引き数を <B>-server</B> または <B>-partition</B> 引き数と結合してはいけません。
<P><DT><B>-server
</B><DD>ファイル・サーバー・マシンを指定します。この引き数は、<B>-partition</B>引き数と結合できますが、<B>-name</B> 引き数とは結合できません。
<P><DT><B>-partition
</B><DD>パーティションを指定します。この引き数は、<B>-server</B> 引き数と結合できますが、<B>-name</B> 引き数とは結合できません。
<P><DT><B>-locked
</B><DD>ロックされた VLDB 項目のみを表示します。このフラグを、他の任意のオプションに結合します。
</DL>
</LI></OL>
<P>各ボリュームの VLDB 項目には、以下の情報が含まれます。
<UL>
<LI>基本 (読み取り / 書き込み) ボリューム名。読み取り専用およびバックアップ・バージョンは、同じ名前にそれぞれ拡張子 <B>.readonly</B> と<B>.backup</B> が付きます。
</LI><LI>実際に存在するボリュームのバージョンに割り当てられるボリューム ID 番号。読み取り / 書き込みの場合は <TT>RWrite</TT>、読み取り専用の場合は <TT>ROnly</TT>、バックアップの場合は <TT>Backup</TT>、リリース・クローンの場合は <TT>RClone</TT> というラベル名の付いたフィールドに表示されます。
(フィールドが表示されない場合は、そのフィールドに対応するボリュームのバージョンは存在しません。)
<TT>RClone</TT> フィールドが表示される場合、通常はリリース処理が正常に完了しなかったことを示しています。また、<TT>Old release</TT> フラグと <TT>New release</TT> フラグが、次に説明するサイト定義の 1 つまたは複数の行に表示されることがあります。
<A NAME="IDX6583"></A>
<A NAME="IDX6584"></A>
</LI><LI>読み取り / 書き込みまたは読み取り専用のボリュームのコピーを持つサイト数で、文字列 <TT>number of sites -></TT> に続いて表示されます。
<A NAME="IDX6585"></A>
<A NAME="IDX6586"></A>
<A NAME="IDX6587"></A>
<A NAME="IDX6588"></A>
<A NAME="IDX6589"></A>
</LI><LI>読み取り / 書き込みまたは読み取り専用のボリュームのコピーを持つ各サイト用の行で、ファイル・サーバー・マシン、パーティション、ボリュームのタイプ (読み取り / 書き込みの場合 <TT>RW</TT>、読み取り専用の場合 <TT>RO</TT>) を指定する。バックアップ・バージョンが存在する場合、そのバージョンは読み取り / 書き込みサイトを共有するとみなされます。サイト定義には、次のようないくつかのフラグが表示されることがあります。
<P>
<DL>
<A NAME="IDX6590"></A>
<P><DT><B><TT>Not released</TT>
</B><DD><B>vos addsite</B> コマンドを使用して読み取り専用サイトを定義して以来 <B>vos release</B> コマンドが発行されていないことを示します。
<A NAME="IDX6591"></A>
<P><DT><B><TT>Old release</TT>
</B><DD><B>vos release</B> コマンドが正常に完了せず、ボリュームの以前の旧バージョンが該当サイトに残っていることを示します。
<A NAME="IDX6592"></A>
<P><DT><B><TT>New release</TT>
</B><DD><B>vos release</B> コマンドは正常に完了していないが、該当サイトにボリュームの正しい新規バージョンが作成されたことを示します。
</DL>
</LI><LI>VLDB 項目がロックされている場合、文字列 <TT>Volume is currently LOCKED</TT> が表示されます。
</LI></UL>
<P><TT>New release</TT> および <TT>Old release</TT> フラグの詳細は、<A HREF="#HDRWQ278">ボリュームの複写 (読み取り専用ボリュームの作成)</A> を参照してください。
<P>単一ボリュームに対するこのコマンドおよびその出力の例。
<PRE>   
   % <B>vos listvldb user.terry</B>
   user.terry
       RWrite: 50489902    Backup: 50489904
       number of sites -> 1
          server fs3.abc.com partition /vicepc RW Site
  
</PRE>
<P><H3><A NAME="HDRWQ305" HREF="auagd002.htm#ToC_235">ボリューム・ヘッダーの表示</A></H3>
<A NAME="IDX6593"></A>
<A NAME="IDX6594"></A>
<P><B>vos listvol</B> コマンドは、ファイル・サーバー・マシン上の 1 つまたはすべてのパーティションにあるすべてのボリュームに対してボリューム・ヘッダーを表示します。
<B>vos</B> コマンド・インタープリターは、指定したマシン上のボリューム・サーバーから情報を入手します。
<B>-fast</B>、<B>-long</B>、または <B>-extended</B> フラグのうちの 1 つを組み込むことによって、表示する情報量を制御することができます。詳細は、以下の <A HREF="#HDRWQ306">ボリューム・ヘッダーの表示</A> を参照してください。
<P>1 つのボリュームだけの単一ボリュームのボリューム・ヘッダーを表示するには、<A HREF="#HDRWQ307">1 つのボリュームの VLDB 項目およびボリューム・ヘッダーの表示</A> で説明する <B>vos examine</B>コマンドを使用します。
<A NAME="IDX6595"></A>
<A NAME="IDX6596"></A>
<P><H3><A NAME="HDRWQ306" HREF="auagd002.htm#ToC_236">ボリューム・ヘッダーの表示</A></H3>
<OL TYPE=1>
<LI><B>vos listvol</B> コマンドを発行します。
<P>
<PRE>   
   % <B>vos listvol</B> &lt;<VAR>machine name</VAR>> [&lt;<VAR>partition name</VAR>>] [<B>-fast</B>] [<B>-long</B>] [<B>-extended</B>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>listvo
</B><DD>は、<B>listvol</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>ボリューム・ヘッダーを表示するファイル・サーバー・マシンの名前です。この引き数を単独または <VAR>パーティション名</VAR>引き数付きで提供します。
<P><DT><B><VAR>partition name</VAR>
</B><DD>この名前とともに提供する必要がある <VAR>machine name</VAR> 引き数が命名する、ファイル・サーバー・マシン上の 1 つのパーティションの名前です。
<P><DT><B>-fast
</B><DD>関係のあるボリュームのボリューム ID 番号のみを表示します。このフラグを <B>-long</B> または <B>-extended</B> フラグと結合しないでください。
<P><DT><B>-long
</B><DD>各ボリュームについての詳細を表示します。このフラグを
<B>-fast</B> または <B>-extended</B> フラグと結合しないでください。
<P><DT><B>-extended
</B><DD><B>-long</B> フラグによって示されるすべての情報に加えて、ボリュームのファイルの読み取り、書き込みに関する統計のテーブルを表示します。このフラグと<B>-fast</B>
または <B>-long</B> フラグを結合しないでください。
</DL>
</LI></OL>
<P>出力はボリューム名のアルファベット順に表示され、デフォルトで、以下の情報がボリュームごとに単一行に示されます。
<UL>
<LI>名前
</LI><LI>ボリューム ID 番号
<A NAME="IDX6597"></A>
</LI><LI>タイプ (読み取り / 書き込みは <TT>RW</TT>、読み取り専用は <TT>RO</TT>、バックアップは <TT> BK</TT>)
</LI><LI>K バイト単位のサイズ (<TT>1024</TT> は １ M バイト)
</LI><LI><B>-extended</B> フラグが提供される場合は、ボリューム内のファイル数
<A NAME="IDX6598"></A>
</LI><LI>ファイル・サーバー・マシンの状況。以下のいずれかを表します。
<P>
<DL>
<A NAME="IDX6599"></A>
<P><DT><B><TT>On-line</TT>
</B><DD>ボリュームは、キャッシュ・マネージャーへ完全にアクセス可能です。
<A NAME="IDX6600"></A>
<P><DT><B><TT>Off-line</TT>
</B><DD>ボリュームはキャッシュ・マネージャーへアクセスできませんが、破壊されてはいないようです。この状況は、ボリュームがダンプされている場合などに表示されます。
<A NAME="IDX6601"></A>
<P><DT><B><TT>Off-line**needs salvage**</TT>
</B><DD>ボリュームが破壊されているようなので、キャッシュ・マネージャーへアクセスできません。この破壊を修理するためには、<B>bos salvage</B>コマンドまたは <B> salvager</B> コマンドを使用してください。
</DL>
</LI></UL>
<P>直前にリストした情報ではなく以下のようなメッセージが表示される場合は、複製が作成中であるなどの理由で、ボリュームは、キャッシュ・マネージャーまたは <B>vos</B> コマンド・インタープリターにアクセスできません。
<PRE>   **** Volume <VAR>volume_ID</VAR> is busy ****
</PRE>
<P>直前にリストした情報ではなく以下のようなメッセージが表示される場合は、ボリュームがひどく破壊されているなどの理由で、ファイル・サーバーはボリュームに接続することができません。ファイル・サーバー・マシンの <B>/usr/afs/logs</B> ディレクトリーの、
<B>FileLog</B> および <B>VolserLog</B> の各ログ・ファイルに追加情報がある場合があります。表示するには、<B>bos getlog</B> コマンドを使用します。
<PRE>   **** Could not attach volume <VAR>volume_ID</VAR> ****
</PRE>
<P>(破壊ボリュームまたは未連結ボリュームをサルベージするための詳細は、
<A HREF="#HDRWQ318">ボリュームのサルベージ</A> を参照してください。)
<P>固有ボリュームの情報は、要約行で一括されます。出力の最初の行では、リスト内にあるボリューム数を指定します。出力の最終行では、オンライン、オフライン、および使用中のボリューム数の一覧を表示します。これは、以下のように表示されます。
<PRE>   
   % <B>vos listvol  fs2.abc.com /vicepb</B>
   Total number of volumes on server fs2.abc.com \
                                       partition /vicepb: 66
   sys                  1969534847 RW       1582 K On-line
   sys.backup           1969535105 BK       1582 K On-line
         .                   .     .         .   .    .
         .                   .     .         .   .    .
   user.pat             1969534536 RW      17518 K On-line
   user.pat.backup      1969534538 BK      17537 K On-line
   Total volumes onLine 66 ; Total volumes offLine 0 ; Total busy 0
   
</PRE>
<P><B>-fast フラグでの出力</B>
<P>
<A NAME="IDX6602"></A>
<B>-fast</B> フラグを組み込むと、以下のように昇順に各ボリュームのボリューム ID 番号のみが表示されます。最終行 (オンライン、オフライン、および使用中ボリュームの一覧) は省略されます。
<PRE>   
   % <B>vos listvol fs3.abc.com /vicepa -f</B>
   Total number of volumes on server fs3.abc.com  \
                                       partition /vicepa: 37
   50489902
   50489904
      .
      .
   35970325
   49732810
   
</PRE>
<P><B>-long フラグでの出力</B>
<A NAME="IDX6603"></A>
<P><B>-long</B> フラグを組み込むと、各ボリュームの出力には、デフォルトのリスト表示のすべての情報以外に以下の情報も含まれます。このリストの各アイテムは、別々の行に出力されます。
<UL>
<LI>ボリュームを収容するファイル・サーバー・マシンおよびパーティション。これは、VLDB またはボリューム・ヘッダーからではなく、コマンドを実行する際にコマンド・インタープリターによって決定されます。
<A NAME="IDX6604"></A>
<A NAME="IDX6605"></A>
<A NAME="IDX6606"></A>
<A NAME="IDX6607"></A>
<A NAME="IDX6608"></A>
<A NAME="IDX6609"></A>
<A NAME="IDX6610"></A>
<A NAME="IDX6611"></A>
</LI><LI>さまざまなバージョンのボリュームに関連付けられたボリューム ID 番号:
読み取り / 書き込み (<TT>RWrite</TT>)、読み取り専用 (<TT>ROnly</TT>)、バックアップ (<TT>Backup</TT>)、ReleaseClone (<TT>RClone</TT>)。そのうちの 1 つは、ボリューム出力の最初の行に表示されるボリューム ID 番号と一致します。
<TT>RWrite</TT>、<TT>ROnly</TT>、または <TT>Backup</TT> の各フィールド内の値が、<TT>0</TT> (ゼロ)である場合は、そのタイプのボリュームはありません。現在 ReleaseClone がない場合は、<TT>RClone</TT> フィールド自体が表示されません。
<A NAME="IDX6612"></A>
<A NAME="IDX6613"></A>
</LI><LI>ボリュームの読み取り / 書き込み用に割り当てられた最大スペース割り当て量。<TT>MaxQuota</TT> フィールドに K バイト単位で示されます。
<A NAME="IDX6614"></A>
<A NAME="IDX6615"></A>
</LI><LI>ボリュームを作成した日時。<TT>Creation</TT>フィールドに示されます。ボリュームが <B>backup diskrestore</B>、
<B>backup volrestore</B>、または <B>vos restore</B> コマンドによって復元されている場合、これは復元時間です
<A NAME="IDX6616"></A>
<A NAME="IDX6617"></A>
</LI><LI>ボリューム内容が最後に変更された日時。<TT>Last Update</TT>フィールドに示されます。読み取り専用およびバックアップ・ボリュームのボリュームの場合は、
<TT>Creation</TT>フィールドのタイム・スタンプと一致します。
<A NAME="IDX6618"></A>
<A NAME="IDX6619"></A>
</LI><LI>次の 2 回のアクセスのあとで、取り出し操作または保管操作のためにボリュームがアクセスされた回数
<UL>
<LI>コマンドが発行された日の 12:00 a.m.。
</LI><LI>ボリュームの位置が最後に変更された時刻。
</LI></UL>
</LI></UL>
<P><B>-long</B> フラグが組み込まれた場合の出力例です。
<PRE>   
   % <B>vos listvol fs2.abc.com b -long</B>
   Total number of volumes on server fs2.abc.com 
                                       partition /vicepb: 66
         .                   .      .         .   .    .
         .                   .      .         .   .    .
   user.pat             1969534536 RW      17518 K On-line
        fs2.abc.com /vicepb
        RWrite 1969534536 ROnly 0        Backup 1969534538 
        MaxQuota      20000 K
        Creation    Mon Jun 12 09:02:25 1989
        Last Update Thu Jan  4 17:39:34 1990
        1573 accesses in the past day (i.e., vnode references)
   user.pat.backup      1969534538 BK      17537 K On-line
        fs2.abc.com /vicepb
        RWrite 1969534536 ROnly 0        Backup 1969534538 
        MaxQuota      20000 K
        Creation    Fri Jan  5 06:37:59 1990
        Last Update Fri Jan  5 06:37:59 1990
        0 accesses in the past day (i.e., vnode references)
	    .               .         .     .       .
	    .               .         .     .       .
   Total volumes onLine 66 ; Total volumes offLine 0 ; Total busy 0
   
</PRE>
<P><B>-extended フラグでの出力</B>
<A NAME="IDX6620"></A>
<P><B>-extended</B> フラグを組み込むと、各ボリュームの出力には、
<B>-long</B> フラグで報告されたすべての情報に加えて、以下の 2 つの統計表も含まれます。
<UL>
<LI><TT>Raw Read/Write Stats</TT> とラベルの付いた表には、読み取りまたは書き込みのためにボリュームがこれまでにアクセスされた回数が示されています。
</LI><LI><TT>Writes Affecting Authorship</TT> とラベルの付いた表には、指定のボリュームのファイルおよびディレクトリーへの書き込みに関する情報が含まれています。
</LI></UL>
<P>次は、<B>-extended</B> フラグが組み込まれた場合の出力例です。
<PRE>   % <B>vos listvol fs3.abc.com a -extended</B>
   common.bboards   1969535592 RW    23149 K used 9401 files On-line
       fs3.abc.com /vicepa
       RWrite 1969535592 ROnly          0 Backup 1969535594
       MaxQuota      30000 K
       Creation    Mon Mar  8 14:26:05 1999
       Last Update Mon Apr 26 09:20:43 1999
       11533 accesses in the past day (i.e., vnode references)
   
                         Raw Read/Write Stats
             |-------------------------------------------|
             |    Same Network     |    Diff Network     |
             |----------|----------|----------|----------|
             |  Total   |   Auth   |   Total  |   Auth   |
             |----------|----------|----------|----------|
   Reads     |      151 |      151 |     1092 |     1068 |
   Writes    |        3 |        3 |      324 |      324 |
             |-------------------------------------------|
    
                      Writes Affecting Authorship
             |-------------------------------------------|
             |   File Authorship   | Directory Authorship|
             |----------|----------|----------|----------|
             |   Same   |   Diff   |    Same  |   Diff   |
             |----------|----------|----------|----------|
   0-60 sec  |       92 |        0 |      100 |        4 |
   1-10 min  |        1 |        0 |       14 |        6 |
   10min-1hr |        0 |        0 |       19 |        4 |
   1hr-1day  |        1 |        0 |       13 |        0 |
   1day-1wk  |        1 |        0 |        1 |        0 |
   > 1wk     |        0 |        0 |        0 |        0 |
             |-------------------------------------------|
   
</PRE>
<P><H3><A NAME="HDRWQ307" HREF="auagd002.htm#ToC_237">1 つのボリュームの VLDB 項目およびボリューム・ヘッダーの表示</A></H3>
<A NAME="IDX6621"></A>
<A NAME="IDX6622"></A>
<A NAME="IDX6623"></A>
<A NAME="IDX6624"></A>
<A NAME="IDX6625"></A>
<A NAME="IDX6626"></A>
<A NAME="IDX6627"></A>
<P><B>vos examine</B> コマンドは、単一ボリュームに対する VLDB およびボリューム・ヘッダーの両方から情報を表示します。
VLDB およびボリューム・ヘッダーを比較できるようにする 2 つのソースからの情報には冗長度があります。
<P>ボリュームのバージョン (読み取り / 書き込み、読み取り専用、およびバックアップ) ごとにボリューム・ヘッダーが異なるため、どれを表示するかを指定することができます。
<VAR>volume name or ID</VAR> 引き数に、適切に <B>.readonly</B> または <B>.backup</B> 拡張子を組み込みます。
VLDB からの情報は、3 つのどのバージョンでも同じです。
<A NAME="IDX6628"></A>
<A NAME="IDX6629"></A>
<P><H3><A NAME="HDRWQ308" HREF="auagd002.htm#ToC_238">1 つのボリュームの VLDB 項目およびボリューム・ヘッダーの表示</A></H3>
<OL TYPE=1>
<LI><B>vos examine</B> コマンドを発行します。
<P>
<PRE>   
   % <B>vos examine</B> &lt;<VAR>volume name or ID</VAR>>
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>e
</B><DD><B>examine</B> の最も短い受け入れ可能な省略形です。
<P><DT><B><VAR>volume name or ID</VAR>
</B><DD>1 つのボリュームを、その完全名またはボリューム ID 番号によって識別します。そのタイプは、読み取り / 書き込み、読み取り専用、またはバックアップです。適切な場合、<B>.backup</B> または <B>.readonly</B> 拡張子を使用します。
</DL>
</LI></OL>
<P>出力リストのトップ部分は、
<B>-long</B> フラグを使用して <B>vos listvol</B> コマンドを発行するときと同じボリューム・ヘッダーからの情報を表示します。このコマンドについての詳細は、<A HREF="#HDRWQ306">ボリューム・ヘッダーの表示</A> を参照してください。ボリュームの読み取り専用バージョンを指定し、それが複数のサイトで存在する場合、その出力にはそれらのすべてが含まれます。出力のボトム部分は、
<B>vos listvldb</B> コマンドを発行するときと同じ VLDB からの情報をリストします。このコマンドの詳細については、<A HREF="#HDRWQ304">VLDB 項目の表示</A> を参照してください。
<P>次は、VLDB 項目がロック状態になっているボリュームの例です。
<PRE>   
   % <B>vos examine user.terry</B>
   user.terry                    536870981 RW   3459 K On-line
       fs3.abc.com /vicepa
       Write 5360870981   ROnly          0  Backup 536870983
       MaxQuota      40000 K
       Creation    Mon Jun 12 15:22:06 1989
       Last Update Fri Jun 16 09:34:35 1989
       5719 accesses in the past day (i.e., vnode references)
       RWrite: 5360870981   Backup: 536870983
       number of sites -> 1
          server fs3.abc.com partition /vicepa RW Site 
       Volume is currently LOCKED
   
</PRE>
<P><H3><A NAME="HDRWQ309" HREF="auagd002.htm#ToC_239">ファイルを含むボリューム名またはボリューム位置の表示</A></H3>
<P>このセクションでは、ファイルやディレクトリーを含むボリュームの名前、ボリューム ID 番号、またはボリュームの位置を入手する方法について説明します。
<P>また、ボリュームに関する 1 つの情報 (名前など) を使用して、そのボリュームのその他の情報 (位置など) を入手することもできます。以下に、関連情報をリストします。
<UL>
<A NAME="IDX6630"></A>
<A NAME="IDX6631"></A>
<A NAME="IDX6632"></A>
<A NAME="IDX6633"></A>
<A NAME="IDX6634"></A>
<A NAME="IDX6635"></A>
<A NAME="IDX6636"></A>
<A NAME="IDX6637"></A>
<A NAME="IDX6638"></A>
<A NAME="IDX6639"></A>
<LI>ボリューム名を使用して、すべての既存バージョンのボリューム ID 番号を入手するには、
<A HREF="#HDRWQ308">1 つのボリュームの VLDB 項目およびボリューム・ヘッダーの表示</A> で説明する <B>vos examine</B> コマンドを使用します。
<P>
<P>ID 番号を提供してボリューム名を入手するコマンドを使用することもできます。
</LI><LI>ボリューム名または ID 番号を使用してその位置を入手するには、
<A HREF="#HDRWQ304">VLDB 項目の表示</A> で説明する <B>vos listvldb</B> コマンドを使用します。
<A NAME="IDX6640"></A>
<A NAME="IDX6641"></A>
<A NAME="IDX6642"></A>
<A NAME="IDX6643"></A>
<A NAME="IDX6644"></A>
<A NAME="IDX6645"></A>
</LI></UL>
<A NAME="IDX6646"></A>
<A NAME="IDX6647"></A>
<A NAME="IDX6648"></A>
<A NAME="IDX6649"></A>
<A NAME="IDX6650"></A>
<A NAME="IDX6651"></A>
<P><H4><A NAME="HDRWQ310">ファイルを含むボリューム名の表示</A></H4>
<OL TYPE=1>
<LI><B>fs listquota</B> コマンドを発行します。
<P>
<PRE>   
   % <B>fs listquota</B> [&lt;<VAR>dir/file path</VAR>>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>lq
</B><DD><B>listquota</B> の受け入れ可能な別名です ( <B>listq</B>は受け入れ可能な最も短い省略形です)。
<P><DT><B><VAR>dir/file path</VAR>
</B><DD>名前が表示されるボリューム内に収容されたディレクトリーまたはファイルの名前です。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。これは、この引き数を省略する場合のデフォルトです。
</DL>
</LI></OL>
<P>次は、出力の例です。
<PRE>   
   % <B>fs listquota /afs/abc.com/usr/terry</B>
   Volume Name     Quota    Used    % Used   Partition 
   user.terry      15000    5071       34%         86%   
   
</PRE>
<A NAME="IDX6652"></A>
<A NAME="IDX6653"></A>
<A NAME="IDX6654"></A>
<A NAME="IDX6655"></A>
<A NAME="IDX6656"></A>
<A NAME="IDX6657"></A>
<P><H4><A NAME="HDRWQ311">ファイルを含むボリュームの ID 番号の表示</A></H4>
<OL TYPE=1>
<LI><B>fs examine</B> コマンドの発行
<P>
<PRE>   
   % <B>fs examine</B> [&lt;<VAR>dir/file path</VAR>>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>exa
</B><DD><B>examine</B> の最も短い受け入れ可能な省略形です。
<P><DT><B><VAR>dir/file path</VAR>
</B><DD>ボリューム ID を表示するボリューム内に収容されたディレクトリーまたはファイルの名前です。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。これは、この引き数を省略する場合のデフォルトです。
</DL>
</LI></OL>
<P>以下の例に、
<TT>vid</TT> フィールドにボリューム ID 番号が出力される形式を図示します。
<PRE>   
   % <B>fs examine /afs/abc.com/usr/terry</B>
   Volume status for vid = 50489902 named user.terry
   Current maximum quota is 15000
   Current blocks used are 5073
   The partition has 46383 blocks available out of 333305  
   
</PRE>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">このコマンドの出力に含まれる区画関連の統計は、標準 UNIX の <B>df</B> コマンドの出力に含まれる対応する値と常に一致するとは限りません。キャッシュ・マネージャーは 5 分間隔でファイル・マネージャーをポーリングして区画情報を得るので、このコマンドによって報告される統計は 5 分前のものである可能性があります。また、オペレーティング・システムによっては、<B>df</B> コマンドの区画サイズ報告には、このコマンドによる計算には含まれない予約済みのスペースが含まれるので、約 10% 大きくなることがあります。
</TD></TR></TABLE>
<A NAME="IDX6658"></A>
<A NAME="IDX6659"></A>
<A NAME="IDX6660"></A>
<A NAME="IDX6661"></A>
<A NAME="IDX6662"></A>
<A NAME="IDX6663"></A>
<A NAME="IDX6664"></A>
<P><H4><A NAME="Header_242">ファイルを含むボリューム位置の表示</A></H4>
<OL TYPE=1>
<LI><B>fs whereis</B> コマンドを発行して、ファイルまたはディレクトリーを含むボリュームを収容するファイル・サーバー・マシン名を表示します。
<P>
<PRE>   
   % <B>fs whereis</B> [&lt;<VAR>dir/file path</VAR>>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>whe
</B><DD>は、<B>whereis</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>dir/file path</VAR>
</B><DD>位置を報告するディレクトリーまたはファイルの名前です。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。これは、この引き数を省略する場合のデフォルトです。
</DL>
<P>
<P>出力では、以下のように、ファイルを含むボリュームを収容するファイル・サーバー・マシンが表示されます。
<P>
<PRE>   
   % <B>fs whereis /afs/abc.com/user/terry</B>
   File /afs/abc.com/usr/terry is on host fs2.abc.com
   
</PRE>
</LI><LI>ボリュームを収容するパーティションも知りたい場合は、まず <B>fs listquota</B> コマンドを発行し、そのボリューム名を表示します。完全な構文については、<A HREF="#HDRWQ310">ファイルを含むボリューム名の表示</A> を参照してください。
<P>
<PRE>   
   % <B>fs listquota</B> [&lt;<VAR>dir/file path</VAR>>]
   
</PRE>
<P>
<P>次に、<B>vos listvldb</B> コマンドを発行して、
<VAR>volume name or ID</VAR> 引き数としてボリューム名を提供します。完全な構文および出力説明については、
<A HREF="#HDRWQ304">VLDB 項目の表示</A> を参照してください。
<P>
<PRE>   
   % <B>vos listvldb</B> &lt;<VAR>volume name or ID</VAR>>
   
</PRE>
</LI></OL>
<HR><H2><A NAME="HDRWQ312" HREF="auagd002.htm#ToC_243">ボリュームの移動</A></H2>
<A NAME="IDX6665"></A>
<A NAME="IDX6666"></A>
<P>ボリュームを移動する 3 つの主な理由を次に示します。
<UL>
<LI>ディスクまたはファイル・サーバー・マシンを修理または置換している際に、一時的に他のパーティションまたはマシン上にボリュームを配置するため。
</LI><LI>過密になりつつあるパーティション上でスペースを空けるため。
<A NAME="IDX6667"></A>
<A NAME="IDX6668"></A>
<A NAME="IDX6669"></A>
<A NAME="IDX6670"></A>
<A NAME="IDX6671"></A>
<P>
過密の症状の 1 つは、関連ボリュームがその割り当て量以下でもファイルを保管することができなくなります。次のエラー・メッセージによって、問題を確認することができます。
<P>
<PRE>   
   afs: failed to store file (partition full)
   
</PRE>
<P>
<P><A HREF="auagd013.htm#HDRWQ439">AFS パフォーマンスのモニターおよび監査</A> で説明する <B>scout</B> または <B>afsmonitor</B> のプログラムを使用して、
AFS サーバー・パーティション上の使用可能スペースをトラックすることができます。
</LI><LI>ファイル・サーバーは、同じサイズの他のマシンに比べて、さらに多くのボリュームを格納するため、あるいは、より一般的なファイルを持つボリュームがあるため過負荷になりかけています。
</LI></UL>
<P>
<A NAME="IDX6672"></A>
<A NAME="IDX6673"></A>
読み取り / 書き込みボリュームを移動するには、これから説明する <B>vos move</B> コマンドを使用します。ボリュームを移動する前に、<B>vos</B> コマンド・インタープリターは、移動先のパーティションに十分な空きスペースがあるかどうかを検証します。ない場合には、移動操作は行われず、次のメッセージが印刷されます。
<PRE>   
   vos: no space on target partition <VAR>destination_part</VAR> to move volume <VAR>volume</VAR>
   
</PRE>
<P>読み取り / 書き込みボリュームを移動するには、
<A HREF="#HDRWQ322">ボリュームを除去して、取り外し解除する方法</A> で説明する <B>vos remove</B> コマンドを使用して、実際は現行サイトからボリュームを除去します。そして、
<A HREF="#HDRWQ280">読み取り / 書き込みボリュームの複写 (読み取り専用ボリュームの作成)</A> で説明する <B>vos addsite</B> および <B> vos release</B> のコマンドを発行して、新規サイトを定義し、そのサイトへボリュームをリリースします。
<A NAME="IDX6674"></A>
<A NAME="IDX6675"></A>
<P>バックアップ・ボリュームは、常に読み取り / 書き込みソース・ボリュームと同じサイトに常駐します。したがって、読み取り / 書き込みソースを移動させる一環として以外では、バックアップ・ボリュームを移動させることはできません。
<B>vos move</B> コマンドは、読み取り / 書き込みボリュームを移動させる際に、自動的にバックアップ・バージョンを削除します。移動操作が完了してすぐに新規サイトで新規のバックアップ・ボリュームを作成するには、
<A HREF="#HDRWQ291">バックアップ・ボリュームの作成および取り付け</A> で説明する <B>vos backup</B> コマンドを発行します。
<A NAME="IDX6676"></A>
<A NAME="IDX6677"></A>
<P><H3><A NAME="Header_244" HREF="auagd002.htm#ToC_244">読み取り / 書き込みボリュームの移動</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>vos move</B> コマンドを発行し、ボリュームを移動します。1 つの行にコマンドを入力します。ここでコマンドが複数行に表示されているのは、読みやすくするためです。
<P>
<PRE>   
   % <B>vos move</B> &lt;<VAR>volume name or ID</VAR>>  \
       &lt;<VAR>machine name on source</VAR>>  &lt;<VAR>partition name on source </VAR>>  \
       &lt;<VAR>machine name on destination</VAR>>  &lt;<VAR>partition name on destination</VAR>>
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>m
</B><DD>は、<B>move</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>volume name or ID</VAR>
</B><DD>移動させる読み取り / 書き込みボリュームの名前またはボリューム ID を指定します。
<P><DT><B><VAR>machine name on source</VAR>
</B><DD>現在ボリュームを収容しているファイル・サーバー・マシンの名前を指定します。
<P><DT><B><VAR>partition name on source</VAR>
</B><DD>ボリュームを格納するパーティションの名前です。
<P><DT><B><VAR>machine name on destination</VAR>
</B><DD>ボリュームの移動先であるファイル・サーバー・マシンの名前です。
<P><DT><B><VAR>partition name on destination</VAR>
</B><DD>ボリュームの移動先であるパーティションの名前です。
</DL>
<P>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">ボリュームの一部がソースまたは移動先のマシンの両方に残される可能性があるため、
<B>vos move</B> 操作を完了前に停止させないことが大切です。詳細については、<I>AFS Administration Reference</I> のコマンドの解説ページを参照してください。
</TD></TR></TABLE>
</LI><LI><B> (オプション)</B> 移動の成功を確認するためには、<B>vos listvldb</B> コマンドを発行します。詳細は、<A HREF="#HDRWQ304">VLDB 項目の表示</A> を参照してください
<P>
<PRE>   
   % <B>vos listvldb</B> &lt;<VAR>volume name or ID</VAR>>
   
</PRE>
</LI><LI>バックアップ・バージョンが、以前の読み取り / 書き込みボリュームのサイトに存在した場合、
<B>vos backup</B> コマンドを発行して新規サイトで新規バックアップを作成します。これについての詳細は、<A HREF="#HDRWQ291">バックアップ・ボリュームの作成および取り付け</A> を参照してください。
<P>
<PRE>   
   % <B>vos backup</B> &lt;<VAR>volume name or ID</VAR>>
   
</PRE>
</LI></OL>
<HR><H2><A NAME="HDRWQ313" HREF="auagd002.htm#ToC_245">VLDB およびボリューム・ヘッダーの同期化</A></H2>
<A NAME="IDX6678"></A>
<A NAME="IDX6679"></A>
<A NAME="IDX6680"></A>
<P>AFS は、ボリューム・ロケーション・データベース (VLDB) が定期的にボリュームの位置をトラックするため、透過的なファイル・アクセスを提供します。キャッシュ・マネージャーは、ファイルが必要な場合はボリューム・ロケーション (VL) サーバーと連絡をとります。すると、VL サーバーは VLDB を読み、そのファイルが含まれるボリュームの現行の位置を見つけます。したがって、VLDB は常に、ファイル・サーバー・マシン上のボリュームの状態を正確に反映する必要があります。ボリューム・サーバーおよび VL サーバーは、
<B>vos</B> オペレーション中にボリュームの状態が変更されると、自動的にボリュームの VLDB 項目を更新します。これには、以下の一連のステップを実行します。
<OL TYPE=1>
<LI><A NAME="LIWQ314"></A>VL サーバーは、VLDB 項目をロックします。ロックは、任意のボリューム・バージョン (読み取り / 書き込み、読み取り専用、バックアップ) を操作しないよう他の操作に伝えて、複数の同時操作から生じる可能性がある混乱を防ぎます。
</LI><LI><A NAME="LIWQ315"></A>VL サーバーは、実行する操作の種類を表す VLDB項目に <I>意図フラグ</I> を設定します。
<A NAME="IDX6681"></A>
<A NAME="IDX6682"></A>
このフラグは内部使用専用であるため、
VLDB リストに表示されることは絶対にありません。操作が途中で終了してしまった場合に備えて、このフラグはどの操作に割り込みがあったかをサルベージャーに通知します。
(その場合、サルベージャーは、操作を完了させる、またはボリュームを直前の一貫した状態に戻すために必要なステップを決定します。サルベージについての詳細は、
<A HREF="#HDRWQ318">ボリュームのサルベージ</A> を参照してください。)
</LI><LI><A NAME="LIWQ316"></A>ボリューム・サーバーは、ボリュームを操作します。通常このサーバーは、ボリューム・ヘッダーに <TT>Off-line</TT> フラグを設定し、操作中にボリュームをファイル・サーバーおよび他のボリューム・サーバー操作にアクセス不能にします。操作が完了すると、ボリュームは再び <TT>On-line</TT> というマークが付きます。
</LI><LI><A NAME="LIWQ317"></A>VL サーバーは、VLDB 項目の操作の結果として生じる任意の変更を記録します。操作が完了すると、
<A HREF="#LIWQ315">2</A> のステップで設定される意図フラグを除去し、
<A HREF="#LIWQ314">1</A> のステップのロックをリリースします。
</LI></OL>
<P>ボリューム・サーバーがボリュームを操作している際に、
<B>vos</B> オペレーションが失敗すると
(<A HREF="#LIWQ316">3</A> のステップに対応)、ボリュームは、<I>破壊</I> と呼ばれる中間状態に残されます。この場合、<TT>Off-line</TT> または <TT>Off-line**needs salvage**</TT> のマーカーは、普通、<B>vos examine</B> コマンドからの出力の最初の行の末尾に表示されます。破壊を修理するには、
VLDB およびボリューム・ヘッダーの再同期を試みる前に、サルベージャーを実行する必要があります。これについての詳細は、<A HREF="#HDRWQ318">ボリュームのサルベージ</A> を参照してください。
<P>より一般的なものには、フラグが設定され取り除かれたときに中断によって
(<A HREF="#LIWQ314">1</A> のステップ、<A HREF="#LIWQ315">2</A> のステップ、
<A HREF="#LIWQ317">4</A> のステップに対応)、
VLDB とボリューム・ヘッダーの間で矛盾が起こります。
VLDB およびボリュームを再同期するには、
<B>vos syncvldb</B> および <B>vos syncserv</B> コマンドを使用します。
VLDB の整合性を完全にするために最適な方法は、セル内のすべてのファイル・サーバー・マシン上で <B>vos syncvldb</B> コマンドを実行し、次に <B>vos syncserv</B> コマンドを実行します。
<A NAME="IDX6683"></A>
<A NAME="IDX6684"></A>
<A NAME="IDX6685"></A>
<P>以下に、ボリューム操作が失敗したことを示すいくつかの症状を示します。
<UL>
<LI>標準エラー・ストリーム上またはサーバー・プロセス・ログ・ファイル内のエラー・メッセージが、操作が異常終了したことを示します。これは、おそらく、ユーザーが完了前にその操作を
(<B>Ctrl-c</B> の記号を使用するなどして) 停止しなければならなかった、または、ファイル・サーバー・マシンまたはサーバー・プロセスが、操作実行中に機能していなかった、などの理由によります。マシンまたはプロセスが今も機能していないかどうかを判断するには、
<A HREF="auagd009.htm#HDRWQ205">BosConfig ファイルのプロセス状況および情報の表示</A> で説明する <B>bos status</B> コマンドを発行します。
</LI><LI>以降の <B>vos</B> オペレーションは、直前の障害により VLDB 項目がロック状態のまま残されたため失敗します。エラー・メッセージに、ボリュームがロックされていると表示されることもあります。ロックされたボリュームのリストを表示するには、
<B>vos listvldb</B> コマンドで <B>-locked</B> フラグを使用します。詳細は、<A HREF="#HDRWQ303">VLDB 項目の表示</A> を参照してください。
<P>
<P>ボリュームの唯一の問題が、VLDB 項目がロックされていることである場合は、おそらく VLDB 全体を同期化する必要はありません。
<B>vos unlock</B> または <B>vos unlockvldb</B>コマンドを代わりに使用します。このコマンドについての詳細は、<A HREF="#HDRWQ333">VLDB 項目のロック解除およびロック</A> を参照してください。
</LI><LI>以降の <B>vos</B> オペレーションは、直前の障害によってオフラインとしてマークされたボリュームが残ったため失敗します。ボリュームの現行状態を検査するには、
<B>vos examine</B> コマンドからの出力の最初の行を検査します。詳細は、<A HREF="#HDRWQ307">1 つのボリュームの VLDB 項目およびボリューム・ヘッダーの表示</A> を参照してください。
</LI></UL>
<A NAME="IDX6686"></A>
<A NAME="IDX6687"></A>
<A NAME="IDX6688"></A>
<A NAME="IDX6689"></A>
<A NAME="IDX6690"></A>
<P><B>vos syncvldb</B> コマンドは、ボリューム・ロケーション・データベース (VLDB) 内の情報を訂正します。この情報は、ファイル・サーバー・マシン上に収容されたすべてのボリュームに関する情報、ただ 1 つのパーティション上のボリュームに関する情報、または単一ボリュームに関する情報のいずれかです。
1 つまたは複数のパーティションについて検査する場合、コマンドはボリューム・サーバーと接触して、各パーティションに実際に常駐するボリュームのリストを入手します。次に、VL サーバーからボリュームごとの VLDB 項目を入手します。そして、パーティション上のボリュームの状態を反映させるために必要な VLDB 項目の変更を行います。たとえば、VLDB 項目が欠けていたり未完全なボリュームを見つけると、コマンドは VLDB 項目を作成または更新します。しかし、ボリュームに対して異なる位置が定義されている VLDB 項目がすでにある場合、または、他の VLDB 項目との調和不可能な衝突がある場合は、代わりに衝突に関するメッセージを標準エラー・ストリームへ書き込みます。コマンドによって、ファイル・サーバー・マシンからボリュームが取り除かれることはありません。
<P>単一ボリュームの VLDB 項目を検査する場合にも、コマンドは自動的に <B>vos syncserv</B> コマンドによって起動される操作を実行します。これは、VLDB 項目が指定のボリューム・タイプ (読み取り / 書き込み、バックアップ、または読み取り専用) 用に正しいかどうかを検証するだけでなく、
VLDB 項目で言及される関連ボリューム・タイプが、項目内でリストされるサイトに実際に存在するかどうかを検査します。
<A NAME="IDX6691"></A>
<P><B>vos syncserv</B> コマンドは、
VLDB 項目内で言及される各ボリューム・タイプ
(読み取り / 書き込み、読み取り専用、およびバックアップ) が、項目内に示されるサイトに実際に存在するかどうかを検査します。任意のファイル・サーバー・マシンの複数のパーティション上、または、
1 つのパーティション上においてサイトに言及するすべての VLDB 項目を検査します。ボリュームの読み取り専用バージョンが、読み取り / 書き込みサイト以外のサイトにある場合、コマンドは、指定したマシンまたはパーティション上以外のサイトを検査して終了する可能性があることに注意してください。
<P>他の VLDB 項目との調和不可能な衝突がなければ、コマンドは VLDB 内の誤った情報を変更します。この場合、代わりに、標準エラー・ストリームへメッセージを書き込みます。コマンドによって、サイトからボリュームが取り除かれることはありません。
<A NAME="IDX6692"></A>
<A NAME="IDX6693"></A>
<A NAME="IDX6694"></A>
<A NAME="IDX6695"></A>
<P><H3><A NAME="Header_246" HREF="auagd002.htm#ToC_246">ボリューム・ヘッダーとの VLDB の同期化 headers</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><A NAME="LIVOL-SYNCVL"></A>マシンまたはパーティション上のすべてのボリュームの正しい状態を VLDBに反映させるために、<B>vos syncvldb</B> コマンドを発行します。
<P>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">VLDB を完全に同期化するには、
<A HREF="#LIVOL-SYNCSR">3</A> のステップに進む前にコマンドを繰り返し発行し、セル内の各ファイル・サーバー・マシンを順番に <B>-server</B> 引き数の代わりに用いて、
<B>-partition</B> および <B>-volume</B> 引き数を省略します。
</TD></TR></TABLE>
<P>
<PRE>   % <B>vos syncvldb -server</B> &lt;<VAR>machine name</VAR>> [<B>-partition</B> &lt;<VAR>partition name</VAR>>]
                          [<B>-volume</B> &lt;<VAR>volume name or ID</VAR>>]  [<B>-verbose >></B> <VAR>file</VAR>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>syncv
</B><DD>は、<B>syncvldb</B> の受け入れ可能な省略形です。
<P><DT><B>-server
</B><DD>VLDB 項目を検査するボリュームを収納しているファイル・サーバー・マシンの名前を指定します。
<B>-volume</B> 引き数も提供している場合は、この引き数にはボリュームが実際に常駐するマシンを指定する必要があります。
<P><DT><B>-partition
</B><DD>VLDB 項目を検証するボリュームを収納しているパーティション
(<B>-server</B> 引き数が指定したファイル・サーバー・マシン上の) を識別します。通常は、この引き数を省略することが最適です。そうすることによって、サーバー・マシン上のすべてのボリュームの VLDB 項目が訂正され (<B>-volume</B> 引き数を提供しない場合)、もしくは、パーティションが実際に <B>-volume</B> 引き数が指定したボリュームを含んでいるかどうかを保証する必要がなくなります。
<P><DT><B>-volume
</B><DD>VLDB 項目を検査する単一ボリュームの名前またはボリューム ID 番号を指定します。
<P><DT><B><B>-verbose >></B> <VAR>file</VAR>
</B><DD>AFS 内またはコマンドを発行しているマシンのローカル・ディスク上のいずれかにある、
<VAR>file</VAR> と呼ばれるファイルへ詳細なトレースを指示します。コマンドは、しばしば、大量の出力を標準出力ストリームへ書き込みます。これをファイルへ書き込むことによって、ユーザーはその出力をより詳細に検査することができます。
</DL>
</LI><LI><A NAME="LIVOL-SYNCSR"></A>VLDB によって指定のサイトにバージョンがリストされる各ボリュームを検査するには、
<B>vos syncserv</B> コマンドを発行します。
<P>
<P><TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">VLDB を完全に同期化するには、繰り返しコマンドを発行し、セル内の各ファイル・サーバー・マシンを <VAR>machine name</VAR> 引き数の代わりに順番に用いて、
<VAR>partition name</VAR> 引き数を省略します。
</TD></TR></TABLE>
<P>
<PRE>   % <B>vos syncserv</B> &lt;<VAR>machine name</VAR>> [&lt;<VAR>partition name</VAR>>] [<B>-v >></B> <VAR>file</VAR>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>syncs
</B><DD>は、<B>syncserv</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>検査する各 VLDB 項目内で言及されるファイル・サーバー・マシン名です。
<P><DT><B><VAR>partition name</VAR>
</B><DD>検査する各 VLDB 項目内で言及されるパーティションを識別します。
VLDB 全体を同期化する場合、この引き数は省略します。
<P><DT><B>-v >> <I><VAR>file</VAR></I>
</B><DD>AFS 内またはコマンドを発行しているマシンのローカル・ディスク上のいずれかにある、
<VAR>file</VAR> と呼ばれるファイルへ詳細なトレースを指示します。コマンドは、しばしば、大量の出力を標準出力ストリームへ書き込みます。これをファイルへ書き込むことによって、ユーザーはその出力をより詳細に検査することができます。
</DL>
</LI></OL>
<HR><H2><A NAME="HDRWQ318" HREF="auagd002.htm#ToC_247">ボリュームのサルベージ</A></H2>
<A NAME="IDX6696"></A>
<A NAME="IDX6697"></A>
<A NAME="IDX6698"></A>
<A NAME="IDX6699"></A>
<A NAME="IDX6700"></A>
<A NAME="IDX6701"></A>
<A NAME="IDX6702"></A>
<A NAME="IDX6703"></A>
<P>ボリューム・サーバーまたはファイル・サーバーがボリューム内のデータを操作しているときに予期しない中断が生じた場合、
VLDB およびボリューム・ヘッダー間で矛盾が発生するだけではなく、ボリュームは中間状態 (<I>破壊</I>) のまま残される可能性があります。たとえば、ファイルへの変更を保管する操作の失敗 (古いデータを新規のデータで上書きした場合) は、古いデータおよび新規のデータをディスク上で混合した状態で残す可能性があります。
<P>ボリューム・サーバーまたはファイル・サーバーが予期せずに終了したために操作が停止されると、
BOS サーバーは、自動的に <B>fs</B> プロセスのすべてのコンポーネントをシャットダウンし、サルベージャーを起動します。サルベージャーは矛盾をチェックし、修正できるものは修正します。ただし、問題が発生する程度の深刻さはあっても、ファイル・サーバー・コンポーネントに障害を起こすほどではない破壊を示す症状があります。この場合、サルベージャーを <B>bos salvage</B> コマンドを発行することによって自分で起動することができます。
<UL>
<LI><B>症状:</B> ファイルが <B>ls</B> コマンドの出力内に表示されるが、ファイルにアクセスしようとすると、ファイルが存在しないというメッセージが出されてアクセスできない。
<P>
<P><B>考えられる原因:</B> ボリューム・サーバーまたはファイル・サーバーがファイル作成操作の途中
(ディレクトリー構造の変更後で、実際にデータを保管する前) で終了しました。
(その他の考えられる理由としては、ディレクトリー上の ACL が、ファイルにアクセスするために必要なアクセス権を許可していない、もしくは、プロセス、マシン、またはネットワークの障害があります。ファイルが破壊されていると思う前に、これらの原因を検査してください。)
<P>
<P><B>サルベージャーによる解決</B> ディレクトリー構造からファイル項目を除去します。
</LI><LI><B>症状:</B>
<B>vos examine</B> および <B>vos listvol</B> のコマンドからの出力内で、ボリュームが <TT>Off-line</TT> とマークされる、または、ボリューム障害にアクセスしようとする。
<P>
<P><B>考えられる原因:</B> 2 つのファイルまたはファイルのバージョンは、操作が中断したため同じディスク・ブロックを共用します。このような破壊を示すボリュームの接続は大変危険であるため、ファイル・サーバーおよびボリューム・サーバーは通常これを拒否します。ボリューム・サーバーまたはファイル・サーバーが、影響を受けたディスク・ブロックの状況について不確実である場合、どちらのサーバーも、そこにさらに多くのデータを書き込もうとする場合があります。書き込みが行えなければ、データは失われます。この影響は連鎖する可能性があり、パーティション上のすべてのデータが失われる原因になります。
<P>
<P><B>サルベージャーによる解決</B>
パーティション全体を失うことがないよう、破壊されたディスク・ブロックのデータを削除します。
</LI><LI><B>症状:</B> <B>vos listvol</B> コマンドにより報告されるそれぞれのボリュームのサイズ統計に基づいた値よりも、パーティション上の使用可能スペースが少ない。
<P>
<P><B>考えられる原因:</B> 孤立したファイルおよびディレクトリーがあります。孤立要素は、その親となるディレクトリー (ファイル・ツリーの上位) による参照が行われないため、完全にアクセス不能です。孤立要素は、サーバー・パーティション上のスペースを占領していても、ボリュームのサイズ (または割り当て量) の計算に数えられません。
<P>
<P><B>サルベージャーによる解決:</B> デフォルトでは、
<B>/usr/afs/logs/SalvageLog</B> ファイルにメッセージを印刷し、孤立ファイル数およびその消費する K バイト数を報告します。
<B>-orphans</B> 引き数を使用して、孤立した要素を削除または接続することができます。<A HREF="#HDRWQ319">ボリュームのサルベージ方法</A>を参照してください。
</LI></UL>
<P>このような症状に気が付いた場合は、<B>bos salvage</B> コマンドを使用して破壊が広がる前にサルベージャーを起動してください。
(コマンドはボリューム上で稼働しますが、
<B>bos</B> スイートに含まれるものです。これは、サルベージャーを実行する際、BOS サーバーがボリューム・サーバーおよびファイル・サーバーの終了、および再始動を調整するためです。サルベージャーが開始する前に終了が行われ、サルベージ操作が終了すると自動的に再始動します。)
<P>1 つ以上のパーティションのサルベージ中は、ファイル・サーバー・マシン上に保管された AFS データはすべてアクセス不能です。
1 つのボリュームのみのサルベージを行うのであれば、これのみがアクセス不能になります。
<P>1 つまたは複数のパーティションの処理中に、コマンドは、破壊された読み取り / 書き込みボリュームへの整合性を復元できる場合は復元します。読み取り専用またはバックアップのボリュームの場合は、ボリューム・ヘッダーだけを検査します。
<UL>
<LI>ボリューム・ヘッダーが破壊されている場合、サルベージャーは、ボリュームを完全に削除し、ログ・ファイル <B>/usr/afs/logs/SalvageLog</B> にその削除を記録します。
<B>vos release</B> または <B>vos backup</B> のコマンドを発行して、読み取り専用またはバックアップのボリュームを再び作成します。
</LI><LI>ボリューム・ヘッダーが無傷の場合、サルベージャーは、ボリュームをスキップします (内容の破壊を検査しません)。しかし、ファイル・サーバーが開始時に破壊に気付いた場合、ファイル・サーバーは、ボリュームへの接続、またはボリュームをオンラインにすることを拒否する場合があります。この場合、<B>vos remove</B> または <B>vos zap</B> のコマンドを発行して、ボリュームを削除することが一番簡単な対処法です。そして、<B>vos release</B> または <B>vos backup</B> コマンドを発行して、再びボリュームを作成します。
</LI></UL>
<P>指示に従い、<B>bos salvage</B> コマンドの引き数を組み合わせることにより、異なる数のボリュームのサルベージを行います。
<UL>
<LI>ファイル・サーバー・マシン上のすべてのボリュームをサルベージするには、<B>-server</B> 引き数および <B>-all</B> フラグを組み合わせます。
</LI><LI>1 つのパーティション上のすべてのボリュームのみをサルベージするには、<B>-server</B> および <B>-partition</B> 引き数を組み合わせます。
</LI><LI>1 つの読み取り / 書き込みボリュームのみをサルベージするには、<B>-server</B> 、
<B>-partition</B>、および <B>-volume</B> 引き数を組み合わせます。
BOS サーバーは単一ボリュームのサルベージ中に、ファイル・サーバーおよびボリューム・サーバーをシャットダウンしないため、このボリュームだけがキャッシュ・マネージャーにアクセスできません。
<B>-volume</B> 引き数を使用して、読み取り専用またはバックアップのボリュームを指名しないでください。その代わりに、<B>vos remove</B> または <B>vos zap</B> のコマンドを使用して、ボリュームを削除します。そして、<B>vos release</B> または <B>vos backup</B> のコマンドを使用して、ボリュームの新規コピーを作成します。
</LI></UL>
<P>サルベージャーは常に、それが実行されているファイル・サーバー・マシンの <B>/usr/afs/logs/SalvageLog</B> ファイルにトレースを書き込みます。もう 1 つのファイル (AFS 内または <B>bos salvage</B> コマンドを発行するマシンのローカル・ディスク上) にもトレースを記録するには、そのファイルを <B>-file</B> 引き数を使用して指名します。または、<B>/usr/afs/logs/SalvageLog</B> ファイルに書き込まれるような標準出力ストリームにトレースを表示するには、<B>-showlog</B> フラグを組み込みます。
<P>デフォルトでは、複数のサルベージャー・サブプロセス (各パーティションにつき 1 つのサブプロセスで最大 4 つまで、
4 つ以上のパーティションには 4 つのサブプロセス) が並列して実行されます。並列して実行するサブプロセスの数を増減するには、
<B>-parallel</B> 引き数に正の整数値を指定します。
<P>物理ディスク上に複数のサーバー・パーティションが存在する場合、デフォルトでサルベージャーはこれを順次サルベージし、パーティション間で常時ディスク・ヘッドを移動することによる効率の悪化を避けます。ただし、パーティションが複数ディスクに及ぶ論理ボリュームとして構成されている場合、これは望ましい方法ではありません。サルベージャーが論理ボリュームを並列してサルベージするよう強制するには、
<B>-parallel</B> 引き数の値に文字列 <B>all</B> を指定します。並列して実行するサブプロセス数を指定するには、サルベージする論理ボリューム数に応じて、正の整数値を指定するか (例、<B>-parallel 5all</B> で 5 つのサブプロセスを指定)、整数を省略して最大 4 つのサブプロセスを実行します。
<P>サルベージャーは、実行時に一時ファイルを作成します。これはデフォルトでは、サルベージするパーティションに書き込まれます。ファイル数が非常に多くなる場合があり、パーティションにファイルが入りきらないと、サルベージャーはサルベージ操作を完了せずに終了します。終了前に一時ファイルは削除されます。同時に実行されている他のサルベージャー・サブプロセスは、一時ファイル用に十分なディスク・スペースがある他のパーティションをすべて完了するまで継続されます。中断されたサルベージ操作を完了するには、該当のパーティションにコマンドを再度発行します。その際、<B>-tmpdir</B> 引き数を追加して、十分なスペースのあるローカル・ディスク・ディレクトリーに一時ファイルを指定変更します。
<P><B>-orphans</B> 引き数を使用すると、サルベージ中にサーバー・パーティションに検出された孤立ファイルおよびディレクトリーの処理方法を制御できます。
<I>孤立</I> 要素は、その親となるディレクトリー (ファイル・スペースの上位) の vnode による参照が行われないため、完全にアクセス不能です。孤立オブジェクトがサーバー・パーティションのスペースを占有しても、ボリューム割り当て量にはカウントされません。
<P>サルベージ中は、<B>bos status</B> コマンドの出力により、
<B>fs</B> プロセスの以下の補助状況が報告されます。
<PRE>   
   Salvaging file system
   
</PRE>
<A NAME="IDX6704"></A>
<A NAME="IDX6705"></A>
<P><H3><A NAME="HDRWQ319" HREF="auagd002.htm#ToC_248">ボリュームのサルベージ方法</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>bos salvage</B> コマンドを発行して、1 つ以上のボリュームをサルベージします。
<P>
<PRE>   
   % <B>bos salvage  -server</B> &lt;<VAR>machine name</VAR>>
                  [<B>-partition</B> &lt;<VAR>salvage partition</VAR>>]  \
                  [<B>-volume</B> &lt;<VAR>salvage volume number or volume name</VAR>>]  \
                  [<B>-file</B> <VAR>salvage log output file</VAR>]  [<B>-all</B>]  [<B>-showlog</B>]  \
                  [<B>-parallel</B> &lt;<VAR># of max parallel partition salvaging</VAR>>]  \
                  [<B>-tmpdir</B> &lt;<VAR>directory to place tmp files</VAR>>]  \
                  [<B>-orphans</B> &lt;<B>ignore</B> | <B>remove</B> | <B>attach</B>>] 
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>-server
</B><DD>ボリュームをサルベージするファイル・サーバー・マシンの名前です。この引き数は、<B>-all</B> フラグまたは<B>-partition</B> 引き数と結合できます。もしくは、<B>-partition</B> および <B>-volume</B> の引き数の両方と結合できます。
<P><DT><B>-partition
</B><DD>すべてのボリュームをサルベージする単一のパーティションの名前です。<B>-server</B> 引き数は、これとともに使用する必要があります。
<P><DT><B>-volume
</B><DD>サルベージする 1 つの読み取り / 書き込みボリュームの名前またはボリューム ID 番号を指定します。この引き数を <B>-server</B> および <B>-partition</B> 引き数と結合します。
<P><DT><B>-file
</B><DD>サーバー・マシン上の <B>/usr/afs/logs/SalvageLog</B> ファイルに加えて、サルベージ操作のトレースを書き込むファイルの完全なパス名を指定します。ファイルのパス名がローカルである場合、トレースは、
<B>bos salvage</B> コマンドが発行されるマシンのローカル・ディスク上の指定ファイルに書き込まれます。
<B>-volume</B> 引き数を組み込むと、ファイルを AFS に置けますが、サルベージ中のボリュームには配置できません。この引き数を <B>-showlog</B> フラグと結合してはいけません。
<P><DT><B>-all
</B><DD><B>-server</B> 引き数で指定したマシン上のすべてのパーティションのすべてのボリュームをサルベージします。
<P><DT><B>-showlog
</B><DD>サルベージ操作のトレースを、
<B>/usr/afs/logs/SalvageLog</B> ファイルへ書き込むほか、標準出力ストリームに表示します。
<P><DT><B>-parallel
</B><DD>並列で実行するサルベージャー・サブプロセスの最大数を指定します。
3 つの値から 1 つを使用します。
<UL>
<LI><B>1</B> から <B>32</B> までの範囲の整数。値 <B>1</B> は、単一のサルベージャー・プロセスがパーティションのサルベージを順次行うことを意味します。
</LI><LI>文字列 <B>all</B>。複数の物理ディスクに及ぶ論理ボリュームとしてフォーマットされたパーティションで、最大 4 つのサルベージャー・サブプロセスを並行で実行します。このような論理ボリュームについてのみ使用してください。
</LI><LI>文字列 <B>all</B> に続く (スペースなし) <B>1</B> から <B>32</B> までの範囲の整数。論理ボリュームとしてフォーマットされたパーティションで指定数のサルベージャー・サブプロセスを実行します。このような論理ボリュームについてのみ使用してください。
</LI></UL>
<P>
<P>
<P>BOS サーバーは、パーティション数よりも多くのサルベージャー・サブプロセスを開始することはなく、単一ボリュームのサルベージには常に 1 つのプロセスのみを開始します。この引き数を省略すると、最大 4 つまでのサルベージャー・サブプロセスが並列して実行されます。
<P><DT><B>-tmpdir
</B><DD>サルベージャー・プロセスの実行中に、一時ファイルを書き込むローカル・ディスク・ディレクトリーの全パス名を指定します。デフォルトでは、一時ファイルは現在サルベージを行っているパーティションに書き込まれます。
<P><DT><B>-orphans
</B><DD>サルベージャーによる孤立ファイルおよびディレクトリーの処理方法を制御します。以下の 3 つの値のいずれかを選択します。
<P>
<DL>
<P><DT><B>ignore
</B><DD>ディスクに孤立オブジェクトを残しますが、
<B>/usr/afs/logs/SalvageLog</B> ファイルにメッセージを印刷し、孤立ファイル数およびその消費する K バイト数を報告します。これは <B>-orphans</B> 引き数を省略した場合、デフォルトです。
<P><DT><B>remove
</B><DD>孤立オブジェクトを除去し、<B>/usr/afs/logs/SalvageLog</B> ファイルにメッセージを印刷し、除去した孤立ファイル数およびその消費していた K バイト数を報告します。
<P><DT><B>attach
</B><DD>孤立オブジェクトへの参照を、ボリュームのルート・ディレクトリーの vnodeに作成し、これを接続します。それぞれのオブジェクトの実名は失われているため、サルベージャーは以下の形式の名前をそれぞれ割り当てます。
<P>
<DL>
<DD><P><B>_ _ORPHANFILE_ _.</B><VAR>index</VAR> (ファイルの場合)
<DD><P><B>_ _ORPHANDIR_ _.</B><VAR>index</VAR> (ディレクトリーの場合)
</DL>
<P>
<P>
<P><VAR>index</VAR> は、それぞれのオブジェクトを固有に識別する 2 桁の数です。孤立オブジェクトは、ボリューム割り当て量に対して変換され、ボリュームのルート・ディレクトリーに発行した <B>ls</B> コマンドの出力に表示されます。
</DL>
</DL>
</LI></OL>
<HR><H2><A NAME="HDRWQ320" HREF="auagd002.htm#ToC_249">ボリューム割り当て量および現行サイズの設定および表示</A></H2>
<A NAME="IDX6706"></A>
<A NAME="IDX6707"></A>
<P>すべての AFS ボリュームには、ボリュームのサイズを制限する関連した<VAR>割り当て量</VAR>があります。新規作成ボリューム用のデフォルトの割り当て量は、5,000 K バイト・ブロック
(5 MB より少し少ない) です。ボリュームがその割り当て量に達すると、ファイル・サーバーは、新規ファイルまたはディレクトリーを作成を拒否します。アプリケーションが、データをフル・ボリューム内の既存ファイルへ書き込んでいる場合、ファイル・サーバーは定義された過多量を許可します (デフォルトでは 1 MB)。
(<B>fileserver</B> コマンドの <B>-spare</B> または <B>-pctspare</B> 引き数を使用して、デフォルトの過多量を変更できます。<I>AFS Administration Reference</I> のコマンドの解説ページを参照してください。)
<P>ボリューム作成時に 5000 KB 以外の割り当て量を設定するには、
<A HREF="#HDRWQ271">読み取り / 書き込みボリュームの作成</A> で説明するように、
<B>-maxquota</B> 引き数を <B>vos create</B> コマンドへ組み込みます。既存のボリューム割り当て量を変更するには、以下で説明する
<B>fs setquota</B> または <B>fs setvol</B> コマンドを発行します。既存のボリューム割り当て量をその現行サイズよりも低く設定しないでください。
<P>一般的には、ボリュームが大きいより小さい方が管理が簡単です。ロード・バランシングなどの目的で、ボリュームを移動する必要がある場合は、小さなボリューム用の他のパーティション上に十分な空きスペースを見つけることの方が簡単です。移動操作は、小さなボリュームほど迅速に完了します。これは、移動操作に割り込む障害やその他のエラーの可能性が少なくなるためです。
AFS は最大ボリューム・サイズをサポートしますが、これは AFS リリースごとに異なります。お使いのバージョンの <I>AFS Release Notes</I> を参照してください。また、ボリュームは複数のパーティションまたは論理ボリュームをスパンできないため、パーティションまたは論理のサイズによって、ボリューム・サイズに絶対制限が付きます。
<P>通常、すべてのボリュームが最大割り当て量に達した場合、入りきらないほどのボリュームを入れてパーティションをオーバー・パックしても大丈夫です。ただし、セルをどの程度までオーバー・パックできるかは、経験によって判断するしかありません。ボリュームにどの種類の割り当て量を割り当てるか (特に、予測不能に成長するシステム・ボリュームより可能性があるユーザー・ボリューム)、および割り当て量に比較して生成および格納される情報の量によって決まります。
<P>以下で説明するように、ボリュームの割り当て量を表示するコマンドがいくつかあります。作成される関連情報の量は、それぞれ異なります。
<P><H3><A NAME="Header_250" HREF="auagd002.htm#ToC_250">単一ボリューム用の割り当て量の設定</A></H3>
<A NAME="IDX6708"></A>
<A NAME="IDX6709"></A>
<A NAME="IDX6710"></A>
<A NAME="IDX6711"></A>
<A NAME="IDX6712"></A>
<OL TYPE=1>
<LI>ユーザーが <B>system:administrators</B> グループに属しているかどうかを検査します。必要な場合には、<B>pts membership</B> コマンドを発行してください。このコマンドの詳細は、<A HREF="auagd021.htm#HDRWQ810">system:administrators グループのメンバーの表示</A> を参照してください。
<P>
<PRE>   % <B>pts membership system:administrators</B>
   
</PRE>
</LI><LI><B>fs setquota</B> コマンドを発行して、ボリュームの最大割り当て量を設定します。
<P>
<PRE>   
   % <B>fs setquota</B> [&lt;<VAR>dir/file path</VAR>>] <B>-max</B> &lt;<VAR>max quota in kbytes</VAR>>
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>sq
</B><DD>は、<B>setquota</B> に対する受け入れ可能なエイリアスです。
<P><DT><B><VAR>dir/file path</VAR>
</B><DD>指示された割り当て量を設定するボリューム内のファイルまたはディレクトリーの名前を指定します。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。これは、この引き数を省略する場合のデフォルトです。
<P>
<P>読み取り専用ボリュームを変更しようとするときに生じる障害を回避するために、ファイルまたはディレクトリーへの読み取り / 書き込みパスを指定します。規則では、パス名の第 2 レベルでセル名の前にピリオドを置いて、読み取り / 書き込みパスを示します (たとえば、
<B>/afs/.abc.com</B>)。読み取り / 書き込みパスおよび読み取り専用パスの概念についての詳細は、
<A HREF="#HDRWQ295">マウント・ポイント横断の規則</A> を参照してください。
<P><DT><B><VAR>max quota in kbytes</VAR>
</B><DD>K バイト・ブロックの単位で表されたボリューム割り当て量を設定します (<B>1024</B> は 1 M バイトと同等)。
<B>0</B> の値は、無制限の割り当て量を付与しますが、パーティションのサイズには絶対制限が付きます。
<VAR>dir/file path</VAR> 引き数を省略する場合は、
<B>-max</B> スイッチを組み込む必要があります
(現行作業ディレクトリーを収容するボリュームに割り当て量を設定するため)。
</DL>
</LI></OL>
<P><H3><A NAME="Header_251" HREF="auagd002.htm#ToC_251">1 つ以上のボリュームに最大割り当て量を設定する方法</A></H3>
<A NAME="IDX6713"></A>
<A NAME="IDX6714"></A>
<A NAME="IDX6715"></A>
<A NAME="IDX6716"></A>
<OL TYPE=1>
<LI>ユーザーが <B>system:administrators</B> グループに属しているかどうかを検査します。必要な場合には、<B>pts membership</B> コマンドを発行してください。このコマンドの詳細は、<A HREF="auagd021.htm#HDRWQ810">system:administrators グループのメンバーの表示</A> を参照してください。
<P>
<PRE>   % <B>pts membership system:administrators</B>
   
</PRE>
</LI><LI>1 つ以上のボリュームに割り当て量を設定するには、<B>fs setvol</B> コマンドを発行します。
<P>
<PRE>   
   % <B>fs setvol</B> [&lt;<VAR>dir/file path</VAR>><SUP>+</SUP>] <B>-max</B> &lt;<VAR>disk space quota in 1K units</VAR>>
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>sv
</B><DD>は、<B>setvol</B> に対する受け入れ可能なエイリアスです。
<P><DT><B><VAR>dir/file path</VAR>
</B><DD>指示された割り当て量を設定する各ボリューム内のファイルまたはディレクトリーの名前を指定します。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。これは、この引き数を省略する場合のデフォルトです。
<P><DT><B><VAR>ディスク・スペース割り当て量  (K バイト単位)</VAR>
</B><DD>K バイト・ブロックの単位で表された最大割り当て量を各ボリュームに設定します (<B>1024</B> は 1 M バイトと同等)。
<B>0</B> の値は、無制限の割り当て量を付与しますが、パーティションのサイズは絶対制限が付きます。
</DL>
</LI></OL>
<A NAME="IDX6717"></A>
<A NAME="IDX6718"></A>
<A NAME="IDX6719"></A>
<A NAME="IDX6720"></A>
<P><H3><A NAME="Header_252" HREF="auagd002.htm#ToC_252">使用割り当て量のパーセント表示</A></H3>
<OL TYPE=1>
<LI><B>fs quota</B> コマンドを発行します。
<P>
<PRE>   
   % <B>fs quota</B> [&lt;<VAR>dir/file path</VAR>><SUP>+</SUP>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>q
</B><DD>は、<B>quota</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>dir/file path</VAR>
</B><DD>割り当て量の使用済みパーセントを表示する各ボリューム内のディレクトリーまたはファイルの名前です。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。これは、この引き数を省略する場合のデフォルトです。
</DL>
</LI></OL>
<P>以下の例は、このコマンドが作成した出力の形式を示しています。
<PRE>   
   % <B>fs quota /afs/abc.com/usr/terry</B>
   34% of quota used.
   
</PRE>
<A NAME="IDX6721"></A>
<A NAME="IDX6722"></A>
<A NAME="IDX6723"></A>
<A NAME="IDX6724"></A>
<A NAME="IDX6725"></A>
<A NAME="IDX6726"></A>
<P><H3><A NAME="Header_253" HREF="auagd002.htm#ToC_253">割り当て量、現行サイズ、および他の情報の表示方法</A></H3>
<OL TYPE=1>
<LI><B>fs listquota</B> コマンドを発行します。
<P>
<PRE>   
   % <B>fs listquota</B> [&lt;<VAR>dir/file path</VAR>><SUP>+</SUP>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>lq
</B><DD>は、<B>listquota</B> に対するエイリアスです。
<P><DT><B><VAR>dir/file path</VAR>
</B><DD>ボリューム名および現行スペース使用とともに割り当て量が表示される各ボリューム内のディレクトリーまたはファイルの名前です。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。これは、この引き数を省略する場合のデフォルトです。
</DL>
</LI></OL>
<P>以下の例に示すように、出力には、ボリューム名、割り当て量および現行サイズ (両方とも K バイト単位)、使用された割り当て量のパーセント、および使用されたボリュームのホスト・パーティションの割合が示されます。
<PRE>   
   % <B>fs listquota /afs/abc.com/usr/terry</B>
   Volume Name     Quota    Used    % Used   Partition 
   user.terry      15000    5071       34%         86%   
   
</PRE>
<A NAME="IDX6727"></A>
<A NAME="IDX6728"></A>
<A NAME="IDX6729"></A>
<A NAME="IDX6730"></A>
<A NAME="IDX6731"></A>
<A NAME="IDX6732"></A>
<A NAME="IDX6733"></A>
<P><H3><A NAME="Header_254" HREF="auagd002.htm#ToC_254">割り当て量、現行サイズ、およびパーティション詳細情報の表示方法</A></H3>
<OL TYPE=1>
<LI><B>fs examine</B> コマンドの発行
<P>
<PRE>   
   % <B>fs examine</B> [&lt;<VAR>dir/file path</VAR>><SUP>+</SUP>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>exa
</B><DD><B>examine</B> の最も短い受け入れ可能な省略形です。
<P><DT><B><VAR>dir/file path</VAR>
</B><DD>割り当て量情報およびホスト・パーティション情報を表示する各ボリューム内のディレクトリーまたはファイルの名前です。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。これは、この引き数を省略する場合のデフォルトです。
</DL>
</LI></OL>
<P>以下の例に示すように、出力には、ボリューム ID 番号およびボリューム名、割り当て量および現行サイズ (両方とも K バイト単位)、およびボリュームのホスト・パーティション上の K バイト・ブロックの未使用数および総数が表示されます。
<PRE>   
   % <B>fs examine /afs/abc.com/usr/terry</B>
   Volume status for vid = 50489902 named user.terry
   Current maximum quota is 15000
   Current blocks used are 5073
   The partition has 46383 blocks available out of 333305   
   
</PRE>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">このコマンドの出力に含まれる区画関連の統計は、標準 UNIX の <B>df</B> コマンドの出力に含まれる対応する値と常に一致するとは限りません。キャッシュ・マネージャーは 5 分間隔でファイル・マネージャーをポーリングして区画情報を得るので、このコマンドによって報告される統計は 5 分前のものである可能性があります。また、オペレーティング・システムによっては、<B>df</B> コマンドの区画サイズ報告には、このコマンドによる計算には含まれない予約済みのスペースが含まれるので、約 10% 大きくなることがあります。
</TD></TR></TABLE>
<HR><H2><A NAME="HDRWQ321" HREF="auagd002.htm#ToC_255">ボリュームおよびそのマウント・ポイントの除去</A></H2>
<A NAME="IDX6734"></A>
<A NAME="IDX6735"></A>
<A NAME="IDX6736"></A>
<A NAME="IDX6737"></A>
<A NAME="IDX6738"></A>
<P>サイトからボリュームを削除、および VLDB からその記録を削除するには、
<B>vos remove</B> コマンドを使用します。このコマンドを使用して、任意の 3 つのタイプのボリュームを削除します。その影響は、タイプごとに異なります。
<UL>
<LI><B>.readonly</B> または <B>.backup</B> 拡張子を付けずに、ボリュームの基本名を指定して読み取り / 書き込みボリュームを指示すると、コマンドは、読み取り / 書き込みボリュームおよび関連したバックアップ・ボリュームの両方を、それらを収容するパーティションから削除します。
<A NAME="IDX6739"></A>
<A NAME="IDX6740"></A>
<P>
読み取り / 書き込みサイトはただ 1 つしかありえないため、
<B>-server</B> および <B>-partition</B> の引き数を提供する必要はありません。サイト情報もまた VLDB 項目から取り除かれ、
<TT>number of sites</TT> として <B>vos examine</B> および <B>vos listvldb</B> コマンドによって報告されるサイト・カウントは 1 つ減ります。読み取り / 書き込みボリュームおよびバックアップ・ボリュームのボリューム ID 番号は、
<B>vos examine</B> および <B>vos listvldb</B> のコマンドからの出力内に表示されませんが、内部で保存されます。読み取り専用サイト (ある場合) は影響されませんが、読み取り / 書き込みサイトが再び定義されないと変更できません。読み取り専用サイトがない場合は、VLDB 項目全体が削除されます。
<P>
<P>読み取り専用コピーが残っていない場合は、ボリューム内容にアクセスできないように、ボリュームのマウント・ポイントを削除することが最も良い方法です。読み取り専用ボリュームのコピーが残っている場合には、マウント・ポイントを削除してはいけません。
</LI><LI>名前に <B>.readonly</B> 拡張子を付けて読み取り専用ボリュームを指示する場合、このボリュームは、収容されているパーティションから削除され、対応するサイト情報は VLDB 項目から取り除かれます。
<TT>number of sites</TT> として <B>vos examine</B> および <B>vos listvldb</B> のコマンドによって報告されるサイト・カウントは、ボリュームを削除するごとに 1 つ減ります。
<A NAME="IDX6741"></A>
<P>
<P>
<P>複数の読み取り専用サイトがある場合、
<B>-server</B> 引き数 (およびオプションで <B>-partition</B> 引き数) を組み込んで、削除するボリュームがあるサイトを指定する必要があります。ただ 1 つしか読み取り専用サイトがない場合は、ボリューム名だけで十分です。このとき読み取り / 書き込みボリュームがないと、VLDB 項目全体が削除されます。
<P>
<P>特にボリュームの読み取り / 書き込みバージョンがまだ存在する場合などでは、読み取り専用ボリュームを削除する際に、ボリュームのマウント・ポイントを削除することは通常適切ではありません。読み取り / 書き込みボリュームが存在しない場合は、
<A HREF="#HDRWQ322">ボリュームを除去して、取り外し解除する方法</A>の<A HREF="#LIWQ325">5</A> のステップでの説明に従って、マウント・ポイントを削除します。
</LI><LI>名前に <B>.backup</B> 拡張子を付けてバックアップ・ボリュームを指示する場合、そのボリュームは収容されているパーティションから削除され、そのサイト情報は VLDB 項目から取り除かれます。バックアップ・サイトはただ 1 つしかありえないため、
<B>-server</B> および <B>-partition</B> の引き数を提供する必要はありません。バックアップ・ボリュームの ID 番号は、
<B>vos examine</B> または <B>vos listvldb</B> コマンドからの出力には表示されませんが、内部で保存されます。
<P>
<P>標準構成では、ユーザー・ボリュームのバックアップ・バージョンごとに別々のマウント・ポイントがあります。存在しないボリュームの内容にアクセスすることを回避するために、そのマウント・ポイントは削除しておくようにしてください。
</LI></UL>
<P><H3><A NAME="Header_256" HREF="auagd002.htm#ToC_256">他の除去コマンド</A></H3>
<A NAME="IDX6742"></A>
<P><B>vos remove</B> コマンドは、自動的にボリュームの VLDB 項目を削除し、パーティションからボリューム・ヘッダーおよびすべてのデータの双方を削除するため、ボリュームを削除する方法としては、ほとんどの場合において適切です。
VLDB 項目またはボリューム・ヘッダーのいずれかが存在しない場合は、残存する要素のみを削除する他のコマンドを使用しなければならないことがあります。これらのコマンドは、VLDB 項目およびボリューム・ヘッダーの両方が存在する通常の場合には使用しないでください。使用した場合、これらの間で矛盾が生じると定義されています。コマンド構文についての詳細は、<I>AFS Administration Reference</I> の解説ページを参照してください。
<P><B>vos zap</B> コマンドは、
VLDB 項目が存在しないボリューム・ヘッダーおよびボリューム・データを削除することによって、ボリュームをそのサイトから取り除きます。
<A NAME="IDX6743"></A>
<A NAME="IDX6744"></A>
<P>
<B>vos listvol</B> コマンドがボリューム・ヘッダーを表示するが、
<B>vos examine</B> または <B>vos listvldb</B> コマンドが VLDB 項目を見つけられない場合は、その VLDB 項目が欠落していることがわかります。このコマンドを実行して、矛盾を訂正する必要があります。これは、
<B>vos syncvldb</B> および <B>vos syncserv</B> コマンドは、ボリューム・ヘッダーを削除しないためです。
<P><B>vos remsite</B> コマンドは、ファイル・サーバー・マシン上のボリュームに影響を及ぼすことなく、
VLDB から読み取り専用サイト定義を除去します。
<A NAME="IDX6745"></A>
<A NAME="IDX6746"></A>
<P>
間違って <B>vos addsite</B> コマンドを発行して読み取り専用サイトを定義したが、まだ、サイトへボリュームをリリースする <B>vos release</B> コマンドを発行していない場合は、このコマンドを使用します。ボリュームをサイトに実際にリリースした場合は、代わりに <B>vos remove</B> コマンドを使用します。
<P><B>vos delentry</B> コマンドは、指定するボリュームについて言及する VLDB 項目全体を除去します。
<A NAME="IDX6747"></A>
<A NAME="IDX6748"></A>
<P>
ボリュームのバージョンが実際にファイル・サーバー・マシン上に存在しても、これらは影響を受けません。このコマンドは、ボリュームの除去が VLDB に記録されなかったことが確実に分かっていて (緊急の場合には <B>vos zap</B> コマンドを使用する場合があります)、
VLDB 全体を <B>vos syncvldb</B> および <B>vos syncserv</B>コマンドを使用して再同期するための時間をとりたくない場合に役立ちます。
<P><H3><A NAME="HDRWQ322" HREF="auagd002.htm#ToC_257">ボリュームを除去して、取り外し解除する方法</A></H3>
<A NAME="IDX6749"></A>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>ボリュームのマウント・ポイントを削除する場合、その親ディレクトリーの ACL 上に <B>d</B> (<B>削除</B>) アクセス権があるかどうかを検査します。必要に応じて、<B>fs listacl</B> コマンドを発行します。これについては、<A HREF="auagd020.htm#HDRWQ788">ACL の表示</A> で詳しく説明しています。
<P>
<PRE>   % <B>fs listacl</B> [&lt;<VAR>dir/file path</VAR>>]
</PRE>
<P>
<P><B>system:administrators</B> グループのメンバーは、<B>a</B> (<B>管理</B>)、および、デフォルトで <B>l</B> (<B>検索</B>) アクセス権を、常にすべての ACL に暗黙的に持っています。また、必要に応じて <B>fs setacl</B> コマンドを使用して、他の権限を付与することができます。
</LI><LI><A NAME="LIWQ323"></A><B>(オプション)</B>
後にボリュームを復元したい場合に備えて、ボリュームをファイルまたはテープへダンプします。ボリュームの内容をファイルにコピーするには、
<A HREF="#HDRWQ326">ボリュームのダンプおよび復元</A> で説明するとおり、
<B>vos dump</B> コマンドを使用します。すると、UNIX <B> tar</B> コマンドなどの第三者バックアップ・ユーティリティーまたはアーカイブ・ユーティリティーを使用して、ファイルをテープへコピーすることができます。
<P>
<P>もしくは、AFS バックアップ・システムを使用して、テープのコピーを作成します。この場合、関心のあるボリュームだけを含む一時的なボリューム・セットを作成すると便利です。一時的なボリューム・セットは、バックアップ・データベースに記録されないため、
1 度だけしか使用しないボリューム・セットの記録でデータベースを混乱させることはありません。これについての詳細は、<A HREF="auagd012.htm#HDRWQ417">ダンプの作成</A> を参照してください。
<A NAME="IDX6750"></A>
<A NAME="IDX6751"></A>
</LI><LI><A NAME="LIWQ324"></A><B>vos remove</B>コマンドを発行してボリュームを削除します。読み取り専用ボリュームを複数のサイトから削除する場合は、サイトごとにコマンドを繰り返します。
<P>
<PRE>   
   % <B>vos remove</B> [<B>-server</B> <VAR>machine name</VAR>>]  [<B>-partition</B> &lt;<VAR>partition name</VAR>>]  \
                <B>-id</B> &lt;<VAR>volume name or ID</VAR>>
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>remo
</B><DD>は、<B>remove</B> の受け入れ可能な省略形です。
<P><DT><B>-server
</B><DD>ボリュームが常駐するファイル・サーバー・マシンを指定します。これは、
<B>-id</B> 引き数が、複数のサイトに存在する読み取り専用ボリュームを指定する場合にのみ必要です。
<P><DT><B>-partition
</B><DD>ボリュームが常駐する <VAR>machine name</VAR> のパーティションを指定します。これは、<B>-id</B> 引き数が、複数のサイトに存在する読み取り専用ボリュームを指定する場合にのみ必要です。これとともに、<B>-server</B> 引き数を与えます。
<P><DT><B>-id
</B><DD>除去しようとしているボリュームを、その完全名またはボリューム ID 番号によって識別します。読み取り専用またはバックアップのボリュームを名前で識別する場合は、適切な拡張子 (<B>.readonly</B> または <B>.backup</B>) を含めます。
</DL>
<A NAME="IDX6752"></A>
<A NAME="IDX6753"></A>
</LI><LI><A NAME="LIWQ325"></A>ボリュームの最後の既存バージョンを削除する場合は、
<B>fs rmmount</B> コマンドを発行して、対応するマウント・ポイントを削除します。詳細は、
<A HREF="#HDRWQ322">ボリュームを除去して、取り外し解除する方法</A> を参照してください。
<P>
<P>従来の方法で取り付けられたバックアップ・ボリュームを削除する場合
(読み取り / 書き込みボリュームのルート・ディレクトリーのサブディレクトリーで)、このステップでソース・ボリュームのマウント・ポイントを削除すると、バックアップ・ボリュームのマウント・ポイントを削除できます。バックアップを完全に別々のディレクトリーで取り付けた場合、バックアップ・ボリュームのマウント・ポイントに対して、このステップを繰り返す必要があります。
<P>
<PRE>   
   % <B>fs rmmount</B> &lt;<VAR>directory</VAR>>
   
</PRE>
</LI><LI><B>(オプション)</B>
<A HREF="#LIWQ323">3</A> のステップでダンプ・ファイルを作成した場合は、これをテープに転送します。
AFS バックアップ・システムの使用が好ましく、これについては <A HREF="auagd011.htm#HDRWQ334">AFS バックアップ・システムの構成</A>、および <A HREF="auagd012.htm#HDRWQ383">AFS データのバックアップと復元</A> で説明しています。
</LI></OL>
<HR><H2><A NAME="HDRWQ326" HREF="auagd002.htm#ToC_258">ボリュームのダンプおよび復元</A></H2>
<A NAME="IDX6754"></A>
<A NAME="IDX6755"></A>
<P><B>vos dump</B> コマンドによってボリュームが <I>ダンプ</I> されると、その内容が ASCII 形式に変換され、指定のファイルに書き込まれます。
<B>vos restore</B> コマンドによって、ダンプ・ファイルの内容は、指示されたファイル・サーバー・マシンに適切なボリューム・フォーマットに変換されてから、ボリュームに戻されます。
<P><H3><A NAME="Header_259" HREF="auagd002.htm#ToC_259">ボリュームのダンプについて</A></H3>
<A NAME="IDX6756"></A>
<A NAME="IDX6757"></A>
<A NAME="IDX6758"></A>
<A NAME="IDX6759"></A>
<A NAME="IDX6760"></A>
<A NAME="IDX6761"></A>
<P>ボリュームのダンプは、次のようないくつかの場合に役に立ちます。
<UL>
<LI>たとえば、第三者のバックアップ・ユーティリティーを使用して、テープにバックアップします。このタイプのバックアップ操作を容易にするには、
<B>vos dump</B> コマンドによって名前付きパイプに書き込みます。代わりに AFS バックアップ・システムの使用について確認するには、
<A HREF="auagd011.htm#HDRWQ334">AFS バックアップ・システムの構成</A> および <A HREF="auagd012.htm#HDRWQ383">AFS データのバックアップと復元</A> を参照してください。
</LI><LI>セルからボリュームを除去する場合 (所有者がユーザーのセルから退くときなど) <B>vos dump</B> コマンドを使用することにより、バックアップ・システムのオーバーヘッドを起こすことなく、保護コピーが作成できます。ボリュームの除去方法についての詳細は、<A HREF="#HDRWQ321">ボリュームおよびそのマウント・ポイントの除去</A> を参照してください。
</LI><LI>非 AFS サーバー・パーティション上にボリュームの保護コピーを作成したい場合。これは、実際のボリュームを別のマシンに移動する、またはボリュームを格納するパーティション上で保守タスクを実行する場合が考えられます。
</LI><LI>破壊された読み取り / 書き込みボリュームを置き換える必要がある場合。破壊されていない読み取り専用またはバックアップのバージョンのボリュームが存在する場合、それをダンプし、そのデータを破壊された内容に上書きして読み取り / 書き込みボリュームへ復元します。
</LI><LI>ボリュームの内容を別のセルにコピーまたは転送する場合。
AFS は、同じセルに属するファイル・サーバー・マシン間だけでのボリューム移動をサポートするため、
<B>vos move</B> コマンドを使用することはできません。
</LI><LI>ボリュームの内容を持つ読み取り / 書き込みコピーをもう 1 つ作成する場合。
2 つ目のボリューム名は、オリジナルの名前と異なっている必要があります。
2 つのボリュームの内容を同一にしたい場合は、両方を手動で更新しなければなりません。このように、AFS は、読み取り / 書き込みボリュームを同期化する機能を提供しません。
</LI><LI>特定の日付よりあとに変更されたことを示すタイム・スタンプが付いた、ボリューム内のファイルおよびディレクトリーだけのコピーが必要です。<B>vos dump</B> コマンドにより、以下の <A HREF="#LIWQ327">3</A> のステップで説明するように増分ダンプ・ファイルが作成できます。
</LI></UL>
<A NAME="IDX6762"></A>
<A NAME="IDX6763"></A>
<A NAME="IDX6764"></A>
<P><B>vos dump</B> コマンドを使用して、コマンドを発行する時刻のボリュームの内容すべてを含む <I>フル・ダンプ</I>を作成するか、
(<B>ls -l</B> コマンドによって表示される) 指定の日時よりもあとに修正されたことを示すタイム・スタンプが付いたファイルおよびディレクトリーのみを含む <I>増分ダンプ</I> を作成することができます。次の指示に対する <A HREF="#LIWQ327">3</A> のステップを参照してください。
<P>ボリュームをダンプしても VLDB 項目が変更されたり、ファイル・サーバー・マシン上のその状況が永続的に影響を受けたりしませんが、ダンプ操作の際、ボリュームの内容にはアクセスすることができません。ボリュームへのアクセスを割り込みから守るには、通常、
<B>vos backup</B> または <B>vos backupsys</B>
コマンドを使用した直後にボリュームのバックアップ・バージョンをダンプして、新規のバックアップ・バージョンを作成するのが最もよい方法です。
<P>ダンプを書き込むファイル名を指定しない場合、
<B>vos dump</B> コマンドの出力は標準出力ストリームに送信されます。これを直接 <B>vos restore</B> コマンドにパイプ接続することもできます。
<P>ボリューム・ダンプ・ファイルは ASCII 形式で作成されているため、
<B>cat</B> コマンドなどのテキスト・エディターまたはコマンドを使用して、その内容を読み取ることができます。ただし、ダンプ・ファイルには、英数字の相関がない特殊文字が含まれていることがたまにあります。これが原因で、一部のディスプレイ・プログラムに問題が起こる可能性があります。
<P>デフォルトで、<B>vos</B> コマンド・インタープリターは、ボリューム・ロケーション・データベース (VLDB) と協力してボリュームの位置を入手するため、
<B>-server</B> および <B>-partition</B> の引き数を必要としません。
<B>-id</B> 引き数が、複数のサイトに常駐する読み取り専用ボリュームを識別する場合、コマンドはそれらのサイトうちのただ 1 つ (普通、<B>vos examine</B> または <B>vos listvldb</B> のコマンドによって報告されるように、ボリュームの VLDB 項目内に最初にリストされるもの) からバージョンをダンプします。特別なサイトから読み取り専用ボリュームをダンプするには、
<B>-server</B> および <B>-partition</B> の引き数を使用して、そのサイトを指定します。VLDB 索引を完全に迂回するには、
<B>-server</B> および <B>-partition</B> の引き数とともに、ボリューム ID 番号 (ボリューム名ではなく) を、
<B>-id</B> 引き数の値として提供します。これによって、VLDB 項目がないボリュームをダンプすることができます。
<A NAME="IDX6765"></A>
<A NAME="IDX6766"></A>
<P><H3><A NAME="Header_260" HREF="auagd002.htm#ToC_260">ボリュームをダンプする方法</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>ダンプ・ファイルを作成するために必要なアクセス権があるかどうかを検査します。ファイルを AFS に配置する場合は、ファイルのディレクトリーの ACL 上に、
<B>i</B> (<B>挿入</B>) アクセス権が必要です。必要に応じて、<B>fs listacl</B> コマンドを発行します。これについては、<A HREF="auagd020.htm#HDRWQ788">ACL の表示</A> で詳しく説明しています。
<P>
<PRE>   % <B>fs listacl</B> [&lt;<VAR>dir/file path</VAR>>]
</PRE>
<P>
<P><B>system:administrators</B> グループのメンバーは、<B>a</B> (<B>管理</B>)、および、デフォルトで <B>l</B> (<B>検索</B>) アクセス権を、常にすべての ACL に暗黙的に持っています。また、必要に応じて <B>fs setacl</B> コマンドを使用して、他の権限を付与することができます。
</LI><LI><A NAME="LIWQ327"></A><B>vos dump</B> コマンドを発行して、ボリュームをダンプします。
<P>
<PRE>   
   % <B>vos dump -id</B> &lt;<VAR>volume name or ID</VAR>> [<B>-time</B> &lt;<VAR>dump from time</VAR>>]
                  [<B>-file</B> &lt;<VAR>arg</VAR>>]  [<B>-server</B> &lt;<VAR>server</VAR>>]  [<B>-partition</B> &lt;<VAR>partition</VAR>>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>-id
</B><DD>ダンプするボリュームを、その完全名またはボリューム ID 番号によって識別します。読み取り専用またはバックアップ・バージョンをダンプする場合は、ボリューム ID 番号を指定するか、適切な拡張子 (<B>.readonly</B>または <B>.backup</B>) を名前に追加します。
<P>
<P>ボリューム・ロケーションの正規の VLDB 検索を迂回するには、ボリューム ID 番号を提供し、この引き数を
<B>-server</B> および <B>-partition</B> 引き数と結合します。
<P><DT><B>-time
</B><DD>フル・ダンプまたは増分ダンプを指定します。フル・ダンプを作成するにはこの引き数を省略するか、または 3 つの許容値のうち 1 つを提供します。
<UL>
<LI>フル・ダンプを作成する場合には、<B>0</B> (ゼロ) を指定してください。
</LI><LI><I>mm</I><B>/</B><I>dd</I><B>/</B><I>yyyy</I>
(月、日、年) 形式の日付
(示された日の午前 0 時 (12:00 a.m.) より後に修正されたファイルおよびディレクトリーのみを含む増分ダンプを作成する場合)。年範囲の有効な値は、<B>1970</B> から <B>2037</B> までです。標準 UNIX 表示における最後の日付の表示は 2038 であるため、これより高い値は無効です。コマンド・インタープリターは、それ以降の日付を自動的に最大値に削減します。例、<B>01/13/1999</B>
</LI><LI><B>"</B><I>mm</I><B>/</B><I>dd</I><B>/</B><I>yyyy</I> <I>hh</I><B>:</B><I>MM</I><B>"</B>形式の日付指定した日時より後に修正されたファイルおよびディレクトリーのみを含む増分ダンプを作成する場合。日付形式は、日付のみの場合と同じ形式です。時刻 (<I>hh</I>:<I>MM</I>) は 24 時間形式の表示です (たとえば、<B>20:30</B>は 8:30 p.m. のことです)。. スペースが含まれるため、式全体を二重引用符 (" ") で囲みます。例、<B>"01/13/1999 22:30"</B>
</LI></UL>
<P><DT><B>-file
</B><DD>ダンプを書き込むファイルのパス名を指定します。ファイルは AFS に置けますが、ダンプされるボリューム内には配置できません。部分的なパス名は、現行作業ディレクトリーに対する相対として解釈されます。ダンプを標準出力ストリームに送信するには、この引き数を省略します。
<P><DT><B>-server
</B><DD>ボリュームが常駐するファイル・サーバー・マシンを指定します。これとともに、<B>-partition</B> 引き数を与えます。
<P><DT><B>-partition
</B><DD>ボリュームが常駐するパーティションを指定します。これとともに、<B>-server</B> 引き数を与えます。
</DL>
</LI></OL>
<P><H3><A NAME="Header_261" HREF="auagd002.htm#ToC_261">ボリュームの復元について</A></H3>
<A NAME="IDX6767"></A>
<A NAME="IDX6768"></A>
<P>3 つのタイプのボリューム (読み取り / 書き込み、読み取り専用、またはバックアップ) は、どれでもダンプすることができますが、ダンプ・ファイルは、<B>vos restore</B> コマンドを使用して、読み取り / 書き込みボリュームとしてのみファイル・システムに復元することができます。このコマンドは、ダンプ・ファイルの内容を ASCII から自動的に変換して、復元されたバージョンを格納するファイル・サーバー・マシンに対して適切なボリューム・フォーマットに再び戻します。
<B>vos dump</B> と同じように、名前付きパイプを介してダンプ・ファイルを復元し、第三者のバックアップ・ユーティリティーとの相互操作を容易にすることができます。
<P>ダンプ・ファイルは、2 つの基本方法のいずれかにより復元できます。どちらの場合も、増分ダンプを復元する前に、フル・ダンプを復元する必要があります。その上で復元する増分ダンプは、フル・ダンプの後で作成されたものでなければなりません。複数の増分ダンプが存在する場合、これを作成された順に復元する必要があります。
<UL>
<LI>新しい名前を付けて指定した場所に作成したばかりのボリュームへ、ボリューム・データを復元することができます。
<A HREF="#HDRWQ328">新規のボリュームにダンプを復元して、それを取り付ける</A> を参照してください。
<P>
<P>ボリュームを復元する際、通常はボリューム・サーバーが自動的にボリュームを割り振るのが最適な方法ですが、ユーザーがボリューム ID 番号を割り当てることができます。ボリューム ID を指定する理由で最も一般的なものは、ボリュームの VLDB 項目が何らかの理由で消えた場合、ユーザーが以前の read/write ボリューム ID を知っていてそれを再利用したいからです。
</LI><LI>既存のボリューム (通常は前にダンプしたもの) に、現在の内容を上書きして復元することができます。これは、現行の内容が破壊されているか、それ以外の誤りがある場合に便利です。その理由は、現行の内容を過去またはボリュームの複製の 1 つのコヒーレント・バージョンで置き換えることが可能になるからです。<A HREF="#HDRWQ330">既存のボリュームを上書きして、ダンプ・ファイルを復元する</A> を参照してください。
<P>
<P><B>-overwrite</B> 引き数を使用することにより、ボリューム内容の上書きを確認し、フル・ダンプまたは増分ダンプのどちらを復元するかを指定します。<B>-overwrite</B> 引き数を省略した場合、ボリューム・サーバーは以下のプロンプトを出して、既存のボリュームをフル (<B>f</B>) または増分 (<B>i</B>) ダンプで上書するか確認します。
<P>
<PRE>   
   Do you want to do a full/incremental restore or abort? [fia](a):
   
</PRE>
<P>
<P><B>-file</B> 引き数を使用して名前を付ける代わりに、ダンプ・ファイルを標準入力ストリームにパイプ接続するのであれば、
<B>-overwrite</B> 引き数を組み込む必要があります。これは、この場合ボリューム・サーバーがプロンプトを表示する場所がなくなるためです。
<P>
<P>ボリュームを新規サイトに移動し、フル・ダンプで上書きをすることができます。新規サイトの指定には、
<B>-server</B> および <B>-partition</B> 引き数を使用します。増分ダンプを復元する場合はボリュームの移動はできません。
dump.
</LI></UL>
<P><B>vos restore</B> コマンドは、ボリューム・ヘッダー中の復元ボリュームの作成日を復元操作の時刻に設定します。これは <B>vos examine</B> および <B>vos listvol</B> コマンドの出力の <TT>Creation</TT>フィールドに報告される時刻です。
<A NAME="IDX6769"></A>
<A NAME="IDX6770"></A>
<P><H3><A NAME="HDRWQ328" HREF="auagd002.htm#ToC_262">新規のボリュームにダンプを復元して、それを取り付ける</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>ユーザーに、ダンプ・ファイルを読み取って新規ボリュームを取り付けるために必要なアクセス権があるかどうかを検査します。ダンプ・ファイルが AFS にあれば、そのディレクトリーの ACL 上に <B>r</B> (<B>読み取り</B>) アクセス権が必要です。新規ボリュームを取り付けるディレクトリーの ACL 上に <B>i</B> (<B>挿入</B>) および <B>a</B> (<B>管理</B>)アクセス権がなければなりません。必要に応じて、<B>fs listacl</B> コマンドを発行します。これについては、<A HREF="auagd020.htm#HDRWQ788">ACL の表示</A> で詳しく説明しています。
<P>
<PRE>   % <B>fs listacl</B> [&lt;<VAR>dir/file path</VAR>>]
</PRE>
<P>
<P><B>system:administrators</B> グループのメンバーは、<B>a</B> (<B>管理</B>)、および、デフォルトで <B>l</B> (<B>検索</B>) アクセス権を、常にすべての ACL に暗黙的に持っています。また、必要に応じて <B>fs setacl</B> コマンドを使用して、他の権限を付与することができます。
</LI><LI>新規ボリュームに対してサイト (ファイル・サーバー・マシン上のディスク・パーティション) を選択します。セルがボリュームの異なるタイプを、別々のファイル・サーバー・マシンにグループ化すると、判別が容易になります。基準を満たす最も空きの多いパーティションにボリュームを配置することもできます。ファイル・サーバー・マシンのパーティション上で使用可能なスペース容量を表示するには、
<B>vos partinfo</B> コマンドを使用します。このコマンドについては、
<A HREF="#HDRWQ271">読み取り / 書き込みボリュームの作成</A> で詳しく説明しています。
<P>
<PRE>   
   % <B>vos partinfo</B> &lt;<VAR>machine name</VAR>> [&lt;<VAR>partition name</VAR>>]
   
</PRE>
</LI><LI><A NAME="LIWQ329"></A>新規ボリュームを作成してそこにダンプ・ファイルを復元するために、<B>vos restore</B> コマンドを発行します。
1 つの行にコマンドを入力します。ここでコマンドが複数行に表示されているのは、読みやすくするためです。
<P>
<PRE>   
   % <B>vos restore</B> &lt;<VAR>machine name</VAR>> &lt;<VAR>partition name</VAR>>  \
                 &lt;<VAR>name of volume to be restored</VAR>>   \
                 [<B>-file</B> &lt;<VAR>dump file</VAR>>] [<B>-id</B> &lt;<VAR>volume ID</VAR>>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>res
</B><DD>は、<B>restore</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>新規ボリュームを作成するファイル・サーバー・マシンに名前を付けます。
<P><DT><B><VAR>partition name</VAR>
</B><DD>新規ボリュームを作成するパーティションの名前です。
<P><DT><B><VAR>name of volume to be restored</VAR>
</B><DD>新規の読み取り / 書き込みボリュームの名前です。VLDB 項目を持つものではいけません。長さは 22文字までとします。
<P><DT><B>-file
</B><DD>復元するダンプ・ファイルです。部分的なパス名は、現行作業ディレクトリーと相対して解釈されます。標準入力ストリームからダンプ・ファイルを読み取る場合は、この引き数を省略します。
<P><DT><B>-volume
</B><DD>新規ボリュームの ID 番号を指定します。これは、既に存在しないボリュームを復元する場合で、その以前のボリューム ID 番号を使用する場合にのみ使用できます。
</DL>
<A NAME="IDX6771"></A>
<A NAME="IDX6772"></A>
</LI><LI><B>fs mkmount</B> コマンドを発行して新規のボリュームを取り付け、その内容が表示できるようにします。詳細は、<A HREF="#HDRWQ298">正規または読み取り / 書き込みの各マウント・ポイントの作成</A> を参照してください。
<P>
<PRE>   
   % <B>fs mkmount</B> &lt;<VAR>directory</VAR>> &lt;<VAR>volume name</VAR>>
   
</PRE>
</LI><LI><B>(オプション)</B> <B>fs lsmount</B> コマンドを発行して、マウント・ポイントが正しいボリュームを参照しているか検証します。詳細な説明が <A HREF="#HDRWQ297">マウント・ポイントの表示方法</A> に示されています。
<P>
<PRE>   
   % <B>fs lsmount</B> &lt;<VAR>directory</VAR>>
   
</PRE>
</LI></OL>
<A NAME="IDX6773"></A>
<A NAME="IDX6774"></A>
<P><H3><A NAME="HDRWQ330" HREF="auagd002.htm#ToC_263">既存のボリュームを上書きして、ダンプ・ファイルを復元する</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>ユーザーに、ダンプ・ファイルを読み取るために必要なアクセス権があるかどうかを検査します。ダンプ・ファイルが AFS にあれば、そのディレクトリーの ACL 上に <B>r</B> (<B>読み取り</B>) アクセス権が必要です。必要に応じて、<B>fs listacl</B> コマンドを発行します。これについては、<A HREF="auagd020.htm#HDRWQ788">ACL の表示</A> で詳しく説明しています。
<P>
<PRE>   % <B>fs listacl</B> [&lt;<VAR>dir/file path</VAR>>]
</PRE>
<P>
<P><B>system:administrators</B> グループのメンバーは、<B>a</B> (<B>管理</B>)、および、デフォルトで <B>l</B> (<B>検索</B>) アクセス権を、常にすべての ACL に暗黙的に持っています。また、必要に応じて <B>fs setacl</B> コマンドを使用して、他の権限を付与することができます。
</LI><LI>現行の内容を上書きして、ダンプ・ファイルの内容を読み取り / 書き込みボリュームに復元します。ボリュームは、現行のボリューム ID 番号を保存します。1 つの行にコマンドを入力します。ここでコマンドが複数行に表示されているのは、読みやすくするためです。
<P>
<PRE>   
   % <B>vos restore</B> &lt;<VAR>machine name</VAR>> &lt;<VAR>partition name</VAR>>  \
                 &lt;<VAR>name of volume to be restored</VAR>>   \
                 [<B>-file</B> &lt;<VAR>dump  file</VAR>>]  \
                 <B>-overwrite</B> &lt;<B>full</B> | <B>incremental</B>>
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>res
</B><DD>は、<B>restore</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>ボリュームがすでに存在する、またはボリュームの移動先であるファイル・サーバー・マシンの名前です。後者の場合、<B>-overwrite</B> 引き数の値は <B>full</B> です。
<P><DT><B><VAR>partition name</VAR>
</B><DD>ボリュームがすでに存在する、またはボリュームの移動先であるパーティションの名前です。後者の場合、<B>-overwrite</B> 引き数の値は <B>full</B> です。
<P><DT><B><VAR>name of volume to be restored</VAR>
</B><DD>ダンプ・ファイルの内容で上書きする読み取り / 書き込みボリュームの名前です。
<P><DT><B>-file
</B><DD>復元するダンプ・ファイルです。部分的なパス名は、現行作業ディレクトリーと相対して解釈されます。標準入力ストリームからダンプ・ファイルを読み取る場合は、この引き数を省略します。この場合、<B>-overwrite</B> 引き数を使用する必要があります。
<P><DT><B>-overwrite
</B><DD>既存のボリュームを上書きするかを確認し、復元するダンプ・ファイルの種類を指定します。以下の値のいずれかを指定します。
<UL>
<LI>フル・ダンプを復元する場合は、<B>f</B> ( <B>full</B>)。
</LI><LI>増分ダンプ・ファイルを復元する場合は、<B>i</B> (<B>incremental</B>)。復元中、ボリュームを移動するのであれば、この値は使用できません。
</LI><LI>復元操作を終了する場合は、<B>a</B>。
</LI></UL>
</DL>
</LI><LI>ボリュームが複写されたら、<B>vos release</B> コマンドを発行して、新規に復元された内容を読み取り専用サイトにリリースします。詳細な説明が、
<A HREF="#HDRWQ278">ボリュームの複写 (読み取り専用ボリュームの作成)</A> に示されています。
<P>
<PRE>   
   % <B>vos release</B> &lt;<VAR>volume name or ID</VAR>>
   
</PRE>
</LI><LI><B>vos backup</B> コマンドを発行して、ボリュームの新規バックアップ・バージョンを作成します。詳細は、<A HREF="#HDRWQ287">バックアップ・ボリュームの作成</A> を参照してください
<P>
<PRE>   
   % <B>vos backup</B> &lt;<VAR>volume name or ID</VAR>>
   
</PRE>
</LI></OL>
<HR><H2><A NAME="HDRWQ331" HREF="auagd002.htm#ToC_264">ボリュームの名前変更</A></H2>
<A NAME="IDX6775"></A>
<A NAME="IDX6776"></A>
<A NAME="IDX6777"></A>
<A NAME="IDX6778"></A>
<P><B>vos rename</B> コマンドを使用すると、ボリュームを名前変更することができます。たとえば、ユーザーのボリューム名に <B>user.</B><VAR>username</VAR> 規則を使用し、ユーザー名を変更する場合、ユーザーのホーム・ボリュームの名前を変更することが適切です
(ユーザー名の変更についての詳細は、<A HREF="auagd018.htm#HDRWQ709">ユーザー名の変更</A> を参照してください)。
<P>
<A NAME="IDX6779"></A>
<A NAME="IDX6780"></A>
<A NAME="IDX6781"></A>
<B>vos rename</B> コマンドは、読み取り / 書き込みボリューム名のみを受け入れますが、関連した読み取り専用ボリュームおよびバックアップ・ボリュームを自動的に変更します。次の指示に従って、ボリュームの現行のマウント・ポイントを、名前変更を反映する新規のマウント・ポイントに置き換えなければなりません。
<A NAME="IDX6782"></A>
<A NAME="IDX6783"></A>
<P><H3><A NAME="HDRWQ332" HREF="auagd002.htm#ToC_265">ボリュームの名前変更</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>ボリュームのマウント・ポイントを置き換えるディレクトリーについて <B>a</B> (<B>管理者</B>)、<B>d</B> (<B>削除</B>)、および <B>i</B> (<B>挿入</B>) アクセス権限があることを検証します。必要に応じて、<B>fs listacl</B> コマンドを発行します。これについては、
<A HREF="auagd020.htm#HDRWQ788">ACL の表示</A> で詳しく説明しています。
<P>
<PRE>   % <B>fs listacl</B> [&lt;<VAR>dir/file path</VAR>>]
</PRE>
<P>
<P><B>system:administrators</B> グループのメンバーは、<B>a</B> (<B>管理</B>)、および、デフォルトで <B>l</B> (<B>検索</B>) アクセス権を、常にすべての ACL に暗黙的に持っています。また、必要に応じて <B>fs setacl</B> コマンドを使用して、他の権限を付与することができます。
</LI><LI><A NAME="LIVOL-REN"></A><B>vos rename</B> コマンドを発行し、ボリュームの名前を変更します。
<P>
<PRE>   
   % <B>vos rename</B> &lt;<VAR>old volume name</VAR>> &lt;<VAR>new volume name</VAR>>
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>ren
</B><DD><B>rename</B> の最も短い受け入れ可能な省略形です。
<P><DT><B><VAR>old volume name</VAR>
</B><DD>読み取り / 書き込みボリュームの現行名です。
<P><DT><B><VAR>new volume name</VAR>
</B><DD>ボリュームに対する新規の名前です。長さは、22 文字以内でなければなりません。
</DL>
<P>
<P>指定された現行のボリューム名に対してボリューム・ロケーション・データベース (VLDB) 項目がない場合、コマンドは失敗して、次のエラー・メッセージが表示されます。
<P>
<PRE>   
   vos: Could not find entry for volume <VAR>old_volume_name</VAR>. 
   
</PRE>
<A NAME="IDX6784"></A>
<A NAME="IDX6785"></A>
</LI><LI><B>fs rmmount</B> コマンドを発行し、ボリュームの古い名前に関連するマウント・ポイントを除去します。詳細は、
<A HREF="#HDRWQ301">マウント・ポイントを除去する方法</A> を参照してください。
<P>
<PRE>   
   % <B>fs rmmount</B> &lt;<VAR>directory</VAR>>
   
</PRE>
<A NAME="IDX6786"></A>
<A NAME="IDX6787"></A>
</LI><LI><B>fs mkmount</B> コマンドを発行して、ボリュームの新規名を示すマウント・ポイントを作成します。詳細は、<A HREF="#HDRWQ298">正規または読み取り / 書き込みの各マウント・ポイントの作成</A> を参照してください。
<P>
<PRE>   
   % <B>fs mkmount</B> &lt;<VAR>directory</VAR>> &lt;<VAR>volume name</VAR>> [<B>-rw</B>]
    
</PRE>
</LI></OL>
<HR><H2><A NAME="HDRWQ333" HREF="auagd002.htm#ToC_266">VLDB 項目のロック解除およびロック</A></H2>
<P><A HREF="#HDRWQ313">VLDB およびボリューム・ヘッダーの同期化</A> で説明するとおり、ボリューム・ロケーション
(VL)・サーバーは、ボリューム・サーバーが VL サーバー上で操作を実行する前に、ボリュームのボリューム・ロケーション・データベース (VLDB) 項目をロックします。それ以外の操作は、ロックされた VLDB 項目を持つボリュームに影響を及ぼすことができないため、ロックすることによって、ボリューム上の複数の同時操作が原因で生じる不整合または破壊を防ぐことができます。
<A NAME="IDX6788"></A>
<A NAME="IDX6789"></A>
<A NAME="IDX6790"></A>
<A NAME="IDX6791"></A>
<A NAME="IDX6792"></A>
<A NAME="IDX6793"></A>
<P>VLDB 項目がロックされているかどうかを検査するには、
<A HREF="#HDRWQ304">VLDB 項目の表示</A> の説明に従って、
<B>vos listvldb</B> コマンドを発行します。コマンドは、ロックされた項目だけを表示する <B>-locked</B> フラグを保持します。
VLDB 項目がロックされている場合、ストリング <TT>Volume is currently LOCKED</TT> がボリュームの出力の最終行に表示されます。
<P>VLDB 項目を自分でロックする場合は、<B>vos lock</B> コマンドを使用します。これは、ボリュームに何か異常があることに気が付き、その原因の調査中にそれに変更が加えられないようにしたい場合に有効です。
<P>ロックした VLDB 項目のロックを解除するには、単一の VLDB 項目のロックを解除する <B>vos unlock</B> コマンドを発行するか、または、多くの項目のロック解除ができる <B>vos unlockvldb</B> コマンドを発行します。これは、ボリューム操作が早期に失敗し、VLDB 項目をロックしたまま残される場合に有効です。この場合、障害によって起こる問題を訂正することはできません。
<A NAME="IDX6794"></A>
<A NAME="IDX6795"></A>
<P><H3><A NAME="Header_267" HREF="auagd002.htm#ToC_267">VLDB 項目をロックする方法</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>vos lock</B> コマンドを発行して、項目をロックします。
<P>
<PRE>   
   % <B>vos lock</B> &lt;<VAR>volume name or ID</VAR>>
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>lo
</B><DD>は、<B>lock</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>volume name or ID</VAR>
</B><DD>ロックされるボリュームを、その完全名またはボリューム ID 番号によって識別します。ボリュームの 3 つのバージョンのいずれかとすることができます。
</DL>
</LI></OL>
<A NAME="IDX6796"></A>
<A NAME="IDX6797"></A>
<P><H3><A NAME="Header_268" HREF="auagd002.htm#ToC_268">単一の VLDB 項目をロックを解除する</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>vos unlock</B> コマンドを発行して、項目をロック解除します。
<P>
<PRE>   % <B>vos unlock</B> &lt;<VAR>volume name or ID</VAR>>
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>unlock
</B><DD>完全な形式で入力する必要があります。
<P><DT><B><VAR>volume name or ID</VAR>
</B><DD>アンロック状態のボリュームを、その完全名またはボリューム ID 番号によって識別します。ボリュームの 3 つのバージョンのいずれかとすることができます。
</DL>
</LI></OL>
<A NAME="IDX6798"></A>
<A NAME="IDX6799"></A>
<P><H3><A NAME="Header_269" HREF="auagd002.htm#ToC_269">複数の VLDB 項目のロック解除</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>vos unlockvldb</B> コマンドを発行して、任意の項目のロックを解除します。
<P>
<PRE>   
   % <B>vos unlockvldb</B> [&lt;<VAR>machine name</VAR>>] [&lt;<VAR>partition name</VAR>>]
   
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>unlockv
</B><DD>は、<B>unlockvldb</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>ファイル・サーバー・マシンを指定します。サイト定義でマシンに言及するすべての VLDB項目をロック解除するためには、この引き数のみを使用します。すべての VLDB 項目のロックを解除するには、この引き数および <VAR>partition name</VAR> 引き数の両方を省略します。
<P><DT><B><VAR>partition name</VAR>
</B><DD>パーティションを指定します。サイト定義でパーティション (マシン上の)
に言及するすべての VLDB 項目をロック解除するためには、この引き数のみを使用します。すべての VLDB 項目のロックを解除するには、この引き数および <VAR>machine name</VAR> 引き数の両方を省略します。
</DL>
</LI></OL>
<P><HR><B>&#91; <A HREF="#Top_Of_Page">ページのトップ</A> &#124; <A HREF="auagd009.htm">前ページ</A> &#124; <A HREF="auagd011.htm">次ページ</A> &#124; <A HREF="auagd002.htm#ToC">目次</A> &#124; <A HREF="auagd026.htm#HDRINDEX">索引</A> &#93;</B> 
<!-- Begin Footer Records  ========================================== -->
<P><HR><B> 
<br>(C) <A HREF="http://www.ibm.com/">IBM Corporation 2000.</A>  All Rights Reserved<!-- 991224 --> 
</B> 
<!-- End Footer Records  ============================================ -->
<A NAME="Bot_Of_Page"></A>
</BODY></HTML>
