<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3//EN">
<HTML><HEAD>
<TITLE>管理の手引き</TITLE>
<!-- Begin Header Records  ========================================== -->
<!-- E:\IDWB\TEMP\idwt2118\AUAGD000.SCR converted by idb2h R4.2 (359) -->
<!-- ID Workbench Version (OS2) on 24 Dec 1999 at 12:07:32            -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Shift_JIS">
<META HTTP-EQUIV="updated" CONTENT="Fri, 24 Dec 1999 12:07:30">
<META HTTP-EQUIV="review" CONTENT="Sun, 24 Dec 2000 12:07:30">
<META HTTP-EQUIV="expires" CONTENT="Mon, 24 Dec 2001 12:07:30">
</HEAD><BODY>
<!-- (C) IBM Corporation 2000. All Rights Reserved    --> 
<BODY bgcolor="ffffff"> 
<!-- End Header Records  ============================================ -->
<A NAME="Top_Of_Page"></A>
<H1>管理の手引き</H1>
<P>
<A NAME="IDX5835"></A>
<A NAME="IDX5836"></A>
<HR><H1><A NAME="HDRWQ96" HREF="auagd002.htm#ToC_99">サーバー・マシンの管理</A></H1>
<P>この章では、AFS サーバー・マシンの管理方法について説明します。この章では、以下の構成情報と管理用タスクについて説明します。
<UL>
<LI>あらゆるサーバー・マシンのローカル・ディスクにある
<B>/usr/afs</B> ディレクトリーのサブディレクトリーに常駐しなければならないバイナリー・ファイルと構成ファイル。
<A HREF="#HDRWQ118">サーバー・マシン上のローカル・ディスク・ファイル</A> を参照してください。
</LI><LI>AFS サーバー・マシンで実行できるさまざまな<I>役割</I> または機能、およびある役割を果しているマシンがどれであるかを判別する方法。
<A HREF="#HDRWQ125">ファイル・サーバー・マシンの 4 つの役割</A> を参照してください。
</LI><LI>データベース・サーバー・マシンの保守の方法。<A HREF="#HDRWQ136">データベース・サーバー・マシンの管理</A> を参照してください。
</LI><LI><B>/usr/afs/etc/CellServDB</B>
ファイルのデータベース・サーバー・マシンのリストを保守する方法。
<A HREF="#HDRWQ153">サーバー CellServDB ファイルの保守</A> を参照してください。
</LI><LI>サーバー・マシンで許可検査を制御する方法。
<A HREF="#HDRWQ158">認証と許可の要件の管理</A> を参照してください。
</LI><LI>ファイル・サーバー・マシンで新規のディスクまたは区分をインストールする方法。
<A HREF="#HDRWQ165">ディスクと区分の追加または除去</A> を参照してください。
</LI><LI>サーバー・マシンの IP アドレスおよび管理 VLDB サーバー項目の変更方法は、
<A HREF="#HDRWQ173">サーバー IP アドレスおよび VLDB サーバー項目の管理</A> を参照してください。
</LI><LI>ファイル・サーバー・マシンをリブートする方法。
<A HREF="#HDRWQ174">サーバー・マシンのリブート</A> を参照してください。
</LI></UL>
<P>新規サーバー・マシンのインストールと構成の方法を確認するには、
<I>AFS インストールの手引き</I> を参照してください。
<P>サーバー・プロセスそのものを管理する方法を確認するには、
<A HREF="auagd009.htm#HDRWQ177">サーバー・プロセスの監視および制御</A> を参照してください。
<P>ボリュームの管理方法を確認するには、
<A HREF="auagd010.htm#HDRWQ229">ボリュームの管理</A> を参照してください。
<HR><H2><A NAME="HDRWQ97" HREF="auagd002.htm#ToC_100">説明の要約</A></H2>
<P>本章では、指示されたコマンドを使用した以下のタスクの実行方法を説明します。
<BR>
<TABLE WIDTH="100%">
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">新規バイナリーのインストール
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>bos install</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">チェックと再始動時のバイナリーの検査
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>bos getrestart</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">バイナリーの検査と再始動の時刻の設定
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>bos setrestart</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">バイナリー・ファイルのコンパイル日付の検査
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>bos getdate</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">新規バイナリーを使用するプロセスの再始動
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>bos restart</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">バイナリーの古いバージョンへの復帰
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>bos uninstall</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">古くなった <B>.BAK</B> および <B>.OLD</B> バージョンの除去
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>bos prune</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">ファイル・サーバー・マシンの区分のリスト作成
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>vos listpart</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">AFS サーバー・プロセスの終了
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>bos shutdown</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">区分のボリュームのリスト作成
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>vos listvldb</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">読み取り / 書き込みボリュームの移動
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>vos move</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">セルのデータベース・サーバー・マシンのリスト作成
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>bos listhosts</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%"><B>CellServDB</B> ファイルへのデータベース・サーバー・マシンの追加
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>bos addhost</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">サーバー <B>CellServDB</B> ファイルからのデータベース・サーバー・マシンの除去
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>bos removehost</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">許可検査の要件の設定
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>bos setauth</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%"><B>bos</B> コマンド、<B>pts</B> コマンド、および <B>vos</B> コマンドの認証の回避
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>-noauth</B> フラグを組み込む
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">kas コマンドの認証の回避
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%">いくつかのコマンドに <B>-noauth</B> フラグを組み込むか、対話モードで <B>noauthentication</B> を発行する
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">すべての VLDB サーバー項目の表示
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>vos listaddrs</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">VLDB サーバー項目の削除
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>vos changeaddr</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">サーバー・マシンをリモートでリブート
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>bos exec</B> <I>reboot_command</I>
</TD></TR></TABLE>
<HR><H2><A NAME="HDRWQ118" HREF="auagd002.htm#ToC_101">サーバー・マシン上のローカル・ディスク・ファイル</A></H2>
<P>いくつかのタイプのファイルは、
AFS サーバー・マシンのローカル・ディスクにある
<B>/usr/afs</B> ディレクトリーのサブディレクトリーに常駐しなければなりません。これらのファイルには、バイナリー・ファイル、構成ファイル、管理用データベース・ファイル (データベース・サーバー・マシン上の)、ログ・ファイル、およびボリューム・ヘッダー・ファイルが含まれます。
<P><B>Windows ユーザー向けの注:</B> この文書で説明されているファイルには、
Windows オペレーティング・システムの稼働するマシン上にはないものがあります。また Windows では、パス名を区切るのに ( <B>/</B> ) の代わりに円記号 ( <B>\</B> ) を使用します。
<A NAME="IDX5837"></A>
<A NAME="IDX5838"></A>
<A NAME="IDX5839"></A>
<P><H3><A NAME="HDRWQ119" HREF="auagd002.htm#ToC_102">/usr/afs/bin ディレクトリーにあるバイナリー</A></H3>
<P><B>/usr/afs/bin</B> ディレクトリーには、マシンのシステム (CPU またはオペレーティング・システム) タイプに適した
AFS サーバー・プロセスとコマンドの組のバイナリーが保管されます。プロセスにサーバー部分とクライアント部分がある場合 (更新サーバーを使った場合)、あるいは、別のコンポーネントがある場合
(<B>fs</B> プロセスを使った場合) には、それぞれのコンポーネントは別々のファイルに常駐します。
<P>予測可能なシステム・パフォーマンスを保証するには、すべてのファイル・サーバー・マシンは、所定のプロセスの同じ AFS 作成バージョンを実行しなければなりません。整合性を簡単に保守するには、更新サーバー・プロセスを使用して、それぞれのシステム・タイプの<I>バイナリー配布マシン</I> から、バイナリーを配布します。詳しくは、<A HREF="#HDRWQ128">バイナリー配布マシン</A> を参照してください。
<P>たとえ、そのプロセスをマシン上で実際に実行しなくても、すべてのプロセスのバイナリーを
<B> /usr/afs/bin</B> ディレクトリーに保持するとよいでしょう。バイナリーは、マシンの構成のプロセス (たとえば、データベース・サーバー機能を既存のファイル・サーバー・マシンに追加すること) を単純化します。同様に、たとえサーバー・マシンでの作業中に頻繁にコマンドを発行しなくても、ディレクトリーにコマンドの組のバイナリーを保持するのもよいことです。コマンドの組のバイナリーを使用すると、ユーザーは、サーバーとマシンの停止から回復中にコマンドを発行することができます。
<P>以下は、AFS サーバー・プロセスまたはコマンドの組に直接関連する
<B>/usr/afs/bin</B> ディレクトリーにあるバイナリー・ファイルのリストです。ほかのバイナリー (たとえば、<B>klog</B> コマンド用) は、特定のファイル・サーバー・マシンのディスクまたは AFS 配布にあるこのディレクトリーに表示されます。
<DL>
<A NAME="IDX5840"></A>
<A NAME="IDX5841"></A>
<P><DT><B>backup
</B><DD>AFS バックアップ・システム用のコマンドの組
(バックアップ・サーバー用のバイナリーは、<B>buserver</B> です)。
<A NAME="IDX5842"></A>
<A NAME="IDX5843"></A>
<P><DT><B>bos
</B><DD>基本制御 (BOS) サーバーと通信するためのコマンドの組
(BOS サーバー用のバイナリーは <B>bosserver</B>)
<A NAME="IDX5844"></A>
<A NAME="IDX5845"></A>
<A NAME="IDX5846"></A>
<A NAME="IDX5847"></A>
<A NAME="IDX5848"></A>
<A NAME="IDX5849"></A>
<P><DT><B>bosserver
</B><DD>基本制御 (BOS) サーバー・プロセス用のバイナリー
<A NAME="IDX5850"></A>
<A NAME="IDX5851"></A>
<A NAME="IDX5852"></A>
<A NAME="IDX5853"></A>
<A NAME="IDX5854"></A>
<A NAME="IDX5855"></A>
<P><DT><B>buserver
</B><DD>バックアップ・サーバー・プロセス用のバイナリー
<A NAME="IDX5856"></A>
<A NAME="IDX5857"></A>
<A NAME="IDX5858"></A>
<A NAME="IDX5859"></A>
<A NAME="IDX5860"></A>
<A NAME="IDX5861"></A>
<P><DT><B>fileserver
</B><DD><B>fs</B> プロセスのファイル・サーバー・コンポーネント用のバイナリー
<A NAME="IDX5862"></A>
<A NAME="IDX5863"></A>
<P><DT><B>kas
</B><DD>認証サーバーと通信するためのコマンドの組
(認証サーバー用のバイナリーは <B>kaserver</B>)
<A NAME="IDX5864"></A>
<A NAME="IDX5865"></A>
<A NAME="IDX5866"></A>
<A NAME="IDX5867"></A>
<A NAME="IDX5868"></A>
<A NAME="IDX5869"></A>
<P><DT><B>kaserver
</B><DD>認証サーバー・プロセス用のバイナリー。
<A NAME="IDX5870"></A>
<A NAME="IDX5871"></A>
<A NAME="IDX5872"></A>
<A NAME="IDX5873"></A>
<A NAME="IDX5874"></A>
<A NAME="IDX5875"></A>
<P><DT><B>ntpd
</B><DD>ネットワーク・タイム・プロトコル・デーモン (NTPD) 用のバイナリー。
AFS はこのバイナリーを再配布し、
<B>runntp</B> プログラムを使用して、NTPD プロセスを構成し初期化します。
<A NAME="IDX5876"></A>
<A NAME="IDX5877"></A>
<A NAME="IDX5878"></A>
<P><DT><B>ntpdc
</B><DD><B>ntpd</B> プログラムに備え付けられたデバッグ・ユーティリティー
<A NAME="IDX5879"></A>
<A NAME="IDX5880"></A>
<P><DT><B>pts
</B><DD>保護サーバー・プロセスと通信するためのコマンドの組
(保護サーバー用のバイナリーは <B>ptserver</B>)
<A NAME="IDX5881"></A>
<A NAME="IDX5882"></A>
<A NAME="IDX5883"></A>
<A NAME="IDX5884"></A>
<A NAME="IDX5885"></A>
<A NAME="IDX5886"></A>
<P><DT><B>ptserver
</B><DD>保護サーバー・プロセス用のバイナリー
<A NAME="IDX5887"></A>
<A NAME="IDX5888"></A>
<A NAME="IDX5889"></A>
<A NAME="IDX5890"></A>
<P><DT><B>runntp
</B><DD>AFS で使用するのに最も適した NTPD を構成するために使用するプログラム用のバイナリー
<A NAME="IDX5891"></A>
<A NAME="IDX5892"></A>
<A NAME="IDX5893"></A>
<A NAME="IDX5894"></A>
<A NAME="IDX5895"></A>
<A NAME="IDX5896"></A>
<P><DT><B>salvager
</B><DD><B>fs</B> プロセスのサルベージャー・コンポーネント用のバイナリー
<A NAME="IDX5897"></A>
<A NAME="IDX5898"></A>
<A NAME="IDX5899"></A>
<A NAME="IDX5900"></A>
<P><DT><B>udebug
</B><DD>AFS の分散データベース・テクノロジー、Ubik の状態を報告するプログラム用のバイナリー
<A NAME="IDX5901"></A>
<A NAME="IDX5902"></A>
<A NAME="IDX5903"></A>
<A NAME="IDX5904"></A>
<A NAME="IDX5905"></A>
<A NAME="IDX5906"></A>
<P><DT><B>upclient
</B><DD>更新サーバー・プロセスのクライアント部分用のバイナリー
<A NAME="IDX5907"></A>
<A NAME="IDX5908"></A>
<A NAME="IDX5909"></A>
<A NAME="IDX5910"></A>
<P><DT><B>upserver
</B><DD>更新サーバー・プロセスのサーバー部分用のバイナリー
<A NAME="IDX5911"></A>
<A NAME="IDX5912"></A>
<A NAME="IDX5913"></A>
<A NAME="IDX5914"></A>
<A NAME="IDX5915"></A>
<A NAME="IDX5916"></A>
<A NAME="IDX5917"></A>
<P><DT><B>vlserver
</B><DD>ボリューム・ロケーション (VL) サーバー・プロセス用のバイナリー
<A NAME="IDX5918"></A>
<A NAME="IDX5919"></A>
<A NAME="IDX5920"></A>
<A NAME="IDX5921"></A>
<A NAME="IDX5922"></A>
<A NAME="IDX5923"></A>
<P><DT><B>volserver
</B><DD><B>fs</B> プロセスのボリューム・サーバー・コンポーネント用のバイナリー
<A NAME="IDX5924"></A>
<A NAME="IDX5925"></A>
<P><DT><B>vos
</B><DD>ボリューム・サーバー・プロセスおよび VL サーバー・プロセスと通信するためのコマンドの組 (これらのサーバー用のバイナリーは、それぞれ <B>volserver</B> と <B>vlserver</B>)
</DL>
<A NAME="IDX5926"></A>
<A NAME="IDX5927"></A>
<A NAME="IDX5928"></A>
<A NAME="IDX5929"></A>
<A NAME="IDX5930"></A>
<P><H3><A NAME="HDRWQ120" HREF="auagd002.htm#ToC_103">/usr/afs/etc ディレクトリーにある共通構成ファイル</A></H3>
<P>あらゆるファイル・サーバー・マシンのローカル・ディスクにあるディレクトリー
<B>/usr/afs/etc</B> には、
ASCII とマシンから独立したバイナリー形式の構成ファイルが含まれます。セル全体の予測可能な AFS パフォーマンスのためには、すべてのサーバー・マシンのバージョンは、それぞれの構成ファイルと同じでなければなりません。
<UL>
<A NAME="IDX5931"></A>
<LI>しきたり通りに AFS の米国版を実行するセルでは、更新サーバーを使用し、それぞれのファイルの共通バージョンを、セルのシステム制御マシンからほかのサーバー・マシンに配布します
(システム制御マシンに関する詳細については、<A HREF="#HDRWQ129">システム制御マシン</A> を参照してください)。システム制御マシンで更新サーバーのサーバー部分を実行し、ほかのすべてのサーバー・マシンでクライアント部分を実行します。緊急事態に対処するための指示によって送信される場合を除いて、システム制御マシンだけでファイルを更新します。
</LI><LI>AFS の国際版を実行するセルでは、更新サーバーを使用して、
<B>/usr/afs/etc</B> ディレクトリーのコンテンツを配布しなければなりません。米国政府の規定により、このディレクトリーのファイルがネットワークを渡るときに、これらのファイルを保護するために AFS で使用するデータ暗号化ルーチンは、
AFS の国際版の更新サーバーに使用することができません。代わりに、それぞれのサーバー・マシンで個別にそのファイルを更新し、それぞれのマシンに対して同じ <B>bos</B> コマンドを正確に発行しなければなりません。必要なデータ暗号化ルーチンは、<B>bos</B> コマンドに使用可能です。したがって、<B>bos</B> コマンドが発行されるマシンから、サーバー・マシンへとネットワークを渡る情報は安全です。
</LI></UL>
<P>
緊急事態に対処するための指示によって送信される場合を除いて、
<B>/usr/afs/etc</B> ディレクトリーにあるどのようなファイルも直接編集してはいけません。通常の環境では、適切な <B>bos</B> コマンドを使用してファイルを変更します。以下のリストには、指示を指すポインターが組み込まれます。
<P>このディレクトリーのファイルには、以下が組み込まれます。
<DL>
<A NAME="IDX5932"></A>
<A NAME="IDX5933"></A>
<P><DT><B>CellServDB
</B><DD>セルのデータベース・サーバー・マシンを命名する ASCII ファイルで、認証、バックアップ、保護、および VL サーバー・プロセスを実行します。ユーザーのセルの最初のサーバー・マシンをインストール中に、
<B>bos setcellname</B> コマンドを発行して、このファイルの初期バージョンを作成します。ユーザーのセルのデータベース・サーバー・マシンの識別を変更するときには、このファイルの更新は非常に重要です。
<P>
<P>サーバー <B>CellServDB</B> ファイルは、クライアント・マシンの <B>/usr/vice/etc</B> ディレクトリーに保管される
<B>CellServDB</B> ファイルとは異なります。クライアント・バージョンは、ユーザーがクライアント・マシンからアクセスできるように選択した、あらゆる AFS セルのデータベース・サーバー・マシンのリストを作成します。サーバー <B>CellServDB</B> ファイルは、ローカル・セルだけのデータベース・サーバーのリストを作成します。それは、サーバー・プロセスがほかのセルのプロセスと更新することはないからです。
<P>
<P>このファイルの保守については、<A HREF="#HDRWQ153">サーバー CellServDB ファイルの保守</A> を参照してください。
<A NAME="IDX5934"></A>
<A NAME="IDX5935"></A>
<A NAME="IDX5936"></A>
<P><DT><B>KeyFile
</B><DD>マシンから独立したバイナリー形式のファイルで、
AFS サーバー・プロセスがチケットを暗号化したり複号するために使用する、サーバー暗号化鍵のリストを作成します。このファイルにある情報は、セルにおける安全な通信の基礎となるため、極めて重要です。このファイルは特別に保護され、特権ユーザーだけが読み取ったり変更することができます。
<P>
<P>このファイルの保守については、<A HREF="auagd014.htm#HDRWQ478">サーバー暗号化鍵の管理</A> を参照してください。
<A NAME="IDX5937"></A>
<A NAME="IDX5938"></A>
<P><DT><B>ThisCell
</B><DD>セルの完全なインターネット・ドメイン形式の名前 (<TT>abc.com</TT> など)
を定義する単一行で構成される ASCII ファイル。<I>AFS インストールの手引き</I> で説明しているように、セルの最初のファイル・サーバー・マシンのインストール時に、
<B>bos setcellname</B> コマンドを使用してこのファイルを作成します。
<P>
<P>このファイルを変更することは、セルの名前を変更する 1 つのステップにしかすぎません。説明は、<A HREF="auagd007.htm#HDRWQ35">セル名の選択</A> を参照してください。
<A NAME="IDX5939"></A>
<A NAME="IDX5940"></A>
<P><DT><B>UserList
</B><DD>特権付き <B>bos</B> コマンド、<B>vos</B> コマンド、および
<B>backup</B> コマンドを発行することを許可されたシステム管理者のリストを作成する ASCII ファイル。このファイルの保守については、<A HREF="auagd021.htm#HDRWQ815">UserList ファイルの管理</A> を参照してください。
</DL>
<A NAME="IDX5941"></A>
<A NAME="IDX5942"></A>
<A NAME="IDX5943"></A>
<A NAME="IDX5944"></A>
<P><H3><A NAME="HDRWQ121" HREF="auagd002.htm#ToC_104">/usr/afs/local ディレクトリーのローカル構成ファイル</A></H3>
<P>ディレクトリー <B>/usr/afs/local</B>には、セルにあるそれぞれのファイル・サーバー・マシンごとに異なる構成ファイルが含まれます。したがって、それらの構成ファイルは、<B>/usr/afs/bin</B> および <B>/usr/afs/etc</B> ディレクトリーにあるファイルのように、中央ソースから自動的に更新されることはありません。最も重要なファイルは、<B>BosConfig</B> ファイルです。このファイルはそのマシンで実行するサーバー・プロセスを定義します。
<P><B>/usr/afs/etc</B> にある共通構成ファイルと同じように、これらのファイルを直接編集してはいけません。適切な場合は、
<B>bos</B> コマンドの組のコマンドを使用します。更新する必要がないファイルもあります。
<P>このディレクトリーに含まれるファイルは、以下のとおりです。
<DL>
<A NAME="IDX5945"></A>
<A NAME="IDX5946"></A>
<P><DT><B>BosConfig
</B><DD>このファイルには、サーバー・マシンで実行されるプロセスがリストされています。
BOS サーバーがモニターするプロセスと、プロセスが失敗したときに行うことを定義しています。また、BOS サーバーが保守の目的でプロセスを自動的に再始動する回数も定義します。
<P>
<P>ファイル・サーバー・マシンのインストール中に、サーバー・プロセスを作成するときに、それらのプロセスの項目は、このファイル内で自動的に定義されます。<I>AFS インストールの手引き</I> では、使用する <B>bos</B> コマンドについて、簡単に説明します。ファイルの詳細な説明と、
<B>bos</B> の組のコマンドでファイルを編集してプロセスの状況を制御するための指示については、
<A HREF="auagd009.htm#HDRWQ177">サーバー・プロセスの監視および制御</A> を参照してください。
<A NAME="IDX5947"></A>
<A NAME="IDX5948"></A>
<P><DT><B>NetInfo
</B><DD>このオプションの ASCII ファイルは、サーバー・マシン上にある 1 つまたは複数のネットワーク・インターフェース・アドレスをリスト表示します。このファイルがファイル・サーバーの初期設定時に存在する場合は、ファイル・サーバーは、そのボリューム・ロケーション・データベース (VLDB) サーバー項目に登録するインターフェースのリストの基本としてこれを使用します。
<A HREF="#HDRWQ173">サーバー IP アドレスおよび VLDB サーバー項目の管理</A>を参照してください
<A NAME="IDX5949"></A>
<A NAME="IDX5950"></A>
<P><DT><B>NetRestrict
</B><DD>このオプションの ASCII ファイルは、1 つまたは複数のネットワーク・インターフェース・アドレスをリスト表示します。このファイルがファイル・サーバーの初期設定時に存在する場合は、ファイル・サーバーは、その VLDB サーバー項目に登録するインターフェースのリストから指定アドレスを削除します。
<A HREF="#HDRWQ173">サーバー IP アドレスおよび VLDB サーバー項目の管理</A>を参照してください
<A NAME="IDX5951"></A>
<A NAME="IDX5952"></A>
<P><DT><B>NoAuth
</B><DD>この長さ 0 のファイルは、マシンで実行されるすべての AFS サーバー・プロセスに、許可検査を実行しないように指示するからです。したがって、これらのサーバー・プロセスは、
<B>anonymous</B> にもかかわらず、どのユーザーのどのようなアクションでも実行します。この非常に危険な状態が役に立つ場合はまれで、主にマシンのインストール中だけです。
<P>
<P>このファイルは、
<B>-noauth</B> フラグをもつ初期 <B>bosserver</B> プロセスを開始するか、あるいは、<B>bos setauth</B> コマンドを発行して認証要件をオフにするときに、自動的に作成されます。<B>bos setauth</B> コマンドを使用して認証をオンにすると、
BOS サーバーはこのファイルを除去します。詳細については、<A HREF="#HDRWQ158">認証と許可の要件の管理</A> を参照してください。
<A NAME="IDX5953"></A>
<A NAME="IDX5954"></A>
<P><DT><B>SALVAGE.fs
</B><DD>この長さ 0 のファイルの存在によって、<B>fs</B> プロセスのファイル・サーバー・コンポーネントの破損を BOS サーバーがどのように処置するかを制御します。
BOS サーバーは、<B>fs</B> プロセスを開始または再始動するたびに、このファイルを作成します。ファイル・サーバーが破損したときにこのファイルが存在する場合には、
BOS サーバーは、ファイル・サーバーとボリューム・サーバーをもう一度再始動する前に、サルベージャーを実行します。ファイル・サーバーが正常に終了するときには、
BOS サーバーはそのファイルを除去して、サルベージャーが実行されないようにします。
<P>
<P>このファイルをユーザー自身が作成したり、または除去してはいけません。
BOS サーバーが自動的に行います。必要な場合は、<B>bos salvage</B> コマンドを使って、ボリュームまたはパーティションを回収することができます。<A HREF="auagd010.htm#HDRWQ318">ボリュームのサルベージ</A> を参照してください。
<A NAME="IDX5955"></A>
<A NAME="IDX5956"></A>
<P><DT><B>salvage.lock
</B><DD>このファイルによって、1 つのファイル・サーバー・マシンで一度に 1 つのサルベージャーしか実行されないことを保証します
(単一のプロセスが、複数のサブプロセスを fork して、複数のパーティションを並列してサルベージできます)。サルベージャーの開始時 (BOS サーバー、または <B>bos salvage</B> コマンドの発行によって呼び出されると)、この長さ 0 のファイルを作成し、それに対して <B>flock</B> システム・コールを発行します。サルベージ・オペレーションが完了すると、このファイルは削除されます。サルベージャーが実行するためには、このファイルをロックする必要があるので、一度に 1 つのサルベージャーしか実行することができません。
<A NAME="IDX5957"></A>
<A NAME="IDX5958"></A>
<A NAME="IDX5959"></A>
<A NAME="IDX5960"></A>
<P><DT><B>sysid
</B><DD>このファイルは、ファイル・サーバー
(<B>fileserver</B> プロセス) がその VLDB サーバー項目に登録するネットワーク・インターフェース・アドレスを記録します。キャッシュ・マネージャーがボリューム・ロケーション情報を要求すると、ボリューム・ロケーション (VL) サーバーは、ボリュームを含む各サーバー・マシンに対して登録されているインターフェースをすべて戻します。これにより、キャッシュ・マネージャーがマルチホーム・ファイル・サーバー・マシンに保管された AFS データにアクセスする際、複数アドレスを使用することができます。詳細については、<A HREF="#HDRWQ173">サーバー IP アドレスおよび VLDB サーバー項目の管理</A> を参照してください。
</DL>
<A NAME="IDX5961"></A>
<A NAME="IDX5962"></A>
<A NAME="IDX5963"></A>
<A NAME="IDX5964"></A>
<A NAME="IDX5965"></A>
<A NAME="IDX5966"></A>
<P><H3><A NAME="HDRWQ122" HREF="auagd002.htm#ToC_105">/usr/afs/db ディレクトリーにある複写済みのデータベース・ファイル</A></H3>
<P>ディレクトリー <B>/usr/afs/db</B> には、認証データベース、バックアップ・データベース、保護データベース、およびボリューム・ロケーション・データベース (VLDB) という、セル内の 4 つの複写されたデータベースに関連した以下の 2 つのタイプのファイルが含まれています。
<UL>
<LI><B>.DB0</B> 拡張子が付いた、それぞれのデータベースを含むファイル。
</LI><LI><B>.DBSYS1</B> 拡張子が付いた、それぞれのデータベースごとのファイル。データベース・サーバー・プロセスは、このファイルでそれぞれのデータベース・オペレーションをログに記録してから実行します。そのオペレーションが妨害されると、そのプロセスはこのファイルに相談してその終了方法を確認します。
</LI></UL>
<P>それぞれのデータベース・プロセス (認証、バックアップ、保護、または VL サーバー) が、そのプロセス専用のデータベース・ファイルとログ・ファイルを保持しています。データベース・ファイルはバイナリー形式です。したがって、データベース・ファイルにアクセスする場合またはデータベース・ファイルを更新する場合は、いつでも、
<B>kas</B> の組 (認証データベースの場合)、
<B>backup</B> の組 (バックアップ・データベースの場合)、
<B>pts</B> の組 (保護データベースの場合)、または <B>vos</B> の組 (VLDB の場合) を使用しなければなりません。
<P>セルで 複数のデータベース・サーバー・マシンを実行する場合には、それぞれのデータベース・サーバー・プロセスは、そのデータベースの独自のコピーを、マシンのハード・ディスクに保持します。ただし、所定のデータベースのすべてのコピーが同じであることが重要です。それらのコピーを同期するためには、
<A HREF="#HDRWQ137">AFS 管理データベースの複写</A> で説明したように、データベース・サーバー・プロセスには、
AFS の分散データベース・テクノロジー、Ubik が必要です。
<P>ここにリストされているファイルは、データベース・サーバー・マシンでだけこのディレクトリーに表示されます。データベース・サーバー・マシン以外のマシンのディレクトリーは、空です。
<DL>
<A NAME="IDX5967"></A>
<A NAME="IDX5968"></A>
<P><DT><B>bdb.DB0
</B><DD>バックアップ・データベース・ファイル
<A NAME="IDX5969"></A>
<A NAME="IDX5970"></A>
<P><DT><B>bdb.DBSYS1
</B><DD>バックアップ・データベース・ログ・ファイル
<A NAME="IDX5971"></A>
<A NAME="IDX5972"></A>
<P><DT><B>kaserver.DB0
</B><DD>認証データベース・ファイル
<A NAME="IDX5973"></A>
<A NAME="IDX5974"></A>
<P><DT><B>kaserver.DBSYS1
</B><DD>認証データベース・ログ・ファイル
<A NAME="IDX5975"></A>
<A NAME="IDX5976"></A>
<P><DT><B>prdb.DB0
</B><DD>保護データベース・ファイル
<A NAME="IDX5977"></A>
<A NAME="IDX5978"></A>
<P><DT><B>prdb.DBSYS1
</B><DD>保護データベース・ログ・ファイル
<A NAME="IDX5979"></A>
<A NAME="IDX5980"></A>
<P><DT><B>vldb.DB0
</B><DD>ボリューム・ロケーション・データベース・ファイル
<A NAME="IDX5981"></A>
<A NAME="IDX5982"></A>
<P><DT><B>vldb.DBSYS1
</B><DD>ボリューム・ロケーション・データベース・ログ・ファイル
</DL>
<A NAME="IDX5983"></A>
<A NAME="IDX5984"></A>
<A NAME="IDX5985"></A>
<A NAME="IDX5986"></A>
<A NAME="IDX5987"></A>
<A NAME="IDX5988"></A>
<P><H3><A NAME="HDRWQ123" HREF="auagd002.htm#ToC_106">/usr/afs/logs ディレクトリーのログ・ファイル</A></H3>
<P><B>/usr/afs/logs</B> ディレクトリーには、さまざまなサーバー・プロセスのログ・ファイルが含まれます。このファイルで通常のオペレーション中に発生する興味深いイベントについて詳しく説明します。たとえば、ボリューム・サーバーでは、ボリュームの移動を <B>VolserLog</B> ファイルに記録することができます。イベントは完了時に記録されます。そのため、サーバー・プロセスでは、これらのファイルを使用しないで、失敗したオペレーションを再構成します。これは <B>/usr/afs/db</B> ディレクトリーにあるログ・ファイルとは異なります。
<P>ログ・ファイル内の情報は、プロセスの障害およびその他の問題を評価するのに非常に役立ちます。たとえば、ボリュームにアクセスしようとしてタイムアウト・メッセージを受け取った場合は、
<B>FileLog</B> ファイルを調べると、ファイル・サーバーがボリュームを付加できなかったことを示す説明が見つかる可能性があります。ログ・ファイルをリモートで調べるには、<A HREF="auagd009.htm#HDRWQ228">サーバー・プロセス・ログ・ファイル表示する</A> で説明しているように、<B>bos getlog</B> コマンドを使用します。
<P>このディレクトリーには、
BOS サーバーでプロセスをモニターする場合に生成される、コア・イメージ・ファイルも含まれます。BOS サーバーは、標準 <B>core</B> 名に拡張子を追加して、コア・ファイルを生成したプロセスを示そうとします (たとえば、保護サーバーによって生成されたコア・ファイルは、
<B>core.ptserver</B> という名前になります)。2 つのプロセスがほぼ同時に失敗すると、
BOS サーバーは正しい拡張子を割り当てることができない場合があります。
<P>このディレクトリーには、以下のファイルが組み込まれます。
<DL>
<A NAME="IDX5989"></A>
<A NAME="IDX5990"></A>
<P><DT><B>AuthLog
</B><DD>認証サーバーのログ・ファイル。
<A NAME="IDX5991"></A>
<A NAME="IDX5992"></A>
<P><DT><B><B>BackupLog</B>
</B><DD>バックアップ・サーバーのログ・ファイル。
<A NAME="IDX5993"></A>
<A NAME="IDX5994"></A>
<P><DT><B><B>BosLog</B>
</B><DD>BOS サーバーのログ・ファイル。
<A NAME="IDX5995"></A>
<A NAME="IDX5996"></A>
<P><DT><B><B>FileLog</B>
</B><DD>ファイル・サーバーのログ・ファイル。
<A NAME="IDX5997"></A>
<A NAME="IDX5998"></A>
<P><DT><B><B>SalvageLog</B>
</B><DD>サルベージャーのログ・ファイル。
<A NAME="IDX5999"></A>
<A NAME="IDX6000"></A>
<P><DT><B><B>VLLog</B>
</B><DD>ボリューム・ロケーション (VL) サーバーのログ・ファイル。
<A NAME="IDX6001"></A>
<A NAME="IDX6002"></A>
<P><DT><B><B>VolserLog</B>
</B><DD>ボリューム・サーバーのログ・ファイル。
<P><DT><B><B>core</B>.<VAR>process</VAR>
</B><DD>存在する場合には、破損したマシンで AFS サーバー・プロセスとして作成されるコア・イメージ・ファイル (おそらく <VAR>process</VAR> が命名したプロセス)。
</DL>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">ログ・ファイルが大きくなりすぎて管理不能になることを防ぐには、定期的にサーバー・プロセス (特にデータベース・サーバー・プロセス) を再始動します。プロセスの再始動を避けるには、UNIX の <B>rm</B> コマンドを使って、プロセスが実行されたらログ・ファイルを削除します。ログ・ファイルは自動的に再作成されます。
</TD></TR></TABLE>
<A NAME="IDX6003"></A>
<A NAME="IDX6004"></A>
<A NAME="IDX6005"></A>
<A NAME="IDX6006"></A>
<A NAME="IDX6007"></A>
<P><H3><A NAME="HDRWQ124" HREF="auagd002.htm#ToC_107">サーバー・パーティションのボリューム・ヘッダー</A></H3>
<P>AFS ボリュームを収容するパーティションは、マシンのルート ( / ) ディレクトリー (たとえば <B>/usr</B> ディレクトリーの下ではなく) のサブディレクトリーに取り付けなければなりません。ファイル・サーバー・マシンのファイル・システム登録ファイル (<B>/etc/fstab</B> または同等のファイル) は、ディレクトリー名とパーティションの装置名を正しくマップしなければなりません。ディレクトリーには、
<B>/vicep</B><VAR>index</VAR> の形式
(それぞれの <VAR>index</VAR> は 1 または 2 文字の小文字) の名前が付きます。規則では、マシン上の最初の AFS パーティションは <B>/vicepa</B> に、
2 番目のパーティションは <B>/vicepb</B> に、というように取り付けます。パーティションの数が 26 より多い場合は、
<B>/vicepaa</B>、<B>/vicepab</B> というように続けます。<I>AFS Release Notes</I> では、サポートされているサーバー・マシンあたりのパーティション数を指定しています。
<P>非 AFS ファイルを AFS パーティションに保管しないでください。ファイル・サーバーおよびボリューム・サーバーは、パーティション上のすべてのスペースが使用可能であると予期します。
<P><B>/vicep</B> ディレクトリーには、以下の 2 つのタイプのファイルが含まれます。
<DL>
<A NAME="IDX6008"></A>
<A NAME="IDX6009"></A>
<P><DT><B>V<VAR>vol_ID</VAR>.vol
</B><DD>このようなそれぞれのファイルが、ボリューム・ヘッダーです。<VAR>vol_ID</VAR> は、
<B>vos examine</B>、<B>vos listvldb</B>、および <B>vos listvol</B> コマンドの出力に表示されるボリューム ID 番号に対応します。
<A NAME="IDX6010"></A>
<A NAME="IDX6011"></A>
<P><DT><B>FORCESALVAGE
</B><DD>この長さ 0 のファイルは、サルベージャーがパーティション全体を回収するトリガーとなります。
AFS 変更済みバージョンの <B>fsck</B> プログラムは、破壊を見つけると、このファイルを作成します。
</DL>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">ほとんどのシステム・タイプにおいては、オペレーティング・システムに提供されている標準の <B>fsck</B> プログラムは、
AFS ファイル・サーバー・マシンでは決して実行してください。標準の <B>fsck</B> プログラムは、
AFS ボリューム・データの形式を認識できないため、サーバー・パーティションからすべての AFS ボリューム・データを削除します。
</TD></TR></TABLE>
<A NAME="IDX6012"></A>
<A NAME="IDX6013"></A>
<HR><H2><A NAME="HDRWQ125" HREF="auagd002.htm#ToC_108">ファイル・サーバー・マシンの 4 つの役割</A></H2>
<P>複数のサーバー・マシンがあるセルでは、すべてのサーバー・マシンがまったく同じ機能を実行しなければならないわけではありません。実行しているサーバー・プロセスを判別して、マシンに想定できる可能な<I>役割</I> が 4 つあります。すべての関連したプロセスを実行することによって、マシンには複数の役割を想定することができます。以下のリストでは 4 つの役割を要約しますが、それらについては、以降の機能グループでより完全に説明します。
<UL>
<LI><I>シンプル・ファイル・サーバー・マシン</I>は、
AFS ファイルをクライアント・マシンに保管し、引き渡すプロセスだけを実行します。ユーザーのセルのパフォーマンスとディスク空間の要件を満たすのに必要なだけの、シンプル・ファイル・サーバー・マシンを実行することができます。
</LI><LI><I>データベース・サーバー・マシン</I> は、
AFS の複写された管理用データベースを保守する 4 つのプロセス、認証、バックアップ、保護、およびボリューム・ロケーション (VL) のサーバー・プロセスを実行します。
</LI><LI><I>バイナリー配布マシン</I> は、そのマシンのシステム型の AFS サーバー・バイナリーを、そのシステム型のほかのすべてのサーバー・マシンに配付します。
</LI><LI>単一の<I>システム制御マシン</I>は、共通のサーバー構成ファイルを、セル内のほかのすべてのサーバー・マシンに配付します。セル内では、AFS の米国版を実行します (AFS の国際版を使用するセルでは、この目的のためにシステム制御マシンを使用してはいけません)。従来通り、マシンは、セルの時間同期ソースとしても稼働し、セルの外部の時間ソースに従って時刻を調整します。
</LI></UL>
<P>セルにあるサーバー・マシンが 1 つだけの場合は、シンプル・ファイル・サーバーとデータベース・サーバーの役割を想定しています。
<I>AFS インストールの手引き</I> にある説明によっても、そのシステム・タイプに応じたシステム制御マシンとバイナリー配布マシンとして、サーバー・マシンを構成することができますが、サーバー・マシンがこれらの機能を実際に実行するのは、ユーザーが別のサーバー・マシンをインストールしてからです。
<P>たとえ、すべてのプロセスが実行されていなくても、すべての AFS サーバー・プロセスのバイナリーを
<B>/usr/afs/bin</B> ディレクトリーに保持するのは最もよいことです。次に、その役割を定義するプロセスを開始するかまたは停止するだけで、マシンに想定される役割を変更することができます。
<A NAME="IDX6014"></A>
<A NAME="IDX6015"></A>
<P><H3><A NAME="HDRWQ126" HREF="auagd002.htm#ToC_109">シンプル・ファイル・サーバー・マシン</A></H3>
<P><I>シンプル・ファイル・サーバー・マシン</I> が実行するのは、
AFS ファイルをクライアント・マシンに保管または送達し、プロセスの状態をモニターし、セルのバイナリー配布マシンとシステム制御マシンから、バイナリー・ファイルと構成ファイルをピックアップするサーバー・プロセスだけです。
<P>一般的に、3 つより多いサーバー・マシンをもつセルだけが、シンプル・ファイル・サーバー・マシンを実行する必要があります。3 つ以下のマシンをもつセルでは、そのすべてのマシンはほとんどの場合データベース・サーバー・マシンです
(管理用データベースの複写から利益を得るため)。
<A HREF="#HDRWQ127">データベース・サーバー・マシン</A> を参照してください。
<P>以下のプロセスは、シンプル・ファイル・サーバー・マシンで実行されます。
<UL>
<LI>BOS サーバー (<B>bosserver</B> プロセス)
</LI><LI><B>fs</B> プロセス。ファイル・サーバー、ボリューム・サーバー、およびサルベージャー・プロセスを結合し、これらがボリュームのデータに対して行うオペレーションを調整し、同じデータで複数のオペレーションを同時に行うことによって生じる矛盾を回避できるようにします。
</LI><LI>NTP コーディネーター (<B>runntp</B> プロセス)。マシンのクロックを、セル内のほかのサーバー・マシンのクロックと同期化させて保持するのに役立ちます。
</LI><LI>その AFS システム・タイプのバイナリー配布マシンからバイナリー・ファイルを選び出す、更新サーバーのクライアント部分 (<B>upclientbin</B> プロセス)
</LI><LI>米国版の AFS を実行しているセル内のシステム制御マシンから共通構成ファイルを選び出す、更新サーバーのクライアント部分 (<B>upclientetc</B> プロセス)
</LI></UL>
<A NAME="IDX6016"></A>
<A NAME="IDX6017"></A>
<A NAME="IDX6018"></A>
<A NAME="IDX6019"></A>
<A NAME="IDX6020"></A>
<A NAME="IDX6021"></A>
<P><H3><A NAME="HDRWQ127" HREF="auagd002.htm#ToC_110">データベース・サーバー・マシン</A></H3>
<P><I>データベース・サーバー・マシン</I> は、
AFS の複写された管理用データベースを保守する 4 つのプロセスを実行します。この 4 つのプロセスとは、認証サーバー、バックアップ・サーバー、保護サーバー、および ボリューム・ロケーション (VL) サーバーで、認証データベース、バックアップ・データベース、保護データベース、およびボリューム・ロケーション・データベース (VLDB) をそれぞれ保守します。これらのサーバー・プロセスとそれらのデータベースの機能を見直すには、
<A HREF="auagd006.htm#HDRWQ18">AFS サーバー・プロセスとキャッシュ・マネージャー</A> を参照してください。
<P>セルに複数のサーバー・マシンがある場合には、複数のデータベース・サーバー・マシンを実行するのはよいことですが、3 つより多くが必要になることはめったにありません。データベースをこの方法で複写すると、情報の可用性と信頼性が増大するという、ボリュームを複写するのと同じ利益が生じます。1 つのデータベース・サーバー・マシンまたはプロセスが終わっても、データベース内の情報は、まだほかのデータベース・サーバー・マシンまたはプロセスから使用可能です。データベース情報に対する要求のロードが複数のマシンに分散し、いずれのマシンも過負荷になることがないようにします。
<P>ただし、複写されたボリュームと異なり、複写されたデータベースは頻繁に変更されます。一貫したシステム・パフォーマンスを得るためには、データベースのすべてのコピーがいつでも同一である必要があります。したがって、コピーの一部にだけ変更を記録することはできません。データベースのコピーを同期化するために、データベース・サーバー・プロセスでは、
AFS の分散データベース・テクノロジーである Ubik を使用します。
<A HREF="#HDRWQ137">AFS 管理データベースの複写</A> を参照してください。
<P>セルにあるあらゆるサーバー・マシンの AFS サーバー・プロセスが、どのマシンがデータベース・サーバー・マシンであるかを知っていることは重要です。特に、データベース・サーバー・プロセスでは、データベースのコピーを調整するために、対等機能との一定の接点を保守しなければなりません。ほかのサーバー・プロセスでは、データベースからの情報を必要とすることがよくあります。あらゆるサーバー・マシンでは、そのセルのデータベース・サーバー・マシンのリストを、ローカルの <B>/usr/afs/etc/CellServDB</B> ファイルに保持します。米国版の AFS を使用するセルでは、システム制御マシンを使用して、このファイルを配布することができます
(<A HREF="#HDRWQ129">システム制御マシン</A> を参照)。
<P>以下のプロセスは、定義・サーバー・マシンを定義します。
<UL>
<LI>認証サーバー (<B>kaserver</B> プロセス)
</LI><LI>バックアップ・サーバー (<B>buserver</B> プロセス)
</LI><LI>保護サーバー (<B>ptserver</B> プロセス)
</LI><LI>VL サーバー (<B>vlserver</B> プロセス)
</LI></UL>
<P>データベース・サーバー・マシンは、<A HREF="#HDRWQ126">シンプル・ファイル・サーバー・マシン</A> にリストされるような、シンプル・ファイル・サーバーを定義するプロセスも実行することができます。1 つのデータベース・サーバー・マシンは、セルのシステム制御マシンとしての機能を果たし、データベース・サーバー・マシンのどれかは、そのシステム・タイプのバイナリー配布マシンとして機能を果たすことができます。
<A HREF="#HDRWQ129">システム制御マシン</A> および <A HREF="#HDRWQ128">バイナリー配布マシン</A> を参照してください。
<A NAME="IDX6022"></A>
<A NAME="IDX6023"></A>
<A NAME="IDX6024"></A>
<A NAME="IDX6025"></A>
<P><H3><A NAME="HDRWQ128" HREF="auagd002.htm#ToC_111">バイナリー配布マシン</A></H3>
<P><I>バイナリー配布マシン</I> では、
AFS プロセスとコマンドの組のバイナリー・ファイルを、そのシステム・タイプのほかのすべてのサーバー・マシンに保管したり配布します。それぞれのファイル・サーバー・マシンでは、
AFS サーバー・プロセス・バイナリーの独自のコピーをローカル・ディスクに、規則では、<B>/usr/afs/bin</B> ディレクトリーに保持します。ただし、一貫したシステム・パフォーマンスのためには、すべてのサーバー・マシンで同じバージョン (作成レベル) のプロセスを実行しなければなりません。バイナリーの作成レベルを調べるための指示については、
<A HREF="#HDRWQ152">バイナリー・ファイルの作成レベルの表示</A> を参照してください。バイナリーの整合性を保持する最も簡単な方法は、それぞれのシステム・タイプのバイナリー配布マシンを使って、バイナリーをそのシステム・タイプのマシンに配布することです。
<P>バイナリー配布マシンを定義するプロセスは、更新サーバーのサーバー部分 (<B>upserver</B> プロセス) です。更新サーバーのクライアント部分 (<B>upclientbin</B> プロセス) は、そのシステム・タイプのほかのサーバー・マシンで実行され、バイナリー配布マシンを参照します。
<P>通常、バイナリー配布マシンは、
<A HREF="#HDRWQ126">シンプル・ファイル・サーバー・マシン</A> にリストされるような簡単なファイル・サーバー・マシンを定義するプロセスも実行します。
1 つのバイナリー配布マシンはセルのシステム制御マシンとしての機能を果たし、任意のバイナリー配布マシンはデータベース・サーバー・マシンとしての機能を果たします。<A HREF="#HDRWQ129">システム制御マシン</A>および <A HREF="#HDRWQ127">データベース・サーバー・マシン</A>を参照してください。
<A NAME="IDX6026"></A>
<A NAME="IDX6027"></A>
<A NAME="IDX6028"></A>
<P><H3><A NAME="HDRWQ129" HREF="auagd002.htm#ToC_112">システム制御マシン</A></H3>
<P>米国版の AFS を実行するセルでは、
<I>システム制御マシン</I> では、セル内のすべてのサーバー・マシンが共有するシステム構成ファイルを保管し配布します。それぞれのファイル・サーバー・マシンでは、構成ファイルの独自のコピーをローカル・ディスクに、規則では <B>/usr/afs/etc</B> ディレクトリーに保持します。ただし、一貫したシステム・パフォーマンスのためには、すべてのサーバー・マシンで同じファイルを使用しなければなりません。ファイルの整合性を保持する最も簡単な方法は、システム制御マシンを使ってファイルを配布することです。本書の説明で指図されるときには、システム制御マシンに保管されるコピーだけを変更します。米国版の AFS は、米国政府の規制により決められた、米国とカナダにあるセル、およびほかの各国の選ばれた機関に使用可能です。
<P>AFS の国際版を実行するセルでは、システム構成ファイルを配布するために、システム制御マシンを使用しません。このファイルの一部には、暗号化しないでネットワークを渡すには重要過ぎる情報が含まれ、米国政府の規制により、必要な暗号化ルーチンを更新サーバーが使用する形式でエクスポートすることは禁じられています。代わりに、それぞれのファイル・サーバー・マシンで個別に、構成ファイルを更新しなければなりません。ファイルを更新するために使用する <B>bos</B> コマンドは、暗号化ルーチンのエクスポート可能な形式を使用して情報を暗号化します。
<P><B>/usr/afs/etc</B> ディレクトリーに保管される構成ファイルのリストについては、
<A HREF="#HDRWQ120">/usr/afs/etc ディレクトリーにある共通構成ファイル</A> を参照してください。
<P><I>AFS インストールの手引き</I> では、システム制御マシンとして、セルの最初のサーバー・マシンを構成します。希望する場合には、後にユーザーがインストールする別のマシンに、その役割を再割り当てすることができますが、ほかのすべてのサーバー・マシンで実行している更新サーバーのクライアント部分を (<B>upclientetc</B> プロセス) を変更して、新規システム制御マシンに当てはめなければなりません。
<P>以下のプロセスは、システム制御マシンを定義します。
<UL>
<A NAME="IDX6029"></A>
<A NAME="IDX6030"></A>
<LI>米国版の AFS を使用しているセルでは、更新サーバー (<B>upserver</B>) プロセスのサーバー部分。更新サーバーのクライアント部分 (<B>upclientetc</B> プロセス) は、ほかのサーバー・マシンで実行され、システム制御マシンを参照します。
</LI><LI>セルが NTPD を使用してクロックを同期化する場合には、セル外部の時間ソースを指す NTP コーディネーター (<B>runntp</B> プロセス)。ほかのマシンの <B>runntp</B> プロセスは、その主な時間ソースとしてシステム制御マシンを参照します。
</LI></UL>
<P>システム制御マシンでは、<A HREF="#HDRWQ126">シンプル・ファイル・サーバー・マシン</A> にリストされるような、シンプル・ファイル・サーバー・マシンを定義するプロセスも実行できます。また、このマシンはデータベース・サーバー・マシンとしての機能も果たすことができ、規則では、そのシステム・タイプのバイナリー配布マシンとしての機能を果たします。単一の <B>upserver</B> プロセスでは、構成ファイルとバイナリー・ファイルの両方を配布することができます。
<A HREF="#HDRWQ127">データベース・サーバー・マシン</A> および <A HREF="#HDRWQ128">バイナリー配布マシン</A> を参照してください。
<A NAME="IDX6031"></A>
<A NAME="IDX6032"></A>
<A NAME="IDX6033"></A>
<A NAME="IDX6034"></A>
<A NAME="IDX6035"></A>
<A NAME="IDX6036"></A>
<A NAME="IDX6037"></A>
<P><H3><A NAME="HDRWQ130" HREF="auagd002.htm#ToC_113">データベース・サーバー・マシンを特定するには</A></H3>
<OL TYPE=1>
<LI><B>bos listhosts</B> コマンドを発行する。
<P>
<PRE>   % <B>bos listhosts</B> &lt;<VAR>machine name</VAR>>
</PRE>
<P>
<P>出力にリストされるマシンは、そのセルのデータベース・サーバー・マシンです。詳細な説明と、出力サンプルについては、<A HREF="#HDRWQ155">セルのデータベース・サーバー・マシンを表示するには</A> を参照してください。
</LI><LI><B>(オプション)</B> <B>bos status</B> コマンドを発行して、
<B>bos listhosts</B> コマンドの出力にリストされたマシンが、そのマシンをデータベース・サーバー・マシンとして定義するプロセスを実際に実行していることを検証します。詳細な指示については、<A HREF="auagd009.htm#HDRWQ205">BosConfig ファイルのプロセス状況および情報の表示</A> を参照してください。
<P>
<PRE>   % <B>bos status</B> &lt;<VAR>machine name</VAR>> <B>buserver kaserver ptserver vlserver</B>
</PRE>
<P>
<P>指定したマシンがデータベース・サーバー・マシンである場合、
<B>bos status</B> コマンドの出力には以下の行が含まれます。
<P>
<PRE>   Instance buserver, currently running normally.
   Instance kaserver, currently running normally.
   Instance ptserver, currently running normally.
   Instance vlserver, currently running normally.
</PRE>
</LI></OL>
<A NAME="IDX6038"></A>
<A NAME="IDX6039"></A>
<A NAME="IDX6040"></A>
<P><H3><A NAME="HDRWQ131" HREF="auagd002.htm#ToC_114">システム制御マシンを特定するには</A></H3>
<OL TYPE=1>
<LI>任意のファイル・サーバー・マシンに <B>bos status</B> コマンドを発行する。詳細な指示は <A HREF="auagd009.htm#HDRWQ205">BosConfig ファイルのプロセス状況および情報の表示</A> にあります。
<P>
<PRE>   % <B>bos status</B> &lt;<VAR>machine name</VAR>> <B>upserver upclientbin upclientetc</B> <B>-long</B>
</PRE>
<P>
<P>表示される出力は、ユーザーが交信したマシン、すなわち、シンプル・ファイル・サーバー・マシン、システム制御マシン、またはバイナリー配布マシンによって異なります。<A HREF="#HDRWQ133">bos status コマンドの出力の解釈</A> を参照してください。
</LI></OL>
<A NAME="IDX6041"></A>
<A NAME="IDX6042"></A>
<A NAME="IDX6043"></A>
<P><H3><A NAME="HDRWQ132" HREF="auagd002.htm#ToC_115">システム・タイプに応じたバイナリー配布マシンを特定するには</A></H3>
<OL TYPE=1>
<LI>検査する対象のシステム・タイプのファイル・サーバー・マシンに、
<B>bos status</B> コマンドを発行する (マシンのシステム・タイプを判別するには、
<A HREF="auagd015.htm#HDRWQ564">システム・タイプ名の表示および設定</A> に説明するように、<B>fs sysname</B> または <B>sys</B> コマンドを発行します)。
<B>bos status</B> コマンドに関する詳細な指示は、<A HREF="auagd009.htm#HDRWQ205">BosConfig ファイルのプロセス状況および情報の表示</A> にあります。
<P>
<PRE>   % <B>bos status</B> &lt;<VAR>machine name</VAR>> <B>upserver upclientbin upclientetc -long</B>
</PRE>
<P>
<P>表示される出力は、ユーザーが交信したマシン、すなわち、シンプル・ファイル・サーバー・マシン、システム制御マシン、またはバイナリー配布マシンによって異なります。<A HREF="#HDRWQ133">bos status コマンドの出力の解釈</A> を参照してください。
</LI></OL>
<A NAME="IDX6044"></A>
<A NAME="IDX6045"></A>
<A NAME="IDX6046"></A>
<P><H3><A NAME="HDRWQ133" HREF="auagd002.htm#ToC_116">bos status コマンドの出力の解釈</A></H3>
<P><B>bos status</B> コマンドの出力の解釈は、単純なファイル・サーバー・マシンでは最も簡単です。<B>upserver</B> プロセスがないため、出力には以下のメッセージが含まれます。
<PRE>   bos: failed to get instance info for 'upserver' (no such entity)
</PRE>
<P>単純なファイル・サーバー・マシンは <B>upclientbin</B> プロセスを実行するので、出力には次のようなメッセージが含まれます。これは、<B>fs7.abc.com</B> がこのシステム・タイプのバイナリー配布マシンであることを示しています。
<PRE>   Instance upclientbin, (type is simple) currently running normally.
   Process last started at Wed Mar 10  23:37:09 1999 (1 proc start)
   Command 1 is '/usr/afs/bin/upclient fs7.abc.com -t 60 /usr/afs/bin'
</PRE>
<P>米国版の AFS を実行している場合は、単純なファイル・サーバー・マシンは <B>upclientetc</B> プロセスも実行するので、出力には次のようなメッセージが含まれます。これは、<B>fs1.abc.com</B> がシステム制御マシンであることを示しています。
<PRE>   Instance upclientetc, (type is simple) currently running normally.
   Process last started at Mon Mar 22  05:23:49 1999 (1 proc start)
   Command 1 is '/usr/afs/bin/upclient fs1.abc.com -t 60 /usr/afs/etc'
</PRE>
<P><H4><A NAME="HDRWQ134">システム制御マシンの出力</A></H4>
<P>米国版の AFS を実行していて、システム制御マシンに <B>bos status</B> コマンドを発行した場合は、出力には次のような <B>upserver</B> プロセスに関する項目が含まれます。
<PRE>   Instance upserver, (type is simple) currently running normally.
   Process last started at Mon Mar 22 05:23:54 1999 (1 proc start)
   Command 1 is '/usr/afs/bin/upserver'
</PRE>
<P><I>AFS インストールの手引き</I> で推奨されているデフォルトの構成を使用している場合、システム制御マシンはそのシステム・タイプのバイナリー配布マシンでもあり、単一の <B>upserver</B> プロセスが両方の種類の更新を配布します。その場合には、出力には次のメッセージが含まれます。
<PRE>   bos: failed to get instance info for 'upclientbin' (no such entity)
   bos: failed to get instance info for 'upclientetc' (no such entity)
</PRE>
<P>システム制御マシンがバイナリー配布マシンでない場合には、出力には <B>upclientetc</B> プロセスに関するエラー・メッセージが含まれ、
<B>upclientbin</B> プロセスの完全なリストは含まれません (この場合、マシン <B>fs5.abc.com</B> がバイナリー配布マシンとして参照されます)。
<PRE>   Instance upclientbin, (type is simple) currently running normally.
   Process last started at Mon Mar 22  05:23:49 1999 (1 proc start)
   Command 1 is '/usr/afs/bin/upclient fs5.abc.com -t 60 /usr/afs/bin'
   bos: failed to get instance info for 'upclientetc' (no such entity)
</PRE>
<P><H4><A NAME="HDRWQ135">バイナリー配布マシンの出力</A></H4>
<P>バイナリー配布マシンに <B>bos status</B> コマンドを発行した場合は、出力には次のような <B>upserver</B> プロセスに関する項目と、
<B>upclientbin</B> プロセスに関するエラー・メッセージが含まれます。
<PRE>   Instance upserver, (type is simple) currently running normally.
   Process last started at Mon Apr 5 05:23:54 1999 (1 proc start)
   Command 1 is '/usr/afs/bin/upserver'
   bos: failed to get instance info for 'upclientbin' (no such entity)
</PRE>
<P>このマシンがシステム制御マシンでもある場合以外は、次のようなメッセージでシステム制御マシン (この場合は <B>fs3.abc.com</B>) が参照されます。
<PRE>   Instance upclientetc, (type is simple) currently running normally.
   Process last started at Mon Apr 5 05:23:49 1999 (1 proc start)
   Command 1 is '/usr/afs/bin/upclient fs3.abc.com -t 60 /usr/afs/etc'
</PRE>
<HR><H2><A NAME="HDRWQ136" HREF="auagd002.htm#ToC_119">データベース・サーバー・マシンの管理</A></H2>
<P>この機能グループでは、データベース・サーバー・マシンの管理方法を説明します。インストールの説明に関しては、
<I>AFS インストールの手引き</I> を参照してください。
<A NAME="IDX6047"></A>
<A NAME="IDX6048"></A>
<A NAME="IDX6049"></A>
<A NAME="IDX6050"></A>
<A NAME="IDX6051"></A>
<A NAME="IDX6052"></A>
<A NAME="IDX6053"></A>
<A NAME="IDX6054"></A>
<A NAME="IDX6055"></A>
<A NAME="IDX6056"></A>
<A NAME="IDX6057"></A>
<P><H3><A NAME="HDRWQ137" HREF="auagd002.htm#ToC_120">AFS 管理データベースの複写</A></H3>
<P><A HREF="auagd007.htm#HDRWQ68">AFS 管理データベースの複写</A> に説明されているように、AFS 管理用データベース (認証、バックアップ、保護、およびボリューム・ロケーションの各データベース) の複写には、いくつかの利点があります。セルが正しく機能するためには、各データベースのコピーが常に同一のものでなければなりません。データベースを同期化させておくために、
AFS は<I>Ubik</I> と呼ばれるユーティリティーのライブラリーを使用します。各データベース・サーバーのプロセスは、関連した lightweight Ubik プロセスとして実行され、クライアント側のプログラムは、Ubik のクライアント側のサブルーチンを呼び出して、データベースの読み取りや変更要求を実行以来します。
<P>Ubik は、管理者の操作を最小にとどめて機能するよう設計されていますが、
<A HREF="#HDRWQ138">Ubik の適切なオペレーションのためのセル構成</A> に示すようにいくつかの構成要件があります。以下の Ubik のオペレーションの概要は、この要件を理解するための手助けとなるでしょう。詳細については、<A HREF="#HDRWQ139">Ubik の自動オペレーション</A> を参照してください。
<P>Ubik は、AFS 管理データベースで行われた変更をすべてのコピーにできるだけすぐに配布することを目的としています。クライアントからの変更要求を受け入れる唯一のデータベース・コピーが <I>同期サイト</I> であり、ここで実行される lightweight Ubik プロセスのことを <I>Ubik コーディネーター</I> といいます。最低限の可用性を保持するため、各データベースごとに別個の Ubik コーディネーターが存在し、
4 つのデータベースごとに別のマシンに同期サイトを置くことができます。データベースの同期サイトもまた、プロセス、マシン、またはネットワークの障害に応じて、マシン間を移動することができます。
<P>データベースのその他のコピー、およびこれを保守するための Ubik プロセスは、
<I>2 次</I> と名付けられます。2 次サイトは、クライアント側プログラムから直接変更を受け入れることはなく、同期サイトからのみ受け入れます。
<P>Ubik コーディネーターは、データベースのコピーに変更を記録すると、即時に変更を 2 次サイトに送ります。短い配布期間中は、たとえ読み取り用であっても、クライアントはデータベースのコピーにアクセスできません。コーディネーターが 2 次サイトの多数に到達することができない場合には、そのコピーを打ち切り、変更の試行が失敗したことをクライアントに通知します。
<P>配布上の障害を避けるため、Ubik プロセスはタイム・スタンプのあるメッセージを交換して、常時交信をするようにします。
2 次サイトの多数がコーディネーターのメッセージに応答する限りは、コーディネーターと同期したサイトの <I>定数</I> が存在するものとされます。プロセス、マシン、またはネットワークの障害により定数が割れる場合には、
Ubik プロセスは新しくコーディネーターを選び出し、できる限り多くのサイト間で定数を確立するようにします。
<A HREF="#HDRWQ141">柔軟なコーディネーターによる可用性の向上</A> を参照してください。
<A NAME="IDX6058"></A>
<A NAME="IDX6059"></A>
<A NAME="IDX6060"></A>
<P><H4><A NAME="HDRWQ138">Ubik の適切なオペレーションのためのセル構成</A></H4>
<P>このセクションでは、適切な Ubik のオペレーションのためのセルの構成方法を説明します。
<UL>
<LI>4 つのデータ・サーバー・プロセス (認証サーバー、バックアップ・サーバー、保護サーバー、および VL サーバー) のすべてを、すべてのデータベース・サーバー・マシンで実行します。
<P>
<P>Ubik のクライアント部分とサーバー部分のどちらも、
<B>CellServDB</B> ファイルにリストされるすべてのデータベース・サーバー・マシンが、すべてのデータベース・サーバー・プロセスを実行していることを求めます。あるマシンで実行されている特定のデータベース・サーバー・プロセスを示すメカニズムはありません。
</LI><LI><B>/usr/afs/etc/CellServDB</B> のファイル情報が常時正しいものとなるよう保守します。
<P>
<P>Ubik は <B>/usr/afs/etc/CellServDB</B> ファイルを参照して、定数の確立、保守に使用するサイトを判別します。情報が正しくないと、データベースの同期がとれない、またはマシンの複数のサブグループからそれぞれコーディネーターが選ばれる結果となります。これは、各マシンの Ubik プロセスが、定数に加わるマシンの判別に一致した結果を出さないためです。
<P>
<P>米国版の AFS を稼働しており、更新サーバーを使用する場合は、システム制御マシン (コピーをその他すべてのサーバー・マシンに配布する) 上に <B>/usr/afs/etc/CellServDB</B> ファイルを置くのが最も簡単な方法です。
<I>AFS インストールの手引き</I> では、更新サーバーの構成方法を説明しています。インターナショナル版の AFS を稼働する場合、各マシン上でファイルを個別に更新しなくてはなりません。
<P>
<P>ファイルを更新するのは、データベース・サーバー・マシンの構成時または使用中止する場合です。手動でファイルを編集するのではなく、適切な <B>bos</B> コマンドを使用します。説明については、
<A HREF="#HDRWQ153">サーバー CellServDB ファイルの保守</A> を参照してください データ ベース・サーバー・マシンのインストールまたは使用の中止に関する <I>AFS インストールの手引き</I> の説明のように、プロセスの停止と開始に関する <A HREF="auagd009.htm#HDRWQ177">サーバー・プロセスの監視および制御</A> の説明は、適切な環境で <B>CellServDB</B> ファイルを忘れずに更新するようユーザーに注意しています。
<P>
<P>(データベースの保守を行わないクライアント・プロセスをサーバー・プロセスもまた、適切なオペレーションを行うため <B>CellServDB</B> ファイルを使用しますが、この場合、Ubik のオペレーションには影響はありません。
<A HREF="#HDRWQ153">サーバー CellServDB ファイルの保守</A> および <A HREF="auagd015.htm#HDRWQ553">データベース・サーバー・マシンの情報を保持する</A> を参照してください。)
<A NAME="IDX6061"></A>
</LI><LI>セル内のすべてのマシン、特にデータベース・サーバー・マシンでは、クロックを同期させるようにしてください。
<P>
<P><I>AFS インストールの手引き</I> に指定されている通常の構成では、
<B>runntp</B> プロセスを実行して、すべての AFS サーバー・マシン上のローカル Network Time Protocol Daemon (NTPD) を監視します。システム上の NTPD は、セル外の信用できるソースとマシンのクロックを同期するよう制御し、他のサーバー・マシンの NTPD に時刻を同報通信します。必要であれば、異なる時刻同期プロトコルを実行することができます。
<P>
<P>Ubik はデータベース・サイトのタイム・スタンプがあるメッセージを交換して常時交信をするため、クロックを同期させておくことは重要です。ネットワーク環境においては、メッセージが即時に宛先に到達すると考えるのは安全な前提ではないので、メッセージのタイム・スタンプは重要です。
Ubik は、着信メッセージと現在の時刻を比較します。差が大きすぎる場合は、障害により Ubik サイト間ので信頼性のある通信が行われず、これによりデータベースが同期されなかった可能性があります。Ubik はメッセージを無効とみなし、この場合異なるコーディネーターを選ぶよう指示が出されることがあります。
<P>
<P>実際に通信が中断したことによりタイム・スタンプを持つメッセージの有効期限が切れた場合、新規のコーディネーターを選ぶのは適当といえますが、送信側と受信側の時刻が異なるという理由だけでメッセージの有効期限が切れたと思われる場合には妥当ではありません。クロックの同期がとれていないことにより Ubik オペレーションが不安定となる場合の例については、
<A HREF="#HDRWQ140">Ubik におけるタイム・スタンプ・メッセージの使用</A> を参照してください。
</LI></UL>
<A NAME="IDX6062"></A>
<A NAME="IDX6063"></A>
<A NAME="IDX6064"></A>
<P><H4><A NAME="HDRWQ139">Ubik の自動オペレーション</A></H4>
<P>以下の Ubik 機能は、保守要件を最低限にするために役に立ちます。
<UL>
<LI>Ubik のサーバーとクライアントの部分は、自動的に作動します。
<P>
<P>それぞれのデータベース・サーバー・プロセスは、
Ubik ライブラリーのサーバー部分を呼び出すため lightweight プロセスを実行します。この lightweight プロセスを Ubik として参照するのが一般的です。これは lightweight プロセスであるため、
Ubik プロセスは、UNIX <B>ps</B> コマンドなどで生成されるプロセス・リストには現れません。データベースを読み取りおよび変更する必要のあるクライアント側プログラムは、別個の lightweight プロセスを実行するのではなく、Ubik ライブラリーのクライアント部分にあるサブルーチンを直接呼び出します。このようなプログラムには、<B>klog</B> コマンドや、<B>pts</B> 組のコマンドがあります。
</LI><LI>Ubik は、データベース・バージョン番号をトラックします。
<P>
<P>コーディネーターがデータベースに変更を記録する際、データベースのバージョン番号が増分で更新されます。バージョン番号によって、サイトが最新のバージョンを入手しているかいないかを決定するのが簡単になります。バージョン番号を使用することにより、新規コーディネーターの選出後、または通信が停止後に復元された場合の通常復帰機能が高速化されます。これは、最新のデータベースを所有するサイトおよび更新の必要があるサイトの判別が容易になるためです。
</LI><LI>Ubik がタイム・スタンプのあるメッセージを使用することにより、データベース・コピーが通常のオペレーションにおいて常に同期化されます。
<P>
<P>データベースの複写によるデータ使用可能性の向上は、すべてのデータベース・コピーが同じでないと意味がありません。クライアントがアクセスするデータベースのコピーに応じて異なる情報を受け取ると、パフォーマンスに矛盾が生じます。先に説明したとおり、Ubik サイトはタイム・スタンプを持つメッセージを交換してピアの状況をトラックします。詳細については、
<A HREF="#HDRWQ140">Ubik におけるタイム・スタンプ・メッセージの使用</A> を参照してください。
</LI><LI>コーディネーターを移動できることにより、データベースの可用性が最大限向上します。
<P>
<P>たとえば、3 つのデータベース・サーバー・マシンを持つセルにおいて、ネットワーク・パーティションがコーディネーターから 2 つの 2 次サイトを分離したとします。コーディネーターは、
<B>CellServDB</B> ファイルにリストされている多数のサイトとは交信できないため、終了します。パーティションの別サイドの 2 つのサイトは、そのサイト間で新しいコーディネーターを選出し、クライアントからのデータベースの変更を受け入れることができます。このようにしてコーディネーターを移動できないとすると、ネットワーク・パーティションが回復するまでデータベースは読み取り専用となってしまいます。
Ubik による選出方法の詳細については、
<A HREF="#HDRWQ141">柔軟なコーディネーターによる可用性の向上</A> を参照してください。
</LI></UL>
<A NAME="IDX6065"></A>
<A NAME="IDX6066"></A>
<P><H5><A NAME="HDRWQ140">Ubik におけるタイム・スタンプ・メッセージの使用</A></H5>
<P>Ubik は、同期サイトと 2 次サイト間で常時交信を行うことにより、データベースのコピーを同期します。
Ubik コーディネーターは、各 2 次サイトに対しタイム・スタンプ付きの <I>保証</I> メッセージを頻繁に送信します。
2 次サイトはメッセージを受信すると、コーディネーターと通信状態にあるものとみなします。
2 次サイトは、時間 <I>T</I> (通常はコーディネーターのメッセージ送信後から 60 秒) の間は、データベースのコピーが有効であると判断します。これに対して、
2 次サイトは特定時間 X (通常はそれ以降の 120 秒) の間はコーディネーターを有効と認める、
<I>賛否表示</I> メッセージを戻します。
<P>コーディネーターは、<I>T</I> 秒ごとより頻繁に保証メッセージを送信します。したがって、有効期限はオーバーラップします。ネットワーク・パーティションやその他の障害によって実際に通信が停止することがなければ、満了することはありません。保証期限が切れた場合、
2 次サイトのデータベース・コピーは、現行ではなくなります。この場合でも、データベース・サーバーはクライアント要求へのサービスを継続します。セル全体が機能するためには、2 次サイトの配布する情報の期限が切れた場合でも、アクセス可能とされている方がよいものと考えられます。いずれにせよ AFS 管理データベースの大部分はそう頻繁に変更されることはなく、データベースがアクセス不能になることにより、コピーにアクセスしたクライアントに対してタイムアウトが生じることになります。
<P>先の説明のとおり、Ubik がタイム・スタンプ付きのメッセージを使用する上では、データベース・サーバー・マシンのクロックを同期させることが重要です。どちらのクロックが先に進んでいるかにより、ずれたクロックが通常の Ubik 機能の妨げとなる場合が 2 つ考えられます。
<P>たとえば、Ubik コーディネーターのクロックが 2 次サイトより進んでいるとします
(コーディネーターのクロックが 9:35:30、2 次サイトのクロックが 9:31:30)。
2 次サイトが、コーディネーターが 9:33:30 まで有効であると認める賛否表示メッセージを送るとします。これは、2 次サイトのクロックでは 2 分先の時刻ですが、コーディネーターからは既に過去です。コーディネーターは、コーディネーターのままでいることはもう支持されていないと推断し、新規のコーディネーターを選出するよう強制します。選出には 3 分ほどかかり、その間データベースのコピーは変更を受け入れません。
<P>これとは逆に、2 次サイトのクロック (14:50:00) が、コーディネーター (14:46:30) より進んでいる場合があります。コーディネーターが 14:47:30 までの保証メッセージを送信した場合、これは 2 次サイトでは期限切れとなります。
2 次サイトは、コーディネーターとの交信が不可能であるとみなし、コーディネーターへの賛否表示を停止し、自身をコーディネーターに選出しようとします。これは、実際にコーディネーターに障害のあった場合には適切な処置ですが、実際に障害がない場合には適切とはいえません。
<P>新規コーディネーターとして選出されようとする単一の 2 次サイトの試みは、ほかのサイトのパフォーマンスには影響しません。2 次サイトのクロックがコーディネーターと同じである限り、他の 2 次サイトからの賛否表示要求を無視し、現行のコーディネーターへの賛否表示を継続します。ただしコーディネーターよりクロックが進んだクロックの 2 次サイトが多くなれば、たとえ現行のコーディネーターが実際に申し分のない作業を行っていても、新規コーディネーターの選出を強制することができます。
<A NAME="IDX6067"></A>
<A NAME="IDX6068"></A>
<A NAME="IDX6069"></A>
<A NAME="IDX6070"></A>
<A NAME="IDX6071"></A>
<A NAME="IDX6072"></A>
<A NAME="IDX6073"></A>
<A NAME="IDX6074"></A>
<A NAME="IDX6075"></A>
<P><H5><A NAME="HDRWQ141">柔軟なコーディネーターによる可用性の向上</A></H5>
<P>Ubik は、コーディネーターの選出が必要となる際に、タイム・スタンプ付きのメッセージを使用します。これはデータベース・コピーの同期をとる場合と同様です。コーディネーターがサイトの過半数から投票メッセージを受け取ると (コーディネーターは暗黙的に自らに投票します)、データベースの変更の配布が正常に行われているとされ、コーディネーターの役割を継続することができます。過半数とは、奇数のサイトがある場合にすべてのデータベース・サイトの 50 % を上回る数のことです。偶数のサイトがある場合は、最下位の IP アドレスを持つサイトに特別な決定権があります。コーディネーターは、十分な票数を獲得できないとその役割を終了し、
Ubik サイトは新規コーディネーターを選出します。このようなことは、コーディネーターが実際に過半数の賛否表示の受信に失敗したり停止する場合を除いて、自然に発生することはありません。2 次サイトには、既存のコーディネーターに対する投票を続行するための組み込まれたバイアスがあり、不適当な選出を回避します。
<P>新規コーディネーターは、多数決によって選出されます。Ubik サブプロセスには、最下位の IP アドレスをもつサイトに投票するためのバイアスがあり、すべてのサイトが賛否表示を自身で受けようと競合した場合よりも速く、必要な過半数を集めるのに役立ちます。選出中 (通常、3 分も続きません)、クライアントはデータベースからの情報を読み取ることはできますが、変更を加えることはできません。
<P>Ubik の選出手続きでは、各データベース・サーバー・プロセスのコーディネーターを異なるマシンに置くことができます。たとえば、4 つすべてのプロセスの Ubik コーディネーターがマシン A で開始し、マシン A の保護サーバーに何らかの理由で障害が発生した場合は、別のサイト (たとえばマシン B) を新規の保護データベース Ubik コーディネーターとして選出しなければなりません。マシン A の保護サーバーが再び動作を開始した後も、マシン B は保護サーバーのコーディネーターのままです。保護サーバーの障害は、認証、バックアップ、および VL サーバーに影響を及ぼしません。したがって、それらのコーディネーターはマシン A に残存しています。
<P><H3><A NAME="HDRWQ142" HREF="auagd002.htm#ToC_125">管理用データベースのバックアップと復元</A></H3>
<P>AFS 管理用データベースには、セル内の AFS のオペレーションにとって重要な情報が保管されます。データベース・サーバー・マシンのハードウェア障害またはその他の問題によってデータベースが破壊された場合は、すべての情報を最初から再作成することは通常、困難で時間がかかります。データを消失から保護するには、管理用データベースを磁気テープなどの永久媒体に定期的にバックアップします。推奨される方法は、UNIX の <B>tar</B> コマンドのような標準のローカル・ディスク・バックアップ・ユーティリティーを使う方法です。
<P>データベースをバックアップする頻度を決めるときは、バックアップ・コピーからデータベースを復元することが必要になった場合に、手作業で再作成してもかまわないデータの量を検討します。ほとんどのセルでは、データベースによって、変更の頻度と程度はかなり異なります。認証データベースに対する変更は、おそらく最も頻度が少なく、ほとんどがユーザー・パスワードの変更です。保護データベースおよび VLDB の変更がおそらく最も頻度が高くなります。その変更とは、ユーザーによるグループの追加または削除やグループ・メンバーシップの変更、および管理者によるボリュームの作成または移動です。変更の数と頻度は、おそらく保護データベースで最大になります。バックアップを毎日行う場合は特にそうです。
<P>また、消失した変更の回復がどれだけ容易かも、データベースによって異なります。
<UL>
<LI>通常のユーザーが変更の大部分をセル内の認証データベースと保護データベースに対して行っている場合は、変更を回復するには大量の検出作業とユーザーへのインタビューがおそらく必要であり、しかもユーザーがいつどのような変更を行ったかを覚えていることが前提となります。
</LI><LI>消失した VLDB に対する変更の回復は、これより簡単です。
<B>vos syncserv</B> コマンドと <B>vos syncvldb</B> コマンドを使って、
VLDB とサーバー・マシンのボリュームの実際の状態を不一致を訂正することができるからです。ただし、これらのコマンドの実行には時間がかかります。
</LI><LI>バックアップ・データベースの構成情報 (テープ・コーディネーター・ポート・オフセット、ボリューム・セットおよび項目、ダンプ階層など) は、おそらくそれほど頻繁には変更されません。その場合、最近の少数の変更を回復するのは難しいことではありません。それと対照的に、ダンプ・オペレーションの結果である新規ダンプ・レコードが多数あることが考えられます。これらのレコードは、<B>backup scantape</B> コマンドで <B>-dbadd</B> 引き数を使って、バックアップ・テープそのものから情報を読み込むことで回復できます。ただし、セルでバックアップするデータの量やダンプを付加する方法によって、この処理は長時間を要し、テープの入れ替えが何度も必要になったりします。さらに、<B>backup scantape</B> コマンドにはいくつかの制約事項があります。このコマンドの最も基本的な制約事項は、データベース内の既存のダンプ・レコードが、このコマンドがスキャンしているテープ上のダンプと同じダンプ ID 番号を持っていることを検出すると、停止するということです。スキャン・オペレーションを継続したい場合は、既存のレコードをデータベースから探し出し、除去しなければなりません。詳細については、<I>AFS Administration Reference</I> の <B>backup scantape</B> コマンドの解説ページを参照してください。
</LI></UL>
<P>データベース間のこれらの相違は、異なる頻度 (バックアップ・データベースについては数日おきから毎週、認証データベースについては 2 〜 3 週間ごとの範囲) でデータベースをバックアップすることを提示しています。一方、配備上の観点からは、特に磁気テープの消費がそれほど問題にならない場合は、すべてのデータベースを同時に (同じ頻度で) バックアップすれば、おそらくもっと単純です。また、一般にデータベースのコピーを長期間残しておく必要はないので、磁気テープは短期間で再利用できます。
<A NAME="IDX6076"></A>
<A NAME="IDX6077"></A>
<P><H3><A NAME="HDRWQ143" HREF="auagd002.htm#ToC_126">管理用データベースをバックアップするには</A></H3>
<OL TYPE=1>
<LI>同期サイトではないデータベース・サーバー・マシン上のローカル・スーパーユーザー <B>root</B> としてログインする。通常、最も高い IP アドレスを持ったマシンが最上の選択です。その理由は、そのマシンが、選択で同期サイトになるということは、ほとんどないからです。
</LI><LI><A NAME="LIDBBK_SHUTDOWN"></A><B>bos shutdown</B> コマンドを発行して、ローカル・マシン上の関係のあるサーバー・プロセスを終了する。コマンドの詳細な説明は、<A HREF="auagd009.htm#HDRWQ223">プロセスを一時停止させる方法</A> を参照してください。
<P>
<P><B>-instance</B> 引き数には、
1 つまたは複数のデータベース・サーバー・プロセスの名前を指定します
(バックアップ・サーバー <B>buserver</B>、認証サーバー <B>kaserver</B>、保護サーバー <B>ptserver</B>、またはボリューム・ロケーション・サーバー <B>vlserver</B>)。ローカル・スーパーユーザー <B>root</B> としてログインするので <B>-localauth</B> フラグを付けますが、管理トークンは必ずしも必要ではありません。
<P>
<PRE>   # <B>bos shutdown</B> &lt;<VAR>machine name</VAR>> <B>-instance</B> &lt;<VAR>instances</VAR>><SUP>+</SUP> <B>-localauth</B> [<B>-wait</B>]
</PRE>
</LI><LI>1 つまたは複数のデータベース・ファイルをテープに転送するには、
<B>tar</B> コマンドなど、ローカル・ディスク・バックアップ・ユーティリティーを使用する。ローカル・データベース・サーバー・マシンにテープ装置が付いていない場合は、リモート・コピー・コマンドを使用してファイルをテープ装置付きのマシンに転送し、その後、そこで <B>tar</B> コマンドを使用します。
<P>
<P>以下のコマンド・シーケンスは、<B>/usr/afs/db</B> ディレクトリーの完全なコンテンツをバックアップします。
<P>
<PRE>   # <B>cd /usr/afs/db</B>
   # <B>tar cvf</B>  <VAR>tape_device</VAR> <B> .</B>
</PRE>
<P>
<P>個々のデータベース・ファイルをバックアップするには、上に示した <B>tar</B> コマンドで、期間をファイルの名前に置換します。
<UL>
<LI>バックアップ・データベースの場合は、<B>bdb.DB0</B>
</LI><LI>認証データベースの場合は、<B>kaserver.DB0</B>
</LI><LI>保護データベースの場合は、<B>prdb.DB0</B>
</LI><LI>VLDB の場合は、<B>vldb.DB0</B>
</LI></UL>
</LI><LI><B>bos start</B> コマンドを発行して、ローカル・マシン上でサーバー・プロセスを再始動する。コマンドの詳細な説明は、<A HREF="auagd009.htm#HDRWQ221">状況フラグを Run に変更してプロセスを開始する方法</A> を参照してください。<B>-instance</B> 引き数には <A HREF="#LIDBBK_SHUTDOWN">2</A> のステップと同じ値を指定します。同様に <B>-localauth</B> フラグを指定します。
<P>
<PRE>   # <B>bos start</B> &lt;<VAR>machine name</VAR>> <B>-instance</B> &lt;<VAR>server process name</VAR>><SUP>+</SUP> <B>-localauth</B>
</PRE>
</LI></OL>
<A NAME="IDX6078"></A>
<A NAME="IDX6079"></A>
<P><H3><A NAME="HDRWQ144" HREF="auagd002.htm#ToC_127">管理用データベースを復元するには</A></H3>
<OL TYPE=1>
<LI>ローカル・スーパーユーザー <B>root</B> として、セル内の各データベース・サーバー・マシンにログインする。
</LI><LI><A NAME="LIDBREST_SHUTDOWN"></A>マシンの 1 つを使用して、<B>bos shutdown</B> コマンドを 1 度、各データベース・サーバー・マシンに発行し、それらのすべてのマシン上の関係のあるサーバー・プロセスを終了する。コマンドの詳細な説明は、<A HREF="auagd009.htm#HDRWQ223">プロセスを一時停止させる方法</A> を参照してください。
<P>
<P><B>-instance</B> 引き数には、
1 つまたは複数のデータベース・サーバー・プロセスの名前を指定します
(バックアップ・サーバー <B>buserver</B>、認証サーバー <B>kaserver</B>、保護サーバー <B>ptserver</B>、またはボリューム・ロケーション・サーバー <B>vlserver</B>)。ローカル・スーパーユーザー <B>root</B> としてログインするので <B>-localauth</B> フラグを付けますが、管理トークンは必ずしも必要ではありません。
<P>
<PRE>   # <B>bos shutdown</B> &lt;<VAR>machine name</VAR>> <B>-instance</B> &lt;<VAR>instances</VAR>><SUP>+</SUP> <B>-localauth</B> [<B>-wait</B>]
</PRE>
</LI><LI>以下のコマンドを各マシン上で発行することによって、データベースを各データベース・サーバー・マシンから除去する。
<P>
<PRE>   # <B>cd /usr/afs/db</B>
</PRE>
<P>
<P>バックアップ・データベースの場合、
<P>
<PRE>   # <B>rm bdb.DB0</B>
   # <B>rm bdb.DBSYS1</B>
</PRE>
<P>
<P>認証データベースの場合は、
<P>
<PRE>   # <B>rm kaserver.DB0</B>
   # <B>rm kaserver.DBSYS1</B>
</PRE>
<P>
<P>保護データベースの場合は、
<P>
<PRE>   # <B>rm prdb.DB0</B>
   # <B>rm prdb.DBSYS1</B>
</PRE>
<P>
<P>VLDB の場合は、
<P>
<PRE>   # <B>rm vldb.DB0</B>
   # <B>rm vldb.DBSYS1</B>
</PRE>
</LI><LI>データベースをバックアップするために使用したローカル・ディスク・バックアップ・ユーティリティーを使用して、最後にバックアップしたバージョンを、
IP アドレスが最も小さいデータベース・サーバー・マシン上の適切なファイルにコピーする。同期サイトにテープ装置が付いている場合は、以下に示すのは <B>tar</B> コマンドの適切な例です。
<P>
<PRE>   # <B>cd /usr/afs/db</B>
   # <B>tar xvf</B> <VAR>tape_device  database_file</VAR>
</PRE>
<P>
<P><I>database_file</I> は、次のいずれかです。
<UL>
<LI>バックアップ・データベースの場合は、<B>bdb.DB0</B>
</LI><LI>認証データベースの場合は、<B>kaserver.DB0</B>
</LI><LI>保護データベースの場合は、<B>prdb.DB0</B>
</LI><LI>VLDB の場合は、<B>vldb.DB0</B>
</LI></UL>
</LI><LI>マシンの 1 つを使用して、<B>bos start</B> コマンドを発行し、サーバー・プロセスを、各データベース・サーバー・マシン上で順番に再始動する。最も低い IP アドレスを持ったマシンから開始します。このマシンがバックアップ・データベースに対する同期サイトになります。このマシンが同期サイトとして確立するのを待った後で、このコマンドの実行を繰り返し、プロセスをほかのデータベース・サーバー・マシン上で再始動します。コマンドの詳細な説明は、<A HREF="auagd009.htm#HDRWQ221">状況フラグを Run に変更してプロセスを開始する方法</A>を参照してください。<B>-instance</B> 引き数には <A HREF="#LIDBREST_SHUTDOWN">2</A> のステップと同じ値を指定します。同様に <B>-localauth</B> フラグを指定します。
<P>
<PRE>   # <B>bos start</B> &lt;<VAR>machine name</VAR>> <B>-instance</B>  &lt;<VAR>server process name</VAR>><SUP>+</SUP>  <B>-localauth</B>
</PRE>
</LI><LI>データベースが、最後にバックアップした以降に変更されている場合は、示された機能グループにある説明に従って適切なコマンドを発行し、復元されたデータベース内に情報を再作成する。<B>pts</B> コマンドを発行する場合は、最初に管理トークンを取得しなければなりません。ローカル・スーパーユーザー <B>root</B> としてログインしている場合は、
<B>backup</B> コマンドおよび <B>vos</B> コマンドで <B>-localauth</B> フラグが受け入れられるので、管理トークンは必要ありません。認証サーバーはいつでも分離された認証を実行するので、
<B>kas</B> コマンドを発行する場合にのみ、<B>-admin</B> 引き数を組み込む必要があります。
<UL>
<LI>バックアップ・データベースでボリューム・セットおよびボリューム項目を定義または除去するには、
<A HREF="auagd011.htm#HDRWQ365">ボリューム・セットおよびボリューム項目の定義および表示</A> を参照する。
</LI><LI>ダンプ階層を編集するには、<A HREF="auagd011.htm#HDRWQ367">ダンプ階層の定義および表示</A> を参照する。
</LI><LI>バックアップ・データベースでテープ・コーディネーター・ポート・オフセット項目を定義または除去するには、
<A HREF="auagd011.htm#HDRWQ361">テープ・コーディネーター・マシンおよびテープ装置の構成</A> を参照する。
</LI><LI>バックアップ・データベースにダンプ・レコードを復元するには、<A HREF="auagd012.htm#HDRWQ421">テープ内容をスキャンするには</A> を参照する。
</LI><LI>ユーザーの認証データベース項目またはパスワードの変更を再作成するには、
<A HREF="auagd018.htm#HDRWQ663">ユーザー・アカウントの管理</A> の該当する機能グループを参照する。
</LI><LI>保護データベース項目またはグループ・メンバーシップ情報を再作成するには、
<A HREF="auagd019.htm#HDRWQ722">保護データベースの管理</A> の該当する機能グループを参照する。
</LI><LI>ボリューム・ヘッダーによって VLDB を同期化するには、<A HREF="auagd010.htm#HDRWQ313">VLDB およびボリューム・ヘッダーの同期化</A> を参照する。
</LI></UL>
</LI></OL>
<A NAME="IDX6080"></A>
<A NAME="IDX6081"></A>
<A NAME="IDX6082"></A>
<A NAME="IDX6083"></A>
<A NAME="IDX6084"></A>
<A NAME="IDX6085"></A>
<HR><H2><A NAME="HDRWQ145" HREF="auagd002.htm#ToC_128">サーバー・プロセス・ソフトウェアのインストール</A></H2>
<P>この機能グループでは、ファイル・サーバー・マシンに新規サーバー・プロセス・バイナリーをインストールする方法、現行バージョンが適切に作動していない場合に前のバージョンに復帰する方法、および、AFS ボリュームを収容する新規のディスクをファイル・サーバー・マシンにインストールする方法について説明します。
<P>サーバー・プロセスのバイナリーを置き換えるための最もよくある理由は、
AFS を新規のバージョンにアップグレードすることです。一般に、更新されたソフトウェアにはインストールの説明が付いていますが、この章は追加の解説書となります。
<P>各 AFS サーバー・マシンは、規則では <B>/usr/afs/bin</B> と呼ばれるローカル・ディスク・ディレクトリーに、サーバー・プロセス・バイナリーを保管しなければなりません。予測可能なシステム・パフォーマンスのためには、すべてのサーバー・マシンで、同じ作成レベルまたは少なくとも同じバージョンのサーバー・ソフトウェアを実行することが最適です。AFS 作成レベルを調べるための指示については、<A HREF="#HDRWQ152">バイナリー・ファイルの作成レベルの表示</A> を参照してください。
<P>更新サーバーを使用すると、一貫したバージョンのソフトウェアをすべてのサーバー・マシンに容易に配布できます。システム・タイプごとに 1 つのサーバー・マシンを<I>バイナリー配布マシン</I> として指定します。そのためには、更新サーバーのサーバー部分 (<B>upserver</B> プロセス) をそのマシン上で実行します。そのシステム・タイプの、その他すべてのサーバー・マシンは、更新サーバーのクライアント部分 (<B>upclientbin</B> プロセス) を実行して、更新されたソフトウェアをバイナリー配布マシンから検索します。<I>AFS インストールの手引き</I> では、適切なプロセスをインストールする方法について説明しています。バイナリー配布マシンに関する詳細については、
<A HREF="#HDRWQ128">バイナリー配布マシン</A> を参照してください。
<P>更新サーバーを使用する場合は、新規バイナリーをバイナリー配布マシンだけにインストールします。
<B>upclientbin</B> プロセスを実行しているマシンにバイナリーを直接インストールすると、プロセスがローカルの <B>/usr/afs/bin</B> ディレクトリーのコンテンツと、システム制御マシンのコンテンツを次回に比較したとき (デフォルトでは 5 分以内) に、バイナリーは上書きされます。
<P>以下の指示は、<B>bos</B> の組の適切なコマンドを使用して、サーバー・バイナリーをインストールおよびアンインストールする方法について説明しています。
<A NAME="IDX6086"></A>
<A NAME="IDX6087"></A>
<A NAME="IDX6088"></A>
<A NAME="IDX6089"></A>
<A NAME="IDX6090"></A>
<P><H3><A NAME="HDRWQ146" HREF="auagd002.htm#ToC_129">新規バイナリーのインストール</A></H3>
<P>AFS サーバー・プロセスが <B>/usr/afs/bin</B> ディレクトリーにインストールされた直後に、自動的に新規プロセスのバイナリー・ファイルに切り替わることはありません。プロセスは、次に再始動されるまで、前のバージョンのバイナリー・ファイルを使用し続けます。デフォルトは、<B>/usr/afs/local/BosConfig</B> ファイルで指定されているように、
BOS サーバーは、新規バイナリー・ファイルが存在するプロセスを毎日午前 5 時に再始動します。この<I>バイナリー再始動時刻</I> を表示または変更するには、
<A HREF="auagd009.htm#HDRWQ226">BOS サーバーの再始動時を設定する</A> の説明に従って、
<B>bos getrestart</B> コマンドと <B>bos setrestart</B> コマンドを使用します。
<P>以下の説明にあるように、<B>bos restart</B> コマンドを発行することによって、ファイル・サーバー・マシンに、新規サーバー・プロセス・バイナリーを使って開始するように強制することができます。
<P>新規コマンドの組のバイナリーをインストールするときは、プロセスを再始動する必要はありません。組のコマンドを次回発行したときは、新規バイナリーが自動的に呼び出されます。
<A NAME="IDX6091"></A>
<A NAME="IDX6092"></A>
<A NAME="IDX6093"></A>
<A NAME="IDX6094"></A>
<A NAME="IDX6095"></A>
<P><B>bos install</B> コマンドを使用すると、BOS サーバーは、自動的に現行バージョンのバイナリー・ファイルの名前に <B>.BAK</B> 拡張子を付けて保管します。現行の <B>.BAK</B> バージョンがある場合、それは <B>.OLD</B> バージョンに名前変更されます (<B>.OLD</B> バージョンがまだない場合)。現行の <B>.OLD</B> バージョンがある場合には、現行の <B>.BAK</B> バージョンがそれを置き換えるためには、
.BAK バージョンは少なくとも 7 日前のものでなければなりません。
<P>AFS バイナリーは、<B>/usr/afs/bin</B> ディレクトリーに保管するのが最適です。これは、BOS サーバーが新規バイナリーの有無を自動的に検査する唯一のディレクトリーだからです。ただし、<B>bos install</B> コマンドの <B>-dir</B> 引き数を使って、サーバー・マシンのローカル・ディスク上のほかのディレクトリーに非 AFS バイナリーをインストールすることができます。詳細については、
<I>AFS Administration Reference</I> にあるコマンドの解説ページを参照してください。
<A NAME="IDX6096"></A>
<A NAME="IDX6097"></A>
<P><H3><A NAME="Header_130" HREF="auagd002.htm#ToC_130">新規サーバー・バイナリーをインストールするには</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証する。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>バイナリーをインストールするソース・ディレクトリーで、バイナリーが使用可能であることを検証する。マシンが AFS クライアントでもある場合は、
AFS の中央ディレクトリーからバイナリーを検索することができます。そうでない場合は、
AFS 配布媒体から直接バイナリーを取得するか、前にバイナリーをインストールしたローカル・ディスク・ディレクトリーから取得するか、または、<B>ftp</B> コマンドなどの転送ユーティリティーを使ってリモート・マシンから、バイナリーを取得することができます。
</LI><LI><A NAME="LIWQ147"></A>バイナリー配布マシンに <B>bos install</B> コマンドを発行する。
(どのマシンがその役割を実行しているかを忘れた場合は、<A HREF="#HDRWQ132">システム・タイプに応じたバイナリー配布マシンを特定するには</A> を参照してください。)
<P>
<PRE>   % <B>bos install</B> &lt;<VAR>machine name</VAR>> &lt;<VAR>files to install</VAR>><SUP>+</SUP>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>i
</B><DD><B>install</B> の受け入れ可能な最も短い省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>バイナリー配布マシンの名前。
<P><DT><B><VAR>files to install</VAR>
</B><DD>ローカルの <B>/usr/afs/bin</B> ディレクトリーにインストールする各バイナリー・ファイルの名前を指定します。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。それぞれのパス名 (ファイル名そのもの) の最後の要素は、置き換えるファイルの名前に一致します。たとえば、サーバー・プロセスの場合は、
<B>bosserver</B> または <B>volserver</B>、コマンドの場合は、<B>bos</B> または <B>vos</B> です。
<P>
<P><B>fs</B> プロセス以外の各 AFS サーバー・プロセスは、単一のバイナリー・ファイルを使用します。
<B>fs</B> プロセスは、3 つのバイナリー・ファイルを使用します。
<B>fileserver</B>、<B>volserver</B>、および <B>salvager</B> です。1 つのコンポーネントの新規バージョンをインストールすることは、必然的に、
3 つすべてを置き換える必要があることを意味するわけではありません。
</DL>
</LI><LI>それぞれのバイナリー配布マシンについて、<A HREF="#LIWQ147">3</A> のステップを繰り返す。
</LI><LI><B>(オプション)</B> プロセスを再始動して新規バイナリーを即時に使用する場合は、
<B>upclientbin</B> プログラムがバイナリー配布マシンから新規バイナリーを検索するまで待ちます。
<A HREF="#HDRWQ150">バイナリー・バージョン日付の表示</A> で説明しているように、
<B>bos getdate</B> コマンドを使って、バイナリー・ファイルのタイム・スタンプを検証することができます。バイナリー・ファイルがそれぞれのサーバー・マシンで使用可能になったら、
<B>bos restart</B> コマンドを発行します。これに関する詳細な説明は、<A HREF="auagd009.htm#HDRWQ225">プロセスの停止および即時の再始動</A> にあります。
<P>
<P>AFS クライアント・マシンで作業している場合には、サーバー・プロセスを再始動する前に、
<B>bos</B> コマンドの組のバイナリーがローカル・ディスク上にあるかどうかを検証する。通例の構成では、
<B>bos</B> コマンドのバイナリーを収容するクライアント・マシンの <B>/usr/afsws/bin</B> ディレクトリーは、
AFS へのシンボリック・リンクであり、それによってローカル・ディスク・スペースが節約されます。ただし、特定のプロセス (特に、データベース・サーバー・プロセス) を再始動すると、再始動中に問題が発生した場合は特に、AFS ファイル・スペースがアクセス不能になる可能性があります。その場合も、<B>bos</B> バイナリーのローカル・コピーがあれば、プロセスのバイナリーをアンインストールまたは再インストールしたり、プロセスを再始動することができます。
<B>cp</B> コマンドを使って、
<B>bos</B> コマンドのバイナリーを <B>/usr/afsws/bin</B> ディレクトリーから <B>/tmp</B> などのローカル・ディレクトリーにコピーします。
<P>
<P>プロセスを再始動すると、サービスの停止の原因になります。可能であれば、システムの使用率が低い時間帯に実行するのが最善です。
<P>
<PRE>   % <B>bos restart</B> &lt;<VAR>machine name</VAR>> &lt;<VAR>instances</VAR>><SUP>+</SUP>
</PRE>
</LI></OL>
<A NAME="IDX6098"></A>
<A NAME="IDX6099"></A>
<A NAME="IDX6100"></A>
<A NAME="IDX6101"></A>
<A NAME="IDX6102"></A>
<A NAME="IDX6103"></A>
<A NAME="IDX6104"></A>
<A NAME="IDX6105"></A>
<P><H3><A NAME="HDRWQ148" HREF="auagd002.htm#ToC_131">直前のバージョンのバイナリーへの復帰</A></H3>
<P>まれな例では、新規バイナリーをインストールすると、直前のバージョンに復帰する必要があるほど重大な問題を引き起こすこともあります。バイナリーをインストールする場合と同様に、一貫したシステム・パフォーマンスのためには、すべてのサーバー・マシンを同じバージョンに戻さなければなりません。ここで説明する <B>bos uninstall</B> コマンドを、各バイナリー配布マシンで発行します。
<P><B>bos uninstall</B> コマンドを使用すると、BOS サーバーは、現行バージョンのバイナリー・ファイルを破棄し、<B>.BAK</B> バージョンのファイルを、拡張子を除去してプロモートします。現行の <B>.OLD</B> バージョンがあれば、<B>.BAK</B> に名前を変更します。
<P>現行の <B>.BAK</B> バージョンがない場合には、
<B>bos uninstall</B> コマンドのオペレーションは失敗し、エラー・メッセージが生成されます。
<B>.OLD</B> バージョンがまだ存在している場合は、<B>mv</B> コマンドを発行して、名前を <B>.BAK</B> に変更してから、<B>bos uninstall</B> コマンドを発行します。
<P>新規バイナリーをインストールしたときと同じように、サーバー・プロセスが復帰したバージョンを使って即時に開始することはありません。現行バイナリーが機能しないために復帰している場合は、以下の指示に従って関係のあるプロセスを再始動します。
<A NAME="IDX6106"></A>
<A NAME="IDX6107"></A>
<P><H3><A NAME="Header_132" HREF="auagd002.htm#ToC_132">直前のバージョンのバイナリーに復帰するには</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証する。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>関係のある各バイナリーの <B>.BAK</B> バージョンが、それぞれのバイナリー配布マシンの <B>/usr/afs/bin</B> ディレクトリーで使用可能であることを検証する。必要な場合は、<A HREF="#HDRWQ150">バイナリー・バージョン日付の表示</A> で説明しているように、<B>bos getdate</B> コマンドを使用することができます。必要であれば、
<B>.OLD</B> バージョンを <B>.BAK</B> に名前変更します。
</LI><LI><A NAME="LIWQ149"></A>バイナリー配布マシンに <B>bos uninstall</B> コマンドを発行する。
(どのマシンがその役割を実行しているかを忘れた場合は、<A HREF="#HDRWQ132">システム・タイプに応じたバイナリー配布マシンを特定するには</A> を参照してください。)
<P>
<PRE>   % <B>bos uninstall</B> &lt;<VAR>machine name</VAR>> &lt;<VAR>files to uninstall</VAR>><SUP>+</SUP>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>u
</B><DD><B>uninstall</B> の受け入れ可能な最も短い省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>バイナリー配布マシンの名前。
<P><DT><B><VAR>files to uninstall</VAR>
</B><DD><B>/usr/afs/bin</B> ディレクトリーの、<B>.BAK</B> バージョンと置き換える各バイナリー・ファイルの名前を指定します。
<B>/usr/afs/bin</B> ディレクトリーが想定されているため、ファイル名だけで十分です。
</DL>
</LI><LI>それぞれのバイナリー配布マシンについて、<A HREF="#LIWQ149">3</A> のステップを繰り返す。
</LI><LI>各サーバー・マシンで、<B>upclientbin</B> プロセスが、バイナリー配布マシンから復帰されたバージョンを検索するまで待ちます。
<A HREF="#HDRWQ150">バイナリー・バージョン日付の表示</A> で説明しているように、
<B>bos getdate</B> コマンドを使って、バイナリー・ファイルのタイム・スタンプを検証することができます。バイナリー・ファイルがそれぞれのサーバー・マシンで使用可能になったら、
<B>bos restart</B> コマンドを発行します。これに関する詳細な説明は、<A HREF="auagd009.htm#HDRWQ225">プロセスの停止および即時の再始動</A> にあります。
<P>
<P>AFS クライアント・マシンで作業している場合には、サーバー・プロセスを再始動する前に、
<B>bos</B> コマンドの組のバイナリーがローカル・ディスク上にあるかどうかを検証する。通例の構成では、
<B>bos</B> コマンドのバイナリーを収容するクライアント・マシンの <B>/usr/afsws/bin</B> ディレクトリーは、
AFS へのシンボリック・リンクであり、それによってローカル・ディスク・スペースが節約されます。ただし、特定のプロセス (特に、データベース・サーバー・プロセス) を再始動すると、再始動中に問題が発生した場合は特に、AFS ファイル・スペースがアクセス不能になる可能性があります。その場合も、<B>bos</B> バイナリーのローカル・コピーがあれば、プロセスのバイナリーをアンインストールまたは再インストールしたり、プロセスを再始動することができます。
<B>cp</B> コマンドを使って、
<B>bos</B> コマンドのバイナリーを <B>/usr/afsws/bin</B> ディレクトリーから <B>/tmp</B> などのローカル・ディレクトリーにコピーします。
<P>
<PRE>   % <B>bos restart</B> &lt;<VAR>machine name</VAR>> &lt;<VAR>instances</VAR>><SUP>+</SUP>
</PRE>
</LI></OL>
<A NAME="IDX6108"></A>
<A NAME="IDX6109"></A>
<A NAME="IDX6110"></A>
<A NAME="IDX6111"></A>
<A NAME="IDX6112"></A>
<A NAME="IDX6113"></A>
<P><H3><A NAME="HDRWQ150" HREF="auagd002.htm#ToC_133">バイナリー・バージョン日付の表示</A></H3>
<P><B>/usr/afs/bin</B> ディレクトリーにあるバイナリー・ファイルの 3 つのバージョン (現行、
<B>.BAK</B> および .<B>OLD</B> バージョン) すべての、コンパイル日付を検査することができます。これは、サーバー・プロセスを再始動して新規バイナリーを使用する前に、そのバイナリー配布マシンからファイル・サーバー・マシンに、新規バイナリーがコピーされたかどうかを検証する際に役立ちます。
<P><B>/usr/afs/bin</B> 以外のディレクトリーにあるバイナリーの日付を検査するには、<B>-dir</B> 引き数を追加します。
<I>AFS Administration Reference</I> を参照してください。
<A NAME="IDX6114"></A>
<A NAME="IDX6115"></A>
<P><H3><A NAME="Header_134" HREF="auagd002.htm#ToC_134">バイナリー・バージョン日付を表示するには</A></H3>
<OL TYPE=1>
<LI><B>bos getdate</B> コマンドを発行する。
<P>
<PRE>   % <B>bos getdate</B> &lt;<VAR>machine name</VAR>> &lt;<VAR>files to check</VAR>><SUP>+</SUP>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>getd
</B><DD><B>getdate</B> の受け入れ可能な最も短い省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>バイナリー日付を表示するファイル・サーバー・マシンの名前を指定します。
<P><DT><B><VAR>files to check</VAR>
</B><DD>表示する各バイナリー・ファイルの名前を指定します。
</DL>
</LI></OL>
<A NAME="IDX6116"></A>
<A NAME="IDX6117"></A>
<A NAME="IDX6118"></A>
<A NAME="IDX6119"></A>
<A NAME="IDX6120"></A>
<A NAME="IDX6121"></A>
<A NAME="IDX6122"></A>
<A NAME="IDX6123"></A>
<P><H3><A NAME="HDRWQ151" HREF="auagd002.htm#ToC_135">使用されないバイナリー・ファイルの削除</A></H3>
<P>新規バイナリーをもつプロセスが、何日も問題なく実行されている場合は、一般に <B>.BAK</B> および <B>.OLD</B> バージョンを <B>/usr/afs/bin</B> ディレクトリーから除去しても安全です。それによって、クラッターを削減し、ファイル・サーバー・マシンのローカル・ディスクのスペースを解放することができます。
<P><B>bos prune</B> コマンドのフラグを使用して、以下のタイプのファイルを除去することができます。
<UL>
<LI><B>/usr/afs/bin</B> ディレクトリーから <B>.BAK</B> 拡張子を持つファイルを除去するには、
<B>-bak</B> フラグを使用します。
</LI><LI><B>/usr/afs/bin</B> ディレクトリーから <B>.OLD</B> 拡張子を持つファイルを除去するには、
<B>-old</B> フラグを使用します。
</LI><LI><B>/usr/afs/logs</B> ディレクトリーから<B>コア</B>と呼ばれるファイルを除去するには、
<B>-core</B> フラグを使用します。
</LI><LI>3 つのタイプすべてのファイルを除去するには、<B>-all</B> フラグを使用します。
</LI></UL>
<A NAME="IDX6124"></A>
<A NAME="IDX6125"></A>
<P><H3><A NAME="Header_136" HREF="auagd002.htm#ToC_136">古くなったバイナリーを除去するには</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証する。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>以下の 1 つまたは複数のフラグを付けて <B>bos prune</B> コマンドを発行する。
<P>
<PRE>   % <B>bos prune</B> &lt;<VAR>machine name</VAR>> [<B>-bak</B>] [<B>-old</B>] [<B>-core</B>] [<B>-all</B>]
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>p
</B><DD><B>prune</B> の受け入れ可能な最も短い省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>古くなったファイルを除去するファイル・サーバー・マシンの名前を指定します。
<P><DT><B>-bak
</B><DD><B>/usr/afs/bin</B> ディレクトリーから、
<B>.BAK</B> 拡張子を持つすべてのファイルを除去します。このフラグを <B>-all</B> フラグと結合しないでください。
<P><DT><B>-old
</B><DD><B>/usr/afs/bin</B> ディレクトリーから、
<B>OLD</B> 拡張子を持つすべてのファイルを除去します。このフラグを <B>-all</B> フラグと結合しないでください。
<P><DT><B>-core
</B><DD><B>/usr/afs/logs</B> ディレクトリーからすべてのコア・ファイルを除去します。このフラグを <B>-all</B> フラグと結合しないでください。
<P><DT><B>-all
</B><DD>ほかの 3 つのフラグの効果を結合します。ほかの 3 つのフラグと結合しないでください。
</DL>
</LI></OL>
<P><H3><A NAME="HDRWQ152" HREF="auagd002.htm#ToC_137">バイナリー・ファイルの作成レベルの表示</A></H3>
<P>サーバー・マシンおよびセル全体の最も一貫したパフォーマンスのためには、すべてのサーバー・プロセスが同じ AFS 配布から検索されるのが最適です。すべての AFS バイナリーには、そのバージョンまたは<I>作成レベル</I> を指定する ASCII 文字列が含まれています。それを表示するには、ほとんどの UNIX 配布に含まれている <B>strings</B> コマンドおよび <B>grep</B> コマンドを使用します。
<A NAME="IDX6126"></A>
<A NAME="IDX6127"></A>
<A NAME="IDX6128"></A>
<A NAME="IDX6129"></A>
<P><H3><A NAME="Header_138" HREF="auagd002.htm#ToC_138">AFS バイナリーの作成レベルを表示するには</A></H3>
<OL TYPE=1>
<LI>バイナリー・ファイルを収容しているディレクトリーに変更する。バイナリーがある場所がわからない場合は、
<B>which</B> コマンドを発行します。
<P>
<PRE>   % <B>which</B> <VAR>binary_file</VAR>
   /<VAR>bin_dir_path</VAR>/<VAR>binary_file</VAR>
   % <B>cd</B> <VAR>bin_dir_path</VAR>
</PRE>
</LI><LI><B>strings</B> コマンドを発行して、バイナリー・ファイルからすべての ASCII 文字列を抽出する。出力を <B>grep</B> コマンドにパイプ指定し、関係のある行を特定します。
<P>
<PRE>   % <B>strings ./</B><VAR>binary_file</VAR> <B>| grep Base</B>
</PRE>
<P>
<P>以下の形式で AFS ビルド・レベルが出力されます。
<P>
<PRE>   @(#)Base configuration afs<VAR>version</VAR>  <VAR>build_level</VAR>
</PRE>
<P>
<P>たとえば、次の文字列は、AFS 3.6 build 3.0 のバイナリーであることを示しています。
<P>
<PRE>   @(#)Base configuration afs3.6 3.0
</PRE>
</LI></OL>
<A NAME="IDX6130"></A>
<A NAME="IDX6131"></A>
<A NAME="IDX6132"></A>
<A NAME="IDX6133"></A>
<A NAME="IDX6134"></A>
<HR><H2><A NAME="HDRWQ153" HREF="auagd002.htm#ToC_139">サーバー CellServDB ファイルの保守</A></H2>
<P>あらゆるサーバー・マシンでは、そのホーム・セルのデータベース・サーバー・マシンのリストを、ローカル・ディスクにあるローカル・ディスク・ファイル
<B>/usr/afs/etc/CellServDB</B> で保守します。データベース・サーバー・プロセスおよびデータベース以外のサーバー・プロセスのどちらも、ファイルを調べます。
<UL>
<LI>データベース・サーバー・プロセス (認証サーバー、バックアップ・サーバー、保護およびボリューム・ロケーション・サーバー) は、複写済みの管理用データベースのコピーの同期化を保持するために、ピアとの一定の交信を保守します。
<P>
<P><A HREF="#HDRWQ137">AFS 管理データベースの複写</A> で詳細に説明したように、データベース・サーバー・プロセスは Ubik ユーティリティーを使用して、保守するデータベース内の情報を同期化します。同期化サイトの Ubik コーディネーターは、データベースの単一の読み取り / 書き込みコピーを保守し、必要に応じて、変更を 2 次サイトに配布します。同期サイトのコーディネーターは、過半数の 2 次サイトとの交信を保守し、コーディネーターのままでいなければなりません。また、<B>CellServDB</B> ファイルを調べて、そのピアの数と、ピアが実行されているマシンを確認しなければなりません。
<P>
<P>コーディネーターがそのピアの過半数との交信を失うと、全部が協力して、多数決によって新規コーディネーターを選出します。選出中は、すべての Ubik プロセスが <B>CellServDB</B> ファイルを調べ、賛否表示を送信する場所と、過半数を構成する数を確認します。
</LI><LI>データベース以外のサーバー・プロセスは、データベースから情報を検索するために、データベース・サーバー・プロセスを実行しているマシンを知っていなければなりません。たとえば、ユーザーが AFS ファイルに初めてアクセスすると、そのファイルを収容するファイル・サーバーは保護サーバーと交信して、ユーザーのグループ・メンバーシップのリストを入手します (このリストは、現行保護サブグループ、すなわち CPS と呼ばれます)。ファイル・サーバーは、ファイルを保護しているアクセス制御リスト (ACL) が、ユーザーに必要なアクセス権を許可するかどうかを決定するときに、
CPS を使用します (詳細については、<A HREF="auagd019.htm#HDRWQ745">保護データベースについて</A> を参照してください)。
</LI></UL>
<A NAME="IDX6135"></A>
<P><B>CellServDB</B> ファイルの情報の欠落や、間違った情報の結果は以下のとおりです。
<UL>
<LI>このファイルがマシンをリストしないと、たとえ、データベース・サーバー・プロセスが実行されていても、それは、実際にはデータベース・サーバー・マシンではありません。Ubik コーディネーターはそのファイルにデータベース更新を送信しないか、あるいは、過半数を確立するカウントにそのファイルを組み込みます。このファイルは、Ubik 選出に参加しません。したがって、たまたまこのファイルと交信したどんなクライアント・マシンにも、データベース情報を配布することを拒否します
(<B>/usr/vice/etc/CellServDB</B> ファイルがマシンをリストすれば、配布できる情報です)。クライアント・マシンのユーザーは、正しく機能するデータベース・サーバー・マシンを交信できるようになる前に、タイムアウトを待たなければなりません。
</LI><LI>ファイルが、データベース・サーバー・プロセスを実行していないマシンをリストすると、重大な結果が生じる可能性があります。Ubik コーディネーターは、そのファイルにデータベース更新を送信することができませんが、過半数を確立するカウントにそのファイルを組み込みます。有効な 2 次サイトが終了し、コーディネーターへの賛否表示の送信を停止すると、このサイトは、コーディネーターはもう必要は過半数を得ていないと、間違った表示をする可能性があります。結果として生じる新規コーディネーターの選出は、データベースからの情報が使用できなくなる間、サービスが停止する原因になります。さらに、間違ってリストされたサイトからの賛否表示が不足することによって、過半数のサイトが新規コーディネーターに投票していないとほかのサイトが考えるために、コーディネーターの選出が妨げられる可能性があります。
<P>
<P>重要性が小さい結果は、データベース以外のサーバー・プロセスが、そのマシンのデータベース・サーバー・プロセスと交信しようとすることです。そのプロセスは実行されていないため、データベース以外のサーバー・プロセスは、タイムアウトの遅れを経験することになります。
</LI></UL>
<P>サーバー・マシンにある <B>/usr/afs/etc/CellServDB</B> ファイルは、クライアント・マシンにある <B>/usr/vice/etc/CellServDB</B> ファイルとは異なります。クライアント・バージョンには、ローカル・セルのほかに、外部セルの項目が組み込まれます。ただし、ユーザーのセルのデータベース・サーバー・マシンを変更するときにはいつでも、どちらのファイルのバージョンも更新することが重要です。同時にクライアントでもあるサーバー・マシンには両方のファイルが必要であり、システム管理者はそれらの両方のファイルを更新する必要があります。<B>CellServDB</B> ファイルのクライアント・バージョンの保守に関する詳細については、<A HREF="auagd015.htm#HDRWQ553">データベース・サーバー・マシンの情報を保持する</A> を参照してください。
<A NAME="IDX6136"></A>
<A NAME="IDX6137"></A>
<A NAME="IDX6138"></A>
<P><H3><A NAME="HDRWQ154" HREF="auagd002.htm#ToC_140">サーバー CellServDB ファイルの配布</A></H3>
<P><B>/usr/afs/etc/CellServDB</B> ファイルにある間違った情報の負の結果を回避するには、データベース・サーバー・マシンを追加または除去するたびに、ユーザーのセルのすべてのサーバー・マシンでその情報を更新しなければなりません。<I>AFS インストールの手引き</I> では、データベース・サーバー・マシンのインストールまたは除去、およびそのコンテキストにある <B>CellServDB</B>
ファイルの更新について詳しく説明します。この機能グループでは、ユーザーのサーバー・マシンにファイルを配布する方法、および、ユーザーが AFS グローバル・ネーム・スペースに参加する場合に、変更をほかのセルに知らせる方法について説明します。
<P>米国版の AFS を使用する場合には、更新サーバーを使用して、セルのシステム制御マシンに保管されるサーバー
<B>CellServDB</B> ファイルの中心コピーを配布します。国際版の AFS を使用する場合には、代わりに、それぞれのサーバー・マシンにあるファイルを個々に変更します。システム制御マシンに関する詳しい説明と、インターナショナル・セルが、
<B>/usr/afs/etc</B> ディレクトリーにあるファイルにシステム制御マシンを使用してはいけない理由については、
<A HREF="#HDRWQ129">システム制御マシン</A> を参照してください。米国版の AFS を使用するときの、更新サーバーの構成については、
<I>AFS インストールの手引き</I> を参照してください。
<P>エラーになる可能性があるエラーのフォーマットを回避するには、ファイルを直接編集するのではなく、いつでも <B>bos addhost</B> コマンドと
<B>bos removehost</B> コマンドを使用します。また、そのマシンで実行されるデータベース・サーバー・プロセスを再始動し、データベース・サーバー・マシンの新規セット間で、コーディネーターの選出を開始しなければなりません。このステップは、<A HREF="#HDRWQ156">CellServDB ファイルにデータベース・サーバー・マシンを追加するには</A> および
<A HREF="#HDRWQ157">CellServDB ファイルからデータベース・サーバー・マシンを除去するには</A> の説明に組み込まれています。ファイルのコンテンツの表示については、
<A HREF="#HDRWQ155">セルのデータベース・サーバー・マシンを表示するには</A> を参照してください。
<P>AFS グローバル・ネーム・スペースのパーツとして、外部ユーザーがユーザーのセルにアクセスできるようにする場合は、ユーザーのセルのデータベース・サーバー・マシンを変更するときには、ほかのセルにも通知する必要があります。AFS サポート・グループは、
AFS グローバル・ネーム・スペースに参加するすべてのセルをリストする
<B>CellServDB</B> ファイルを保守します。詳細については、
<A HREF="auagd007.htm#HDRWQ39">ユーザーのセルをほかのユーザーが見ることができるようにする</A> を参照してください。
<P>セルのデータベース・サーバー・マシンを公示する別の方法は、
AFS ファイル・スペースの従来の場所である、
<B>/afs/</B><VAR>cell_name</VAR><B>/service/etc/CellServDB.local</B> にファイルのコピーを保守することです。詳しくは、<A HREF="auagd007.htm#HDRWQ44">3 番目のレベル</A> を参照してください。
<A NAME="IDX6139"></A>
<A NAME="IDX6140"></A>
<A NAME="IDX6141"></A>
<A NAME="IDX6142"></A>
<A NAME="IDX6143"></A>
<A NAME="IDX6144"></A>
<P><H3><A NAME="HDRWQ155" HREF="auagd002.htm#ToC_141">セルのデータベース・サーバー・マシンを表示するには</A></H3>
<OL TYPE=1>
<LI><B>bos listhosts</B> コマンドを発行する。ファイルを正しく保守した場合には、その出力はあらゆるサーバー・マシンで同じになりますが、
<I>machine name</I> 引き数を使用すると、希望する場合には、さまざまなマシンを検査することができます。
<P>
<PRE>   % <B>bos listhosts</B> &lt;<VAR>machine name</VAR>> [&lt;<VAR>cell name</VAR>>]
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>listh
</B><DD><B>listhosts</B> の受け入れ可能な最も短い省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD><B>/usr/afs/etc/CellServDB</B> ファイルをそこから表示する、サーバー・マシンを指定します。
<P><DT><B><VAR>cell name</VAR>
</B><DD>外部セルの完全なインターネット・ドメイン名を指定します。
<B>machine name</B> 引き数として提供するために、セル内の少なくても 1 つのサーバー・マシンの名前をすでに知っていなければなりません。
</DL>
</LI></OL>
<P>出力には、指定されたサーバー・マシンの
<B>CellServDB</B> ファイルに表示される順序で、マシンをリストします。出力では、以下の例のように、それぞれのマシンに 1 つの <TT>Host</TT> インデックス番号を割り当てます。そのインデックスとマシンの IP アドレス、名前、または
Ubik コーディネーターまたは 2 次サイトとしての役割との間に、暗黙の関係はありません。
<PRE>   % <B>bos listhosts fs1.abc.com</B>
   Cell name is abc.com
       Host 1 is fs1.abc.com
       Host 2 is fs7.abc.com
       Host 3 is fs4.abc.com
</PRE>
<P>命名サービス (ドメイン名サービスまたはローカル・ホスト・テーブルなど)
が適切に機能している限りは、出力は、IP アドレスではなく名前でマシンをリストします。
IP アドレスを表示するには、ローカル・スーパーユーザー <B>root</B>として、サーバー・マシンにログインし、テキスト・エディターを使用するか、あるいは、<B>cat</B> コマンドなどのコマンドを表示し、
<B> /usr/afs/etc/CellServDB</B> ファイルを見ます。
<A NAME="IDX6145"></A>
<A NAME="IDX6146"></A>
<A NAME="IDX6147"></A>
<A NAME="IDX6148"></A>
<A NAME="IDX6149"></A>
<A NAME="IDX6150"></A>
<A NAME="IDX6151"></A>
<A NAME="IDX6152"></A>
<A NAME="IDX6153"></A>
<A NAME="IDX6154"></A>
<A NAME="IDX6155"></A>
<A NAME="IDX6156"></A>
<P><H3><A NAME="HDRWQ156" HREF="auagd002.htm#ToC_142">CellServDB ファイルにデータベース・サーバー・マシンを追加するには</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証する。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>bos addhost</B> コマンドを発行して、それぞれの新規データベース・サーバー・マシンを、
<B>CellServDB</B> ファイルに追加する。米国版の AFS を使用する場合には、
<I>machine name</I> として、システム制御マシンを指定します。
(システム制御マシンはどれかを忘れてしまった場合には、
<A HREF="#HDRWQ134">システム制御マシンの出力</A> を参照してください。)
国際版の AFS を使用する場合には、順番に <I>machine name</I> の名前を置き換えることによって、それぞれの、またはユーザーのセルのサーバー・マシンでこのコマンドを繰り返します。
<P>
<PRE>   % <B>bos addhost </B> &lt;<VAR>machine name</VAR>>  &lt;<VAR>host name</VAR>><SUP>+</SUP>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>addh
</B><DD><B>addhost</B> の受け入れ可能な最も短い省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>米国版の AFS を使用している場合には、システム制御マシンに名前を付けます。国際版の AFS を使用している場合には、順番に、それぞれのユーザーのサーバー・マシンに名前を付けます。
<P><DT><B><VAR>host name</VAR>
</B><DD>それぞれのデータベース・サーバー・マシンの完全修飾ホスト名を指定し、
<B>CellServDB</B> ファイルに追加します
(たとえば、<B>fs4.abc.com</B>)。
BOS サーバーは <B>gethostbyname( )</B> ルーチンを使用して、各マシンの IP アドレスを取得し、名前とアドレスをともに自動的に記録します。
</DL>
</LI><LI>認証サーバー、バックアップ・サーバー、保護サーバー、および VL サーバーをあらゆるデータベース・サーバー・マシンで再始動します。その結果、マシンの新規セットが、新規 Ubik 座標の選択に関係します。説明では、プロセスの基本名を使用し、別のプロセス名を使用する場合には、適切な置換を行います。完全な構文については、<A HREF="auagd009.htm#HDRWQ225">プロセスの停止および即時の再始動</A>を参照してください。
<P><B>重要 :</B>
すべてのデータベース・サーバー・マシンで即時に引き続いて、以下のコマンドを繰り返します。
<P>
<PRE>   % <B>bos restart</B>  &lt;<VAR>machine name</VAR>> <B>buserver kaserver ptserver vlserver</B>
</PRE>
</LI><LI>ユーザーのセルのクライアント・マシンごとに、<B>/usr/vice/etc/CellServDB</B> ファイルを編集します。説明については、<A HREF="auagd015.htm#HDRWQ553">データベース・サーバー・マシンの情報を保持する</A> を参照してください。
</LI><LI>AFS グローバル名スペースを共有する場合には、
AFS プロダクト・サポート・グループを使って行った変更を登録する、ユーザーのセルの指定サイト接続の 1 つを入手してください。
<P>
<P>ユーザーのセルのサーバー <B>CellServDB</B> ファイルの主要なコピーを、基本位置
(<B>/afs/</B><I>cell_name</I><B>/service/etc/CellServDB.local</B>) で保持する場合には、ファイルを編集して変更を反映させます。
</LI></OL>
<A NAME="IDX6157"></A>
<A NAME="IDX6158"></A>
<A NAME="IDX6159"></A>
<A NAME="IDX6160"></A>
<A NAME="IDX6161"></A>
<A NAME="IDX6162"></A>
<A NAME="IDX6163"></A>
<A NAME="IDX6164"></A>
<A NAME="IDX6165"></A>
<A NAME="IDX6166"></A>
<A NAME="IDX6167"></A>
<P><H3><A NAME="HDRWQ157" HREF="auagd002.htm#ToC_143">CellServDB ファイルからデータベース・サーバー・マシンを除去するには</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証する。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>bos removehost</B> コマンドを発行して、
<B>CellServDB</B> ファイルから、それぞれのデータベース・サーバー・マシンを除去する。米国版の AFS を使用する場合には、
<I>machine name</I> として、システム制御マシンを指定します。
(システム制御マシンはどれかを忘れてしまった場合には、
<A HREF="#HDRWQ134">システム制御マシンの出力</A> を参照してください。)
国際版の AFS を使用する場合には、順番に <I>machine name</I> の名前を置き換えることによって、それぞれの、またはユーザーのセルのサーバー・マシンでこのコマンドを繰り返します。
<P>
<PRE>   % <B>bos removehost</B> &lt;<VAR>machine name</VAR>>  &lt;<VAR>host name</VAR>><SUP>+</SUP>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>removeh
</B><DD><B>removehost</B> の受け入れ可能な最も短い省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>米国版の AFS を使用している場合には、システム制御マシンに名前を付けます。国際版の AFS を使用している場合には、順番に、それぞれのユーザーのサーバー・マシンに名前を付けます。
<P><DT><B><VAR>host name</VAR>
</B><DD>それぞれのデータベース・サーバー・マシンの完全修飾ホスト名を指定し、
<B>CellServDB</B> ファイルから除去します
(たとえば、<B>fs4.abc.com</B>)。
</DL>
</LI><LI>認証サーバー、バックアップ・サーバー、保護サーバー、および VL サーバーをあらゆるデータベース・サーバー・マシンで再始動します。その結果、マシンの新規セットが、新規 Ubik 座標の選択に関係します。説明では、プロセスの基本名を使用し、別のプロセス名を使用する場合には、適切な置換を行います。完全な構文については、<A HREF="auagd009.htm#HDRWQ225">プロセスの停止および即時の再始動</A>を参照してください。
<P><B>重要 :</B>
すべてのデータベース・サーバー・マシンで即時に引き続いて、以下のコマンドを繰り返します。
<P>
<PRE>   % <B>bos restart</B>  &lt;<VAR>machine name</VAR>> <B>buserver kaserver ptserver vlserver</B>
</PRE>
</LI><LI>ユーザーのセルのクライアント・マシンごとに、<B>/usr/vice/etc/CellServDB</B> ファイルを編集します。説明については、<A HREF="auagd015.htm#HDRWQ553">データベース・サーバー・マシンの情報を保持する</A> を参照してください。
</LI><LI>AFS グローバル名スペースを共有する場合には、
AFS プロダクト・サポート・グループを使って行った変更を登録する、ユーザーのセルの指定サイト接続の 1 つを入手してください。
<P>
<P>ユーザーのセルのサーバー <B>CellServDB</B> ファイルの主要なコピーを、基本位置
(<B>/afs/</B><I>cell_name</I><B>/service/etc/CellServDB.local</B>) で保持する場合には、ファイルを編集して変更を反映させます。
</LI></OL>
<HR><H2><A NAME="HDRWQ158" HREF="auagd002.htm#ToC_144">認証と許可の要件の管理</A></H2>
<P>この機能グループでは、許可検査を検査し、そのクライアントと相互に認証することによって、
AFS サーバー・プロセスが、適切な許可ユーザーだけが特権コマンドを確実に実行するようにする方法について説明します。ユーザーが、マシンごとまたはセルごとをベースにして要件を検査する認証を制御できる方法と、コマンドの発行時に、相互認証をバイパスする方法についても説明します。
<A NAME="IDX6168"></A>
<A NAME="IDX6169"></A>
<A NAME="IDX6170"></A>
<A NAME="IDX6171"></A>
<A NAME="IDX6172"></A>
<A NAME="IDX6173"></A>
<P><H3><A NAME="HDRWQ159" HREF="auagd002.htm#ToC_145">認証対許可</A></H3>
<P>多くの AFS コマンドには、コマンドで呼び出される AFS サーバー・プロセスが、適切な許可ユーザーに対してだけ、特権を実行するという<I>特権が付いています</I>。サーバー・プロセスは、以下の 2 つのテストを実行して、適切に許可されているかどうかを決定します。
<UL>
<LI><I>認証</I> テストで、サーバー・プロセスは、ユーザーまたはアプリケーションのために機能しているコマンド・インタープリター、キャッシュ・マネージャー、またはほかのクライアント・プロセスと、相互に認証します。このテストの目的は、コマンドの発行者を決定することです。サーバー・プロセスは、自分が発行者であると主張する人が本当の発行者であることを、サーバー・チケットと発行者のトークンのほかのコンポーネントを検査して検証します。
(次に、このテストによって、クライアント・プロセスで、そのサーバー・プロセスが本物であることを検証することができます。)
発行者がトークンを持っていないか、あるいは、別の方法でテストが失敗すると、サーバー・プロセスはその発行者に、完全に許可されていないユーザーである、
<B>anonymous</B> の識別を割り当てます。相互認証に関する詳細な説明については、
<A HREF="auagd007.htm#HDRWQ91">相互認証の詳細</A> を参照してください。
<P>
<P>多くの個々のコマンドを使用すると、相互に認証しようとしなくても、<B>anonymous</B> の識別を想定することによって、認証テストをう回することができます。ただし、コマンドが特権で、サーバー・プロセスがまだ認証テストを実行している場合には、これは役に立たないことに注意してください。なぜなら、このような場合には、プロセスでは、特権コマンドを
<B>anonymous</B> ユーザーに対して実行することを拒否するからです。
</LI><LI><I>許可</I> テストでは、サーバー・プロセスは、特権ユーザーのリストを調べ、発行者がコマンドの使用を許可されているかどうかを決定します。このテストの目的は、発行者に許可されていることを決定することです。<A HREF="auagd021.htm#HDRWQ797">管理権限の管理</A> で説明したように、異なるサーバー・プロセスは、異なるユーザーのリストを調べます。サーバー・プロセスは、許可されていない発行者に対してどんな特権コマンドの実行も拒否します。コマンドに特権の要件がなければ、サーバー・プロセスはこのステップをスキップし、即時に実行します。
<P>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP"><B>anonymous</B> ユーザー、または <B>system:anyuser</B> グループを特権リストに入れないでください。許可検査が無意味になります。
<P>
<P><B>bos setauth</B> コマンドを使用して、サーバー・マシンのサーバー・プロセスで、許可を検査するかどうかを制御することができます。ほかのサーバー・マシンは影響を受けません。許可検査をオフにすることはセキュリティー上非常に危険であることに留意してください。なぜなら、そのマシンのサーバー・プロセスは、どんなユーザーのためのどんなアクションでも実行するからです。
</TD></TR></TABLE>
</LI></UL>
<A NAME="IDX6174"></A>
<A NAME="IDX6175"></A>
<A NAME="IDX6176"></A>
<A NAME="IDX6177"></A>
<P><H3><A NAME="HDRWQ160" HREF="auagd002.htm#ToC_146">サーバー・マシンでの許可検査の制御</A></H3>
<P>許可検査を使用不可にすることは、セキュリティー上の重大な欠陥となります。なぜなら、<B>anonymous</B> ユーザーであっても、ファイル・サーバー・マシンの AFS サーバー・プロセスは、任意のユーザーのどんなアクションでも実行するからです。
<P>許可検査を使用不可にすることが一般的なのは、ユーザーが新規ファイル・サーバー・マシンをインストールしているときだけです
(<I>AFS インストールの手引き</I> を参照してください)。これが必要となるのは、すべての必要なセキュリティー機構の構成を、通常これを使用する他のアクションを実行する前に行うことは不可能なためです。最高の安全のためには、インストールしているマシンのコンソールで作業した後すぐに、許可検査をオンにします。
<P>通常のオペレーション中に、許可検査を使用不可にする唯一の理由は、サーバー暗号化鍵を使ってエラーが発生した場合に、サーバーがユーザーを正しく認証できないままにしておくことです。鍵関連の緊急事態の処理に関する説明については、
<A HREF="auagd014.htm#HDRWQ496">サーバー暗号化鍵の緊急事態の取り扱い</A> を参照してください。
<P>許可検査をそれぞれのファイル・サーバー・マシンで別々に制御します。
1 つのマシンで許可検査をオンにするかまたはオフにすることは、ほかのマシンには影響を及ぼしません。一般的に、クライアント・マシンはサーバー・プロセスを無作為に選択するため、すべてのマシンの要件を同じにしなければ、ある特定のコマンドに功を奏する許可検査の条件を予測することは困難です。許可検査をセル全体に対してオン / オフにするには、適切なコマンドをあらゆるファイル・サーバー・マシンで繰り返さなければなりません。
<P>サーバー・プロセスは、そのローカル・ディスクにあるディレクトリー <B>/usr/afs/local</B> を定期的にモニターし、許可を検査する必要があるかどうかを決定します。<B>NoAuth</B> というファイルがそのディレクトリーにあれば、サーバーは許可を検査しません。このファイルがなければ (通常の場合)、サーバーは許可検査を行います。
<P>BOS サーバーを介して、<B>NoAuth</B> ファイルの存在を制御します。
<B>bos setauth</B> コマンドを使って許可検査を使用不可にすると (または、インストール中に、BOS サーバーを開始するコマンドに <B>-noauth</B> フラグを書き込むと)、
BOS サーバーは長さ 0 の <B>NoAuth</B> ファイルを作成します。許可検査を再度使用可能にすると、BOS サーバーはそのファイルを除去します。
<A NAME="IDX6178"></A>
<A NAME="IDX6179"></A>
<A NAME="IDX6180"></A>
<A NAME="IDX6181"></A>
<A NAME="IDX6182"></A>
<P><H3><A NAME="HDRWQ161" HREF="auagd002.htm#ToC_147">サーバー・マシンの許可検査を使用不可にする</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証する。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>bos setauth</B> コマンドを発行して、許可検査を使用不可にします。
<P>
<PRE>   % <B>bos setauth</B> &lt;<VAR>machine name</VAR>> <B>off</B>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>seta
</B><DD><B>setauth</B> の受け入れ可能な最も短い省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>サーバー・プロセスが許可を検査しないファイル・サーバー・マシンを指定します。
</DL>
</LI></OL>
<A NAME="IDX6183"></A>
<A NAME="IDX6184"></A>
<A NAME="IDX6185"></A>
<P><H3><A NAME="HDRWQ162" HREF="auagd002.htm#ToC_148">サーバー・マシンの許可検査を使用可能にする</A></H3>
<OL TYPE=1>
<LI>許可検査を再度使用可能にする
(マシンは現在許可の検査をしていないため、特権は必要はありません。) 構文の詳細については、先のセクションを参照してください。
<P>
<PRE>   % <B>bos setauth</B> &lt;<VAR>machine name</VAR>> <B>on</B>
</PRE>
</LI></OL>
<A NAME="IDX6186"></A>
<A NAME="IDX6187"></A>
<P><H3><A NAME="HDRWQ163" HREF="auagd002.htm#ToC_149">個々のコマンドの相互認証をう回する</A></H3>
<P>いくつかのサーバー・プロセスを使用すると、任意のユーザーが (システム管理者だけではなく) コマンドを発行するときに、相互認証を使用できないようにすることができます。サーバー・プロセスは、発行者を認証されていないユーザー
<B>anonymous</B> として扱います。
<P>相互認証を妨げる機能は、緊急事態に使用するために提供されています (<A HREF="auagd014.htm#HDRWQ496">サーバー暗号化鍵の緊急事態の取り扱い</A> で説明する鍵の緊急事態など)。通常の状況では、許可検査はオンにして、認証を妨げることが無益であるようにしなければなりません。サーバー・プロセスは、特権コマンドを <B>anonymous</B> に対して実行することを拒否します。
<P>許可検査をオフにしているときには、認証を止めることが有効である可能性があります。鍵の緊急事態にたまたまありがちなように、サーバーが特定の暗号化鍵を理解できないと、認証の試行という実際の行為が、問題の原因となる可能性があります。
<A NAME="IDX6188"></A>
<A NAME="IDX6189"></A>
<A NAME="IDX6190"></A>
<A NAME="IDX6191"></A>
<A NAME="IDX6192"></A>
<A NAME="IDX6193"></A>
<A NAME="IDX6194"></A>
<A NAME="IDX6195"></A>
<P><H3><A NAME="HDRWQ164" HREF="auagd002.htm#ToC_150">bos、kas、pts、および vos コマンドに対する相互認証をう回するには</A></H3>
<P>組の多くのコマンドで使用可能な <B>-noauth</B> フラグを提供します。コマンドがフラグを受け入れるかどうかを検証するには、コマンドの組に <B>help</B> コマンドを発行するか、あるいは、<I>AFS Administration Reference</I> のコマンドの参照ページを調べます
(参照ページでも、それぞれのコマンドのフラグとして受け入れ可能な最も短い省略形を指定します)。組の <B>apropos</B> コマンドおよび
<B>help</B> コマンドは、フラグを受け入れません。
<P><B>kas interactive</B> コマンドに
<B>-noauth</B> フラグを組み込むことによって、対話式セッション中に発行されるすべての <B>kas</B> コマンドでは、相互認証をう回することができます。認証済みの識別を使って、すでに対話モードを入力した場合には、
<B>(kas) noauthentication</B> コマンドを発行し、
<B>anonymous</B> 識別を想定します。
<A NAME="IDX6196"></A>
<P><H3><A NAME="Header_151" HREF="auagd002.htm#ToC_151">fs コマンドの相互認証をう回するには</A></H3>
<P>これは、<B>fs</B> コマンドを発行する前に、
<B>unlog</B> コマンドを発行して、ユーザーのトークンを破棄しない限り不可能です。
<HR><H2><A NAME="HDRWQ165" HREF="auagd002.htm#ToC_152">ディスクと区分の追加または除去</A></H2>
<P>既存のファイル・サーバー・マシンにディスクを追加するだけで、
AFS はユーザーのセルに記憶域を簡単に追加することができます。この機能グループでは、
AFS ボリュームを保管するために使用するディスクをインストールする方法、または除去する方法について説明します。
(<I>AFS インストールの手引き</I> で説明したように、記憶域を追加する別の方法は、追加のサーバー・マシンをインストールすることです。)
<P>ディスクの追加と除去のどちらも、少なくても短時間のファイル・システムの停止の原因になります。それは、サーバー区分の新規のセットを認識させるために、
<B>fs</B> プロセスを再始動しなければならないからです。オペレーティング・システムには、ディスクを追加または除去する前に、マシンを止める必要があるものがあります。このような場合には、まず、すべての AFS サーバー・プロセスを終了しなければなりません。ほかのすべての点では、ディスクの追加または除去の AFS が関連した局面は、複雑ではありません。したがって、停止の期間は、主として、ディスクそのものをインストールまたは除去するのに要する時間によって異なります。
<P>新規のディスクのインストールに関する以下の説明では、そのディスクに AFS ボリュームを収容する準備が完全に済んでいます。
<B>vos create</B> コマンドを使用して新規ボリュームを作成するか、あるいは、<B>vos move</B> コマンドを使用して、ほかの区分から既存のボリュームを移動することができます。説明については、
<A HREF="auagd010.htm#HDRWQ271">読み取り / 書き込みボリュームの作成</A> および <A HREF="auagd010.htm#HDRWQ312">ボリュームの移動</A> を参照してください。ディスクの除去に関する指示は、基本的には、インストールの指示の逆ですが、データの損失を保護する特別なステップが組み込まれます。
<P>サーバー・マシンには、256 の AFS サーバー区分を収容することができます。ディレクトリーに取り付けられたそれぞれの区分には、<B>/vicep</B><I>index</I> (<I>index</I> は 1 または 2 文字の小文字) 形式の名前が付きます。規則では、マシン上の最初の区分は <B>/vicepa</B> に、
2 番目の区分は <B>/vicepb</B>に、という具合に進み、最後の 26 番目の区分は <B>/vicepz</B> に取り付けられます。追加の区分は、<B>/vicepaa</B> から
<B>/vicepaz</B> に、最後は <B>/vicepiv</B> に取り付けられます。連続した文字を使用する必要はありませんが、その方が簡単です。
<P>それぞれの <B>/vicep</B> ディレクトリーは、ほかのディレクトリーのサブディレクトリーとしてではなく、ローカル・ファイル・システムのルート・ディレクトリー
( <B>/</B> )の下に、直接取り付けます。たとえば、<B>/usr/vicepa</B> は受け入れ可能な位置ではありません。また、ファイル・サーバー・マシンのファイル・システム登録ファイル
(<B>/etc/fstab</B> または同等のファイル)
にある区分の装置名に、ディレクトリーをマップしなければなりません。
<P>これまでの指示では、マシンの AFS 初期設定ファイルには、以下のコマンドが組み込まれ、それぞれのリブート後に、BOS サーバーを再始動することを想定しています。
BOS サーバーは、ローカル
<B>/usr/afs/local/BosConfig</B> ファイルにリストされる、ほかの AFS サーバー・プロセスを開始します。
<B>bosserver</B> コマンドの任意選択の引き数については、
<I>AFS Administration Reference</I> のこのコマンドの参照ページを参照してください。
<PRE>   /usr/afs/bin/bosserver &amp;
</PRE>
<A NAME="IDX6197"></A>
<A NAME="IDX6198"></A>
<A NAME="IDX6199"></A>
<A NAME="IDX6200"></A>
<A NAME="IDX6201"></A>
<A NAME="IDX6202"></A>
<A NAME="IDX6203"></A>
<P><H3><A NAME="HDRWQ166" HREF="auagd002.htm#ToC_153">新規ディスクを追加したり取り付けて、AFS ボリュームを収容するには</A></H3>
<OL TYPE=1>
<LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI>新規ディスクを分割する AFS 区分の数と、その区分を取り付けるディレクトリーの名前を決めます
(この機能グループの概要で、命名規則について説明しています)。既存のサーバー区分をマシンに表示するには、
<B>vos listpart</B> コマンドを発行します。ローカル・スーパーユーザー <B>root</B> としてログインするので <B>-localauth</B> フラグを付けますが、管理トークンは必ずしも必要ではありません。
<P>
<PRE>   # <B>vos listpart</B> &lt;<VAR>machine name</VAR>> <B>-localauth</B>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>listp
</B><DD><B>listpart</B> の受け入れ可能な最も短い省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>ローカル・ファイル・サーバー・マシンに命名します。
<P><DT><B>-localauth
</B><DD>ローカルの <B>/usr/afs/etc/KeyFile</B> ファイルからの鍵を使用して、サーバー・チケットを構成します。相互の認証中に、<B>bos</B> コマンド・インタープリターが、サーバー・チケットを BOS サーバーに提示します。
</DL>
</LI><LI>区分を取り付ける場所にそれぞれのディレクトリーを作成する。
<P>
<PRE>   # <B>mkdir /vicep</B><VAR>x</VAR>[<VAR>x</VAR>]
</PRE>
<A NAME="IDX6204"></A>
<A NAME="IDX6205"></A>
<A NAME="IDX6206"></A>
<A NAME="IDX6207"></A>
</LI><LI><A NAME="LIWQ167"></A>テキスト・エディターを使用して、それぞれの新規ディスク区分ごとに、マシンのファイル・システム登録ファイル
(<B>/etc/fstab</B> または同等のファイル) に項目を作成し、直前のステップで作成したディレクトリーにその装置名をマップします。そのファイルにある既存の項目を参照して、オペレーティング・システムによって異なる、適切な形式を確認します。
</LI><LI><A NAME="LIWQ168"></A>オペレーティング・システムで、マシンをシャットオフして新規ディスクをインストールする必要がある場合には、<B>bos shutdown</B> コマンドを発行して、
BOS サーバー以外のすべての AFS サーバー・プロセスを終了します
(マシンをシャットオフすると、BOS サーバーは安全に終了します)。ローカル・スーパーユーザー <B>root</B> としてログインするので <B>-localauth</B> フラグを付けますが、管理トークンは必ずしも必要ではありません。コマンドの詳細な説明は、<A HREF="auagd009.htm#HDRWQ223">プロセスを一時停止させる方法</A> を参照してください。
<P>
<PRE>   # <B>bos shutdown</B> &lt;<VAR>machine name</VAR>> <B>-localauth</B> [<B>-wait</B>]
</PRE>
</LI><LI><A NAME="LIWQ169"></A>必要な場合には、マシンをシャットオフします。ディスクとオペレーティング・システムの取引先が提供する指示に従って、新規ディスクをインストールし形式設定します。必要な場合には、ディスクの区分表を編集し、ファイル・システム登録ファイルに加えた変更を、
<A HREF="#LIWQ167">4</A>のステップで反映させます。指示については、オペレーティング・システムの資料を調べてください。
</LI><LI><A HREF="#LIWQ169">6</A> のステップでマシンをシャットオフした場合には、そのマシンをオンにする。そうでない場合には、<B>bos restart</B> コマンドを発行して、
<B>fs</B> プロセスを再始動し、サーバー区分の新規セットを認識させます。ローカル・スーパーユーザー <B>root</B> としてログインするので <B>-localauth</B> フラグを付けますが、管理トークンは必ずしも必要ではありません。<B>bos restart</B> コマンドに関する詳細は、
<A HREF="auagd009.htm#HDRWQ225">プロセスの停止および即時の再始動</A> を参照してください。
<P>
<PRE>   # <B>bos restart</B> &lt;<VAR>machine name</VAR>>  <B>fs -localauth</B> 
</PRE>
</LI><LI><B>bos status</B> コマンドを発行して、すべてのサーバー・プロセスが正しく実行されているかどうかを検証する。詳細については、<A HREF="auagd009.htm#HDRWQ205">BosConfig ファイルのプロセス状況および情報の表示</A> を参照してください。
<P>
<PRE>   # <B>bos status</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI></OL>
<A NAME="IDX6208"></A>
<A NAME="IDX6209"></A>
<A NAME="IDX6210"></A>
<A NAME="IDX6211"></A>
<A NAME="IDX6212"></A>
<P><H3><A NAME="HDRWQ170" HREF="auagd002.htm#ToC_154">AFS ボリュームを収容しているディスクを取り外したり、除去するには</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証する。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>ボリュームを除去するか、あるいはほかの区分に移動する準備として、
<B>vos listvol</B> コマンドを発行し、ユーザーが除去しようとしているそれぞれのディスクのそれぞれの区分に収容されるボリュームをリストします。詳細については、<A HREF="auagd010.htm#HDRWQ305">ボリューム・ヘッダーの表示</A> を参照してください。
<P>
<PRE>   % <B>vos listvol</B> &lt;<VAR>machine name</VAR>> [&lt;<VAR>partition name</VAR>>] 
</PRE>
</LI><LI>ファイル・システムに保存したい任意のボリュームを、別の区分に移動する。読み取り / 書き込みボリュームのみ移動可能です。詳細と、読み取り専用およびバックアップ・ボリュームの移動に関する指示については、<A HREF="auagd010.htm#HDRWQ312">ボリュームの移動</A> を参照してください。
<P>
<PRE>   % <B>vos move</B> &lt;<VAR>volume name or ID</VAR>>  \
       &lt;<VAR>machine name on source</VAR>>  &lt;<VAR>partition name on source</VAR>>  \
       &lt;<VAR>machine name on destination</VAR>>  &lt;<VAR>partition name on destination</VAR>>
</PRE>
</LI><LI><B>(オプション)</B> 保持したくないボリュームがある場合には、
<B>vos dump</B> コマンドまたは AFS バックアップ・システムを使用して、それらのボリュームをバックアップする。
<A HREF="auagd010.htm#HDRWQ326">ボリュームのダンプおよび復元</A> または <A HREF="auagd012.htm#HDRWQ412">データのバックアップ</A> をそれぞれ参照してください。
</LI><LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
<A NAME="IDX6213"></A>
<A NAME="IDX6214"></A>
</LI><LI><B>umount</B> コマンドを発行します。除去するディスクにあるそれぞれの区分ごとにこのコマンドの発行を繰り返します。
<P>
<PRE>   # <B>cd /</B>
   # <B>umount /dev/</B>&lt;<VAR>partition_block_device_name</VAR>>
</PRE>
<A NAME="IDX6215"></A>
</LI><LI><A NAME="LIWQ171"></A>テキスト・エディターを使用して、マシンのファイル・システム登録ファイル
(<B>/etc/fstab</B> または同等のファイル) から、それぞれの区分の項目を除去するか、またはコメント化する。
</LI><LI>それぞれの区分に関連した <B>/vicep</B> ディレクトリーを除去する。
<P>
<PRE>   # <B>rmdir /vicep</B><VAR>xx</VAR>
</PRE>
</LI><LI>オペレーティング・システムで、マシンをシャットオフしてディスクを除去する必要がある場合には、
<B>bos shutdown</B> コマンドを発行して、
BOS サーバー以外のすべての AFS サーバー・プロセスを終了します
(マシンをシャットオフすると、BOS サーバーは安全に終了します)。ローカル・スーパーユーザー <B>root</B> としてログインするので <B>-localauth</B> フラグを付けますが、管理トークンは必ずしも必要ではありません。コマンドの詳細な説明は、<A HREF="auagd009.htm#HDRWQ223">プロセスを一時停止させる方法</A> を参照してください。
<P>
<PRE>   # <B>bos shutdown</B> &lt;<VAR>machine name</VAR>> <B>-localauth</B> [<B>-wait</B>]
</PRE>
</LI><LI><A NAME="LIWQ172"></A>必要な場合には、マシンをシャットオフします。ディスクとオペレーティング・システムの取引先が提供する指示に従って、ディスクを除去します。必要な場合には、ディスクの区分表を編集し、ファイル・システム登録ファイルに加えた変更を、
<A HREF="#LIWQ171">7</A> のステップで反映させます。指示については、オペレーティング・システムの資料を調べてください。
</LI><LI><A HREF="#LIWQ172">10</A> のステップでマシンをシャットオフした場合には、そのマシンをオンにする。そうでない場合には、<B>bos restart</B> コマンドを発行して、
<B>fs</B> プロセスを再始動し、サーバー区分の新規セットを認識させます。ローカル・スーパーユーザー <B>root</B> としてログインするので <B>-localauth</B> フラグを付けますが、管理トークンは必ずしも必要ではありません。<B>bos restart</B> コマンドに関する詳細は、
<A HREF="auagd009.htm#HDRWQ225">プロセスの停止および即時の再始動</A> を参照してください。
<P>
<PRE>   # <B>bos restart</B> &lt;<VAR>machine name</VAR>>  <B>fs -localauth</B> 
</PRE>
</LI><LI><B>bos status</B> コマンドを発行して、すべてのサーバー・プロセスが正しく実行されているかどうかを検証する。詳細については、<A HREF="auagd009.htm#HDRWQ205">BosConfig ファイルのプロセス状況および情報の表示</A> を参照してください。
<P>
<PRE>   # <B>bos status</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI></OL>
<A NAME="IDX6216"></A>
<A NAME="IDX6217"></A>
<A NAME="IDX6218"></A>
<A NAME="IDX6219"></A>
<A NAME="IDX6220"></A>
<A NAME="IDX6221"></A>
<A NAME="IDX6222"></A>
<A NAME="IDX6223"></A>
<A NAME="IDX6224"></A>
<A NAME="IDX6225"></A>
<A NAME="IDX6226"></A>
<HR><H2><A NAME="HDRWQ173" HREF="auagd002.htm#ToC_155">サーバー IP アドレスおよび VLDB サーバー項目の管理</A></H2>
<P>マルチホーム・ファイル・サーバーに対する AFS のサポートはほとんどが自動的に行われます。ファイル・サーバー・プロセスは、そのファイル・サーバー・マシンのネットワーク・インターフェースの IP アドレスをローカルの
<B>/usr/afs/local/sysid</B> ファイルに記録し、これらをボリューム・ロケーション・データベース (VLDB) の <I>サーバー項目</I> に登録します。
<B>sysid</B> ファイルおよびサーバー項目は、同じ固有番号により識別され、これにより両者間の関連が作成されます。
<P>キャッシュ・マネージャーがボリューム・ロケーション情報を要求すると、ボリューム・ロケーション (VL) サーバーは、ボリュームを含む各サーバー・マシンに対して登録されているインターフェースをすべて戻します。これにより、キャッシュ・マネージャーがマルチホーム・ファイル・サーバー・マシンに保管された AFS データにアクセスする際、複数アドレスを使用することができます。
<P>ファイル・サーバーが VLDB サーバー項目にどのインターフェースを登録するか制御するのであれば、ローカル <B>/usr/afs/local</B> ディレクトリーに <B>NetInfo</B> および <B>NetRestrict</B> の 2 つのファイルを作成することにより制御が可能です。ファイル・サーバーは再始動するたびに
<B>NetInfo</B> ファイルがこれが存在する場合にこれを読み取り、ローカル・マシンのインターフェースのリストを作成します。ファイルを作成しない場合には、ファイル・サーバーはオペレーティング・システムによって構成されたネットワーク・インターフェースのリストを使用します。その上でファイル・サーバーは、<B>NetRestrict</B> ファイルがある場合には、そのリストのアドレスを削除します。ファイル・サーバーは、<B>sysid</B> ファイルに結果リストを記録し、これと同じ固有 ID を持つ VLDB サーバー項目にインターフェースを登録します。
<P>データベース・サーバー・マシンにおいては、<B>NetInfo</B> および <B>NetRestrict</B> ファイルはまた、他のデータベース・サーバー・マシンで実行されているデータベース・サーバー・プロセスと通信する際に Ubik データベース同期ライブラリーが使用するインターフェースを決定します。
<P>各サーバー項目には、最大数の IP アドレスが存在します
(<I>AFS Release Notes</I>を参照)。マルチホーム・ファイル・サーバー・マシンのインターフェースがこの最大数より多ければ、
AFS は超過分を無視します。このようなマシンについては、<B>NetInfo</B> および <B>NetRestrict</B> ファイルを使用して、どのインターフェースを登録するか制御するとよいでしょう。
<P>何らかの理由により <B>sysid</B> ファイルがなくなった場合には、ファイル・サーバーは新規の固有 ID の新規ファイルを作成します。ファイル・サーバーが新規ファイルの内容を登録する際、ボリューム・ロケーション (VL) サーバーは通常、新規ファイルが既存のサーバー項目に対応することを自動的に認識し、既存のサーバー項目を新規ファイル内容および ID で上書きします。ただし、<B>sysid</B> ファイルを削除しなくて済むのであれば、削除しない方がよいでしょう。
<P>同様に、ファイル・サーバー・マシン間で <B>sysid</B> ファイルをコピーしないでください。新規のファイル・サーバー・マシンをインストールする作業の一部として、既存のマシンの <B>/usr/afs</B> ディレクトリーの内容を普通にコピーするのであれば、新規マシンの <B>/usr/afs/local</B> ディレクトリーから <B>sysid</B> ファイルを削除してからファイル・サーバーを開始するようにしてください。
<P>既存のサーバー項目を新規 <B>sysid</B> ファイルの内容および ID で上書きしてよいか VL サーバーが判別できない場合があります。VL サーバーはこの場合、ファイル・サーバーがインターフェースを登録できないようにし、ファイル・サーバーは開始できません。これはたとえば、新規 <B>sysid</B> ファイルに、現在別々のサーバー項目に登録されている 2 つのインターフェースが含まれる場合に起こります。このような場合、VL サーバー・マシンの <B>/usr/afs/log/VLLog</B> ファイルおよびファイル・サーバー・マシンの <B>/usr/afs/log/FileLog</B> ファイルにあるエラー・メッセージが、<B>vos changeaddr</B> コマンドを使用して問題を解決する必要があることを示します。指示および支援については、AFS プロダクト・サポート・グループにご連絡ください。
<P>このようにまれな場合を除き、<B>vos changeaddr</B> コマンドの適切な使用法としては、ファイル・サーバー・マシンをサービスから削除する場合に VLDB サーバー項目を完全に削除する場合があります。VLDB は、最大数のサーバー項目を含むことができます (<I>AFS Release Notes</I>を参照)。使用されない項目を削除することにより、新規サーバー・マシンに必要なサーバー項目を割り当てることができます。以下の説明を参照してください。
<P>VLDB サーバー項目に登録されたインターフェースのリストを変更するのに <B>vos changeaddr</B> コマンドを使用しないでください。ファイル・サーバー・マシンの IP アドレスおよびサーバー項目を変更するには、以下の説明を参照してください。
<A NAME="IDX6227"></A>
<A NAME="IDX6228"></A>
<A NAME="IDX6229"></A>
<P><H3><A NAME="Header_156" HREF="auagd002.htm#ToC_156">サーバーの NetInfo ファイルを作成または編集する</A></H3>
<OL TYPE=1>
<LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI>テキスト・エディターを使用して、<B>/usr/afs/local/NetInfo</B> ファイルをオープンします。各行に小数点付き 10 進数の IP アドレスを配置します (たとえば、<TT>192.12.107.33</TT>)。項目はどのような順序でもかまいません。
</LI><LI>変更したリストを使用してすぐにファイル・サーバーを開始するには、
<B>bos restart</B> コマンドを使用して <B>fs</B> プロセスを再始動します。説明については、
<A HREF="auagd009.htm#HDRWQ225">プロセスの停止および即時の再始動</A> を参照してください
</LI></OL>
<A NAME="IDX6230"></A>
<A NAME="IDX6231"></A>
<A NAME="IDX6232"></A>
<P><H3><A NAME="Header_157" HREF="auagd002.htm#ToC_157">サーバーの NetRestrict ファイルを作成または編集する</A></H3>
<OL TYPE=1>
<LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI>テキスト・エディターを使用して、<B>/usr/afs/local/NetRestrict</B> ファイルをオープンします。各行に小数点付き 10 進数の IP アドレスを配置します。アドレスはどのような順序でもかまいません。そのフィールドで可能なすべてのアドレスを表すワイルドカードには、値 <B>255</B> を使用します。たとえば <TT>192.12.105.255</TT> と入力した場合、キャッシュ・マネージャーは、192.12.105 サブネットのいずれのアドレスも登録しません。
</LI><LI>変更したリストを使用してすぐにファイル・サーバーを開始するには、
<B>bos restart</B> コマンドを使用して <B>fs</B> プロセスを再始動します。説明については、
<A HREF="auagd009.htm#HDRWQ225">プロセスの停止および即時の再始動</A> を参照してください
</LI></OL>
<A NAME="IDX6233"></A>
<A NAME="IDX6234"></A>
<P><H3><A NAME="Header_158" HREF="auagd002.htm#ToC_158">VLDB のすべてのサーバー項目を表示する</A></H3>
<OL TYPE=1>
<LI>VLDB のすべてのサーバー項目を表示するには、<B>vos listaddrs</B> コマンドを発行します。
<P>
<PRE>   % <B>vos listaddrs</B>
</PRE>
<P>
<P><B>lista</B> は、
<B>listaddrs</B> の受け入れ可能な最も短い省略形です。
<P>
<P>出力の各行にはすべての VLDB サーバー項目がそれぞれ表示されます。マルチホーム・ファイル・サーバーの場合には、その登録済みアドレスがすべて行に表示されます。最初のアドレスは、<B>vos examine</B> および <B>vos listvldb</B> コマンドの出力でボリュームのサイトとして報告されたアドレスです。
<P>
<P>VLDB サーバー項目は IP アドレスを記録し、コマンド・インタープリターは、ローカル名サービス
(ドメイン・ネーム・サービスなどのプロセス、またはローカル・ホスト・テーブルのいずれか)
によりアドレスをホスト名に変換してからこれを表示します。出力に IP アドレスが表示される場合は、これを変換することができないためです。
<P>
<P>項目が存在する場合でも、これは必ずしもマシンが活動状態のファイル・サーバー・マシンであるとは限りません。使用されないサーバー項目を削除するには、以下の説明を参照してください。
</LI></OL>
<A NAME="IDX6235"></A>
<A NAME="IDX6236"></A>
<P><H3><A NAME="Header_159" HREF="auagd002.htm#ToC_159">VLDB から使用されないサーバー項目を削除する</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証する。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>VLDB からサーバー項目を削除するには、<B>vos changeaddr</B> コマンドを発行します。
<P>
<PRE>   % <B>vos changeaddr</B> &lt;<VAR>original IP address</VAR>> <B>-remove</B>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>ch
</B><DD><B>changeaddr</B> の受け入れ可能な最も短い省略形です。
<P><DT><B><VAR>original IP address</VAR>
</B><DD>現在 VLDB に登録されているファイル・サーバー・マシンの IP アドレスを 1 つ指定します。マルチホーム・ファイル・サーバーは、そのいずれのアドレスでも識別ができます。
<P><DT><B>-remove
</B><DD>サーバー項目を削除します。
</DL>
</LI></OL>
<P><H3><A NAME="Header_160" HREF="auagd002.htm#ToC_160">サーバー・マシンの IP アドレスを変更する</A></H3>
<OL TYPE=1>
<LI>ユーザーが、<B>/usr/afs/etc/UserList</B> ファイルにリストされているかどうかを検証する。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>マシンがシステム制御マシン、またはバイナリー配布マシンであり、またそのホスト名も変更しようとする場合は、他のサーバー・マシンの関連 <B>upclient</B> プロセスを再定義して、新規ホスト名が参照できるようにします。<B>bos delete</B> および <B>bos create</B> コマンドを使用します
(<A HREF="auagd009.htm#HDRWQ216">プロセスの作成および除去</A> を参照)。
</LI><LI>マシンがデータベース・サーバー・マシンであれば、セル内の各サーバー・マシンの <B>/usr/afs/etc/CellServDB</B> ファイルにある項目を編集し、新規 IP アドレスのうちの 1 つを表示します。
AFS 米国版を使用している場合は、システム制御マシン上のファイルを編集することができます。更新サーバーがすべてのサーバー・マシンに変更ファイルを配布する間 (デフォルトで 5 分間) 待ちます。
</LI><LI>マシンがデータベース・サーバー・マシンの場合、<B>bos shutdown</B> コマンドを発行してすべてのサーバー・プロセスを停止します。マシンがファイル・サーバーでもある場合は、この間そのボリュームにはアクセスすることができません。コマンドの詳細な説明は、<A HREF="auagd009.htm#HDRWQ223">プロセスを一時停止させる方法</A> を参照してください。
<P>
<PRE>   % <B>bos shutdown</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>マシンの IP アドレスを変更するには、オペレーティング・システムに提供されているユーティリティーを使用します。
</LI><LI>必要があれば、<B>/usr/afs/local/NetInfo</B> ファイル、または <B>/usr/afs/local/NetRestrict</B> ファイル (あるいはその両方) を編集して、変更したアドレスが反映されるようにします。本節のはじめにある説明に従ってください。
</LI><LI>マシンがデータベース・サーバー・マシンの場合、<B>bos restart</B> コマンドを発行してマシンのすべてのサーバー・プロセスを再始動します。
<B>bos restart</B> コマンドに関する詳細は、
<A HREF="auagd009.htm#HDRWQ225">プロセスの停止および即時の再始動</A> を参照してください。
<P>
<PRE>   % <B>bos restart</B> &lt;<VAR>machine name</VAR>> <B>-all</B>
</PRE>
<P>
<P>同時に、セル内の他のすべてのデータベース・サーバー・マシンで <B>bos restart</B> コマンドを発行し、データベース・サーバー・プロセスのみ (認証、バックアップ、保護、およびボリューム・ロケーション・サーバー) を再始動します。コマンドが連続して発行できるようにし、すべてのデータベース・サーバー・プロセスが起動できるようにします。
<P>
<PRE>   % <B>bos restart</B> &lt;<VAR>machine name</VAR>> <B>kaserver buserver ptserver vlserver</B>
</PRE>
<P>
<P>セル内のそれぞれのデータベース・サーバー・マシンの IP アドレスを変更する場合は、セル内のそれぞれのファイル・サーバー・マシンで <B>bos restart</B> コマンドを発行して
<B>fs</B> プロセスを再始動します。
</LI><LI>マシンがデータベース・サーバー・マシンでなければ、<B>bos restart</B> コマンドを発行して <B>fs</B> プロセスを再始動します
(マシンがデータベース・サーバー・マシンであれば、プロセスは前のステップで開始済みです)。ファイル・サーバーは自動的にインターフェースの新規リストをコンパイルし、これを <B>/usr/afs/local/sysid</B> ファイルに記録して、
VLDB サーバー項目に登録します。
<P>
<PRE>   % <B>bos restart</B> &lt;<VAR>machine name</VAR>> <B>fs</B>
</PRE>
</LI><LI>マシンがデータベース・サーバー・マシンであれば、セル内の各クライアント・マシンの <B>/usr/vice/etc/CellServDB</B> ファイルにある項目を編集し、新規 IP アドレスのうちの 1 つを表示します。説明は、<A HREF="auagd015.htm#HDRWQ553">データベース・サーバー・マシンの情報を保持する</A> を参照してください。
</LI><LI>保護データベースにマシンの以前の IP アドレスのマシン項目がある場合は、
<B>pts rename</B> コマンドを使用して新規アドレスに変更します。説明については、
<A HREF="auagd019.htm#HDRWQ767">保護データベース項目の名前の変更</A> を参照してください
</LI></OL>
<A NAME="IDX6237"></A>
<A NAME="IDX6238"></A>
<A NAME="IDX6239"></A>
<HR><H2><A NAME="HDRWQ174" HREF="auagd002.htm#ToC_161">サーバー・マシンのリブート</A></H2>
<P>適切なコマンドをコンソールで入力するか、または、リモート・マシンで <B>bos exec</B> コマンドを発行するかのいずれかによって、サーバー・マシンをリブートすることができます。ユーザーは現在の場所を離れる必要がないため、リモートのリブートが便利かもしれませんが、コンソールでできるように、リブートの進行追跡することはできません。サーバー・マシンのオペレーティング・システムが BOS サーバーを認識しているため、リモートのリブートは可能です。
BOS サーバーは、ローカル・スーパーユーザー<B>root</B>として、
<B>bos exec</B> コマンドを実行します。
<P>サーバー・マシンをリブートすることは、いくつかのセルのルーチン保守の一部で、
AFS の資料の指示には、1 つのステップとして組み込まれています。リブートは、
AFS が関連した問題から回復するための標準メソッドであることを意図したものではないのは確かですが、マシンの反応が鈍いときや、ほかのすべての理にかなったオプションを試行したときの、唯一の最後の手段です。
<P>リブートは、サービスの停止の原因になります。マシンにボリュームが保管されている場合には、リブートが完了し、ファイル・サーバーが再接続されるまで、そのすべてのボリュームにはアクセスできなくなります。そのマシンがデータベース・サーバー・マシンである場合には、それぞれのデータベース・サーバー・プロセスごとに同期化サイトを再選出している間は、そのデータベースからの情報は使用できなくなります。一般的には、VL サーバーの停止は、最大の影響を及ぼします。それは、キャッシュ・マネージャーが AFS データを取り出すためには、
VLDB にアクセスできなければならないからです。
<P>規則では、サーバー・マシンの AFS 初期設定ファイルには、それぞれがリブートした後に、
BOS サーバーを再始動するための以下のコマンドが組み込まれています。
BOS サーバーは、ローカルの
<B>/usr/afs/local/BosConfig</B> ファイルにリストされるほかの
AFS サーバー・プロセスを開始します。これらの指示は、初期設定ファイルに以下のコマンドが組み込まれていることを想定しています。
<PRE>   /usr/afs/bin/bosserver &amp;
</PRE>
<P><H3><A NAME="HDRWQ175" HREF="auagd002.htm#ToC_162">コンソールからのファイル・サーバー・マシンのリブート</A></H3>
<OL TYPE=1>
<LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI><B>bos shutdown</B> コマンドを発行して、
BOS サーバー以外のすべての AFS サーバー・プロセス終了する。
BOS サーバーは、ユーザーがマシンを終了すると、安全に終了します。ローカル・スーパーユーザー <B>root</B> としてログインするので <B>-localauth</B> フラグを付けますが、管理トークンは必ずしも必要ではありません。コマンドの詳細な説明は、<A HREF="auagd009.htm#HDRWQ223">プロセスを一時停止させる方法</A> を参照してください。
<P>
<PRE>   # <B>bos shutdown</B> &lt;<VAR>machine name</VAR>> <B>-localauth</B> [<B>-wait</B>]
</PRE>
</LI><LI>マシンをリブートする。多くのシステム・タイプでは、適切なコマンドは <B>shutdown</B> でが、オプションは異なる場合があります。UNIX 管理者の手引きを参照してください。
<P>
<PRE>   # <B>shutdown</B>
</PRE>
</LI></OL>
<A NAME="IDX6240"></A>
<A NAME="IDX6241"></A>
<P><H3><A NAME="HDRWQ176" HREF="auagd002.htm#ToC_163">リモートでファイル・サーバー・マシンをリブートするには</A></H3>
<OL TYPE=1>
<LI>ユーザーがリブートしているマシンの
<B>/usr/afs/etc/UserList</B> ファイルに、ユーザーがリストされているかどうかを検証する。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>bos shutdown</B> を発行して、BOS サーバー以外の
AFS サーバー・プロセスを停止する。
BOS サーバーは、マシンをオフにすると安全に終了します。コマンドの詳細な説明は、<A HREF="auagd009.htm#HDRWQ223">プロセスを一時停止させる方法</A> を参照してください。
<P>
<PRE>   % <B>bos shutdown</B> &lt;<VAR>machine name</VAR>>  [<B>-wait</B>]
</PRE>
</LI><LI><B>bos exec</B> コマンドを発行して、マシンをリモートでリブートする。
<P>
<PRE>   % <B>bos exec</B> &lt;<VAR>machine name</VAR>> <VAR>reboot_command</VAR>
</PRE>
<P>
<P>ここで、
<DL>
<P><DT><B><VAR>machine name</VAR>
</B><DD>リブートするファイル・サーバー・マシンを命名します。
<P><DT><B><VAR>reboot_command</VAR>
</B><DD>マシンのオペレーティング・システムのためのリブート・コマンドです。多くのシステム・タイプでは、適切なコマンドは <B>shutdown</B> ですが、オペレーティング・システム資料を参照してください。
</DL>
</LI></OL>
<P><HR><B>&#91; <A HREF="#Top_Of_Page">ページのトップ</A> &#124; <A HREF="auagd007.htm">前ページ</A> &#124; <A HREF="auagd009.htm">次ページ</A> &#124; <A HREF="auagd002.htm#ToC">目次</A> &#124; <A HREF="auagd026.htm#HDRINDEX">索引</A> &#93;</B> 
<!-- Begin Footer Records  ========================================== -->
<P><HR><B> 
<br>(C) <A HREF="http://www.ibm.com/">IBM Corporation 2000.</A>  All Rights Reserved<!-- 991224 --> 
</B> 
<!-- End Footer Records  ============================================ -->
<A NAME="Bot_Of_Page"></A>
</BODY></HTML>
