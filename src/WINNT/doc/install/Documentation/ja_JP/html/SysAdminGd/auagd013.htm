<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3//EN">
<HTML><HEAD>
<TITLE>管理の手引き</TITLE>
<!-- Begin Header Records  ========================================== -->
<!-- E:\IDWB\TEMP\idwt2118\AUAGD000.SCR converted by idb2h R4.2 (359) -->
<!-- ID Workbench Version (OS2) on 24 Dec 1999 at 12:07:32            -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Shift_JIS">
<META HTTP-EQUIV="updated" CONTENT="Fri, 24 Dec 1999 12:07:30">
<META HTTP-EQUIV="review" CONTENT="Sun, 24 Dec 2000 12:07:30">
<META HTTP-EQUIV="expires" CONTENT="Mon, 24 Dec 2001 12:07:30">
</HEAD><BODY>
<!-- (C) IBM Corporation 2000. All Rights Reserved    --> 
<BODY bgcolor="ffffff"> 
<!-- End Header Records  ============================================ -->
<A NAME="Top_Of_Page"></A>
<H1>管理の手引き</H1>
<HR><H1><A NAME="HDRWQ439" HREF="auagd002.htm#ToC_360">AFS パフォーマンスのモニターおよび監査</A></H1>
<A NAME="IDX7089"></A>
<A NAME="IDX7090"></A>
<A NAME="IDX7091"></A>
<A NAME="IDX7092"></A>
<A NAME="IDX7093"></A>
<A NAME="IDX7094"></A>
<A NAME="IDX7095"></A>
<A NAME="IDX7096"></A>
<P>AFS は、3 つの主要なモニター・ツールを備えています。
<UL>
<LI><B>scout</B> プログラム。ファイル・サーバーのパフォーマンスを監視し、その統計を収集します。
</LI><LI><B>fstrace</B> コマンド・スイート。キャッシュ・マネージャーのオペレーションを詳細にトレースします。
</LI><LI><B>afsmonitor</B> プログラム。ファイル・サーバーおよびキャッシュ・マネージャーの両方について監視し、統計を収集します。
</LI></UL>
<P>AFS は、AIX を実行するファイル・サーバー・マシン上での AFS イベントを監査するためのツールも提供します。
<HR><H2><A NAME="HDRWQ440" HREF="auagd002.htm#ToC_361">説明の要約</A></H2>
<P>この章では、指示されたコマンドを使用して次のタスクの実行方法を説明します。
<BR>
<TABLE WIDTH="100%">
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%"><B>scout</B> プログラムの初期化
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>scout</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">トレース・ログに関する情報の表示
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>fstrace lslog</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">イベント・セットに関する情報の表示
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>fstrace lsset</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">トレース・ログのサイズの変更
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>fstrace setlog</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">イベント・セットの状態の設定
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>fstrace setset</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">トレース・ログの内容のダンプ
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>fstrace dump</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">トレース・ログの消去
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>fstrace clear</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%"><B>afsmonitor</B> プログラムの初期化
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>afsmonitor</B>
</TD></TR></TABLE>
<HR><H2><A NAME="HDRWQ449" HREF="auagd002.htm#ToC_362">scout プログラムの使用</A></H2>
<A NAME="IDX7097"></A>
<P><B>scout</B> プログラムは、ファイル・サーバー・マシン上で実行されるファイル・サーバー・プロセスの状況をモニターします。これは、指定した一連のファイル・サーバー・プロセスの統計を集めて、これをグラフィカル形式で表示し、構成可能なしきい値を超える統計がある場合は警告します。
<P>具体的に <B>scout</B> プログラムには、以下の機能があります。
<UL>
<LI>ローカルおよび外部セルから、任意数のサーバー・マシン上のファイル・サーバー・プロセスのモニターが、単一の位置より行えます。この数は表示ウィンドウのサイズによってのみ制限されます。サイズは統計を表示できるだけのサイズにする必要があります。
</LI><LI>複数の統計に対してしきい値を設定することができます。ある統計の値がしきい値を超えると、
<B>scout</B> プログラムは注意を促すためにその値を強調表示します
(反転表示します)。値がしきい値より低くなると、強調表示は解除されます。しきい値はシステム管理者が制御するため、システム管理者が注意が必要であると考える状態を強調表示させることができます。<A HREF="#HDRWQ455">重要な統計の強調表示</A> を参照してください。
</LI><LI><B>scout</B> プログラムは、ファイル・サーバー・プロセス、マシン、およびネットワークの障害について注意を促し、プローブに反応しない各マシンの名前を強調表示して、これにすぐに応答できるようにします。
</LI><LI><B>scout</B> プログラムがファイル・サーバー・プロセスから何回統計を収集するかを設定することができます。
</LI></UL>
<P><H3><A NAME="HDRWQ450" HREF="auagd002.htm#ToC_363">システム要件</A></H3>
<A NAME="IDX7098"></A>
<A NAME="IDX7099"></A>
<A NAME="IDX7100"></A>
<A NAME="IDX7101"></A>
<A NAME="IDX7102"></A>
<A NAME="IDX7103"></A>
<A NAME="IDX7104"></A>
<P><B>scout</B> プログラムは、ほとんどの UNIX で標準のユーティリティーとして配布される
<B>curses</B> グラフィックス・パッケージにアクセスする AFS クライアント・マシン上で実行します。
scout プログラムは、ダム端末および端末をエミュレートするウィンドウ操作システムのどちらでも実行できますが、出力表示は、反転表示およびカーソルのアドレス指定をサポートするマシンが最も適しています最適な結果を得るには、TERM 環境変数には、正しい端末タイプ、または実際の端末タイプに類似した特性を持つ端末タイプを設定する必要があります。
AIX を実行するマシンでは、TERM を <B>vt100</B> に設定することをお勧めします (その端末が類似しているものである場合)。その他のオペレーティング・システムに対しては、設定可能な値は、
<B>xterm</B>、<B>xterms</B>、<B>vt100</B>、<B>vt200</B>、および <B>wyse85</B> です。
<A NAME="IDX7105"></A>
<P><B>scout</B> プログラムの実行には特権は必要ないため、バイナリーのあるディレクトリー (通常の構成では <B>/usr/afsws/bin</B> ディレクトリー) にアクセスできるユーザーであれば、これを使用することができます。統計を収集するプログラムのプローブは、ファイル・サーバー・プロセスに大きな負荷を課しませんが、バイナリー・ファイルを適切なアクセス制御リスト (ACL) を持つディレクトリーに配置することにより、その使用を制限することができます。
<P><B>scout</B> プログラムの複数インスタンスを単一のクライアント・マシンで実行することができます。それぞれのインスタンスは、その専用接続上 (そのウィンドウ内) にあります。これはフォアグラウンドで実行する必要があり、これを実行するウィンドウは、割り込みシグナルを除いて追加入力を受け入れません。
<P><B>scout</B> プログラムは複数のマシンで実行することもでき、その出力は単一マシンで表示ができます。これには制御マシンから他のマシンに telnet 接続をオープンし、それぞれのリモート・ウィンドウでプログラムを初期化します。この場合、<B>-host</B> フラグを
<B>scout</B> コマンドに組み込み、各リモート・マシンの名前を出力表示ウィンドウ上部の <I>banner line</I> に表示することができます。
<A HREF="#HDRWQ453">バナー行</A> を参照してください。
<P><H3><A NAME="HDRWQ451" HREF="auagd002.htm#ToC_364">-basename 引き数を使用したドメイン名の指定</A></H3>
<A NAME="IDX7106"></A>
<A NAME="IDX7107"></A>
<P>前述のように、<B>scout</B> プログラムを使用して、任意の数のファイル・サーバー・マシン上のプロセスをモニターすることができます。すべてのマシンが同一のセルに含まれる場合、そのホスト名はすべて同一のドメイン名サフィックス (ABC Corporation のセルの <B>abc.com</B> など) を持ちます。この場合、<B>-basename</B> 引き数を <B>scout</B> コマンドに使用すると、いくつかの利点があります。
<UL>
<LI>コマンド行で各ファイル・サーバー・マシン名を入力する際、ドメイン名サフィックスを省略することができます。
<B>scout</B> プログラムは、それぞれのマシン名に自動的にドメイン名を追加し、完全修飾されたホスト名が指定されます。
<B>-basename</B> を組み込まずにドメイン名サフィックスを省略することもできますが、この場合、正しい名前の決定は、接続時のセルの命名サービスの状態に依存します。
</LI><LI>マシン名の一部を切り捨てずに、表示ウィンドウの該当列に収まるようにすることができます
(表示列の名前の切り捨てに関する詳細は、
<A HREF="#HDRWQ454">統計表示領域</A> を参照してください)。
</LI><LI>ドメイン名は、表示ウィンドウ上部のバナー行に表示され、監視しているセルの名前を示します。
</LI></UL>
<P><H3><A NAME="HDRWQ452" HREF="auagd002.htm#ToC_365">scout 表示のレイアウト</A></H3>
<A NAME="IDX7108"></A>
<A NAME="IDX7109"></A>
<P><B>scout</B> プログラムは、統計を専用ウィンドウか、ウィンドウ操作環境が使用できない場合は通常の画面のいずれかで表示します。最適な結果を得るためには、画面が反転表示で表示し、カーソルのアドレス指定を実行するウィンドウまたは画面を使用します。
<P><B>scout</B> 画面には 3 つの主要な領域の
<I>バナー行</I>、<I>統計表示領域</I> および <I>プローブ/メッセージ行</I> があります。本機能グループでは、その内容および <A HREF="#HDRWQ459">コマンドおよび表示のサンプル</A> に示すグラフィック例を説明します。
<P><H4><A NAME="HDRWQ453">バナー行</A></H4>
<A NAME="IDX7110"></A>
<A NAME="IDX7111"></A>
<P>デフォルトでは、ウィンドウまたは画面の上部のバナー行に文字列 <TT>scout</TT> が表示され、
<B>scout</B> プログラムが実行中であることを示します。コマンド行で適切なオプションを組み込むことにより、以下の 2 種類の追加情報を表示することができます。
<UL>
<LI><B>-host</B> フラグを組み込み、ローカル・マシン名をバナー行に表示します。特に、複数のマシン上で
<B>scout</B> プログラムを実行し、結果を 1 つのマシンに表示する場合、これは便利です。
<P>
<P>たとえば、
<B>scout</B> プログラムをマシン <B>client1.abc.com</B> で実行し、<B>-host</B> フラグを使用した場合、以下のバナー行が表示されます。
<PRE>   [client1.abc.com] scout
</PRE>
</LI><LI><B>-basename</B> 引き数を組み込み、指定したセル・ドメイン名をバナー行に表示します。詳しくは、<A HREF="#HDRWQ451">-basename 引き数を使用したドメイン名の指定</A> を参照してください。
<P>
<P>たとえば、値 <B>abc.com</B> を
<B>-basename</B> 引き数に指定すると、バナー行は以下のように表示されます。
<P>
<PRE>   scout for abc.com
</PRE>
</LI></UL>
<P><H4><A NAME="HDRWQ454">統計表示領域</A></H4>
<A NAME="IDX7112"></A>
<A NAME="IDX7113"></A>
<P>統計表示領域は、ウィンドウの大半を占め、
6 つの列に分割されます。以下のリストには、ウィンドウ内でこれが左から右に現れる順に説明しています。
<DL>
<P><DT><B><TT>Conn</TT>
<A NAME="IDX7114"></A>
</B><DD>ファイル・サーバー・プロセスとクライアント・マシン間でオープンしている RPC 接続の数を表示します。通常この数は、
4 番目の列の <TT>Ws</TT> 以上の値となります。この数を Ws 列の値より大きくすることができるのは、そのマシンの各ユーザーは同時にいくつかの異なる接続をオープンすることが可能であり、
1 つのクライアント・マシンは複数のユーザーを扱えるためです。
<P><DT><B><TT>Fetch</TT>
<A NAME="IDX7115"></A>
</B><DD>ファイル・サーバー・プロセスが開始されてからクライアント・マシンから受信したフェッチ・タイプの
RPC (フェッチ・データ、フェッチ・アクセス・リスト、およびフェッチ状況) の RPC 数を表示します。ファイル・サーバー・プロセスが再始動すると 0 にリセットします。
<P><DT><B><TT>Store</TT>
<A NAME="IDX7116"></A>
</B><DD>ファイル・サーバー・プロセスが開始されてからクライアント・マシンから受信した保管タイプの
RPC (保管データ、保管アクセス・リスト、および保管状況) の RPC 数を表示します。ファイル・サーバー・プロセスが再始動すると 0 にリセットします。
<P><DT><B><TT>Ws</TT>
<A NAME="IDX7117"></A>
<A NAME="IDX7118"></A>
<A NAME="IDX7119"></A>
</B><DD>最近の 15 分間にファイル・サーバー・プロセスと通信したクライアント・マシン (ワークステーション) の数を表示します
(このようなマシンは、
<I>アクティブ</I> と呼ばれます)。
1 つのクライアント・マシンが 1 つのファイル・サーバー・プロセスに対して複数の接続をオープンすることができるため、この数値が <TT>Conn</TT> 列の数値より小さくなる可能性があります。
<P><DT><B>[Unlabeled column]
</B><DD>ファイル・サーバー・プロセスが実行されているファイル・サーバー・マシンの名前を表示します。幅は 12 文字です。これより文字数が長い名前は切り捨てられ、最後の文字にアスタリスク (<TT>*</TT>) が表示されます。すべてのマシンが同一のドメイン名サフィックスの場合は、<B>-basename</B> 引き数を使用して切り捨てを行わなくてもよいようにします。<A HREF="#HDRWQ451">-basename 引き数を使用したドメイン名の指定</A> を参照してください。
<P><DT><B><TT>Disk attn</TT>
<A NAME="IDX7120"></A>
<A NAME="IDX7121"></A>
<A NAME="IDX7122"></A>
<A NAME="IDX7123"></A>
</B><DD>最大 26 までのファイル・サーバー・マシンの
AFS サーバー (<B>/vicep</B>) パーティションで使用可能なブロックの K バイト数を表示します。各パーティションは次のように表示されます。
<P>
<PRE>      <VAR>partition_letter</VAR>:<VAR>free_blocks</VAR>
</PRE>
<P>
<P>
<P>たとえば、<TT>a:8949</TT> は、パーティション <B>/vicepa</B> には 8,949 KB の空きがあることを示します。ウィンドウの幅がすべてのパーティション項目を 1 行で表示するには狭すぎる場合は、<B>scout</B> プログラムは自動的にパーティションの項目を6 番目の列内のサブ列にスタックします。
<P>
<P><TT>Disk attn</TT> 列のラベルは、列内の項目が強調表示されるしきい値を示します。デフォルトでは、<B>scout</B> プログラムは 95% 以上使用されているパーティションを強調表示し、この場合のラベルは以下のようになります。
<P>
<PRE>   Disk attn: > 95% used
</PRE>
<P>
<P>
<P>このしきい値およびその強調表示との関係についての詳細は、
<A HREF="#HDRWQ455">重要な統計の強調表示</A> を参照してください。
</DL>
<P>5 番目 (ファイル・サーバー・マシン名) 以外のすべての列に対しては、
<B>-attention</B> 引き数を使用してしきい値を設定し、この値を超えるものについては <B>scout</B> プログラムが統計を強調表示するようにできます。デフォルトでは、強調表示されるのは 5 番目および 6 番目の列の値のみです。
<B>-attention</B> 引き数の使用法については、
<A HREF="#HDRWQ455">重要な統計の強調表示</A> を参照してください。
<P><H4><A NAME="Header_368">プローブ、レポート作成行</A></H4>
<A NAME="IDX7124"></A>
<A NAME="IDX7125"></A>
<P>画面下部の行には、<B>scout</B> がファイル・サーバー・プロセスを統計のために何回プローブしたかを示します。統計表示領域には、最新のプローブによって収集された統計が表示されます。デフォルトでは、<B>scout</B> プログラムはファイル・サーバーを 60 秒ごとにプローブしますが、
<B>-frequency</B> 引き数を使用して別のプローブ頻度を指定することができます。
<P><H3><A NAME="HDRWQ455" HREF="auagd002.htm#ToC_369">重要な統計の強調表示</A></H3>
<A NAME="IDX7126"></A>
<A NAME="IDX7127"></A>
<A NAME="IDX7128"></A>
<A NAME="IDX7129"></A>
<P>現在しきい値を超える統計に注目できるよう、
<B>scout</B> プログラムはこれは反転表示 (強調表示) します。ほとんどの統計に対してしきい値が設定でき、特別な注意が必要な値と正常な値を判別することができます。
<P><H4><A NAME="HDRWQ456">サーバー障害の強調表示</A></H4>
<A NAME="IDX7130"></A>
<A NAME="IDX7131"></A>
<A NAME="IDX7132"></A>
<A NAME="IDX7133"></A>
<A NAME="IDX7134"></A>
<P>5 番目の列のみ、強調表示を制御することができません。この列で識別するファイル・サーバー・マシンについては、別の列に統計が表示されます。あるマシンのファイル・サーバー・プロセスがプローブへの応答に失敗すると、
<B>scout</B> プログラムはこの列を強調表示して、他の列の値を空白にします。プローブへの応答が失敗した場合には、ファイル・サーバー・プロセス、ファイル・サーバー・マシン、またはネットワークの障害が示されている可能性があるため、強調表示によりユーザーへのサービスの障害となる状況に注意を向けるようにします。
<P>ファイル・サーバー・プロセスが再びプローブに応答すると、その名前が正常に表示され、他の行に再度統計が表示されます。一度にすべてのマシン名が強調表示される場合は、ネットワーク障害によってファイル・サーバー・マシンと
<B>scout</B> プログラムを実行しているクライアント・マシンとの接続が中断した可能性があります。
<P><H4><A NAME="Header_371">極端な統計値の強調表示</A></H4>
<P>5 つの統計表示行の 1 つ以上の行にしきい値を設定するには、
<B>-attention</B> 引き数を使用します。しきい値は、モニターするすべてのファイル・サーバー・プロセスに適用されます
(異なるマシンに異なるしきい値は設定できません)。詳細は、
<A HREF="#HDRWQ458">scout プログラムの起動</A> の構文記述を参照してください。
<P>実行中の <B>scout</B> プログラムに対し、しきい値を変更することはできません。現行のプログラムを停止して、新規に開始します。また、<B>scout</B> プログラムは再始動にあたりしきい値を保存しないため、プログラムを開始するごとにしきい値を指定しなくてはなりません。
<P><H3><A NAME="HDRWQ457" HREF="auagd002.htm#ToC_372">scout の表示サイズ変更</A></H3>
<A NAME="IDX7135"></A>
<A NAME="IDX7136"></A>
<A NAME="IDX7137"></A>
<P><B>scout</B> プログラムの実行中は、表示ウィンドウのサイズを変更しないでください。サイズを大きくしても問題はありませんが、<B>scout</B> プログラムは必ずしも新規のサイズに調整されるとは限りません。表示幅を縮小すると、列の位置合わせが乱れる場合があり、表示が読みづらくなります。どのようなサイズ変更を実行しても、<B>scout</B> プログラムは、次のプローブの結果を表示するまでは表示の調整を全く行いません。
<P>表示サイズを効率よく変更する場合は、<B>scout</B> プログラムを停止させてからウィンドウのサイズを変更し、それからプログラムを再始動します。この場合でも、表示環境から受け取る情報の正確さに応じて、サイズ変更に対する <B>scout</B> プログラムの反応は異なります。開発段階でのテストでは、表示環境がウィンドウのサイズ変更についての信頼できる情報を提供しないことが判明しています。
X ウィンドウ・システムを使用する場合は、以下のコマンドのシーケンスを <B>scout</B> プログラムを開始 (またはコマンドをシェル初期化ファイルに配置) する前に実行すると、サイズ変更を適切に調整することができます。
<PRE>   %<B> set noglob</B>
   % <B>eval '/usr/bin/X11/resize'</B> 
   % <B>unset noglob</B>
</PRE>
<A NAME="IDX7138"></A>
<A NAME="IDX7139"></A>
<A NAME="IDX7140"></A>
<A NAME="IDX7141"></A>
<A NAME="IDX7142"></A>
<P><H3><A NAME="HDRWQ458" HREF="auagd002.htm#ToC_373">scout プログラムの起動</A></H3>
<OL TYPE=1>
<LI>専用のコマンド・シェルを開きます。必要であれば、これを適当なサイズに変更します。
</LI><LI><B>scout</B> コマンドを発行して、プログラムを起動します。
<P>
<PRE>   % <B>scout</B>  [<B>initcmd</B>]  <B>-server</B> &lt;<VAR>FileServer name(s) to monitor</VAR>><SUP>+</SUP>  \
            [<B>-basename</B> &lt;<VAR>base server name</VAR>>]  \
            [<B>-frequency</B> &lt;<VAR>poll frequency, in seconds</VAR>>] [<B>-host</B>]  \
            [<B>-attention</B> &lt;<VAR>specify attention (highlighting) level</VAR>><SUP>+</SUP>]  \
            [<B>-debug</B> &lt;<VAR>turn debugging output on to the named file</VAR>>]
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>initcmd
</B><DD>このコマンドが AFS コマンド構文解析プログラムを使用できるようにするオプション文字列です。これは省略して無視することもできます。
<P><DT><B>-server
</B><DD>監視する各ファイル・サーバー・プロセスが実行されているファイル・サーバー・マシンを指定することによって、それらのプロセスを識別します。
<B>-basename</B> 引き数を使用しない場合は、完全修飾したホスト名を使用します。この場合、すべてのマシン名に共通のドメイン名サフィックスを省略して、それぞれのマシン名の開始部分のみを指定します。
<P><DT><B>-basename
</B><DD><B>-server</B> 引き数で指定したすべてのファイル・サーバー・マシンに共通のドメイン名サフィックスを指定します。この引き数についての説明は、
<A HREF="#HDRWQ451">-basename 引き数を使用したドメイン名の指定</A> を参照してください。
<P>
<P>ドメイン名サフィックスをマシン名の開始部分から分離するピリオドは除外して、サフィックス内のピリオドは入れてください。
(たとえば、
ABC Corporation セルでは、正しい値は <B>abc.com</B> であり、<B>.abc.com</B> ではありません。)
<P><DT><B>-frequency
</B><DD><B>scout</B> プログラムによるファイル・サーバー・プロセスのプローブ頻度を秒単位で設定します。0 (ゼロ) より大きい整数を指定します。デフォルトは 60 秒です。
<P><DT><B>-host
</B><DD><B>scout</B> プログラムを実行するマシンの名前を、ウィンドウのバナー行に表示します。デフォルトでは、マシン名は表示されません。
<P><DT><B>-attention
</B><DD>1 つ以上の統計を強調表示するしきい値を定義します。統計としきい値の組み合わせはいずれの順でも指定でき、それぞれの組み合わせおよび組み合わせ内の各部分は 1 つ以上のスペースで区切ります。以下のリストに、それぞれの統計に対する構文を定義します。
<A NAME="IDX7143"></A>
<A NAME="IDX7144"></A>
<A NAME="IDX7145"></A>
<P>
<P>
<DL>
<P><DT><B>conn <VAR>connections</VAR>
</B><DD>ファイル・サーバーがクライアント・マシンに対しオープンにした接続の数が
<VAR>connections</VAR> 値を超えた場合、
<TT>Conn</TT> (最初の) 列の値が強調表示されます。値がしきい値より低くなると、強調表示は解除されます。デフォルトのしきい値はありません。
<P><DT><B>fetch <VAR>fetch_RPCs</VAR>
</B><DD>クライアントがファイル・サーバー・プロセスに対して行ったフェッチ RPC の数が
<VAR>fetch_RPCs</VAR> の値を超えた場合、
<TT>Fetch</TT> (2 番目の) 列の値が強調表示されます。ファイル・サーバー・プロセスが再始動した場合にのみ、強調表示は解除され、この場合、値はゼロに戻ります。デフォルトのしきい値はありません。
<P><DT><B>store <VAR>store_RPCs</VAR>
</B><DD>クライアントがファイル・サーバー・プロセスに対して行った保管 RPC の数が <VAR>store_RPC</VAR> の値を超えた場合、<TT>Store</TT> (3 番目の) 列の値が強調表示されます。ファイル・サーバー・プロセスが再始動した場合にのみ、強調表示は解除され、この場合、値はゼロに戻ります。デフォルトのしきい値はありません。
<P><DT><B>ws <VAR>active_clients</VAR>
</B><DD>アクティブ・クライアント・マシン (最近の 15 分間でファイル・サーバーに接触したマシン) の数が
<VAR>active_clients</VAR> の値を超えた場合、
<TT>Ws</TT> (4 番目の) 列の値が強調表示されます。値がしきい値より低くなると、強調表示は解除されます。デフォルトのしきい値はありません。
<P><DT><B>disk <VAR>percent_full</VAR> % または disk <VAR>min_blocks</VAR>
</B><DD>ディスクの使用スペースが
<VAR>percent_full</VAR> 値で指定したパーセントを超えた場合、または空きブロックの KB 数が <VAR>min_blocks</VAR> 値を下回った場合、
<TT>Disk attn</TT> (6 番目の) 列のパーティションの値が強調表示されます。値が <VAR>percent_full</VAR> しきい値を下回る、または<VAR>min_blocks</VAR> を上回った場合、強調表示は解除されます。
<P>
<P>指定した値は、6 番目の列のヘッダー中、文字列 <TT>Disk attn</TT> の後に表示されます。デフォルトのしきい値は、
95% です。
<P>
<P><VAR>percent_full</VAR> の受け入れ可能な値は、
<B>0</B> (ゼロ) から <B>99</B> の範囲の整数で、この統計を <VAR>min_blocks</VAR> 値と区別するためにパーセント記号を追加します。
.
</DL>
<P>
<P>
<P>以下の例では、<TT>Conn</TT> 列のしきい値を
100、<TT>Ws</TT> 列を 50、および <TT>Disk attn</TT> 列を 75% に設定しています。<TT>Fetch</TT> および <TT>Store</TT> 列にはしきい値はありません。
<P>
<P><B>-attention conn 100 ws 50 disk
75%</B>
<P>
<P>以下の例では、前の例と同じ結果となりますが、
<TT>Disk attn</TT> 列のしきい値が 5000 KB の空きブロックに設定されています。
<P>
<P><B>-attention disk 5000 ws 50 conn 100</B>
<P><DT><B>-debug
</B><DD>デバッグの出力を可能にし、その出力を指定したファイルに送信します。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。デフォルトではデバッグの出力は生成されません。
</DL>
</LI></OL>
<P><H3><A NAME="Header_374" HREF="auagd002.htm#ToC_374">scout プログラムの停止</A></H3>
<A NAME="IDX7146"></A>
<OL TYPE=1>
<LI>表示ウィンドウで <B>Ctrl-c</B> を入力します。ユーザーの環境で通常使用する割り込みシグナルがこれと異なる場合でも、これが正しい割り込みシグナルとなります。
</LI></OL>
<P><H3><A NAME="HDRWQ459" HREF="auagd002.htm#ToC_375">コマンドおよび表示のサンプル</A></H3>
<A NAME="IDX7147"></A>
<A NAME="IDX7148"></A>
<P>本機能グループでは、<B>scout</B> プログラムの例を示します。各種引き数の組み合わせによる画面表示が示されています。
<P>最初の例では、ABC Corporation 社の管理者がオプションの引き数またはフラグを何も指定せずに <B> scout</B> コマンドを発行します。複数のマシン名を指定するため、
<B>-server</B> 引き数を指定します。<B>-basename</B> 引き数は使用していませんが、それぞれのマシン名の開始部分について指定します。この際、セルのネーム・サービスにより、
<B>scout</B> プログラムが接続の確立に必要とする完全修飾名を取得します。
<PRE>   % <B>scout -server fs1 fs2</B> 
</PRE>
<P><A HREF="#FIGWQ460">図 2</A> は、結果として示される表示を表しています。最初に気付くのは、5 番目 (ラベルなし) の列に表示されるマシン名は、管理者がコマンド行に入力したとおりに表示されるということです。表示領域の 2 行目 (マシン名
<TT>fs2</TT> が 5 番目の列に表示されている) を参照してください。<TT>Conn</TT> および <TT> Ws</TT> 列は共に、<B>fs2</B> がクライアント・マシンとの間で 144 の RPC 接続をオープンしていることを示しており、各クライアントごとに複数の接続が可能であることを示します。<TT>Fetch</TT> 列は、ファイル・サーバー・プロセスが最後に起動されてから、クライアント・マシンが 2,734,278 のフェッチ RPC を <B>fs2</B> に対して実行したことを示し、<TT>Store</TT> 列はクライアント・マシンが 34,066 の保管 RPC を実行したことを示します。
<P><TT>Disk attn</TT> 列には 6 つのパーティション項目が表示され、それぞれのパーティションには <TT>a</TT> から <TT>f</TT> までの文字が付きます (<B>/vicepa</B> から
<B>/vicepf</B> に対して)。これらは、ウィンドウ幅の関係で 2 つのサブ列で 3 行に表示されます。ウィンドウの幅がそれ以上に広い場合は、サブ列の数はこれより多くなります。パーティション項目のうち 4 つ (<TT>a</TT>、<TT>c</TT>、<TT>d</TT>、および <TT>e</TT>) は反転表示され、それらの項目が 95% 占有 (<TT>Disk attn</TT> ヘッダーに表示されるしきい値) を超えていることを示しています。
<P><B><A NAME="FIGWQ460" HREF="auagd003.htm#FT_FIGWQ460">図 2. 最初の例 scout 表示</A></B><BR>
<TABLE BORDER ><TR><TD><BR>
<B><BR><IMG SRC="scout1.gif" ALT="最初の例 scout 表示"><BR></B><BR>
</TD></TR></TABLE>
<P>2 番目の例では、管理者は、<B>scout</B> プログラムのオプション引き数をさらに使用しています。
<UL>
<LI>管理者は例 1 と同じ形式のマシン名を指定しますが、今回は <B>-basename</B> 引き数を使用して、そのドメイン名サフィックス <B>abc.com</B> の指定もします。これは、<B>scout</B> プログラムはネーム・サービスに対して名前を完全修飾したホスト名に拡張するようには要求しないことを暗黙指定するものですが、それでもネーム・サービスによりホスト名は IP アドレスに変換されます。
</LI><LI><B>-host</B> フラグを使用して、
<B>scout</B> プログラムが実行中のクライアント・マシンの名前をバナー行に表示します。
</LI><LI><B>-frequency</B> 引き数を使用して、プローブ頻度をデフォルトの 1 分間に 1 回から 5 秒ごとに 1 回に変更します。
</LI><LI><B>-attention</B> 引き数を使用して、パーティション強調表示のしきい値をデフォルトの 95% 占有から最低限度 5000 KB に変更します。
</LI></UL>
<PRE>   % <B>scout -server fs1 fs2 -basename abc.com -host -frequency 5 -attention disk 5000</B> 
</PRE>
<P>オプションの引き数を使用すると、<A HREF="#FIGWQ461">図 3</A> と <A HREF="#FIGWQ460">図 2</A> にはいくつかの違いが発生します。最初の違いは、<B> -host</B> フラグが取り入れられているため、バナー行には、<B> -basename</B> 引き数で指定されたベース名 <TT>abc.com</TT> とともに、<TT>[client52]</TT> として <B>scout</B> プロセスを実行しているマシンの名前が表示されます。
<P>もう 1 つの違いは、その値は <A HREF="#FIGWQ460">図 2</A> の場合と同じですが、マシン <B>fs2</B> のパーティションのうち 4 つではなく 2 つが反転表示されます。これは、管理者が強調表示のしきい値を最低 5000 ブロックに変更したためで、<TT>Disk attn</TT> 列のヘッダーにも表示されます。マシン <B>fs2</B> のパーティション <B>/vicepa</B> および <B>/vicepd</B> はまだ 95% 占有ですが、5000 以上の空きブロックを持っています。パーティション <B> /vicepc</B> および <B>/vicepe</B> は空きブロックが 5000 より少ないため強調表示されています。
<P>また、プローブ頻度の変更によって生じる結果にも注目してください。この結果は画面の左下のプローブ/メッセージ行に表示されます。この画面例と例 1 の画面例は共に、管理者が <B>scout</B>
コマンドを発行してから 1 分間経過しています。ただし、この例では、<B>scout</B> プロセスがファイル・サーバー・プロセスをプローブした回数が 1 回ではなく 12 回となっています。
<P><B><A NAME="FIGWQ461" HREF="auagd003.htm#FT_FIGWQ461">図 3. 2 回目の例 scout 表示</A></B><BR>
<TABLE BORDER ><TR><TD><BR>
<B><BR><IMG SRC="scout2.gif" ALT="2 回目の例 scout 表示"><BR></B><BR>
</TD></TR></TABLE>
<P><A HREF="#FIGWQ462">図 4</A> では、State University セルの管理者はそのセルのファイル・サーバー・マシンの 3 つをモニターします。管理者は <B>-basename</B> 引き数を使用して <B>stateu.edu</B> ドメイン名を指定します。
<PRE>   % <B>scout -server server2 server3 server4 -basename stateu.edu</B> 
</PRE>
<P><B><A NAME="FIGWQ462" HREF="auagd003.htm#FT_FIGWQ462">図 4. 3 番目の scout 表示</A></B><BR>
<TABLE BORDER ><TR><TD><BR>
<B><BR><IMG SRC="scout3.gif" ALT="3 番目の例 scout 表示"><BR></B><BR>
</TD></TR></TABLE>
<P><A HREF="#FIGWQ463">図 5</A> は、<B>scout</B> プログラムの 3 つの機能を説明しています。最初に、異なるセルのファイル・サーバー・マシン
(<B>fs1.abc.com</B>、<B>server3.stateu.edu</B> および <B>sv7.def.com</B>) を 1 つの表示でモニターします。これらのマシンは異なるセルに所属するため、
<B>-basename</B> 引き数を指定することはできません。
<P>2 番目に、
5 番目の列に入りきらないマシン名を切り捨てて表示しているようすを示しています。名前の最後にアスタリスクを使用して、これが省略されていることを示しています。
<P>3 番目に、<B>scout</B> プロセスがファイル・サーバー・プロセスに到達できないと、どのような状態になるかを示しています。この場合、マシンのうちの 1 つの
<B>sv7.def.com</B> が強調表示され、他の列の値が空白になっています。
<P><B><A NAME="FIGWQ463" HREF="auagd003.htm#FT_FIGWQ463">図 5. 4 番目の例 scout 表示</A></B><BR>
<TABLE BORDER ><TR><TD><BR>
<B><BR><IMG SRC="scout4.gif" ALT="4 番目の例 scout 表示"><BR></B><BR>
</TD></TR></TABLE>
<HR><H2><A NAME="HDRWQ464" HREF="auagd002.htm#ToC_376">fstrace コマンド・スイートの使用</A></H2>
<P>本機能グループは、システム管理者がデバッグの目的でキャッシュ・マネージャーの活動をトレースするために使用する
<B>fstrace</B> コマンドについて説明します。
<A HREF="auagd015.htm#HDRWQ513">クライアント・マシンとキャッシュ・マネージャーの管理</A> に説明されているキャッシュ・マネージャーについて精通しているユーザーを前提としています。
<P><B>fstrace</B> コマンド・スイートにより、キャッシュ・マネージャーの内部活動をモニターし、その操作を詳細に記録またはトレースすることができます。操作は、<I>イベント</I> と呼ばれますが、
<B>cm</B> <I>イベント・セット</I> より構成されます。
<B>cm</B> イベントの例としては、ファイルのフェッチおよび UNIX
<B>ls</B> コマンドを使用した、ファイルおよびサブディレクトリーのリストに対する情報の検索があります。
<P>以下に <B>fstrace</B> コマンドとその機能を示します。
<UL>
<LI><B>fstrace apropos</B> コマンドは、コマンドの短い説明を提供します。
</LI><LI><B>fstrace clear</B> コマンドは、トレース・ログを消去します。
</LI><LI><B>fstrace dump</B> コマンドは、トレース・ログの内容をダンプします。
</LI><LI><B>fstrace help</B> コマンドは、コマンドの説明と構文を提供します。
</LI><LI><B>fstrace lslog</B> コマンドは、トレース・ログの情報をリストします。
</LI><LI><B>fstrace lsset</B> コマンドは、イベント・セットについての情報をリストします。
</LI><LI><B>fstrace setlog</B> コマンドは、トレース・ログのサイズを変更します。
</LI><LI><B>fstrace setset</B> は、イベント・セットの状態を設定します。
</LI></UL>
<P><H3><A NAME="HDRWQ465" HREF="auagd002.htm#ToC_377">fstrace コマンド・スイートについて</A></H3>
<P><B>fstrace</B> コマンド・スイートの機能は、<B> fs debug</B> コマンドが提供する機能に相当し、これを大幅に拡張します。この使用目的は、クライアント・マシンの停止、キャッシュの整合性の問題、クロック同期エラー、およびボリュームまたは AFS ファイルへのアクセス失敗など、キャッシュ・マネージャーの特定の問題の診断を補助することにあります。このため、<B>fstrace</B> ロギングは、
AFS サーバー・プロセスの場合とは異なり、常時使用可能とはしておかない方がよいでしょう。
<P>トレース・ログのほとんどのメッセージは、下位レベルのキャッシュ・マネージャー操作に対応しています。
AFS ソース・コードに習熟している操作員でなければ解釈できない場合が考えられます。
AFS ソース・ライセンスを所有する場合は、ソースを自分自身で解釈するか、または AFS 製品サポート・グループと共同して根底にある問題を解決することができます。
AFS ソース・ライセンスを所有していない場合は、問題が発生したらすぐに AFS 製品サポート・グループに連絡する方が効率的でしょう。
<B>fstrace</B> トレースが適切であれば、これをアクティブにするよう指示がなされます。
<P>ログのサイズはすぐに増大し、ローカル・ファイル・スペースにファイルを書き込む場合は、貴重なディスク・スペースを使用することになります。さらに、ログのサイズが大きくなり過ぎると、結果を解析して関連情報を見つけるのが困難になる場合があります。
<A NAME="IDX7149"></A>
<A NAME="IDX7150"></A>
<P>AFS を使用可能にし、<B>cm</B> イベントが発生するたびトレース・ログ <B>cmfx</B> にメッセージが書き込まれます。問題を診断するには、トレース・ログの出力を確認してキャッシュ・マネージャーが実行した操作を分析します。トレース・ログのデフォルトのサイズは 60 KB ですが、このサイズは変更することができます。
<A NAME="IDX7151"></A>
<A NAME="IDX7152"></A>
<P><B>fstrace</B> コマンド・スイートを使用するためには、まずトレースを使用可能にしてから、
<B>fstrace setset</B> コマンドを使用してトレース・ログのためのスペースを予約または割り振ります。このコマンドを使用すると、<B>cm</B> イベント・セットを以下の 3 つのうちの 1 つの状態に設定し、イベント・セットに対してトレースを使用可能にするか使用不可にする、またはカーネル内のトレース・ログのためのスペースを割り振り解除することができます。
<A NAME="IDX7153"></A>
<A NAME="IDX7154"></A>
<A NAME="IDX7155"></A>
<DL>
<P><DT><B>活動状態
</B><DD>イベント・セットに対してトレースを使用可能にし、トレース・ログのためのスペースを割り振ります。
<P><DT><B>活動停止中
</B><DD>一時的にイベント・セットに対してトレースを使用不可にします。しかしながら、イベント・セットはデータを送信するログが占有するスペースの割り振りを継続します。
<P><DT><B>休止
</B><DD>イベント・セットに対するトレースを使用不可にします。さらに、イベント・セットはデータを送信するログが占有するスペースを解放します。<B> cmfx</B> トレース・ログにデータを送信する <B> cm</B> イベント・セットがこの状態であるときには、そのログに割り振られたスペースは解放または割り振り解除されます。
</DL>
<A NAME="IDX7156"></A>
<A NAME="IDX7157"></A>
<A NAME="IDX7158"></A>
<P>イベント・セットとトレース・ログ両方は、<I>持続</I> として指定することができます。指定すると、イベント・セットの状態が誤ってリセットされなくなり、またはトレース・ログがクリアされなくなります。指定は、カーネルがコンパイルされるときに行われ、変更することはできません。
<P><B>cm</B>のようなイベント・セットが持続している場合、<B>-set</B> 引き数を <B>fstrace setset</B> コマンドに組み込まないとその状態を変更することができません。(すなわち、引き数なしで <B>fstrace setset</B>コマンドを発行すると、他のすべてのイベント・セットの状態と同様にその状態を変更することはできません)。同様に、<B>cmfx</B>のようなトレース・ログが持続している場合、<B>-set</B> または <B> -log</B> 引き数のいずれかを<B>fstrace clear</B> コマンドに取り入れた場合にだけクリアすることができます ( 引き数なしで<B>fstrace clear</B> コマンドを発行しても他のすべてのトレース・ログと同様にクリアすることはできません。)
<P>問題が発生した場合は、<B>fstrace setset</B> コマンドを使用して
<B>cm</B> イベント・セットを活動状態に設定します。使用中の AFS クライアントでトレースを使用可能にすると、記録されるイベントのボリュームが重要となります。したがって、問題を診断する際には、できる限り AFS 活動を制限して、ログにある異質のトレーシングの量を少なくします。トレースがシステム・パフォーマンスに悪い影響を与える場合があるため、問題を診断していないときは <B>cm</B> トレースを 休止状態にします。
<P>問題が再生可能である場合は、
<B>fstrace clear</B> コマンドを使用して <B>cmfx</B> トレース・ログを消去します。問題を簡単に再生できない場合は、問題が再度発生するまでイベント・セットの状態を活動状態のままにしておきます。
<P>トレース・ログの内容を表示させて <B> cm</B> イベントを分析するためには、
<B>fstrace dump</B> コマンドを使用して、トレース・ログの内容行を標準出力またはファイルにコピーします。
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">特定のコマンドまたはプロセスが問題の原因となっている場合は、その id (PID) を判別します。<B>fstrace dump</B> コマンドの出力から PID を検索し、問題に関連する行のみを見つけます。
</TD></TR></TABLE>
<P><H3><A NAME="HDRWQ466" HREF="auagd002.htm#ToC_378">fstrace コマンド・スイートの使用要件</A></H3>
<A NAME="IDX7159"></A>
<A NAME="IDX7160"></A>
<P>特権が必要でない <B>fstrace help</B> コマンドおよび <B> fstrace apropos</B> コマンド以外は、
<B>fstrace</B> コマンドを発行するには、そのコマンドを発行する人間がローカル・クライアント・マシン上で <B>root</B> としてログインする必要があります。
<B> fstrace</B> コマンドを発行する前に、必要な特権を持っていることを確認してください。
<P>ロギングを実行できるようにするためには、キャッシュ・マネージャー・カタログが、適切な位置にある必要があります。
<B>fstrace</B> コマンド・スイートは、標準 UNIX カタログ・ユーティリティーを使用します。デフォルトのロケーションは、<B>/usr/vice/etc/C/afszcm.cat</B> です。キャッシュ・マネージャー・カタログは、そのファイルを任意の場所に移し、適切な NLSPATH および LANG 環境変数を使用すると、別のディレクトリーに入れることができます。
<P><H3><A NAME="Header_379" HREF="auagd002.htm#ToC_379">fstrace コマンドを効率的に使用する</A></H3>
<P>To use <B>fstrace</B>コマンドを最も効率的に使用するには、指示どおりに構成します。
<UL>
<LI><B>fstrace</B> バイナリーはローカル・ディスクのディレクトリーに格納します。
</LI><LI><B>fstrace</B> ログをファイルにダンプする際、これをローカル・ディスクのファイルに送信します。
</LI><LI>トレースは、わずか数分で大きくなる場合があります。ログをローカル・ファイルにダンプする前に、十分な空きがあるか確認してください。ローカル・ファイル・システム内のパーティションでディスク割り当て量を使用している場合は、特に注意してください。
</LI><LI>AFS クライアント・マシン上でのキャッシュ・マネージャーの活動を、問題の操作以外に制限します。これにより、トレース内にある無関係のデータを減らすことができます。
</LI><LI><B>fstrace</B> ログをアクティブにするのは、できるだけ短時間とします。できれば、問題の操作の実行直前にトレースをアクティブにし、操作が完了したらすぐに活動停止にします。そして即時にトレース・ログをファイルにダンプします。
</LI><LI>可能であれば、問題のある操作を開始するコマンドまたはプログラムの UNIX プロセス ID (PID) を取得します。これにより、トレース・ログを解析する際、
PID に関連したメッセージを検索することができます。
</LI></UL>
<P><H3><A NAME="HDRWQ467" HREF="auagd002.htm#ToC_380">トレース・ログの活動化</A></H3>
<P>AFS クライアント・マシンでキャッシュ・マネージャーのトレースを開始するには、まず最初に以下を構成します。
<UL>
<LI><B>cmfx</B> カーネルのトレース・ログ。<B>fstrace setlog</B> コマンドを使用します。
</LI><LI><B>cm</B> イベント・セット。<B>fstrace
setset</B> コマンドを使用します。
</LI></UL>
<P><B>fstrace setlog</B> コマンドは、
<B>cmfx</B> カーネルのトレース・ログのサイズを K バイトで設定します。トレース・ログはデフォルトで、カーネルの 60 K バイトを占有します。トレース・ログが既に存在する場合は、このコマンドが発行されると消去され、指定されたサイズの新規ログが作成されます。トレース・ログが存在しない場合は、希望するサイズの新規ログが作成されます。
<P><B>fstrace setset</B> コマンドは、
<B>cm</B> カーネルのイベント・セットの状態を設定します。
<B> cm</B> イベント・セットの状態は、該当するイベント・セットに含まれるイベントの情報がロギングされるかどうかを決定します。
<P>AFS クライアント・マシンに対してカーネルのトレースを設定すると、イベント・セットの状態およびトレース・ログのために割り振られたカーネル・バッファーのサイズをチェックすることができます。
<B> cm</B> イベント・セットの状態に関する情報を表示するためには、
<B>fstrace lsset</B> コマンドを発行します。
<B>cmfx</B> トレース・ログの情報を表示するためには、
<B>fstrace lslog</B> コマンドを使用します。<A HREF="#HDRWQ469">トレース・ログまたはイベント・セットの状態の表示</A> にある説明を参照してください。
<A NAME="IDX7161"></A>
<A NAME="IDX7162"></A>
<A NAME="IDX7163"></A>
<A NAME="IDX7164"></A>
<P><H3><A NAME="Header_381" HREF="auagd002.htm#ToC_381">トレース・ログの構成方法</A></H3>
<OL TYPE=1>
<LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI><B>fstrace setlog</B> コマンドを発行し、
<B>cmfx</B> カーネルのトレース・ログのサイズを設定します。
<P>
<PRE>   # <B>fstrace setlog</B>  [<B>-log</B> &lt;<VAR>log_name</VAR>><SUP>+</SUP>]  <B>-buffersize</B> &lt;<VAR>1-kilobyte_units</VAR>>
</PRE>
</LI></OL>
<P>次の例は、<B>cmfx</B> トレース・ログのサイズを
80 KB に設定します。
<PRE>   # <B>fstrace setlog cmfx 80</B> 
</PRE>
<A NAME="IDX7165"></A>
<A NAME="IDX7166"></A>
<A NAME="IDX7167"></A>
<A NAME="IDX7168"></A>
<P><H3><A NAME="HDRWQ468" HREF="auagd002.htm#ToC_382">イベント・セットの設定方法</A></H3>
<OL TYPE=1>
<LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI><B>fstrace setset</B> コマンドを発行して、イベント・セットの状態を設定します。
<P>
<PRE>   % <B>fstrace setset</B> [<B>-set</B> &lt;<VAR>set_name</VAR>><SUP>+</SUP>] [<B>-active</B>] [<B>-inactive</B>]  \
                    [<B>-dormant</B>] 
</PRE>
</LI></OL>
<P>以下の例では、<B>cm</B> イベント・セットをアクティブにします。
<PRE>   # <B>fstrace setset cm -active</B>
</PRE>
<P><H3><A NAME="HDRWQ469" HREF="auagd002.htm#ToC_383">トレース・ログまたはイベント・セットの状態の表示</A></H3>
<P>イベント・セットは、トレース・ログに取り入れるため<I>活動</I> 状態になっている必要があります。イベント・セットの状態を表示するには、<B>fstrace lsset</B> コマンドを使用します。その状態を設定するには、<A HREF="#HDRWQ468">イベント・セットの設定方法</A>に説明してあるように、<B> fstrace setset</B> コマンドを使用します。
<P>トレース・ログのサイズおよび割り当て情報を表示するには、<B>-long</B> 引き数を付けて<B>fstrace lslog</B>コマンドを発行します。
<A NAME="IDX7169"></A>
<A NAME="IDX7170"></A>
<A NAME="IDX7171"></A>
<A NAME="IDX7172"></A>
<P><H3><A NAME="Header_384" HREF="auagd002.htm#ToC_384">イベント・セットの状態を表示</A></H3>
<OL TYPE=1>
<LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI><B>fstrace lsset</B> コマンドを発行して、使用可能なイベント・セットおよびその状態を表示します。
<P>
<PRE>   # <B>fstrace lsset</B>  [<B>-set</B> &lt;<VAR>set_name</VAR>><SUP>+</SUP>]
</PRE>
</LI></OL>
<P>次の例は、ローカル・マシン上のイベント・セットおよびその状態を表示します。
<PRE>   # <B>fstrace lsset cm</B>
   Available sets:
   cm active
</PRE>
<P>このコマンドの出力は、イベント・セットおよびその状態をリストします。
<B>cm</B> イベント・セットのイベントの 3 つの状態は、以下のとおりです。
<DL>
<P><DT><B><TT>活動状態</TT>
</B><DD>トレースが使用可能です。
<P><DT><B><TT>活動停止中</TT>
</B><DD>トレースは使用不可になりますが、スペースは対応するトレース・ログ (<B>cmfx</B>) にまだ割り当てられています。
<P><DT><B><TT>休止</TT>
</B><DD>トレースは使用不可になり、スペースは対応するトレース・ログ (<B>cmfx</B>) には割り当てられません。イベント・セットのトレースを使用不可にします。
</DL>
<A NAME="IDX7173"></A>
<A NAME="IDX7174"></A>
<A NAME="IDX7175"></A>
<A NAME="IDX7176"></A>
<P><H3><A NAME="Header_385" HREF="auagd002.htm#ToC_385">ログ・サイズの表示</A></H3>
<OL TYPE=1>
<LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI><B>fstrace lslog</B> コマンドを発行して、カーネルのトレース・ログに関する情報を表示します。
<P>
<PRE>   # <B>fstrace lslog</B>  [<B>-set</B> &lt;<VAR>set_name</VAR>><SUP>+</SUP>]  [<B>-log</B> &lt;<VAR>log_name</VAR>>]  [<B>-long</B>] 
</PRE>
</LI></OL>
<P>次の例は、<B>-long</B> フラグを使用して、
<B>cmfx</B> トレース・ログに関する追加情報を表示します。
<PRE>   # <B>fstrace lslog cmfx -long</B>
   Available logs:
   cmfx : 60 kbytes (allocated)
</PRE>
<P>このコマンドの出力は、そのトレース・ログに関する情報をリストします。<B>-long</B> フラグを指定せずに <B> fstrace lslog</B> コマンドを発行すると、このコマンドはログ名だけをリストします。
<B>-long</B> フラグを指定して <B>fstrace lslog</B> コマンドを発行すると、このコマンドはログ、ログの K バイト単位のサイズ、およびログの割り振り状態をリストします。
<P>カーネルのトレース・ログの割り振り状態には、以下の 2 つがあります。
<DL>
<P><DT><B><TT>割り振り済み</TT>
</B><DD>カーネル内にログ用のスペースが予約されています。この状態は、このログに書き込まれるイベント・セットの状態が
<I>活動状態</I> (イベント・セットに対するトレースが使用可能である) または
<I>非活動状態</I> (イベント・セットに対するトレースが一時的に使用不可である) のいずれかであることを意味します。しかしながら、イベント・セットはデータを送信するログが占有するスペースの予約を継続します。
<P><DT><B><TT>割り振り解除</TT>
</B><DD>カーネル内にログ用のスペースが予約されていません。この状態は、このログに書き込まれるイベント・セットの状態が
<I>活動中止</I> (イベント・セットに対するトレースが使用不可である) であることを意味します。
</DL>
<P><H3><A NAME="HDRWQ470" HREF="auagd002.htm#ToC_386">トレース・ログのダンプとクリア</A></H3>
<P>トレースしたいキャッシュ・マネージャー・オペレーションが完了したら、<B>fstrace dump</B> コマンドを使用してトレース・ログを標準出力ストリームにダンプするか、または <B>-file</B> 引き数で名前が付けられたファイルにダンプします。または、トレース・ログを連続してダンプするには、<B>-follow</B> 引き数を使用します (希望する場合、<B>-file</B> 引き数と結合して)。連続ダンプを停止するには、&lt;<B> Ctrl-c</B>> のような割り込みシグナルを押します。
<P>データが必要なくなったときトレース・ログをクリアするには、<B>fstrace clear</B> コマンドを発行します。(<B>fstrace setlog</B> コマンドは、ログのサイズを変更するために使用するときには既存のトレース・ログも自動的にクリアします。)
<A NAME="IDX7177"></A>
<A NAME="IDX7178"></A>
<A NAME="IDX7179"></A>
<A NAME="IDX7180"></A>
<A NAME="IDX7181"></A>
<P><H3><A NAME="Header_387" HREF="auagd002.htm#ToC_387">トレース・ログの内容のダンプ方法</A></H3>
<OL TYPE=1>
<LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI><B>fstrace dump</B> コマンドを発行し、トレース・ログをダンプします。
<P>
<PRE>   # <B>fstrace dump</B> [<B>-set</B> &lt;<VAR>set_name</VAR>><SUP>+</SUP>]  [<B>-follow</B> &lt;<VAR>log_name></VAR>]  \
                  [<B>-file</B> &lt;<VAR>output_filename</VAR>>]  \
                  [<B>-sleep</B> &lt;<VAR>seconds_between_reads</VAR>>]
</PRE>
</LI></OL>
<P>各ダンプの出力の先頭には、ダンプが開始された日時を指定するヘッダーがあります。
<B>-follow</B> 引き数が指定されていない場合は、ダンプされるログの数が表示されます。ヘッダーは次のように表示されます。
<PRE>   AFS Trace Dump --
   Date: <VAR>date</VAR> <VAR>time</VAR>
   Found <VAR>n</VAR> logs.
</PRE>
<P>ここで、<I>date</I> は、トレース・ログ・ダンプの開始日、
<I>time</I> はトレース・ログ・ダンプの開始時間、そして <I>n</I> は <B>fstrace dump</B> コマンドによって検索されたログの数を指定します。
<P>以下は、トレース・ログのダンプ・ヘッダーの例です。
<PRE>   AFS Trace Dump --
   Date: Fri Apr 16 10:44:38 1999
   Found 1 logs.
</PRE>
<P>ヘッダーの後にはログの内容が続き、そのログの内容は活動中のイベント・セットからログに書き込まれたメッセージで構成されます。ログに書き込まれるメッセージは、以下の 3 つの構成要素で構成されます。
<UL>
<LI>メッセージに関連したタイム・スタンプ (任意の開始点から経過した秒数)
</LI><LI>メッセージに関連したプロセス ID またはスレッド ID
</LI><LI>メッセージそのもの
</LI></UL>
<P>トレース・ログのメッセージの形式は次のとおりです。
<PRE>   time <VAR>timestamp</VAR>, pid <VAR>pid</VAR>:<VAR>event message</VAR>
</PRE>
<P>ここで、<I>timestamp</I> は任意に開始点から経過した秒数であり、
<I>pid</I> はキャッシュ・マネージャー・イベントのプロセス ID 番号、および <I>event message</I> は AFS ソース・コード内の機能に対応するキャッシュ・マネージャー・イベントです。
<P>以下は、ダンプしたトレース・ログ・メッセージの例です。
<PRE>   time 749.641274, pid 3002:Returning code 2 from 19
</PRE>
<P>トレース・ログのメッセージを最適な読み取り可能形式にするには、クライアント・マシンのローカル・ディスクにキャッシュ・マネージャー・カタログ・ファイルがインストールされている必要があります。通常の位置は、<B>/usr/vice/etc/C/afszcm.cat</B> です。以下のように文字列 <TT>raw op</TT> で開始するメッセージは、カタログがインストールされていないことを示します。
<PRE>   raw op 232c, time 511.916288, pid 0
   p0:Fri Apr 16 10:36:31 1999
</PRE>
<P>1024 秒ごとに、現行の時間メッセージが別々のログに書き込まれます。このメッセージの形式は次のとおりです。
<PRE>   time <VAR>timestamp</VAR>, pid <VAR>pid</VAR>: Current time: <VAR>unix_time</VAR>
</PRE>
<P>ここで、<VAR>timestamp</VAR> は任意に開始点から経過した秒数であり、
<VAR>pid</VAR> はプロセス ID 番号、そして <VAR>unix_time</VAR> は 1970 年 1 月 1 日以降の標準時刻形式です。
<P>現行の時間メッセージを使用して、各ログ・メッセージに関連する実際の時間を判別することができます。実際の時間の判別は以下のとおりに行います。
<OL TYPE=1>
<LI>実際の時間を判別したいログ・メッセージの位置を指定する。
</LI><LI>現行の時間メッセージにたどり着くまでダンプ・レコードを逆方向に検索する。
</LI><LI>現行の時間メッセージの <I>timestamp</I> がログ・メッセージの <I>timestamp</I> より小さい場合は、後者の値から前者の値を減算します。現行の時間メッセージの <I>timestamp</I> がログ・メッセージの <I>timestamp</I> より大きい場合は、後者の値に 1024 を追加し、その結果から前者の値を減算します。
</LI><LI>ログ・メッセージの実際の時間を決定するためには、結果の数値を現行の時間メッセージの <I>unix_time</I> に加算します。
</LI></OL>
<P>ログ・データは限定された循環バッファーに保管されるため、いくつかのデータは読み取られる前に上書きされる場合があります。このことが発生すると、ダンプの適切な場所に以下のメッセージが表示されます。
<PRE>   Log wrapped; data missing.
</PRE>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">作業負荷が大きい場合にダンプの中間でこのメッセージが表示される場合がありますが、このメッセージはすべてのログ・データがログに書き込まれないこと、またはいくつかのデータが上書きされることを示します。
<B>fstrace setlog</B> コマンドを使用してログのサイズを大きくすると、この問題の発生を少なくすることができます。
</TD></TR></TABLE>
<A NAME="IDX7182"></A>
<A NAME="IDX7183"></A>
<A NAME="IDX7184"></A>
<A NAME="IDX7185"></A>
<A NAME="IDX7186"></A>
<P><H3><A NAME="Header_388" HREF="auagd002.htm#ToC_388">トレース・ログの内容の消去</A></H3>
<OL TYPE=1>
<LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI><B>fstrace clear</B> コマンドを発行して、ログ名またはイベント・セットを指定してログを消去します。
<P>
<PRE>   # <B>fstrace clear</B>  [<B>-set</B> &lt;<VAR>set_name</VAR>><SUP>+</SUP>]  [<B>-log</B> &lt;<VAR>log_name</VAR>><SUP>+</SUP>]
</PRE>
</LI></OL>
<P>次の例は、ローカル・マシン上の <B>cm</B> イベント・セットが使用する <B>cmfx</B> ログを消去します。
<PRE>   # <B>fstrace clear cm</B>
</PRE>
<P>次の例もまたローカル・マシン上の <B>cmfx</B> ログを消去します。
<PRE>   # <B>fstrace clear cmfx</B>
</PRE>
<A NAME="IDX7187"></A>
<P><H3><A NAME="HDRWQ471" HREF="auagd002.htm#ToC_389">fstrace コマンドの例</A></H3>
<P>本機能グループには、<B>fstrace</B> コマンド・スイートの使用例を広範囲にわたって説明しています。このコマンドは、
AFS 製品サポートで問題の診断を行う際に、キャッシュ・マネージャーの活動の詳細なトレースを収集するのに役立ちます。製品サポート担当者の指示により、トレースのための適切なパラメーター設定が選択できます。
<P>カーネルのトレース・ログを開始する前に、ファイル・アクセスの問題に遭遇している AFS クライアント・マシン上のキャッシュ・マネージャーを分離するようにしてください。必要であれば、このマシン上のキャッシュ・マネージャーの活動を最小にするために、ユーザーに別のマシンに移動するように指示します。トレース・ログに記録される無関係な AFS 活動記録の量を最低限にするには、<B>fstrace</B> バイナリーおよびダンプ・ファイルは AFS ではなくローカル・ディスクに配置します。
<B>fstrace</B> コマンドを発行するには、ローカル・スーパーユーザー <B>root</B> としてログインする必要があります。
<P>カーネルのトレースを開始する前に、<B>fstrace lsset</B> コマンドを発行して <B>cm</B> イベント・セットの状態をチェックします。
<PRE>   # <B>fstrace lsset cm</B>
</PRE>
<P>クライアント・マシン上でそれまでにトレースが使用可能にされていない場合、またはトレースがオフにされている場合は、次の出力が表示されます。
<PRE>   Available sets:
   cm inactive
</PRE>
<P>クライアント・マシン上でトレースがオフにされ、トレース・ログのためのカーネル・メモリーが割り振られていない場合は、次の出力が表示されます。
<PRE>   Available sets:
   cm inactive (dormant)
</PRE>
<P><B>cm</B> イベント・セットの現行の状態が<TT> 活動停止中</TT>または<TT>活動停止中 (休止中)</TT>である場合は、
<B> -active</B> フラグを指定した <B>fstrace setset</B> コマンドを発行してカーネルのトレースをオンにしてください。
<PRE>   # <B>fstrace setset cm -active</B>
</PRE>
<P>現時点でクライアント・マシン上でトレースが使用可能である場合は、次の出力が表示されます。
<PRE>   Available sets:
   cm active
</PRE>
<P>現時点でトレースが使用可能である場合は、
<B> fstrace setset</B> コマンドを使用する必要はありません。<B>fstrace clear</B> コマンドを発行して、既存のトレース・ログの内容を消去し、現行の問題に関係のない以前のトレースを除去します。
<PRE>   # <B>fstrace clear cm</B>
</PRE>
<P>イベント・セットの状態をチェックした後で、<B>fstrace lslog</B> コマンドを <B>-long</B> フラグとともに発行して、カーネル・トレース・ログの現在の状態およびサイズをチェックする必要があります。
<PRE>   # <B>fstrace lslog cmfx -long</B>
</PRE>
<P>クライアント・マシン上でそれまでにトレースが使用可能にされていない場合、または <B>cm</B> イベント・セットが以前<TT>活動状態</TT>または<TT>活動停止中</TT>に設定された場合、次に示す出力に類似した出力が表示されます。
<PRE>   Available logs:
   cmfx : 60 kbytes (allocated)
</PRE>
<P><B>fstrace</B> トレース・ユーティリティーは、デフォルトで 60 K バイトのメモリーをトレース・ログに割り振ります。カーネル・トレース・ログに割り振るトレース・ログの量は、
<B> fstrace setlog</B> コマンドを使用して設定することによって、増やしたり減らしたりすることができます。
<B> -buffersize</B> 引き数で指定する数値は、カーネル・トレース・ログに割り振られる K バイトの数を示します。カーネル・トレース・ログのサイズを 100 K バイトに増やす場合は、次のコマンドを発行します。
<PRE>   # <B>fstrace setlog cmfx</B> 100
</PRE>
<P>カーネル・トレース・ログが必要に応じて構成されたことを確認した後で、カーネル・トレース・ログをダンプするためのファイルを設定することができます。たとえば、以下の <B>fstrace dump</B> コマンドを使用して、<B>cmfx.dump.file.1</B> という名前のダンプ・ファイルを作成します。そのコマンドに <B>-follow</B> および <B>-sleep</B> 引き数を追加して、コマンドを継続プロセスとして発行します。<B> -sleep</B> 引き数の値を <I>10</I> を設定すると、
10 秒ごとにカーネル・トレース・ログの出力をファイルにダンプします。
<PRE>   # <B>fstrace dump -follow</B> cmfx <B>-file</B> cmfx.dump.file.1 <B>-sleep</B> 10
   AFS Trace Dump -
      Date: Fri Apr 16 10:54:57 1999
   Found 1 logs.
   time 32.965783, pid 0: Fri Apr 16 10:45:52 1999
   time 32.965783, pid 33657: Close 0x5c39ed8 flags 0x20 
   time 32.965897, pid 33657: Gn_close vp 0x5c39ed8 flags 0x20 (returns
   0x0) 
   time 35.159854, pid 10891: Breaking callback for 5bd95e4 states 1024
   (volume 0)
   time 35.407081, pid 10891: Breaking callback for 5c0fadc states 1024
   (volume 0)
       .                         .
       .                         .
       .                         .
   time 71.440456, pid 33658: Lookup adp 0x5bbdcf0 name g3oCKs fid (756
   4fb7e:588d240.2ff978a8.6) 
   time 71.440569, pid 33658: Returning code 2 from 19 
   time 71.440619, pid 33658: Gn_lookup vp 0x5bbdcf0 name g3oCKs (returns
   0x2) 
   time 71.464989, pid 38267: Gn_open vp 0x5bbd000 flags 0x0 (returns 0x
   0) 
   AFS Trace Dump - Completed
</PRE>
<HR><H2><A NAME="HDRWQ472" HREF="auagd002.htm#ToC_390">afsmonitor プログラムの使用</A></H2>
<A NAME="IDX7188"></A>
<P><B>afsmonitor</B> プログラムを使用すると、統計情報を収集することによって、指定したファイル・サーバーおよびキャッシュ・マネージャー・プロセスの状態およびパフォーマンスを監視することができます。1 つの使用法として、
<B>afsmonitor</B> プログラムを使用して、キャッシュ・マネージャー構成を最適に調整し、ファイル・サーバーの負荷を調整することができます。
<P><B>afsmonitor</B> プログラムを使用すると、次のタスクを実行することができます。
<UL>
<LI>1 つの場所から、任意の数のマシン上 (ローカル・セルおよび外部セルの両方) の任意の数のファイル・サーバーおよびキャッシュ・マネージャーのプロセスを監視する。
</LI><LI>監視する統計すべてに対してしきい値を設定する。ある統計の値がしきい値を超えると、<B>afsmonitor</B> プログラムは注意を促すためにその値を強調表示します。すべてのマシンに適用する、またはいくつかのマシンだけに適用するしきい値レベルを設定することができます。
</LI><LI>統計がしきい値を超えたときにプログラムまたはスクリプトを自動的に呼び出します。
</LI></UL>
<P><H3><A NAME="HDRWQ473" HREF="auagd002.htm#ToC_391">afsmonitor プログラムの実行要件</A></H3>
<A NAME="IDX7189"></A>
<P>以下のソフトウェアは、
<B>afsmonitor</B> プログラムが実行されているマシンにアクセス可能でなければなりません。
<UL>
<LI>AFS <B>xstat</B> ライブラリー。
<B>afsmonitor</B> プログラムがデータを収集するために使用します。
</LI><LI><B>curses</B> グラフィックス・パッケージ。ほとんどの UNIX で標準ユーティリティーとして提供されます。
</LI></UL>
<A NAME="IDX7190"></A>
<A NAME="IDX7191"></A>
<P><B>afsmonitor</B> 画面は、いわゆるダム端末と、端末をエミュレートするウィンドウ操作システムの両方で、正常に形式設定します。出力を最適に表示するためには、表示環境が反転表示とカーソルのアドレス指定をサポートしている必要があります。
TERM 環境変数を、正しい端末タイプ、または実際の端末タイプに類似した特性を持つ値に設定します。表示ウィンドウまたは端末には、最低 80 カラムの幅および 12 行の長さが必要です。
<A NAME="IDX7192"></A>
<A NAME="IDX7193"></A>
<A NAME="IDX7194"></A>
<P><B>afsmonitor</B> プログラムは、独立した固有の専用ウィンドウまたは端末で、フォアグラウンドで実行する必要があります。そのウィンドウまたは端末は、
<B>afsmonitor</B> プログラムの実行中は、他のいかなる活動にも使用できません。各インスタンスがそれぞれ独自の専用のウィンドウまたは端末で実行されていれば、
<B>afsmonitor</B> プログラムの任意の数のインスタンスを、単一のマシン上で実行することができます。追加のインスタンスを開始する場合、最大 3 分の時間がかかりますので注意してください。
<P>
<A NAME="IDX7195"></A>
<B> afsmonitor</B> プログラムを実行するには、特権は必要ありません。規約では、このプログラムは <B> /usr/afsws/bin</B> ディレクトリーにインストールされ、そのディレクトリーにアクセスできる人は誰でもファイル・サーバーとキャッシュ・マネージャーをモニターすることができます。何百人もがプログラムを実行するのでなければ、<B>afsmonitor</B> プログラムが統計を収集するために使用するプローブによってファイル・サーバーまたはキャッシュ・マネージャー上でかなりの負荷が発生することはありません。プログラムの使用を制限したい場合は、許可ユーザーだけが使用できるディレクトリーにプログラムのバイナリー・ファイルを移動させてください。
<P><H3><A NAME="Header_392" HREF="auagd002.htm#ToC_392">afsmonitor 出力画面</A></H3>
<A NAME="IDX7196"></A>
<P><B>afsmonitor</B> プログラムは、次の 3 つの画面でデータを表示します。
<UL>
<LI><TT>System Overview</TT>: この画面は、
<B>afsmonitor</B> プログラムが初期設定されるときに、自動的に表示されます。この画面は、監視されているマシンの数と、その中で <I>アラート</I> (しきい値を超過した統計) を持っているマシンの数を、ファイル・サーバーとキャッシュ・マネージャーに分けて表示します。続いて、この画面は監視されている各マシンごとにホスト名とアラートの数をリストし、プロセスが最後のプローブへの応答に失敗した場合は、それも示します。
</LI><LI><TT>File Server</TT>: この画面は、監視されている各ファイル・サーバー・マシンごとに、ファイル・サーバー統計を表示します。この画面は、しきい値を超過した統計を強調表示し、最後のプローブへの応答に失敗したマシンを識別します。
</LI><LI><TT>Cache Managers</TT>: この画面は、監視されている各クライアント・マシンごとに、キャッシュ・マネージャー統計を表示します。この画面は、しきい値を超過した統計を強調表示し、最後のプローブへの応答に失敗したマシンを識別します。
</LI></UL>
<P>すべての画面の各コーナーのフィールドには、以下の情報が表示されます。
<UL>
<LI>左上のコーナーには、プログラム名とバージョン番号が表示されます。
</LI><LI>右上のコーナーには、画面の名前、現行ページ番号と合計ページ数、および現行カラム番号と合計カラム数が表示されます。ページ番号 (たとえば、<TT>p. 1 of 3</TT>) は、現行ページのインデックスと、データが表示されているページ (縦方向) の合計数を示しています。カラム番号 (たとえば、<TT>c. 1 of 235</TT>) は、現行カラムの左端のインデックスと、データが表示されているカラムの合計数を示しています。
(記号 <TT>>>></TT> は右方にまだデータがあることを示し、記号 <TT>&lt;&lt;&lt;</TT> は左方にまだデータがあることを示します。)
</LI><LI>左下のコーナーには、使用可能コマンドのリストが表示されます。コマンド名の最初の文字を入力すると、そのコマンドが実行されます。現時点で使用可能なオプションだけが表示されます。たとえば、1 ページのデータしかない場合は、画面を上にスクロールする <TT>next</TT> コマンドや、下にスクロールする <TT>prev</TT> コマンドは表示されません。コマンドの説明については、表示画面のナビゲートについて説明する、次のセクションを参照してください。
</LI><LI>右下のコーナーには、プログラムがファイル・サーバー (<TT>fs</TT>) かキャッシュ・マネージャー (<TT>cm</TT>)、またはその両方をプローブした回数をレポートする、
<TT>probes</TT> フィールドが表示されます。ファイル・サーバーとキャッシュ・マネージャーのカウントは、別にすることができます。
<TT>freq</TT> フィールドは、プログラムがプローブを送信する頻度をレポートします。
</LI></UL>
<P><B>afsmonitor 表示画面のナビゲート</B>
<P>上述のように、すべての表示画面の左下のコーナーには、別の画面 (別の種類の表示、または現在表示されている統計またはマシンの続き)
へ移動するために現在使用できるコマンドの名前が表示されます。コマンドを実行するには、コマンド名の最初の文字を小文字で入力します。以下のリストに示すように、コマンドの中には、大文字で入力すると異なる結果が得られるものがあります。
<DL>
<P><DT><B><TT>cm</TT>
</B><DD><TT>Cache Managers</TT> 画面に切り替えます。
<TT>System Overview</TT> 画面および <TT>File Servers</TT> 画面でのみ、使用可能です。
<P><DT><B><TT>fs</TT>
</B><DD><TT>File Servers</TT> 画面に切り替えます。
<TT>System Overview</TT> 画面および <TT>Cache Managers</TT> 画面でのみ、使用可能です。
<P><DT><B><TT>left</TT>
</B><DD>左方に横スクロールして、現在表示されているデータ・カラムの左方のデータ・カラムを表示します。画面の左上に <TT>&lt;&lt;&lt;</TT> 記号が表示されている場合にのみ、使用可能です。大文字の <B>L</B> を入力すると、左端まで横スクロールし、最初のデータ・カラムを表示します。
<P><DT><B><TT>next</TT>
</B><DD>縦方向にスクロールダウンし、次ページのマシン名を表示します。複数のマシン・ページが存在し、現在表示されているのが最終ページでない場合にのみ、使用可能です。大文字の <B>N</B> を入力すると、最終ページまでスクロールします。
<P><DT><B><TT>oview</TT>
</B><DD><TT>System Overview</TT> 画面に切り替えます。
<TT>Cache Managers</TT> 画面および <TT>File Servers</TT> 画面でのみ、使用可能です。
<P><DT><B><TT>prev</TT>
</B><DD>縦方向にスクロールアップし、前ページのマシン名を表示します。複数のマシン・ページが存在し、現在表示されているのが最初のページでない場合にのみ、使用可能です。大文字の <B>N</B> を入力すると、最初のページまでスクロールします。
<P><DT><B><TT>right</TT>
</B><DD>右方に横スクロールして、現在表示されているデータ・カラムの右方のデータ・カラムを表示します。このコマンドは、画面の右上に <TT>>>></TT> 記号が表示されている場合にのみ、使用可能です。大文字の <B>R</B> を入力すると、右端まで横スクロールし、最後のデータ・カラムを表示します。
</DL>
<P><H3><A NAME="Header_393" HREF="auagd002.htm#ToC_393">[システム概要]画面</A></H3>
<P><TT>System Overview</TT> 画面は、
<B>afsmonitor</B> プログラムが初期設定されると自動的に表示されます。この画面は、ファイル・サーバーおよびキャッシュ・マネージャーのプロセスの状況を、現行ウィンドウに表示可能な数だけ表示します。表示されていない情報を表示するには、スクロールダウンしてください。
<P>この画面では、情報は左方のファイル・サーバー情報と、右方のキャッシュ・マネージャー情報に分かれています。各グループのヘッダーは、2 種類の情報を提供します。
<UL>
<LI>プログラムが指定されたプロセスについて監視しているマシンの数
</LI><LI>アラートの数とそれらのアラートによって影響を受けるマシンの数
(<I>アラート</I> は、統計がしきい値を超過したか、または、プロセスが最後のプローブへの応答に失敗したことを示します)
</LI></UL>
<P>その後には、監視されているマシンのリストが続きます。マシン上にアラートがあると、その数が、ホスト名の左方に、大括弧で囲まれて表示されます。あるプロセスが最後のプローブに対する応答に失敗すると、そのプロセスの左方に、
<TT>PF</TT> (プローブの失敗) という文字が、大括弧に囲まれて表示されます。
<P>以下の図は、<TT>システム概要</TT> 画面の例を示しています。
<B>afsmonitor</B> プログラムは、6 つのファイル・サーバーと 7 つのキャッシュ・マネージャーをモニターしています。ホスト <B> fs1.abc.com</B> 上のファイル・サーバー・プロセスおよびホスト <B>cli33.abc.com</B> 上のキャッシュ・マネージャーは、1 つのしきい値が超えられたことを示すため、それぞれに <TT>[ 1]</TT> がマークされています。ホスト <B>fs6.abc.com</B> 上の <TT>[PF]</TT> マーカーは、そのファイル・サーバー・プロセスが最後のプローブに応答しなかったことを示しています。
<P><B><A NAME="Figure_6" HREF="auagd003.htm#FT_Figure_6">図 6. afsmonitor [システム概要] 画面</A></B><BR>
<TABLE BORDER ><TR><TD><BR>
<B><BR><IMG SRC="overview.gif" ALT="[システム概要]画面"><BR></B><BR>
</TD></TR></TABLE>
<P><H3><A NAME="Header_394" HREF="auagd002.htm#ToC_394">[ファイル・サーバー]画面</A></H3>
<P><TT>File Servers</TT> 画面は、ファイル・サーバー統計の最初のプローブで収集された値を表示します。
<P>画面上部 (標準プログラムのバージョンおよび画面の表題のブロックのすぐ下) の要約行は、監視するファイル・サーバーの数、アラートの数、およびそれらのアラートによって影響を受けるマシンの数を指定します。
<P>最初の列には、監視されているファイル・サーバーを実行しているマシンのホスト名が常に表示されます。
<P>ホスト名の列の右側には、統計の列が、そのディスプレイまたはウィンドウの幅の中で表示可能な数だけ表示されます。各列には 10 文字分のスペースが必要です。各列の上には、統計の名前が表示されます。マシン上のファイル・サーバーが最新のプローブに応答しなかった場合は、各列にダッシュが 2 つずつ表示されます (<TT>--</TT>)。ある値が構成したしきい値を超えると、その値は反転表示で強調表示されます。割り当てられた列幅に対して値が大きすぎる場合は、同じ行の次の列に桁あふれします。
<P>利用可能なファイル・サーバー統計のリストは、<A HREF="auagd024.htm#HDRWQ843">付録 C,  afsmonitor プログラムの統計</A> を参照してください。
<P>以下の図は、前述のシステム概要画面の例に続く <TT>ファイル・サーバー</TT> 画面を示していますが、追加の 1 つのサーバー・プローブが完了しています。この例では、<B>fs1</B> 上のファイル・サーバー・プロセスが、受信したパフォーマンス呼び出しの数に対して構成したしきい値 (<B>numPerfCalls</B>) を超えているため、そのフィールドが反転表示されています。ホスト <B> fs6</B> は、プローブ 10 に応答しなかったので、すべてのフィールドにダッシュが表示されます。
<P><B><A NAME="Figure_7" HREF="auagd003.htm#FT_Figure_7">図 7. afsmonitor [ファイル・サーバー] 画面</A></B><BR>
<TABLE BORDER ><TR><TD><BR>
<B><BR><IMG SRC="fserver1.gif" ALT="[ファイル・サーバー]画面"><BR></B><BR>
</TD></TR></TABLE>
<P>[ファイル・サーバー]画面および[キャッシュ・マネージャー]画面 (次の機能グループで説明) はともに、何百もの列のデータを表示することができるため、左右にスクロールできるように設計されています。上掲の画面は左端の画面であり、画面の表題ブロックは 235 のカラムのうち 1 番目のカラムが表示されていることを示します。画面の右上隅に表示される <TT>&gt;&gt;&gt;</TT> 記号およびコマンド・ブロックの <B>right</B> コマンドは、右にスクロールするとさらにデータが存在することを示しています。(使用可能な統計の情報については、
<A HREF="auagd024.htm#HDRWQ843">付録 C,  afsmonitor プログラムの統計</A> を参照してください。)
<P><B>right</B> コマンドを実行すると、画面は以下の例に類似したものとなります。ここでは、水平スクロールの記号が左 (<TT>&lt;&lt;&lt;</TT>) と右 (<TT>>>></TT>) を指し示し、
<B>left</B> および <B>right</B> コマンドの両方が表示され、左右両方にスクロールすると追加のデータが存在することを示すことに注意してください。
<P><B><A NAME="Figure_8" HREF="auagd003.htm#FT_Figure_8">図 8. 右方に 1 ページシフトしたafsmonitor [ファイル・サーバー] 画面</A></B><BR>
<TABLE BORDER ><TR><TD><BR>
<B><BR><IMG SRC="fserver2.gif" ALT="右方に 1 ページシフトした[ファイル・サーバー]画面"><BR></B><BR>
</TD></TR></TABLE>
<P><H3><A NAME="Header_395" HREF="auagd002.htm#ToC_395">[キャッシュ・マネージャー]画面</A></H3>
<P><TT>Cache Managers</TT> 画面は、キャッシュ・マネージャー統計の最新のプローブで収集された値を表示します。
<P>画面上部 (標準プログラムのバージョンおよび画面の表題のブロックのすぐ下) の要約行は、監視するキャッシュ・マネージャーの数、アラートの数、およびそれらのアラートによって影響を受けるマシンの数を指定します。
<P>最初の列には、監視されているキャッシュ・マネージャーを実行しているマシンのホスト名が常に表示されます。
<P>ホスト名の列の右側には、統計の列が、そのディスプレイまたはウィンドウの幅の中で表示可能な数だけ表示されます。各列には 10 文字分のスペースが必要です。各列の上には、統計の名前が表示されます。マシン上のキャッシュ・マネージャーが最新のプローブに応答しなかった場合は、各列にダッシュが 2 つずつ表示されます (<TT>--</TT>)。ある値が構成したしきい値を超えると、その値は反転表示で強調表示されます。割り当てられた列幅に対して値が大きすぎる場合は、同じ行の次の列に桁あふれします。
<P>利用可能なキャッシュ・マネージャー統計のリストは、<A HREF="auagd024.htm#HDRWQ843">付録 C,  afsmonitor プログラムの統計</A> を参照してください。
<P>以下の図は、前述の[システム概要]画面に続く[キャッシュ・マネージャー]画面を示しています。この例では、ホスト <B>cli33</B> 上のキャッシュ・マネージャー・プロセスが接続できるセルの数に対して構成したしきい値 (<B>numCellsContacted</B>) を超えているため、そのフィールドが反転表示されています。
<P><B><A NAME="Figure_9" HREF="auagd003.htm#FT_Figure_9">図 9. afsmonitor [キャッシュ・マネージャー] 画面</A></B><BR>
<TABLE BORDER  WIDTH="100%"><TR><TD>
<B><BR><IMG SRC="cachmgr.gif" ALT="[キャッシュ・マネージャー]画面"><BR></B>
</TD></TR></TABLE>
<HR><H2><A NAME="HDRWQ474" HREF="auagd002.htm#ToC_396">afsmonitor プログラムの構成</A></H2>
<A NAME="IDX7197"></A>
<A NAME="IDX7198"></A>
<P><B>afsmonitor</B> プログラムをカスタマイズするには、ASCII 形式の構成ファイルを作成し、<B>-config</B> 引き数を使用して名前を付けます。構成ファイルでは以下を指定することができます。
<UL>
<LI>モニターするためのファイル・サーバー、キャッシュ・マネージャー、またはその両方
</LI><LI>表示する統計。デフォルトでは、表示には、ファイル・サーバー用の 271 統計およびキャッシュ・マネージャー用の 570 統計があります。使用可能な統計の情報については、<A HREF="auagd024.htm#HDRWQ843">付録 C,  afsmonitor プログラムの統計</A> を参照してください。
</LI><LI>統計に設定するしきい値およびしきい値を超えた場合に実行するスクリプトまたはプログラム。デフォルトでは、しきい値は定義されず、スクリプトまたはプログラムは何も実行されません。
</LI></UL>
<P>以下のリストは、構成ファイルで表示できる指示を示しています。
<DL>
<P><DT><B><TT>cm<VAR>host_name</VAR></TT>
</B><DD>キャッシュ・マネージャー統計を表示するクライアント・マシンを指定します。ファイル内の <B>cm</B> 行の順序によって、
<TT>System Overview</TT> および <TT>Cache Managers</TT> 出力画面で上から下に表示されるクライアント・マシンの順序が決まります。
<P><DT><B><TT>fs<VAR>host_name</VAR></TT>
</B><DD>ファイル・サーバー統計を表示するファイル・サーバー・マシンを指定します。ファイル内の <B>fs</B> 行の順序によって、
<TT>System Overview</TT> および <TT>File Servers</TT> 出力画面で上から下に表示されるファイル・サーバー・マシンの順序が決まります。
<P><DT><B><TT>thresh  fs | cm  <VAR>field_name</VAR>  <VAR>thresh_val</VAR>
 [<VAR>cmd_to_run</VAR>]  [<VAR>arg</VAR><SUB>1</SUB>] . . .  [<VAR>arg</VAR><SUB>n</SUB>]</TT>
</B><DD>ファイル・サーバー統計 (<B>fs</B>) またはキャッシュ・マネージャー統計 (<B>cm</B>) 用に、統計 <VAR>field_name</VAR> にしきい値 <VAR>thresh_val</VAR> を割り当てます。オプションの <VAR>cmd_to_execute</VAR> フィールドは、統計の値が <VAR>thresh_val</VAR> 未満から <VAR>thresh_val</VAR> 以上に変わる度に実行するバイナリーまたはスクリプトを指定します。
<VAR>thresh_val</VAR> を超える値間の変更では、そのバイナリーまたはスクリプトは再起動されません。オプションの <VAR>arg</VAR><SUB>1</SUB> から
<VAR>arg</VAR><SUB>n</SUB> のフィールドは、引き数として <B>afsmonitor</B> プログラムが
<VAR>cmd_to_execute</VAR> コマンドに渡す、追加の値です。
1 つまたは複数のスペースを持つフィールドがある場合は、フィールド全体を引用符で囲みます。
<P>
<P><B>fs</B>、<B>cm</B>、<VAR>field_name</VAR>、
<VAR>threshold_val</VAR>、および <VAR>arg</VAR><SUB>1</SUB> から
<VAR>arg</VAR><SUB>n</SUB> パラメーターは、
<B>thresh</B> 行の同名の値に対応しています。
<VAR>host_name</VAR> パラメーターは、統計がしきい値を超えた場所が、ファイル・サーバーかクライアント・マシンか、および、
<VAR>actual_val</VAR> パラメーターが、しきい値と同じまたはしきい値を超えている
<VAR>field_name</VAR> の実際の値かどうかを識別します。
<P>
<P><B>thresh</B> 行を使用して、
<B>fs</B> 行にリストされているすべてのファイル・サーバー・マシンか、
<B>cm</B> 行にリストされているすべてのクライアント・マシンに適用する、グローバルなしきい値を設定するか、あるいは、単一のファイル・サーバーまたはクライアント・マシンにのみ適用する、マシン固有のしきい値を設定します。
<UL>
<LI>グローバルなしきい値を設定するには、<B>thresh</B> 行を、ファイル内のすべての <B>fs</B> 行または <B>cm</B>行より前に配置します。
</LI><LI>マシン固有のしきい値を設定するには、<B>thresh</B> 行を、対応する <B>fs</B> または <B>cm</B> 行よりも下で、かつ、他のすべての <B>fs</B> または <B>cm</B> 行よりも上に配置します。グローバルなしきい値が設定されている場合、マシン固有のしきい値は、常に、対応するグローバルなしきい値を上書きします。
<B>thresh fs</B> 行を <B>cm</B> 行の直後に配置したり、
<B>thresh cm</B> 行を <B>fs</B> 行の直後に配置することは避けてください。
</LI></UL>
<P><DT><B><TT>show  fs | cm  <VAR>field/group/section</VAR></TT>
</B><DD><TT>File Servers</TT> 画面 (<B>fs</B>) または
<TT>Cache Managers</TT> 画面 (<B>cm</B>) に表示する個々の統計、統計グループ、または統計のセクションと、それらの表示順序を指定します。
<I>AFS 管理の手引き</I> 内の <B>afsmonitor</B> 統計の付録は、それぞれの統計が属するグループとセクションを指定します。必要な数の <B>show</B> 行を組み込んで画面表示を好きなようにカスタマイズし、ファイル内の任意の場所に配置します。構成ファイル内での <B>show</B> 行の上から下への順序によって、対応する画面でその統計が表示される左から右への順序が決まります。
<P>
<P>構成ファイル内に <B>show</B> 行がない場合は、キャッシュ・マネージャーとファイル・サーバーの両方のすべての統計が、画面に表示されます。同様に、<B>show fs</B> 行がない場合は、すべてのファイル・サーバー統計が <TT>File Servers</TT> 画面に表示され、
<B>show cm</B> 行がない場合は、すべてのクライアント統計が <TT>Cache Managers</TT> 画面に表示されます。
<P><DT><B>#<VAR>comments</VAR>
</B><DD>最初のシャープ (<B>#</B>) 記号によって
<B>afsmonitor</B> プログラムが無視するテキスト行の先頭です。シャープ記号は、その行の 1 番最初の列に配置する必要があります。
</DL>
<P><B>show</B> 命令の <VAR>field/group/section</VAR> フィールドに表示できる値のリストは、<A HREF="auagd024.htm#HDRWQ843">付録 C,  afsmonitor プログラムの統計</A> を参照してください。)
<P>次の例は、可能な構成ファイルを示しています。
<PRE>   thresh cm dlocalAccesses  1000000
   thresh cm dremoteAccesses  500000 handleDRemote
   thresh fs rx_maxRtt_Usec     1000
   cm client5
   cm client33
   cm client14
   thresh cm dlocalAccesses  2000000
   thresh cm vcacheMisses      10000
   cm client2
   fs fs3
   fs fs9
   fs fs5
   fs fs10
   show cm numCellsContacted
   show cm dlocalAccesses
   show cm dremoteAccesses
   show cm vcacheMisses
   show cm Auth_Stats_group
</PRE>
<P>最初の 3 つの <B>thresh</B> 命令が、すべての <B>fs</B> または <B>cm</B> 命令の前にあるため、これらの行はグローバルしきい値を設定します。
<UL>
<LI>このファイルのキャッシュ・マネージャー・プロセスはすべて、
<B>dlocalAccesses</B> 統計のしきい値を <B>1000000</B> とします
(例外として、マシン <B>client2</B> は
<B>2000000</B> を上書き値に使用)
</LI><LI>このファイルのキャッシュ・マネージャー・プロセスはすべて、
<B>dremoteAccesses</B> 統計のしきい値を <B>500000</B> とします。この値を超えると、スクリプト <B>handleDRemote</B> が起動します。
</LI><LI>このファイルのファイル・サーバー・プロセスはすべて、
<B>rx_maxRtt_Usec</B> 統計のしきい値を <B>1000</B> とします。
</LI></UL>
<P>4 つの <B>cm</B> 命令により、マシン <B>client5</B>、<B>client33</B>、
<B>client14</B>、および <B>client2</B> 上のキャッシュ・マネージャーをモニターします。最初の 3 つは、すべてのグローバルしきい値を使用します。
<P><B>client2</B> 上のキャッシュ・マネージャーは、
<B>dremoteAccesses</B> 統計に対しグローバルしきい値を使用しますが、
<B>dlocalAccesses</B> に対するものとは異なるものです。さらに、
<B>client22</B> は、
<B>vcacheMisses</B> 統計に設定されたしきい値を使用する唯一のキャッシュ・マネージャーです。
<P><B>fs</B> 命令により、マシン <B>fs3</B>、<B>fs9</B>、<B>fs5</B>、および <B>fs10</B> 上のファイル・サーバーをモニターします。これらはすべて、
<B>rx_maxRtt_Usec</B> 統計に対するグローバルしきい値を使用します。
<P><B>show fs</B> 命令がないため、
[ファイル・サーバー]画面にはすべてのファイル・サーバー統計が表示されます。[キャッシュ・マネージャー]画面には、
<B>show cm</B> 命令で指定した統計のみが左から右の順に表示されます。
<B>Auth_Stats_group</B> には複数の統計が含まれ、そのすべてが表示されます (<B>curr_PAGs</B>、<B>curr_Records</B>、<B>curr_AuthRecords</B>、<B>curr_UnauthRecords</B>、<B>curr_MaxRecordsInPAG</B>、<B>curr_LongestChain</B>、<B>PAGCreations</B>、<B>TicketUpdates</B>、<B>HWM_PAGS</B>、
<B>HWM_Records</B>、<B>HWM_MaxRecordsInPAG</B>、および <B>HWM_LongestChain</B>)。
<HR><H2><A NAME="HDRWQ475" HREF="auagd002.htm#ToC_397">afsmonitor 統計のファイルへの書き込み</A></H2>
<A NAME="IDX7199"></A>
<P><B>afsmonitor</B> プログラムを使用して収集し表示するすべての統計情報は、それらの情報を出力ファイルに書き込むことによって保管することができます。出力ファイルは、<B>afsmonitor</B> プロセスを起動するときに、
<B>-output</B> 引き数を使用して作成することができます。出力ファイルを使用すると、プロセスのパフォーマンスを長い期間に渡って追跡することができ、さらに後処理の技法を適用してシステム傾向を詳細に分析することができます。
<P><B>afsmonitor</B> プログラム出力ファイルは、
[ファイル・サーバー]画面および[キャッシュ・マネージャー]画面が提供する情報を記録する単一の ASCII ファイルです。この出力ファイルの形式は次のとおりです。
<PRE>   <VAR>time</VAR>   <VAR>host_name</VAR> <B>CM</B>|<B>FS</B>   <VAR>list_of_measured_values</VAR>
</PRE>
<P><I>list_of_measured_values</I> が、
<I>host_name</I> 上に存在するキャッシュ・マネージャー
(<B>CM</B>) またはファイル・サーバー (<B>FS</B>) のプロセスから収集された
<VAR>time</VAR> を指定します。プローブが失敗した場合は、
<I>list_of_measured_values</I> の代わりに値 <TT>-1</TT> が表示されます。
<P>このファイル形式にはいくつかの利点があります。
<UL>
<LI>このファイル形式は、標準エディターを使用して表示することができます。頻繁にこのファイルを表示する場合は、
<B>-output</B> 引き数を指定した <B>-detailed</B> フラグを使用してください。これにより、出力ファイルが読みやすい形式となります。
</LI><LI>UNIX ツールの標準セットを使用することによって、このファイルをフィルターに掛けて、必要な情報を取り出すことができます。
</LI><LI>このファイル形式は、<B>afsmonitor</B> プログラム出力の長期間の保管に適しています。
</LI></UL>
<A NAME="IDX7200"></A>
<A NAME="IDX7201"></A>
<HR><H2><A NAME="Header_398" HREF="auagd002.htm#ToC_398">afsmonitor プログラムの開始</A></H2>
<OL TYPE=1>
<LI><B>afsmonitor</B> プログラムの各インスタンスごとに個別のコマンド・シェル・ウィンドウをオープンするか、専用端末を使用します。コマンドをバックグラウンドで実行することができないため、このウィンドウまたは端末は <B>afsmonitor</B> プロセス専用にする必要があります。
</LI><LI><B>afsmonitor</B> プログラムを初期化します。メッセージ <TT> afsmonitor Collecting Statistics...</TT> に続いて [システム概要] 画面が表示され、正常に開始したことが確認されます。
<P>
<PRE>   % <B>afsmonitor</B> [<B>initcmd</B>]  [<B>-config</B> &lt;<VAR>configuration file</VAR>>]  \
                [<B>-frequency</B> &lt;<VAR>poll frequency, in seconds</VAR>>]  \
                [<B>-output</B> &lt;<VAR>storage file name</VAR>>] [<B>-detailed</B>]  \
                [<B>-debug</B> &lt;<VAR>turn debugging output on to the named file</VAR>>] \
                [<B>-fshosts</B> &lt;<VAR>list of file servers to monitor</VAR>><SUP>+</SUP>]  \
                [<B>-cmhosts</B> &lt;<VAR>list of cache managers to monitor</VAR>><SUP>+</SUP>]
   afsmonitor Collecting Statistics...
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>initcmd
</B><DD>このコマンドが AFS コマンド構文解析プログラムを使用できるようにするオプション文字列です。これは省略して無視することもできます。
<P><DT><B>-config
</B><DD>モニターするマシンおよび統計をリストする <B>afsmonitor</B> 構成ファイルのパス名を指定します。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。この引き数か、または <B>-fshosts</B> および
<B>-cmhosts</B> 引き数のどちらかあるいは両方を指定します。しきい値の設定、または画面表示のカスタマイズを行うには、構成ファイルを使用する必要があります。構成ファイルの作成に関する詳細は、<A HREF="#HDRWQ474">afsmonitor プログラムの構成</A> を参照してください。
<P><DT><B>-frequency
</B><DD>ファイル・サーバーおよびキャッシュ・マネージャーのプローブ頻度を秒単位で指定します。
<B>1</B>
から <B>86400</B> までの値が受け入れ可能で、デフォルト値は <B>60</B> です。この頻度は、ファイル・サーバーおよびキャッシュ・マネージャーの両方のプローブに適用されますが、ファイル・サーバーおよびキャッシュ・マネージャーのプローブはそれぞれ別々に開始され処理されます。あるホストに対する実際のプローブ間隔は、すべてのホストがそのプローブに応答するために必要な時間をプローブ頻度に追加したものです。
<P><DT><B>-output
</B><DD>すべての統計データを書き込む出力ファイル名を指定します。デフォルトでは、出力ファイルは何も作成されません。このファイルについての詳細は、
<A HREF="#HDRWQ475">afsmonitor 統計のファイルへの書き込み</A> を参照してください。
<P><DT><B>-detailed
</B><DD><B>-output</B> 引き数で指定した出力ファイルを、読みやすい形式にします。このフラグと <B>-output</B> 引き数を合わせてしようする必要があります。
<P><DT><B>-fshosts
</B><DD>監視する各ファイル・サーバー・プロセスが実行されているホストを指定することによって、それらのファイル・サーバー・プロセスを識別します。ホストのインターネット形式の全ホスト名、またはセルの名前サービスで使用可能な省略形を使用してホストを識別することができます。必要であれば、この引き数と <B>-cmhosts</B> を組み合わせることができますが、
<B>-config</B> 引き数とは組み合わせないでください。
<P><DT><B>-cmhosts
</B><DD>監視する各キャッシュ・マネージャー・プロセスが実行されているホストを指定することによって、それらのキャッシュ・マネージャー・プロセスを識別します。ホストのインターネット形式の全ホスト名、またはセルの名前サービスで使用可能な省略形を使用してホストを識別することができます。必要であれば、この引き数と <B>-fshosts</B> を組み合わせることができますが、
<B>-config</B> 引き数とは組み合わせないでください。
</DL>
</LI></OL>
<HR><H2><A NAME="Header_399" HREF="auagd002.htm#ToC_399">afsmonitor プログラムの停止</A></H2>
<A NAME="IDX7202"></A>
<P><B>afsmonitor</B> プログラム・セッションを終了するには、
&lt;<B>Ctrl-c</B>> 割り込みシグナルまたは大文字の <B>Q</B> を入力します。
<HR><H2><A NAME="HDRWQ476" HREF="auagd002.htm#ToC_400">xstat データ収集機能</A></H2>
<A NAME="IDX7203"></A>
<A NAME="IDX7204"></A>
<A NAME="IDX7205"></A>
<A NAME="IDX7206"></A>
<A NAME="IDX7207"></A>
<A NAME="IDX7208"></A>
<A NAME="IDX7209"></A>
<A NAME="IDX7210"></A>
<A NAME="IDX7211"></A>
<A NAME="IDX7212"></A>
<A NAME="IDX7213"></A>
<P><B>afsmonitor</B> プログラムは、<B>xstat</B> データ収集機能を使用して、
(<B>afsmonitor</B> プログラムが) その機能を実行するために使用するデータを収集して計算します。また、<B>xstat</B> 機能を使用して、独自のデータ表示プログラムを作成することもできます。その場合は、次のことを考慮してください。ファイル・サーバーは、ファイル・サーバーの RPC ルーチンを呼び出すすべてのプログラムをキャッシュ・マネージャーとみなします。したがって、ファイル・サーバー・インターフェースを直接呼び出すすべてのプログラムは、キャッシュ・マネージャーの呼び出しインターフェースをエクスポートする必要があります。この呼び出しプログラムは、必要なコールバック状態をエミュレートすることができる必要があり、ファイル・サーバーからの定期的なキープアライブ・メッセージに応答する必要があります。さらに、呼び出しプログラムはその収集データを取りまとめることができる必要があります。
<P><B>xstat</B> 機能は、ユーザー・レベルのアプリケーションで使用できる 2 つの C 言語ライブラリーで構成されます。
<UL>
<LI><B>/usr/afsws/lib/afs/libxstat_fs.a</B> は、
1 つまたは複数の実行中のファイル・サーバー・プロセスの情報を取りまとめる呼び出しをエクスポートします。
</LI><LI><B>/usr/afsws/lib/afs/libxstat_cm.a</B> は、
1 つまたは複数の実行中のキャッシュ・マネージャーの情報を収集する呼び出しをエクスポートします。
</LI></UL>
<P>このライブラリーを使用すると、発呼者は以下を登録することができます。
<UL>
<LI>検査するファイル・サーバーまたはキャッシュ・マネージャーの集合。
</LI><LI>ファイル・サーバーまたはキャッシュ・マネージャーに対してデータをプローブする頻度。
</LI><LI>データを収集するたびに呼び出すユーザー指定のルーチン。
</LI></UL>
<P>ライブラリーは、軽いプロセス、コールバック対話、およびデータ収集に関連するタイミングの問題すべてを処理します。ユーザーは、データを処理するだけで済みます。
<P><H3><A NAME="Header_401" HREF="auagd002.htm#ToC_401">libxstat ライブラリー</A></H3>
<A NAME="IDX7214"></A>
<A NAME="IDX7215"></A>
<P><B>libxstat_fs.a</B> および <B>libxstat_cm.a</B> ライブラリーは、コールバック要件およびファイル・サーバーとキャッシュ・マネージャーのデータの収集に関連する複雑な問題を扱います。システム管理者は、必要なデータを累算する方法のみを提供します。それぞれの <B>xstat</B> ライブラリーは、3 つのルーチンをインプリメントします。
<UL>
<LI>初期化 (<B>xstat_fs_Init</B> および <B> xstat_cm_Init</B>) は、定期的な収集およびデータの処理を調整します。
</LI><LI>即時プローブ (<B>xstat_fs_ForceProbeNow</B> および <B>xstat_cm_ForceProbeNow</B>) は、即時のデータの収集を強制し、このプローブが終了すると、収集は通常のプローブ・スケジュールに戻ります。
</LI><LI>クリーンアップ (<B>xstat_fs_Cleanup</B> および <B>xstat_cm_Cleanup</B>) は、すべての接続を終了させ、すべてのデータ収集のトレースをメモリーから削除します。
</LI></UL>
<P>
<A NAME="IDX7216"></A>
<A NAME="IDX7217"></A>
<A NAME="IDX7218"></A>
<A NAME="IDX7219"></A>
<A NAME="IDX7220"></A>
ファイル・サーバーおよびキャッシュ・マネージャーは、それぞれがクライアントが取り出すことができるデータ収集を定義します。データ収集は、単に、1 つの単位として収集することができる関連する数値の集合です。たとえば、ファイル・サーバーおよびキャッシュ・マネージャーは、それぞれがプロファイルおよびパフォーマンスのデータ収集を定義します。プロファイル収集は、障害分析のために、サーバー内で呼び出される内部機能の回数のカウントを保持します。パフォーマンス収集は、パフォーマンス分析のために、特にファイル・サーバーの内部ディスク I/O 統計およびキャッシュ・マネージャーのキャッシュ効果の数値を記録します。
<P>
<A NAME="IDX7221"></A>
<A NAME="IDX7222"></A>
<A NAME="IDX7223"></A>
<B>xstat</B>、そのライブラリー、ライブラリー内のルーチンについての追加の使用法を提供する詳細な仕様書については、
AFS 製品サポートに連絡してください。
<P><H3><A NAME="Header_402" HREF="auagd002.htm#ToC_402">xstat のサンプル・コマンド</A></H3>
<A NAME="IDX7224"></A>
<A NAME="IDX7225"></A>
<A NAME="IDX7226"></A>
<A NAME="IDX7227"></A>
<A NAME="IDX7228"></A>
<P>AFS は、次の2 つの下位レベルのサンプル・コマンド、
<B>xstat_fs_test</B> および <B>xstat_cm_test</B> を提供します。これらのコマンドを使用すると、<B>xstat</B> 機能を試すことができます。これらのコマンドは、情報を取りまとめ、ファイル・サーバーまたはキャッシュ・マネージャーの使用可能なデータ収集を表示します。これらのサンプル・コマンドは、
<B>xstat</B> を使用して収集できるデータ・タイプの例を提供するためのものであり、実際のデータの収集に使用することはできません。
<A NAME="IDX7229"></A>
<A NAME="IDX7230"></A>
<A NAME="IDX7231"></A>
<A NAME="IDX7232"></A>
<P><H4><A NAME="Header_403">サンプル xstat_fs_test コマンドの使用</A></H4>
<OL TYPE=1>
<LI><B>xstat_fs_test</B> サンプル・コマンドを発行して、
<B>libxstat_fs.a</B> ライブラリー内のルーチンをテストし、ファイル・サーバー・プロセスに関連したデータ収集を表示します。このコマンドは、フォアグラウンドで実行します。
<P>
<PRE>   % <B>xstat_fs_test</B> [<B>initcmd</B>]  \
                   <B>-fsname</B> &lt;<VAR>File Server name(s) to monitor</VAR>><SUP>+</SUP>  \
                   <B>-collID</B> &lt;<VAR>Collection(s) to fetch</VAR>><SUP>+</SUP>  [<B>-onceonly</B>]  \
                   [<B>-frequency</B> &lt;<VAR>poll frequency, in seconds</VAR>>]  \
                   [<B>-period</B> &lt;<VAR>data collection time, in minutes</VAR>>] [<B>-debug</B>] 
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>xstat_fs_test
</B><DD>完全な形式で入力する必要があります。
<P><DT><B>initcmd
</B><DD>このコマンドが AFS コマンド構文解析プログラムを使用できるようにするオプション文字列です。これは省略して無視することもできます。
<P><DT><B>-fsname
</B><DD>ファイル・サーバー・プロセスを監視する各ファイル・サーバー・マシンのインターネット・ホスト名です。
<P><DT><B>-collID
</B><DD>戻される各データ収集を指定します。指定するデータ収集は、このコマンドがファイル・サーバーについて取りまとめるデータのタイプおよび量を定義します。データは、事前定義されたデータ構造 (データ構造の詳細情報について前に参照した仕様書を参照してください)
で戻されます。
<P>
<P>2 つの値が受け入れ可能です。
<UL>
<LI><B>1</B> は、ファイル・サーバーに関連する種々の内部パフォーマンス統計を報告します (たとえば、vnode キャッシュ項目および<B> Rx</B> プロトコル活動など)。
</LI><LI><B>2</B> は、値 <B>1</B> が提供する内部パフォーマンス統計のすべて、およびファイル・サーバーについてのいくつかの追加の詳細なパフォーマンスの数値を報告します (たとえば、ファイル・サーバーの RPC に関する最小、最大、および累積統計、完了するまでの時間、および成功する数など)。
</LI></UL>
<P><DT><B>-onceonly
</B><DD>コマンドが 1 回だけ統計を取りまとめるようにします。コマンドによって、30 秒ごとに統計のためにファイル・サーバーのプローブが実行されるようにするためには、このオプションを省略します。このオプションを省略するには、&lt;<B>Ctrl-c</B>> 割り込みシグナルを使用して、適宜コマンドを停止します。
<P><DT><B>-frequency
</B><DD>プログラムがファイル・サーバーへのプローブを開始する頻度を秒単位で設定します。この引き数を省略した場合は、デフォルトは 30 秒です。
<P><DT><B>-period
</B><DD>終了するまでにユーティリティーを実行する時間の長さを秒単位で設定します。この引き数を省略した場合は、デフォルトは 10 分です。
<P><DT><B>-debug
</B><DD>コマンド実行時に追加情報を表示します。
</DL>
</LI></OL>
<A NAME="IDX7233"></A>
<A NAME="IDX7234"></A>
<A NAME="IDX7235"></A>
<A NAME="IDX7236"></A>
<P><H4><A NAME="Header_404">サンプル xstat_cm_test コマンドの使用</A></H4>
<OL TYPE=1>
<LI><B>xstat_cm_test</B> サンプル・コマンドを発行して、
<B>libxstat_cm.a</B> ライブラリー内のルーチンをテストし、キャッシュ・マネージャーに関連したデータ収集を表示します。このコマンドは、フォアグラウンドで実行します。
<P>
<PRE>   % <B>xstat_cm_test</B> [<B>initcmd</B>]  \
                   <B>-cmname</B> &lt;<VAR>Cache Manager name(s) to monitor</VAR>><SUP>+</SUP>  \
                   <B>-collID</B> &lt;<VAR>Collection(s) to fetch</VAR>><SUP>+</SUP> \
                   [<B>-onceonly</B>] [<B>-frequency</B> &lt;<VAR>poll frequency, in seconds</VAR>>]  \
                   [<B>-period</B> &lt;<VAR>data collection time, in minutes</VAR>>] [<B>-debug</B>] 
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>xstat_cm_test
</B><DD>完全な形式で入力する必要があります。
<P><DT><B>initcmd
</B><DD>このコマンドが AFS コマンド構文解析プログラムを使用できるようにするオプション文字列です。これは省略して無視することもできます。
<P><DT><B>-cmname
</B><DD>キャッシュ・マネージャーを監視する各クライアント・マシンのホスト名です。
<P><DT><B>-collID
</B><DD>戻される各データ収集を指定します。指定するデータ収集は、このコマンドがキャッシュ・マネージャーについて取りまとめるデータのタイプおよび量を定義します。データは、事前定義されたデータ構造 (データ構造の詳細情報について前に参照した仕様書を参照してください)
で戻されます。
<P>
<P>2 つの値が受け入れ可能です。
<UL>
<LI><B>0</B> は、キャッシュ・マネージャーが起動されてから異なる内部キャッシュ・マネージャー・ルーチンが呼び出された回数に関するプロファイル情報を提供します。
</LI><LI><B>1</B> は、キャッシュ・マネージャーに関連する種々の内部パフォーマンス統計を報告します
(たとえば、キャッシュがどの程度効果的に使用されているか、セル内およびセル間のデータ・アクセスの量についての統計)。
</LI><LI><B>2</B> は、値 <B>1</B> が提供する内部パフォーマンス統計のすべて、およびキャッシュ・マネージャーについてのいくつかの追加の詳細なパフォーマンスの数値を報告します (たとえば、キャッシュ・マネージャーが送信する RPC の数およびその呼び出しが完了するまでの時間についての統計、およびデータ・アクセスに関連する認証、アクセス、および PAG 情報などについての統計)。
</LI></UL>
<P><DT><B>-onceonly
</B><DD>コマンドが 1 回だけ統計を取りまとめるようにします。コマンドによって、統計のために 30 秒ごとにキャッシュ・マネージャーのプローブが実行されるようにするためには、このオプションを省略します。このオプションを省略するには、&lt;<B>Ctrl-c</B>> 割り込みシグナルを使用して、適宜コマンドを停止します。
<P><DT><B>-frequency
</B><DD>プログラムがファイル・サーバーへのプローブを開始する頻度を秒単位で設定します。この引き数を省略した場合は、デフォルトは 30 秒です。
<P><DT><B>-period
</B><DD>終了するまでにユーティリティーを実行する時間の長さを秒単位で設定します。この引き数を省略した場合は、デフォルトは 10 分です。
<P><DT><B>-debug
</B><DD>コマンド実行時に追加情報を表示します。
</DL>
</LI></OL>
<HR><H2><A NAME="HDRWQ477" HREF="auagd002.htm#ToC_405">AIX ファイル・サーバー上の AFS イベントの監査</A></H2>
<A NAME="IDX7237"></A>
<A NAME="IDX7238"></A>
<A NAME="IDX7239"></A>
<A NAME="IDX7240"></A>
<P>AIX ファイル・サーバー上の AFS イベントは、監査情報を AFS から AIX の検査システムへ転送する AFS 機構を使用して監査することができます。以下に示す AFS イベントの汎用クラスを監査することができます。特定の AFS 監査イベントの完全なリストは、<A HREF="auagd025.htm#HDRWQ846">付録 D,  AIX 監査イベント</A> を参照してださい。
<UL>
<LI>認証および識別イベント
</LI><LI>セキュリティー・イベント
</LI><LI>特権必須イベント
</LI><LI>オブジェクト作成および削除イベント
</LI><LI>属性変更イベント
</LI><LI>プロセス制御イベント
</LI></UL>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">この節は、AIX の検査システムについて知識があることを前提とします。詳細については、使用する AIX のバージョンの <I>AIX システム管理の手引き</I> を参照してください。
</TD></TR></TABLE>
<P><H3><A NAME="Header_406" HREF="auagd002.htm#ToC_406">AFS 監査を AIX ファイル・サーバー上で構成する</A></H3>
<P>ディレクトリー <B>/usr/afs/local/audit</B> には、
AFS イベントを監査するために行う AIX ファイル・サーバーの構成に必要な情報を含む 3 つのファイルがあります。
<UL>
<LI><B>events.sample</B> ファイルには、監査することができる AFS イベントに関する情報が含まれています。このファイルの内容は、対応する AIX のイベント・ファイル
(<B>/etc/security/audit/events</B>) に統合します。
</LI><LI><B>config.sample</B> ファイルは、
AFS 監査イベントの 6 つのクラスおよびそれらのクラスを構成するイベントを定義します。このファイルは、ローカル・スーパーユーザー <B>root</B> として実行するファイル・サーバーに対して監査を行う AFS 監査イベントのクラスも定義します。このファイルの内容は、対応する AIX 構成ファイル (<B>/etc/security/audit/config</B>) に統合する必要があります。
</LI><LI><B>objects.sample</B> ファイルには、監査ファイルについての情報のリストが含まれます。ローカル・ファイル・スペース内のファイルのみを監査してください。このファイルの内容は、対応する AIX オブジェクト・ファイル (<B>/etc/security/audit/objects</B>) に統合する必要があります。
</LI></UL>
<P>これらのファイルを適切に構成して、AFS 関連情報を組み込んだら、
AIX 検査システムを使用して監査を開始し終了します。
<P><H3><A NAME="Header_407" HREF="auagd002.htm#ToC_407">AFS 監査の使用可能</A></H3>
<OL TYPE=1>
<LI>AFS イベントを監査する各ファイル・サーバー上のファイル <B>/usr/afs/local/Audit</B> 内に、次のストリングを作成します。
<P>
<PRE>      <B>AFS_AUDIT_AllEvents</B>
</PRE>
</LI><LI><B>bos restart</B> コマンド (<B>-all</B> フラグを指定する) を発行して、各ファイル・サーバー上のすべてのサーバー・プロセスを停止して、再始動します。このコマンドの使用に関する説明については、<A HREF="auagd009.htm#HDRWQ225">プロセスの停止および即時の再始動</A> を参照してください。
</LI></OL>
<P><H3><A NAME="Header_408" HREF="auagd002.htm#ToC_408">AFS 監査の使用不可能化</A></H3>
<OL TYPE=1>
<LI>もはや AFS イベントの監査をする必要がない、各ファイル・サーバー上のファイル <B>/usr/afs/local/Audit</B> の内容を削除します。
</LI><LI><B>bos restart</B> コマンド (<B>-all</B> フラグを指定する) を発行して、各ファイル・サーバー上のすべてのサーバー・プロセスを停止して、再始動します。このコマンドの使用に関する説明については、<A HREF="auagd009.htm#HDRWQ225">プロセスの停止および即時の再始動</A> を参照してください。
</LI></OL>
<P><HR><B>&#91; <A HREF="#Top_Of_Page">ページのトップ</A> &#124; <A HREF="auagd012.htm">前ページ</A> &#124; <A HREF="auagd014.htm">次ページ</A> &#124; <A HREF="auagd002.htm#ToC">目次</A> &#124; <A HREF="auagd026.htm#HDRINDEX">索引</A> &#93;</B> 
<!-- Begin Footer Records  ========================================== -->
<P><HR><B> 
<br>(C) <A HREF="http://www.ibm.com/">IBM Corporation 2000.</A>  All Rights Reserved<!-- 991224 --> 
</B> 
<!-- End Footer Records  ============================================ -->
<A NAME="Bot_Of_Page"></A>
</BODY></HTML>
