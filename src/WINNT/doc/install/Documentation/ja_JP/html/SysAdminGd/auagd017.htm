<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3//EN">
<HTML><HEAD>
<TITLE>管理の手引き</TITLE>
<!-- Begin Header Records  ========================================== -->
<!-- E:\IDWB\TEMP\idwt2118\AUAGD000.SCR converted by idb2h R4.2 (359) -->
<!-- ID Workbench Version (OS2) on 24 Dec 1999 at 12:07:32            -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Shift_JIS">
<META HTTP-EQUIV="updated" CONTENT="Fri, 24 Dec 1999 12:07:30">
<META HTTP-EQUIV="review" CONTENT="Sun, 24 Dec 2000 12:07:30">
<META HTTP-EQUIV="expires" CONTENT="Mon, 24 Dec 2001 12:07:30">
</HEAD><BODY>
<!-- (C) IBM Corporation 2000. All Rights Reserved    --> 
<BODY bgcolor="ffffff"> 
<!-- End Header Records  ============================================ -->
<A NAME="Top_Of_Page"></A>
<H1>管理の手引き</H1>
<P>
<A NAME="IDX7578"></A>
<HR><H1><A NAME="HDRWQ602" HREF="auagd002.htm#ToC_535">uss コマンド組によるユーザー・アカウントの作成と削除</A></H1>
<P><B>uss</B> コマンド組を使用すると、
AFS ユーザー・アカウントの作成と削除を迅速かつ容易に行うことができます。単一アカウントの作成は、<B>uss add</B> コマンドを使って、単一アカウントの削除は、
<B>uss delete</B> コマンドを使って、また、複数アカウントの作成と削除は、
<B>uss bulk</B> コマンドを使って実行できます。
<P>単一の <B>uss add</B> コマンドまたは <B>uss bulk</B> コマンドが、完全な AFS ユーザー・アカウントを作成できます。その理由は、
<B>uss</B> コマンド・インタープリターは、ユーザーが多くのアカウント・コンポーネントの構成を事前定義するテンプレート・ファイルを参照するからです。<B>uss delete</B> コマンドは、ユーザー・アカウントの多くのアカウント・コンポーネントを削除しますが、テンプレート・ファイルを使用しません。
<P>また、<B>uss</B> 組は、ユーザーのサイトに固有のアカウントの作成と削除の一部を実行するために、ユーザーが書き込むシェル・スクリプトまたはほかのプログラムを容易に取り込みます。<B>uss</B> コマンドの実行と同時にスクリプトまたはプログラムを自動的に起動するには、テンプレート・ファイルまたはバルク入力ファイルにある適切な命令を使用します。この章のさまざまな機能グループでは、スクリプトの可能な使用方法について説明します。
<P><B>uss</B> コマンドを使用すると必要なステップの多くが自動化され、正しい順序で行われるので、このメソッドを使用してアカウントを作成および削除することをお勧めします。あるいは、一連の別のコマンドをさまざまな AFS サーバーに対して発行することによって、ユーザー・アカウントを作成できますが、ただしこの場合は uss コマンドを使用する場合よりもレコード保持に注意が必要です。説明については、<A HREF="auagd018.htm#HDRWQ663">ユーザー・アカウントの管理</A>を参照してください。
<HR><H2><A NAME="HDRWQ603" HREF="auagd002.htm#ToC_536">命令の概要</A></H2>
<P>この章では、指示されたコマンドを使用して次のタスクを行う方法について説明します。
<BR>
<TABLE WIDTH="100%">
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%">単一ユーザー・アカウントを削除する
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%"><B>uss add</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%">単一ユーザー・アカウントを削除する
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%"><B>uss delete</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%">複数アカウントの追加と削除を行う
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%"><B>uss bulk</B>
</TD></TR></TABLE>
<HR><H2><A NAME="HDRWQ607" HREF="auagd002.htm#ToC_537">uss コマンド組の概要</A></H2>
<P><B>uss</B> 組内のコマンドは、AFS ユーザー・アカウントの作成と削除を自動化するのに、以下のように役立ちます。
<UL>
<LI><B>uss add</B> コマンドは、アカウントを１つずつ順次に作業して、アカウントのすべてのコンポーネントを作成する。このコマンドは、アカウント構成を定義するテンプレート・ファイルを参照します。
</LI><LI><B>uss delete</B> コマンドは、アカウントを 1 つずつ作業して、アカウントの主要コンポーネントを削除する。このコマンドは、テンプレート・ファイルを使用しないので、追加のタスクを手動で実行する必要があります。
</LI><LI><B>uss bulk</B> コマンドは、複数アカウントの作成と削除ができる。このコマンドは、バルク入力ファイルを参照します。バルク入力ファイルは、アカウントの作成と削除の命令をいくつでも、プロセスをさらに自動化するためのほかの命令と一緒に含むことができます。
</LI></UL>
<A NAME="IDX7579"></A>
<A NAME="IDX7580"></A>
<P><H3><A NAME="Header_538" HREF="auagd002.htm#ToC_538">AFS ユーザー・アカウントのコンポーネント</A></H3>
<P>AFS ユーザー・アカウントは、多くのコンポーネントを持つことができます。必須のコンポーネントは 2 つだけであり、保護データベースおよび認証データベースの項目です。ほかのコンポーネントは、以下の機能性と使用可能度を追加します。次の情報は、対応のセクション <A HREF="auagd018.htm#HDRWQ663">ユーザー・アカウントの管理</A> にも掲載されていますが、読者の便宜のためにここでも説明します。
<UL>
<LI>ユーザー名 (AFS により認証されるときに使用する名前) を定義し、その名前を、AFS サーバーがユーザーを参照するときに内部的に使用する番号であるユーザーの AFS ユーザー ID (AFS UID) にマップする
<I>保護データベース項目</I>。また、保護データベースは、ユーザーが所属するグループも追跡します。詳細については、<A HREF="auagd019.htm#HDRWQ722">保護データベースの管理</A> を参照してください。
</LI><LI>暗号キーとして使用するのに適したスクランブル形式でユーザーの AFS パスワードをレコードする、
<I>認証データベース項目</I>。
</LI><LI>ユーザーのホーム・ディレクトリー内のすべてのファイルを、ファイル・サーバー・マシンの単一パーティション上にまとめて保管するホーム・<I>ボリューム</I>。ボリュームには、そのサイズを制限する関連した<VAR>割り当て</VAR>があります。ボリュームについての詳細は、<A HREF="auagd010.htm#HDRWQ229">ボリュームの管理</A> を参照してください。
</LI><LI>ユーザーのボリュームのコンテンツを AFS ファイル・スペース内で可視およびアクセス可能にし、ユーザーのホーム・ディレクトリーの役割を果たす<I>マウント・ポイント</I>。マウント・ポイントについての詳細は、<A HREF="auagd010.htm#HDRWQ269">ボリュームの取り付けについて</A> を参照してください。
</LI><LI>ユーザーのファイル管理を可能にする、ホーム・ディレクトリーの<I>アクセス制御リスト (ACL)</I>
およびディレクトリーの所有権 (UNIX の <B>ls -ld</B> コマンドによって表示されるように)。
AFS ファイル保護についての詳細は、
<A HREF="auagd020.htm#HDRWQ773">アクセス制御リスト (ACL) の管理</A>を参照してください。
</LI><LI>ユーザーの、キャッシュを介した AFS ファイルにログインおよびアクセスを可能にする、各クライアント・マシンの<I>ローカル・パスワード・ファイル項目</I> (<B>/etc/passwd</B> ファイルまたは同等のファイルにある)。この章の後のセクションでは、ローカル・パスワード・ファイルの項目について、さらに詳しく説明します。
</LI><LI>アカウントの使用をより容易にする、ほかの<I>構成ファイル</I>。たとえば、ユーザーのログインとログアウトをもっと容易にしたり、電子メールの受信やプリントに役立つファイルなど。
</LI></UL>
<A NAME="IDX7581"></A>
<A NAME="IDX7582"></A>
<P><H3><A NAME="HDRWQ608" HREF="auagd002.htm#ToC_539">uss コマンドに対する特権要件</A></H3>
<P><B>uss</B> コマンドを正常に発行するには、標準の AFS 管理権がすべて必要です。すなわち、<B>system:administrators</B> グループ内のメンバーシップ、関係のあるすべてのサーバー・マシン上の <B>/usr/afs/etc/UserList</B> ファイルへの包含、および認証データベース項目上の <TT>ADMIN</TT> フラグです。管理権についての詳細は、
<A HREF="auagd021.htm#HDRWQ797">管理権限の管理</A>を参照してください。
<A NAME="IDX7583"></A>
<A NAME="IDX7584"></A>
<A NAME="IDX7585"></A>
<A NAME="IDX7586"></A>
<A NAME="IDX7587"></A>
<A NAME="IDX7588"></A>
<A NAME="IDX7589"></A>
<P><H3><A NAME="HDRWQ609" HREF="auagd002.htm#ToC_540">操作のエラーおよび中断の回避と回復</A></H3>
<P>複雑なオペレーションの例に違わず、アカウントの作成と削除操作が完了前に停止するにはいくつかのあり得る原因があります。
<B>uss</B> コマンドを発行する前に以下の点を確認することにより、いくつかの一般的な原因を容易に回避することができます。
<UL>
<LI><A HREF="#HDRWQ608">uss コマンドに対する特権要件</A>で説明するように、操作の完了に必要な管理権をすべて所有していることを確認します。
<B>uss add</B>、<B>uss delete</B>、および<B>uss bulk</B> コマンドの使用方法の説明には、この確認もステップの 1 つとして含まれています。
</LI><LI>構文の誤りがないか、有効な値を使用しているかについて、テンプレートおよびバルク入力ファイルを修正します。詳しくは、<A HREF="#HDRWQ618">uss テンプレート・ファイルの作成</A> および <A HREF="#HDRWQ661">バルク入力ファイルの組み立て</A> を参照してください。
</LI><LI>ネットワーク、サーバー・マシン、またはサーバー・プロセスの障害に気付いている場合は、
<B>uss</B> コマンドを発行してはいけません。<B>uss</B> 操作は非常に多くの AFS コンポーネントに影響するので、障害があるときにこのコマンドは成功しそうにありません。
</LI></UL>
<P>オペレーションが停止するエラーを回避する別の方法は、<B>-dryrun</B> フラグを、実際のコマンドで使用されるほかの引き数と組み合わせて、<B>uss</B> コマンドを事前表示することです。
<B>uss</B> コマンド・インタープリターは、実際にコマンドを実行せずにそのコマンドによって実行されるアクションを画面上でトレースします。
<P><B>-dryrun</B> フラグを使用すると、オペレーションを停止する可能性のある多くの基本的エラー、特にコマンド行、テンプレート・ファイル、またはバルク入力ファイルにおける構文の誤りによって起きるエラーが明らかになります。ただし、このフラグによって、すべての起こり得るエラーが捕そくできるわけではありません。コマンド・インタープリターは、追跡しているアクションを実際に実行しようとしているわけではないからです。たとえば、ボリューム・サーバーの障害は、
<B>-dryrun</B> フラグが組み込まれているときには、必ずしもボリューム作成ステップを停止する必要はありません。コマンド・インタープリターが実際にサーバーを接続していないからです。このような障害は、実際の作成オペレーションを停止するだけです。
<A NAME="IDX7590"></A>
<A NAME="IDX7591"></A>
<A NAME="IDX7592"></A>
<P><B>uss</B> コマンド・インタープリターが、オペレーションを停止させる原因とはならないエラー条件に遭遇すると、通常、文字列 <TT>uss: Warning:</TT> で始まるメッセージをプリントし、停止を避けるために取ろうとしているアクションを説明します。たとえば、ユーザーの保護データベース項目が既にある場合、以下のメッセージが標準出力ストリームに表示されます。
<PRE>   uss: Warning: User '<VAR>user</VAR>' already in the protection database
   The uid for user '<VAR>user</VAR>' is <VAR>AFS UID</VAR>
</PRE>
<P><TT>Warning</TT> は、もっと重大なエラー・メッセージには表示されません。その代わり、重大なエラー・メッセージは、なぜコマンド・インタープリターが、要求されたアクションを実行できないのかという理由を説明します。これらのエラーのすべてが <B>uss</B> オペレーションを停止させる原因となるわけではありませんが、やはり、訂正アクションを必要とします。たとえば、親ディレクトリーの ACL 上で、必要なアクセス権を欠如している場合、あるいは、
<B>V</B> 命令の <VAR>mount_point</VAR> フィールド内のマウント・ポイント・パス名の形式が間違っている場合、マウント・ポイントを作成する試みは失敗します。けれども、このエラーは、その後、テンプレート内の命令が、サブディレクトリーまたはファイルを、存在していないマウント・ポイントの下でインストールしようとするまでは、作成オペレーションを停止させる原因にはなりません。
<P>コマンド・シェル・プロンプトが、エラー・メッセージの後、直接に戻る場合は、一般的に、そのエラーは重大で、オペレーションを停止します。アカウントの作成中、または削除中にエラーにより停止した場合、回復するための最良の方法は、原因を見つけて修正し、その後、同じ <B>uss</B> コマンドを再発行します。
<A NAME="IDX7593"></A>
<A NAME="IDX7594"></A>
<A NAME="IDX7595"></A>
<A NAME="IDX7596"></A>
<A NAME="IDX7597"></A>
<A NAME="IDX7598"></A>
<P>以下のリストでは、ユーザー・アカウントのコンポーネントが存在している場合に、アカウント作成コマンド (<B>uss add</B> コマンド、または、バルク入力ファイルに <B>add</B> 命令が含まれている場合は <B>uss bulk</B> コマンド) を再発行するとどうなるかについて説明しています。
<UL>
<LI>保護データベース項目がすでに存在している場合、メッセージは、その存在を確認し、関連した AFS UID を指定する。
</LI><LI>認証データベース項目がすでに存在している場合、メッセージがその存在を確認する。
</LI><LI>ボリュームおよび関連したボリューム・ロケーション・データベース (VLDB) 項目がすでに存在している場合、メッセージがそれらの存在を確認する。けれども、コマンドが最後に実行した以降に、テンプレート <B>V</B> 命令内の関係のあるフィールドのどれかに変更があった場合、
<B>uss</B> コマンド・インタープリターは、ボリュームの割り当て量、マウント・ポイント、または ACL を変更します。<VAR>mount_point</VAR> フィールドの値に変更があった場合、コマンド・インタープリターは、新規マウント・ポイントを作成しますが、既存マウント・ポイントを除去しません。
</LI><LI>テンプレート <B>A</B> 命令内のフィールドに変更があった場合、
<B>uss</B> コマンド・インタープリターは、コメントせずに変更する。
</LI><LI>テンプレート・ファイル内の <B>D</B>、<B>E</B>、
<B>F</B>、<B>L</B>、または <B>S</B> 命令によって定義されたディレクトリー、ファイル、またはリンクがすでに存在する場合、
<B>uss</B> コマンド・インタープリターは、既存の要素をテンプレート定義に準拠した要素と置き換える。ある要素を上書きするかどうかを確認するためのプロンプトを、
<B>uss</B> コマンド・インタープリターに出させるかどうかを制御するには、以下のように <B>-overwrite</B> フラグを <B>uss add</B>、または <B>uss bulk</B> コマンドに対して使用します。
<UL>
<LI><B>-overwrite</B> フラグを組み込むと、コマンド・インタープリターは、確認のための質問をせずに自動的にすべての要素を上書きする。
</LI><LI>このフラグを省略すると、コマンド・インタープリターは、各アカウントごとにプロンプトを出して、そのアカウントに関連したすべての要素を上書きするかどうかを尋ねる。
</LI></UL>
</LI><LI>コマンド・インタープリターは常に、テンプレート・ファイル内の <B>X</B> 命令を再実行する。コマンドの結果がすでに保持されている場合、これを再発行することは、
<B>uss</B> コマンドのコンテキストの外側でそれを再発行するのと同じ効果を持ちます。
</LI></UL>
<P><B>uss delete</B> コマンドが、すでに削除されているアカウント・コンポーネントを参照するとどうなるかということを以下に説明します。
<UL>
<LI>ボリュームおよび VLDB 項目がもはや存在しない場合、メッセージがそれらの不在を確認する。
</LI><LI>認証データベース項目がもはや存在しない場合、メッセージがその不在を確認する。
</LI></UL>
<A NAME="IDX7599"></A>
<HR><H2><A NAME="HDRWQ610" HREF="auagd002.htm#ToC_541">uss によるローカル・パスワード・ファイル項目の作成</A></H2>
<P>セルの AFS のファイル・スペースへの認証済みアクセスを入手するには、ユーザーは有効な AFS トークンを持っているだけではなく、AFS クライアント・マシンのローカル・パスワード・ファイル (<B>/etc/passwd</B> または同等のファイル) に項目を持っていなければなりません。この機能グループでは、ユーザーの AFS UID が、ローカル・パスワード・ファイルにリストされる UNIX UID と一致することが重要である理由、ファイルのパスワード・フィールドに指定する適切な値、および単一ソースのパスワード・ファイルを作成する方法の概要について説明します。
<P>テンプレート・ファイルの <B>E</B> 命令を使用して、アカウント作成の一部としてローカル・パスワード・ファイルの項目を自動生成する方法については、<A HREF="#HDRWQ613">共通送信元パスワード・ファイルの作成</A> を参照してください。
<P>次の情報は、対応のセクション <A HREF="auagd018.htm#HDRWQ663">ユーザー・アカウントの管理</A> にも掲載されていますが、読者の便宜のためにここでも説明します。
<A NAME="IDX7600"></A>
<A NAME="IDX7601"></A>
<A NAME="IDX7602"></A>
<A NAME="IDX7603"></A>
<A NAME="IDX7604"></A>
<P><H3><A NAME="HDRWQ611" HREF="auagd002.htm#ToC_542">一致する AFS と UNIX UID の割り当て</A></H3>
<P>AFS ユーザー ID 番号 (AFS UID) と UNIX UID が一致する場合、ユーザー・アカウントは管理と使用が最も容易です。AFS 文書内のすべての命令は、2つの UID が一致することを前提としています。
<P>AFS と UNIX の UID を同じにする最も基本的な理由は、UNIX の <B>ls -l</B> および <B>ls -ld</B> コマンドによって報告される所有者名が AFS のファイルやディレクトリーでも意味をなすようになることです。
UNIX の標準の慣習に従って、ファイル・サーバーは、AFS のファイルやディレクトリーの所有者フィールドの番号ではなくユーザー名、つまり、所有者の AFS UID を記録します。<B>ls l</B> コマンドを発行すると、ファイル・サーバーは AFS 保護データベースではなくローカル・パスワード・ファイルのマッピングに従って UID をユーザー名に変換します。
AFS と UNIX の UID が一致しない場合、<B>ls -l</B>コマンドは予期せぬ (正しくない) 所有者を報告します。ローカル・パスワード・ファイルが同じ UNIX UID を異なる名前にマップする場合は、異なるクライアント・マシン上では、出力が異なることがあります。
<P>以下のようなさまざまなタイプのユーザーのアカウントを作成しているときには、指示された機能グループでの勧めに従って、AFS および UNIX UID を一致させてください。
<UL>
<LI>UNIX UID をすでに持っているユーザーに対して AFS アカウントを作成する場合は、機能グループ <A HREF="#HDRWQ614">uss による既存の UNIX アカウントの変換</A> を参照する。
</LI><LI>セル内のユーザーが既存の UNIX アカウントを持っているけれども、
AFS アカウントを作成する対象のユーザーがまだ持っていない場合は、保護サーバーに AFS UID を自動的に割り当てさせるのが最良の方法である。AFS UID と既存の UNIX UID の重複を避けるには、
<A HREF="auagd019.htm#HDRWQ771">AFS UID および GID カウンターの表示および設定</A> の説明に従って、保護データベースの <TT>max user id</TT> カウンターを UNIX UID の最大値よりも高く設定する。
</LI><LI>既存の UNIX アカウントを持つユーザーがいない場合は、保護サーバーがデフォルト値か設定した <TT>max user id</TT> カウンターから開始して自動的に AFS UID を割り振るのを許可する。
</LI></UL>
<A NAME="IDX7605"></A>
<A NAME="IDX7606"></A>
<P><H3><A NAME="HDRWQ612" HREF="auagd002.htm#ToC_543">ローカル・パスワード・ファイルにパスワードを指定</A></H3>
<P>AFS 仕様に変更されたログイン・ユーティリティーのインストールと構成を行う場合は、
AFS による認証が最も簡単です。AFS は、ユーザーをローカル・ファイル・システムに記録することと、
AFS トークンを入手することを 1 つのステップで行います。この場合、ローカル・パスワード・ファイルは、もはや、ほとんどの状況下で、ユーザーのログインする能力を制御しません。なぜなら、
AFS 仕様に変更されたログイン・ユーティリティーは、ユーザーが正しい AFS パスワードを提示したかどうかについて、ローカル・パスワード・ファイルを調べないからです。しかし、それでも、パスワード・ファイル項目内のパスワード・フィールド (通常、
2 番目のフィールド) を以下の方法で使用して、ログインと認証を制御できます。
<UL>
<LI>アスタリスク ( * ) をフィールド内に入れて、ローカル・ログインおよび AFS による認証の両方を防止する。これは、主に、特定のユーザーがマシンにログインするのを阻止したいときなど、緊急の場合に有用です。
</LI><LI>標準の 13 文字以外の任意の長さの文字列をフィールドに入れて、ユーザーが正しい AFS パスワードを提示しなかった場合に、ローカル・ファイル・システムへのログインを阻止する。これは、ローカル AFS アカウントを持っている人だけに、マシンへのログインを許可したい場合に適切です。これを行うには、単一の <B>X</B> またはほかの文字が最も容易に認識できる方法です。
</LI><LI>不正な AFS パスワードを指定した後でも、ユーザーがローカル・ファイル・システムにログインできるようにするには、標準 UNIX パスワード設定コマンド (<B>passwd</B> またはこれに相当するもの) を発行して、標準 UNIX 暗号化パスワードをフィールドに記録します。
</LI></UL>
<P>AFS 仕様に変更したログイン・ユーティリティーを使用しない場合、標準の UNIX パスワードを、ユーザーが使用するすべてのクライアント・マシンのローカル・パスワード・ファイルに入れなければなりません。ユーザーは、ローカル・ファイル・システムだけにログインし、次に、
<B>klog</B> コマンドを発行して AFS と認証しなければなりません。ローカル・パスワード・ファイルと認証・データベースのパスワードが同じであれば、最も単純ですが、これは必須ではありません。
<A NAME="IDX7607"></A>
<A NAME="IDX7608"></A>
<A NAME="IDX7609"></A>
<A NAME="IDX7610"></A>
<A NAME="IDX7611"></A>
<P><H3><A NAME="HDRWQ613" HREF="auagd002.htm#ToC_544">共通送信元パスワード・ファイルの作成</A></H3>
<P>この機能グループでは、<B>uss</B> コマンドを使用してユーザー・アカウントを作成しているときに、ローカル・パスワード・ファイルの共通ソース・バージョンを作成する方法について説明します。ステップの順序は、次のとおりです。
<OL TYPE=1>
<LI>ローカル・パスワード・ファイル項目の形式の 1 行ファイルを作成するテンプレート・ファイルに、
<B>E</B> 命令を組み込みます。
</LI><LI>1 行ファイルを、ローカル・パスワード・ファイルの共通ソース・バージョンに組み込みます。このファイルは AFS に保管すると意味をなします。このステップの自動化については、以下の 2 つの例を参照してください。
</LI><LI>おそらく、AFS <B>package</B> ユーティリティーを使用して、<A HREF="auagd016.htm#HDRWQ566">パッケージ・プログラムを使用したクライアント・マシンの構成</A>で説明するように、共通パスワード・ファイルを各クライアント・マシンに配布します。
</LI></OL>
<P>たとえば、ABC Corporation が使用するテンプレートでは、次の <B>E</B> 命令を組み込んで、<B>passwd_</B><VAR>username</VAR> という名前のファイルを <B>/afs/.abc.com/common/etc/newaccts</B> ディレクトリーに作成します (テンプレート・ファイルの全内容と <B>E</B> コマンドの詳細な説明は、それぞれ、<A HREF="#HDRWQ635">uss テンプレート例</A>と <A HREF="#HDRWQ640">E 命令による 1 行ファイルの作成</A> にあります)。
<PRE>   E /afs/.abc.com/common/etc/newaccts/passwd_$USER 0644 root  \
        "$USER:X:$UID:11:$NAME:$MTPT:/bin/csh"
</PRE>
<P><B>smith</B> というユーザー名を持ったユーザー、Joe L. Smith に対して、この命令は、<B>passwd_smith</B> と呼ばれるファイルを作成します。このファイルは、以下の行を含みます。
<PRE>   smith:X:1205:11:Joe L. Smith:/afs/abc.com/usr/usr1/smith:/bin/csh
</PRE>
<P>この方法で作成されたセットのファイルを、共通送信元パスワード・ファイルに組み込む方法としては、おそらく、シェル・スクリプトが最も容易な方法です。そこで、2 つのサンプル・シェル・スクリプトが登場します。プロセスをさらに自動化するには、ファイル・サーバー・マシンの <B>/usr/afs/local/BosConfig</B> に <B>cron</B>プロセスを作成して、シェル・スクリプトを毎日一定の時刻に実行するようにします。詳細は、<A HREF="auagd009.htm#HDRWQ217">新規プロセスを作成および開始する方法</A> を参照してください。
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">以下のスクリプト例は、示唆にすぎません。それらを使用するか、あるいは、類似のスクリプトを作成するためにそれらをモデルとする場合は、ユーザーが欲している結果をそのスクリプトがもたらすことを、できれば、テスト環境でテストしなければなりません。
</TD></TR></TABLE>
<P><B>C シェル・スクリプトの例</B>
<P>最初の例は、ABC Corporation のセルに適した単純な C シェルです。この例では、<B>/afs/.abc.com/common/uss/newaccts</B> ディレクトリーで検出された個々のファイルを、アルファベット順にソートして、
<B>/afs/.abc.com/common/etc</B> ディレクトリーで検出された新規バージョンのグローバル・パスワード・ファイルに組み込みます。現行バージョンを <B>.old</B> 拡張子を付けて保管し、その後、組み込みが終了すると、個々のファイルを除去します。
<PRE>   set  dir = /afs/.abc.com/common
   cat  $dir/uss/newaccts/passwd_* $dir/etc/passwd  >!  $dir/etc/passwd.new
   mv  $dir/etc/passwd  $dir/etc/passwd.old
   sort  $dir/etc/passwd.new  >  $dir/etc/passwd
   rm  $dir/etc/passwd.new  $dir/uss/newaccts/passwd_*
</PRE>
<P><B>Bourne シェル・スクリプトの例</B>
<P>2 番目の、さらに複雑な例は、Bourne シェル・スクリプトです。これは、最初、グローバル・パスワード・ファイルに組み込まれる新規 <B>passwd_</B><VAR>username</VAR> ファイルが存在することを検査します。これは実行中に、各新規項目がまだ存在していないことを検査します。より短い C シェルの例と同様に、この例は、
<B>/afs/.abc.com/common/uss/newaccts</B> ディレクトリーで検出された個々のファイルを、
<B>/afs/.abc.com/common/etc</B> ディレクトリーで検出された新規バージョンのグローバル <B>passwd</B> ファイルに組み込みます。
<PRE>   #!/bin/sh
   DESTDIR=/afs/.abc.com/common/uss/newaccts
   cd  $DESTDIR
   DEST=/afs/.abc.com/common/etc
   cp /afs/.abc.com/common/etc/passwd   /afs/.abc.com/common/uss/newaccts/passwd
   echo "copied in passwd file."
   PASSWD=/afs/.abc.com/common/uss/newaccts/passwd
   ENTRIES=`ls passwd_*`
   case $ENTRIES in 
   "")
        echo No new entry found to be added to passwd file
        ;;
   *)
        echo  "Adding new users to passwd file."
        for  i  in  $ENTRIES
        do
           cat  $i  |  awk  -F:  '{print $1  >  "foo"}'
           USER=`cat foo`
           case  `egrep  -e  \^$USER\: $PASSWD` in 
           "")
                   echo  adding  $USER
                   cat  $i  >>  $PASSWD
                   ;;
           *)
                   echo  $USER already in passwd file
                   ;;
           esac
           mv  $i  ../old.passdir/done_${i}
        done
        cd  /afs/.abc.com/common/uss/newaccts
        echo  "sorting password file"
        sort  ${PASSWD}  >  ${PASSWD}.sorted
        echo  "installing files"     
        install  ${PASSWD}.sorted ${DEST}/passwd
        echo  "Password file is built, sorted and installed."
        ;;
   esac
</PRE>
<A NAME="IDX7612"></A>
<A NAME="IDX7613"></A>
<A NAME="IDX7614"></A>
<HR><H2><A NAME="HDRWQ614" HREF="auagd002.htm#ToC_545">uss による既存の UNIX アカウントの変換</A></H2>
<P>このセクションでは、既存の UNIX アカウントがあり、そのアカウントを AFS アカウントに変換する場合に検討しなければならない 3 つの主要な問題について説明します。
<P><H3><A NAME="HDRWQ615" HREF="auagd002.htm#ToC_546">UNIX と AFS UID を一致させる</A></H3>
<P>前述のように、AFS ユーザーは、自分が承認済みユーザーとして AFS ファイル・スペースにアクセスするすべてのクライアント・マシン上のローカル・パスワード・ファイル内に項目を持っていなければなりません。UNIX UID と AFS UID が一致する場合は、管理と使用が両方とも、より単純になります。既存の UNIX アカウントを変換するとき、以下の 2 つの代替があります。
<UL>
<LI>AFS UID を既存の UNIX UID に一致させる。この場合、ユーザーは、AFS アカウントを作成するときに、AFS UID を自分で割り当てる必要があります。
<UL>
<LI><B>uss add</B> コマンドを使用する場合は、<B>-uid</B> 引き数を組み込む。
</LI><LI><B>uss bulk</B> コマンドを使用する場合は、バルク入力ファイル内の <B>add</B> 命令の <VAR>uid</VAR> フィールドに、望みの UID を指定する。
</LI></UL>
<P>
<P>ユーザーの UNIX UIDを保存しているので、ローカル・パスワード・ファイル項目内の UID を更新する必要がない。しかし、AFS 仕様に変更されたログイン・ユーティリティーを使用している場合は、項目のパスワード・フィールドの変更が必要なことがあります。パスワード・フィールドの値が、
AFS 仕様に変更されたログイン・ユーティリティーによるログインにどのように影響するかについての説明は、<A HREF="#HDRWQ610">uss によるローカル・パスワード・ファイル項目の作成</A>を参照してください。
<P>
<P>現在または将来、既存の UNIX UID アカウントを持っていない新規ユーザーに対して AFS アカウントを作成する必要がある場合は、新規 AFS UID が既存の UNIX UID のどれとも競合しないことを確認する必要がある。最も簡単な方法は、保護データベースの <TT>max user id</TT> カウンターを、既存の最大 UNIX UID よりも高い値に設定することです。<A HREF="auagd019.htm#HDRWQ771">AFS UID および GID カウンターの表示および設定</A> を参照してください。
</LI><LI>既存の UNIX UID を変更して、保護サーバーが自動的に割り当てる新規 AFS UID に一致させる。
<P>
<P>AFS アカウントを作成するとき、保護サーバーに AFS UID を自動的に割り振らせることができる。アカウント作成中のローカル・パスワード・ファイルの新規項目の作成についての説明は、
<A HREF="#HDRWQ610">uss によるローカル・パスワード・ファイル項目の作成</A>を参照してください。
<P>
<P>UNIX UID を変更することには、1 つの欠点がある。つまり、
AFS ユーザーになる前にユーザーがローカル・ファイル・システム内で所有していたファイルとディレクトリーの所有者フィールドに、前の UID が含まれたままであるということです。
<B>ls -l</B> および <B>ls -ld</B> コマンドによって、正しい所有者を表示したい場合、ファイルをローカル・ファイル・システムに残すか AFS に移動するかにかかわらず、<B>chown</B> コマンドを使用して、値をユーザーの新規 UID に変更します。<A HREF="#HDRWQ617">ローカル・ファイルを AFS に移動する</A> を参照してください。
</LI></UL>
<P><H3><A NAME="HDRWQ616" HREF="auagd002.htm#ToC_547">パスワード・フィールドを適切に設定する</A></H3>
<P>既存の UNIX アカウントは、すでに、パスワード・フィールド内の (スクランブル) パスワードと共に、項目をローカル・パスワード・ファイル内に持っています。ログイン・ユーティリティーのタイプによっては、以下のようにパスワード・フィールド内の値の変更が必要になる場合があります。
<UL>
<LI>ログイン・ユーティリティーが AFS で使用するように変更されていない場合は、実際のパスワードがローカル・パスワード・ファイル項目のパスワード・フィールド内に (スクランブル形式で) 表示されねばならない。
</LI><LI>ログイン・ユーティリティーが AFS で使用するように変更されている場合は、それぞれの値がログイン・ユーティリティーの動作に異なる影響を与える、有効な値の中から 1 つを選択することができる。<A HREF="#HDRWQ610">uss によるローカル・パスワード・ファイル項目の作成</A> を参照してください。
</LI></UL>
<P>実際のパスワードをローカル・パスワード・ファイル項目に入れることを選択する場合は、
<A HREF="#HDRWQ640">E 命令による 1 行ファイルの作成</A> で説明したように、テンプレート・ファイル・ファイル内の <B>E</B> 命令を使用して、ダミー・パスワードを定義することができます。ユーザーに UNIX <B>passwd</B> コマンドを発行させて、ダミーを実際のシークレット・パスワードと置き換えます。
<P><H3><A NAME="HDRWQ617" HREF="auagd002.htm#ToC_548">ローカル・ファイルを AFS に移動する</A></H3>
<P>既存の UNIX アカウントは、おそらく、マシンのローカル・ファイル・システムに保管されたファイルとディレクトリーを所有しており、これらは、新しいホーム・ボリュームに転送すると意味をなします。最も容易なメソッドは、それらを、AFS クライアント・マシンのローカル・ディスク上に移動することであり、その後、UNIX <B>mv</B> コマンドを使用して、それらをユーザーの新規 AFS ホーム・ディレクトリーに転送します。
<P>ファイルとディレクトリーを AFS に移動する際、それらのモード・ビットの意味が変更することに留意してください。
AFS では、モード・ビットの 2 番目と 3 番目のセット (グループおよびその他) を無視し、最初のセット (所有者ビット) は直接使用しません。ただし、ACL 上の項目と一緒の場合にのみ使用します (詳細は、
<A HREF="auagd020.htm#HDRWQ796">AFS が UNIX モード・ビットを解釈する方法</A> を参照してください)。
ACL がファイルまたはディレクトリーを少なくともモード・ビットと同じくらい安全に保護することを確認してください。
<P>ユーザーの UNIX UID を変更して、新規 AFS UID に一致させることを選択した場合は、
UNIX ファイルとディレクトリーの所有権も変更しなければなりません。AFS に常駐している <B>system:administrators</B> グループのメンバーだけが、
<B>chown</B> コマンドをファイルおよびディレクトリー上で発行することができます。
<A NAME="IDX7615"></A>
<A NAME="IDX7616"></A>
<A NAME="IDX7617"></A>
<HR><H2><A NAME="HDRWQ618" HREF="auagd002.htm#ToC_549">uss テンプレート・ファイルの作成</A></H2>
<P><B>uss</B> コマンドによるユーザー・アカウントの作成は、一般的に、個別のコマンドよりも便利です。アカウントの作成プロセスは、密着して制御することができますが、
<B>uss</B> テンプレート・ファイルにより、アカウント作成の多くの局面を事前に定義することができます。テンプレートを構成してから <B>uss</B> コマンドを発行するので、構成の詳細を注意深く検討し、構文エラーを訂正する時間があります。以下のリストは、テンプレートを使用するその他の利点について要約しています。
<UL>
<LI>アカウント・コンポーネントの作成と削除を行う正しい順序、または各コマンドの引き数の順序を覚える必要がない。このことは、エラーの可能性を削減する。
</LI><LI>同じ情報を何度もタイプする必要がない。かわりに、コマンド行での入力をできるだけ少なくできるように、定数および変数をテンプレート・ファイルに作成しておくことができます。<A HREF="#HDRWQ620">テンプレート・ファイル内での定数と変数の使用</A> を参照してください。
</LI><LI>さまざまなタイプのユーザーに対して、さまざまなテンプレートを作成することができます。指定したユーザーのコンポーネントとの差異を覚える代わりに、<B>uss add</B> または <B>uss bulk</B>コマンドを発行するときに、適切なテンプレートを指定します。
</LI><LI><A HREF="#HDRWQ619">3 つのタイプのユーザー・アカウントの作成</A> で説明するように、テンプレートに特定の情報を組み込みまたは削除することによって、AFS アカウントの 3 つのタイプ (認証専用、基本、またはフル) のいずれかを作成することができます。
</LI></UL>
<P>以下のリストは、テンプレート・ファイルに表示できる命令について説明し、詳細を説明している後の機能グループを特定します。ここでは、それらは、さまざまなタイプの命令間の依存関係を正しく処理するために、通常、最適な順序で表示されます。
<DL>
<P><DT><B><B>G</B>
</B><DD><B>uss</B> コマンド・インタープリターが、新規に作成されたホーム・ディレクトリーを均等に配布する親ディレクトリーのセットの 1 つを定義する。対応するテンプレート・ファイル変数 $AUTOを、
<B>V</B> 命令の <VAR>mount_point</VAR> フィールドに入れます。
<A HREF="#HDRWQ636">G 命令によるユーザー・ホーム・ディレクトリーの均等配布</A> および <A HREF="#HDRWQ637">V 命令によるボリュームの作成</A> を参照してください。
<P><DT><B><B>V</B>
</B><DD>ボリュームを作成し、それをユーザーのホーム・ディレクトリーとして、
AFS ファイル・スペース内の指定された位置にマウントし、ボリュームの割り当て量を設定し、所有者および ACL をディレクトリーに対して定義する。この命令は、空 (ゼロ長) でないすべてのテンプレート内に表示されねばなりません。<A HREF="#HDRWQ637">V 命令によるボリュームの作成</A> を参照してください。
<P><DT><B><B>D</B>
</B><DD>ディレクトリー、それも通常は、新規ホーム・ディレクトリーのサブディレクトリーを作成し、そのモード・ビット、所有者、および ACL を設定する。<A HREF="#HDRWQ638">D 命令によるディレクトリーの作成</A> を参照してください。
<P><DT><B><B>F</B>
</B><DD>プロトタイプをコピーすることによってファイルを作成し、そのモード・ビットおよび所有者を設定する。
<A HREF="#HDRWQ639">F 命令によるプロトタイプからのファイルの作成</A> を参照してください。
<P><DT><B><B>E</B>
</B><DD>命令自身のコンテンツ内にコピーすることによって単一行ファイルを作成し、その後、ファイルのモード・ビットおよび所有者を設定する。
<A HREF="#HDRWQ640">E 命令による 1 行ファイルの作成</A> を参照してください。
<P><DT><B><B>L</B>
</B><DD>ハード・リンクを作成する。<A HREF="#HDRWQ641">L および S 命令によるリンクの作成</A> を参照してください。
<P><DT><B><B>S</B>
</B><DD>記号リンクを作成する。<A HREF="#HDRWQ641">L および S 命令によるリンクの作成</A> を参照してください。
<P><DT><B><B>A</B>
</B><DD>パスワードおよび認証の試みに制限を課すことによってアカウント・セキュリティーを向上させる。<A HREF="#HDRWQ642">A 命令によるアカウント・セキュリティーの強化</A> を参照してください。
<P><DT><B><B>X</B>
</B><DD>コマンドを実行する。<A HREF="#HDRWQ643">X 命令によるコマンド実行</A> を参照してください。
</DL>
<A NAME="IDX7618"></A>
<A NAME="IDX7619"></A>
<A NAME="IDX7620"></A>
<P><H3><A NAME="HDRWQ619" HREF="auagd002.htm#ToC_550">3 つのタイプのユーザー・アカウントの作成</A></H3>
<P><B>uss add</B> および <B>uss bulk</B> コマンドを使用して、機能性のレベルが異なる 3 つのタイプのアカウントを作成できます。タイプの詳細な説明については、
<A HREF="auagd007.htm#HDRWQ73">AFS ユーザー・アカウントの作成</A>を参照してください。以下のリストでは、それぞれのタイプに対するテンプレートの構成方法を説明します。
<UL>
<LI>認証専用アカウントを作成するには、空 (ゼロ長) のテンプレート・ファイルを作成します。このようなアカウントには、認証データベースの項目と保護データベースの項目の 2 つのコンポーネントがあります。
</LI><LI><A HREF="#HDRWQ636">G 命令によるユーザー・ホーム・ディレクトリーの均等配布</A> で説明したように、基本アカウントを作成するには <B>V</B> 命令を組み込み、ホーム・ディレクトリーを均等に配布したい場合は <B>G</B> 命令を組み込みます。認証データベースと保護データベースのほかに、このタイプのアカウントには、所有者および ACL セットによって適切にホーム・ディレクトリーに取り付けられたボリュームを適切に組み込みます。
</LI><LI>フルアカウントを作成するには、<B>V</B> および <B>G</B> 命令に加えて、
<B>D</B>、<B>E</B>、<B>F</B>、
<B>L</B>、および <B>S</B> の各命令を適切に組み込みます。このタイプのアカウントは、ログイン、印刷、およびメール送信などの基本機能に対する構成ファイルを組み込みます。いくつかの有用なタイプの構成ファイルについての説明は、
<A HREF="auagd007.htm#HDRWQ76">新規の AFS アカウントでの標準ファイルの作成</A> を参照してください。
</LI></UL>
<A NAME="IDX7621"></A>
<A NAME="IDX7622"></A>
<A NAME="IDX7623"></A>
<A NAME="IDX7624"></A>
<P><H3><A NAME="HDRWQ620" HREF="auagd002.htm#ToC_551">テンプレート・ファイル内での定数と変数の使用</A></H3>
<P><B>uss</B> テンプレート・ファイルの各命令はいくつかのフィールドを持ち、それらのフィールドによって作成する要素の特性が定義されます。たとえば、<B>D</B> 命令のフィールドは、ディレクトリーのパス名、所有者、モード・ビット、および ACL を定義します。
<P>3 つのタイプの値をフィールドに入れることができます。つまり、変数、定数、またはその 2 つの組み合わせです。適切な値は、<B>uss add</B> コマンドにどの引き数を与えるかということ、またはバルク入力ファイル内のどのフィールドに <B>add</B> 命令を組み込むかによって異なります。
<P>アカウント構成の局面がすべてのユーザーに対して同じ場合は、文字列を挿入することによって、定数値を該当フィールド内に定義する。たとえば、10,000 KB のスペース割り当て量をすべてのユーザー・ボリュームに割り当てるには、文字列 <B>10000</B> を <B>V</B> 命令の <VAR>quota</VAR> フィールドに入れます。
<P>一方、アカウント構成の局面がユーザーごとに異なる場合は、変数を該当フィールドに書き込みます。この場合、各アカウントを作成するときに、変数に対して値を与えなければなりません。これは、対応する引き数を <B>uss add</B> コマンドに与えるか、あるいは値を、バルク入力ファイルの <B>add</B> 命令の対応するフィールドに入れるかのいずれかで行います。
<P><A HREF="#TBLWQ621">表 3</A> に要約するように、<B>uss</B> コマンドの組は、テンプレート変数のセットを定義します。テンプレート変数のセットのそれぞれが自己の値に対して、対応する送信元を持っています。用途についての説明は、各テンプレートの説明に関する、次の機能グループ (<A HREF="#HDRWQ637">V 命令によるボリュームの作成</A>
から <A HREF="#HDRWQ643">X 命令によるコマンド実行</A>まで) を参照してください。
<BR>
<P><B><A NAME="TBLWQ621" HREF="auagd004.htm#FT_TBLWQ621">表 3. uss テンプレート変数の値の送信元</A></B><BR>
<TABLE WIDTH="100%" BORDER>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%"><B>変数</B>
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%"><B>値の送信元</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$AUTO
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%">テンプレートの直前の <B>G</B> 命令
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$MTPT
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%"><B>V</B> 命令内の場合は、<B>uss add</B> コマンドへの <B>-mount</B> 引き数か、バルク入力ファイルの <B>add</B> 命令の <VAR>mount_point</VAR> フィールド。後続の命令内の場合は <B>V</B> 命令の <VAR>mount_point</VAR> フィールド
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$NAME
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%">与えられていれば、<B>uss add</B> コマンドへの <B>-realname</B> 引き数か、バルク入力ファイルの
<B>add</B> 命令の <VAR>mount_point</VAR> フィールド。それ以外の場合は <B>uss add</B> コマンドへの
<B>-user</B> 引き数か、バルク入力ファイルの <B>add</B> 命令の <VAR>username</VAR> フィールド
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$PART
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%"><B>uss add</B> コマンドへの <B>-partition</B> 引き数か、バルク入力ファイルの <B>add</B> 命令の <VAR>partition</VAR> フィールド
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$PWEXPIRES
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%"><B>uss add</B> コマンドへの <B>-pwexpires</B> 引き数か、バルク入力ファイルの <B>add</B> 命令の <VAR>password_expires</VAR> フィールド
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$SERVER
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%"><B>uss add</B> コマンドへの <B>-server</B> 引き数か、バルク入力ファイルの <B>add</B> 命令の <VAR>file_server</VAR> フィールド
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$UID
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%">与えられていれば、<B>uss add</B> コマンドへの <B>-uid</B> 引き数か、バルク入力ファイルの <B>add</B> 命令の <VAR>uid</VAR> フィールド。それ例外の場合は保護サーバーによる自動割り当て
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$USER
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%"><B>uss add</B> コマンドへの <B>-user</B> 引き数か、バルク入力ファイルの <B>add</B> 命令の <VAR>username</VAR> フィールド
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$1 から $9
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%"><B>uss add</B> コマンドへの <B>-var</B> 引き数か、バルク入力ファイルの <B>add</B> 命令の <VAR>var1</VAR> から <VAR>var9</VAR> までのフィールド
</TD></TR></TABLE>
<P>変数の共通使用は、ユーザーのボリュームを収納しているファイル・サーバーとパーティションを定義することです。この定義作業は、しばしば、ユーザーごとに異なります。$SERVER 変数を <B>V</B> 命令の <VAR>server</VAR> フィールドに入れ、また、$PART 変数をその <VAR>partition</VAR> フィールドに入れます。<B>uss add</B> コマンドを使用する場合は、希望の値に
<B>-server</B> および <B>-partition</B> 引き数を与えます。
<B>uss bulk</B> コマンドを使用する場合は、バルク入力ファイル内の各ユーザーの <B>add</B> 命令の <VAR>file_server</VAR> フィールドと <VAR>partition</VAR> フィールドに希望の値を指定します。
<A NAME="IDX7625"></A>
<A NAME="IDX7626"></A>
<P>$1 から $9 までの変数により、アカウントの他の特徴をカスタマイズすることができます。これらの変数に値を与えるには、
<B>uss add</B> コマンドに対する <B>-var</B> 引き数を使うか、またはバルク入力ファイルの <B>add</B> 命令の該当フィールドに値を入れます。
<B>-var</B> 引き数は、それに対する各インスタンスが 2 つの部分、つまり、番号インデックスおよび値を、スペースで分離されて持っているという点で、ほかの引き数とは異なります。番号変数の使用例については、
<A HREF="#HDRWQ637">V 命令によるボリュームの作成</A> の <VAR>mount_point</VAR> および <VAR>quota</VAR> フィールドの説明を参照してください。
<P>アカウント構成のいくつかの局面が、一部、定数、一部、変数である場合は、変数と定数を命令フィールドで結合できます。たとえば、ABC Corporation が、ユーザー・ボリュームを <B>/afs/abc.com/usr</B> ディレクトリーにマウントするとしましょう。パス名のユーザー・ボリュームの部分は定数ですが、マウント・ポイントとホーム・ディレクトリーの名前はユーザーのユーザー名であり、このユーザー名が $USER 変数に対応していますアカウントをこの方法で構成するには、<B>V</B> 命令の <VAR>mount point</VAR> フィールド内の定数文字列と変数を以下のように結合します。
<PRE>   /afs/abc.com/usr/$USER
</PRE>
<P>次に、<B>uss add</B> コマンドに <B> -user</B> 引き数を使用するか、バルク入力ファイル内の各ユーザーの
<B>add</B> 命令の<VAR> username</VAR> フィールドを使用するかして、$USER 変数の値を設定します。
<A NAME="IDX7627"></A>
<A NAME="IDX7628"></A>
<P><H3><A NAME="HDRWQ632" HREF="auagd002.htm#ToC_552">テンプレート・ファイルを入れる場所</A></H3>
<P>テンプレートは、<B>uss</B> コマンド・インタープリターに対して使用可能でなければなりません。なぜなら、テンプレートは、たとえ、それが認証専用アカウントの作成に適切なゼロ長ファイルであっても、
<B>uss add</B> または <B>uss bulk</B> コマンドを実行するからです。
<P><B>uss add</B> コマンドまたは <B>uss bulk</B> コマンドに <B>-template</B> 引き数を与えない場合、コマンド・インタープリターは次の各ディレクトリー順に <B>uss.template</B> という名前のファイルを検索します。
<OL TYPE=1>
<LI>現行作業ディレクトリー
</LI><LI><B>/afs/<VAR>cellname</VAR>/common/uss</B> (<VAR>cellname</VAR> は、ローカルセルです)
</LI><LI><B>/etc</B>
</LI></OL>
<P>異なる名前を持ったテンプレート・ファイルを使用するか、あるいは、異なるディレクトリーに保管するされたテンプレート・ファイルを <B>uss add</B> または <B>uss bulk</B> コマンドに対する <B>-template</B> 引き数に組み込みます。ファイル名だけを与えると、コマンド・インタープリターは、ファイル名を、直前にリストされたディレクトリー内で探します。パス名とファイル名を与えると、コマンド・インタープリターは、指定されたディレクトリーだけを探し、部分的パス名を現行作業ディレクトリーに対する相対と解釈します。
<A NAME="IDX7629"></A>
<A NAME="IDX7630"></A>
<P><H3><A NAME="HDRWQ633" HREF="auagd002.htm#ToC_553">テンプレートの組み立てについてのいくつかの一般規則</A></H3>
<P>この機能グループでは、テンプレート・ファイルを組み立てるときに従う、いくつかの一般的規則について要約します。各命令の構文の定義については、次のセクション (<A HREF="#HDRWQ636">G 命令によるユーザー・ホーム・ディレクトリーの均等配布</A> から <A HREF="#HDRWQ643">X 命令によるコマンド実行</A> まで) を参照してください。
<UL>
<LI>変数がテンプレート内の別の場所にある要素から値を取得する場合、参照前に定義を行う必要があります。命令行を以下の順序で書き込むと、通常、結果として、変数の正しいレゾリューションになります。
<P>
<P><B>G  V  D  F  E  L  S  A X</B>
</LI><LI>各命令内のフィールドは、命令の構文定義によって指定された順序で表示されねばなりません。これに関しては、次の機能グループで、各命令について説明します。フィールドを省略することはできません。各フィールドをその近隣のフィールドから、1 つまたは複数のスペースで分離します。
</LI><LI>パス名を指定するとき、フルパス名を与えます。パス名の一部は、現行作業ディレクトリー (<B>uss</B> コマンドが発行されたディレクトリー) との関連で解釈されます。意図しない結果をもたらす可能性があります。
</LI><LI>各命令は、テンプレート・ファイル内の単一行上に表示されねばならず、改行文字 (<B>&lt;Return></B>) は、命令の末尾にだけ位置します。この本では、いくつかの命令の例が複数の行上に表示されることがありますが、それは、ただ、読みやすいようにしたものです。
</LI><LI><B>uss add</B> コマンドに対して、対応する引き数を組み込むことによって、あるいは、バルク入力ファイルの <B>add</B> 命令の対応するフィールドに値を入れることによって、テンプレート内に表示されるすべての変数に値を与えます。欠落した値があると、作成オペレーション全体が停止します。たとえ、変数を与えても、変数がテンプレート・ファイル内に表示されない場合、コマンド・インタープリターは、バルク入力ファイル内の対応するコマンド行引き数またはフィールドを無視します。
</LI><LI>テンプレート・ファイル内にブランク行を使用して、さらに読みやすくすることもできます。ファイルにコメントを入れる場合、各注釈行の先頭に番号記号
(<B>#</B>) を入れます。
</LI></UL>
<P><H3><A NAME="HDRWQ634" HREF="auagd002.htm#ToC_554">ローカル・ディスクのディレクトリーとファイルの作成について</A></H3>
<P><B>D</B>、<B>E</B>、および <B>F</B> 命令を使用して、ユーザーが <B>uss</B> コマンドを発行しているマシンのローカル・ファイル・システム内でディレクトリーまたはファイルを作成することは可能ですが、そのような使用法は、お勧めできません。その使用法は、以下の 2 つの複雑さを導く可能性があります。
<UL>
<LI>ローカル・ファイル・システムは、新規ローカル・ディスクのディレクトリーまたはファイルの所有権をその作成者に自動的に割り当てる。ユーザーは、オブジェクトを作成している <B>uss</B> コマンドの発行者であるので、ローカル・ファイル・システムは、ユーザーの UNIX UID をレコードします。それが適切でなくて、オブジェクトの作成時に、別の所有者を指定したい場合、ユーザーは、ローカル・スーパーユーザー <B>root</B> としてログインしていなければなりません (ローカル・ファイル・システムは、
<B>root</B> ユーザーだけに UNIX <B>chown</B> コマンドの発行を許可します。このコマンドが、<B>uss</B> コマンド・インタープリターを起動して、所有者をデフォルト値から変更します)。また、<B>-admin</B> 引き数を <B>uss add</B> または <B>uss bulk</B> コマンドに対して使用して、特権 AFS 管理者として認証しなければなりません。管理者だけが認証データベース項目および保護データベース項目を作成することができます。これらの項目は、
<B>uss</B> コマンド・インタープリターが常に新規アカウントの一部として作成します。
<P>
<P>代替案は、<B>uss</B> オペレーションが完了した後、ローカル・スーパーユーザー <B>root</B> となり、その後、必要な <B>chown</B> コマンドを発行することである。けれども、この代替案は、アカウント作成プロセスの自動化をそれだけ減じます。
</LI><LI>ローカル・ディスク・ディレクトリーの作成は、常に、エラー・メッセージを生成する。なぜなら、
<B>uss</B> コマンド・インタープリターがローカル・ディレクトリーの ACL を正常に設定できないからである。それにもかかわらず、ディレクトリーは作成され、値が <B>D</B> 命令の <VAR>ACL</VAR> フィールド内に表示されねばなりません。
</LI></UL>
<P>マシンのローカル・ディスクを構成するためにお勧めするメソッドは、むしろ、
AFS <B>package</B> ユーティリティーを使用することです。
<A HREF="auagd016.htm#HDRWQ566">パッケージ・プログラムを使用したクライアント・マシンの構成</A> を参照してください。
<A NAME="IDX7631"></A>
<A NAME="IDX7632"></A>
<P><H3><A NAME="HDRWQ635" HREF="auagd002.htm#ToC_555">uss テンプレート例</A></H3>
<P>この機能グループでは、基本およびフルアカウント・タイプのためのテンプレート (認証のみのアカウントのテンプレートは空です) の例について説明します。
<P>最初の例では、基本アカウントを作成します。この例では、2 つの <B>G</B> 命令と 1 つの <B>V</B> 命令を含み、フィールドは、これらの命令の中で、ボリューム名、ファイル・サーバー・マシン、パーティション、
K バイト単位の割り当て量、マウント・ポイント、ホーム・ディレクトリー所有者、およびホーム・ディレクトリー・アクセス制御リストを定義します。ABC Corporation のセルでは、適切なテンプレートは以下のとおりです。
<PRE>   G /afs/.abc.com/usr1
   G /afs/.abc.com/usr2
   V  user.$USER  $SERVER.abc.com  /vicep$PART  5000  $AUTO/$USER   $UID  \
        $USER all staff rl
</PRE>
<P>このタイプのテンプレートを使って <B>uss add</B> コマンドを発行するときは、以下の引き数を与えます。
<UL>
<LI><B>-user</B>。$USER 変数に対して、ユーザー名を指定します。
</LI><LI><B>-server</B>。$SERVER 変数に対して、ファイル・サーバー・マシン名の固有の部分を指定します。
</LI><LI><B>-partition</B>。$PART 変数に対して、パーティション名の固有の部分を指定します。
</LI></UL>
<P>保護サーバーは、自動的に、$UID 変数に対して AFS UID を割り当て、
<B>G</B> 命令は、$AUTO 変数に対して値を与えます。
<P>以下のテンプレート・ファイル例では、ABC Corporation のセル内にフルアカウントを作成します。次のセクションでは命令のそれぞれのタイプを扱い、この例の効果について説明します。
<B>V</B> および <B>E</B> 命令がそれぞれ 2 行に表示されているのは、ただ、読みやすくするためであることに注意してください。
<PRE>   #
   # Specify the available grouping directories
   #
   G /afs/.abc.com/usr1
   G /afs/.abc.com/usr2
   #
   # Create the user's home volume
   #
   V user.$USER $SERVER.abc.com /vicep$PART 5000 /afs/.abc.com/$AUTO/$USER \
        $UID $USER all abc:staff rl
   #
   # Create directories and files for mail
   #
   D $MTPT/.MESSAGES 0700 $UID $USER all abc:staff none 
   D $MTPT/.Outgoing 0700 $UID $USER rlidwk postman rlidwk 
   D $MTPT/Mailbox 0700 $UID $USER all abc:staff none  system:anyuser lik
   #
   # Here are some useful scripts for login etc.
   #
   F $MTPT/.Xbiff 0755 $UID /afs/abc.com/admin/user/proto
   F $MTPT/.Xresources 0644 $UID /afs/abc.com/admin/user/proto
   F $MTPT/.Xsession 0755 $UID /afs/abc.com/admin/user/proto
   F $MTPT/.cshrc 0755 $UID /afs/abc.com/admin/user/proto
   F $MTPT/.login 0755 $UID /afs/abc.com/admin/user/proto
   F $MTPT/.logout 0755 $UID /afs/abc.com/admin/user/proto
   F $MTPT/.twmrc 0644 $UID /afs/abc.com/admin/user/proto
   F $MTPT/preferences 0644 $UID /afs/abc.com/admin/user/proto
   #
   # Make a passwd entry
   #
   E /afs/.abc.com/common/etc/newaccts/passwd_$USER 0644 root  \
        "$USER:X:$UID:11:$NAME:$MTPT:/bin/csh"
   #
   # Put in the standard password/authentication checks
   #
   A $USER 250 noreuse 9 25
   #
   # Create and mount a public volume for the user
   #
   X "create_public_vol $USER $1 $2"
   #
   # Here we set up the symbolic link to public directory
   #
   S /afs/abc.com/public/$USER $MTPT/public
</PRE>
<A NAME="IDX7633"></A>
<A NAME="IDX7634"></A>
<A NAME="IDX7635"></A>
<A NAME="IDX7636"></A>
<A NAME="IDX7637"></A>
<P><H3><A NAME="HDRWQ636" HREF="auagd002.htm#ToC_556">G 命令によるユーザー・ホーム・ディレクトリーの均等配布</A></H3>
<P>数千のユーザー・アカウントを持ったセルでは、ユーザー・ボリュームに対するマウント・ポイントを複数の親ディレクトリーに配布することは、道理にかなっています。なぜなら、それらのマウント・ポイントをすべて 1 つのディレクトリーに入れると、ユーザー・ホーム・ディレクトリーがアクセスされたとき、ディレクトリー検索が顕著にスローダウンするからです。可能性のある解決策は、ユーザー・ホーム・ディレクトリーをアルファベット順にグループ化する親ディレクトリーか、または、大学や企業の部門など、反映する親ディレクトリーを作成することです。しかし、本当に大きなセルの場合、そのように分けられたグループであっても大きすぎて、ディレクトリーの検索が遅くなり、そのグループに属するユーザーはホーム・ディレクトリーにアクセスするたびに不当な不利益を被ることになります。ワークプレースの部門を反映するグループ化のもう 1 つの欠点は、ユーザーが部門との関係を変更すると、マウント・ポイントも移動しなければならないということです。
<P>1 つの代替案は、ワークプレースの部門を表さない複数の親ディレクトリーに、ユーザー・ホーム・ディレクトリーを均等に配布することです。<B>uss</B> コマンドの組を使用すると、<B>G</B> 命令をそれぞれに対して、テンプレート・ファイルの先頭の位置で入れ、その後、
<B>V</B> 命令の <VAR>mount_point</VAR> フィールドで $AUTO 変数を使用することによって、ディレクトリーのリストを定義することができます。<B>uss</B> コマンド・インタープリターは、$AUTO 変数と出会うと、
<B>G</B> 命令によって名付けられ、かつ現在、最も少ない項目を持っているとディレクトリーと置換します。(実際、$AUTO 変数は、パス名を組み込んでいるどのフィールドにも、どのタイプの命令にも表示できます。あらゆる場合で、コマンド・インタープリターは、現在、最も少ない項目を持っているディレクトリーと置換します。)
<P><B>G</B> 命令の構文は以下のとおりです。
<PRE>   G  <VAR>directory</VAR>
</PRE>
<P>ここで、<VAR>directory</VAR> は、完全なディレクトリー・パス名か、または最終要素だけ (ディレクトリーそのもの) のいずれかを指定します。選択項目によって、
<B>V</B> 命令の <VAR>mount_point</VAR> フィールドに入れる適切な値を決定します。
<P>読み取り専用のボリュームにマウント・ポイントを作成しようとしたことが原因の障害が起きないように、各ディレクトリーへの読み取り / 書き込みパスを指定してください。規則では、パス名の第 2 レベルのセル名の前にピリオドを付けて読み取り / 書き込みパスを示します (<B>/afs/.abc.com</B> など)。ファイル・スペースの読み取り / 書き込みパスと読み取り専用パスの概念の詳細については、<A HREF="auagd010.htm#HDRWQ294">ボリュームの取り付け</A> を参照してください。
<P>たとえば、
<A HREF="#HDRWQ635">uss テンプレート例</A> のフルアカウントに対する ABC Corporation のテンプレート例では、以下の 2 つのディレクトリーを定義します。
<PRE>   G /afs/.abc.com/usr1
   G /afs/.abc.com/usr2
</PRE>
<P>そして、値 <B>$AUTO/$USER</B> を、
<B>V</B> 命令の <VAR>mount_point</VAR> フィールドに書き込みます。同じ結果をもたらす 1 つの代替案は、ディレクトリーを以下のように定義することです。
<PRE>   G usr1
   G usr2
</PRE>
<P>そして、<B>V</B> 命令の <VAR>mount_point</VAR> フィールドに、さらに完全なパス名
<B>/afs/.abc.com/$AUTO/$USER</B> を指定します。
<A NAME="IDX7638"></A>
<A NAME="IDX7639"></A>
<A NAME="IDX7640"></A>
<A NAME="IDX7641"></A>
<A NAME="IDX7642"></A>
<A NAME="IDX7643"></A>
<P><H3><A NAME="HDRWQ637" HREF="auagd002.htm#ToC_557">V 命令によるボリュームの作成</A></H3>
<P>テンプレート・ファイルが空 (ゼロ長) でない限り、
1 つの (必ず 1 つだけの) <B> V</B> 命令がテンプレート・ファイル内に表示されねばなりません。
(<B>uss</B> アカウント作成オペレーションの一部としてユーザーに別のボリュームを作成するには、<B>X</B> 命令を使用して <B>vos create</B> コマンドを起動するか、このコマンドを <B>fs mkmount</B> コマンドなどの他のコマンドとともに起動するスクリプトを起動します。例については、<A HREF="#HDRWQ643">X 命令によるコマンド実行</A> を参照してください。)
<P><B>V</B> 命令は、以下の AFS エンティティーを定義します。
<UL>
<LI>1 つのボリュームおよび関連した VLDB 項目
</LI><LI>ボリュームのサイト (ファイル・サーバー・マシンおよびパーティション)
</LI><LI>AFS ファイル・スペース内のボリュームのマウント・ポイント。これがユーザーのホーム・ディレクトリーとなる
</LI><LI>ボリュームのスペース割り当て量
</LI><LI>ホーム・ディレクトリーの所有者。通常は新規ユーザー
</LI><LI>ホーム・ディレクトリーの ACL。通常、これが少なくとも、すべてのアクセス権をユーザーに許可する
</LI></UL>
<P><B>V</B> 命令内のフィールドについての以下の説明は、
<A HREF="#HDRWQ635">uss テンプレート例</A> で述べたフルアカウント・テンプレート内の例を引用しています (ここで、命令が 2 行に表示されているのは、ただ、読みやすくするためです)。
<PRE>   V  user.$USER  $SERVER.abc.com  /vicep$PART  5000  \
       /afs/.abc.com/$AUTO/$USER  $UID  $USER all abc:staff rl
</PRE>
<P><B>V</B> 命令の構文は以下のとおりです。
<PRE>   V  <VAR>volume_name</VAR>  <VAR>server</VAR>  <VAR>partition</VAR>  <VAR>quota</VAR>  <VAR>mount_point</VAR> <VAR>owner</VAR>  <VAR>ACL</VAR>
</PRE>
<P>ここで、
<DL>
<P><DT><B><B>V</B>
</B><DD>ボリューム作成の命令を示します。
<P><DT><B><VAR>volume_name</VAR>
</B><DD>ボリュームの名前を、VLDB 内にレコードされたとおりに指定します。
<P>
<P>ユーザー名をボリューム名の一部として組み込む規則に従うには、$USER 変数をこのフィールドに組み込みます。この変数は、<B>uss add</B> コマンドへの <B>-user</B> 引き数か、バルク入力ファイルの <B>add</B> 命令の <VAR>username</VAR> フィールドから値を取得します。
<P>
<P>ABC Corporation の例では、値 <B>user.$USER</B> を使用して、標準ボリューム名に
<B>user.</B><VAR>username</VAR> を割り当てます。たとえば、ユーザー <B>smith</B> に対してアカウントを作成する場合は、<B>uss add</B> コマンドへの引き数として <B>-user smith</B> を組み込むか、バルク入力ファイルの <B>add</B> 命令の <VAR>username</VAR> フィールドに値 <B>smith</B> を入れます。
<P><DT><B><VAR>server</VAR>
</B><DD>新規ボリュームを作成するファイル・サーバー・マシンに名前を付けます。最も望ましいのは完全修飾されたホスト名 (<B> fs1.abc.com</B> など) を与えることですが、ボリュームの作成時に省略形式の名前を解決する命名サービスを使用することができれば、省略形式も可能です。
<P>異なるユーザーのボリュームを異なるファイル・サーバー・マシンに入れるには、$SERVER 変数をこのフィールド内で使用し、<B>uss add</B> コマンドに対する <B>-server</B> 引き数か、または、バルク入力ファイルの <B>add</B> 命令の <VAR>server</VAR> フィールドかのいずれかによって、値をこの変数に与えます。コマンド行にすべてをタイプすることなく、完全に修飾されたホスト名を指定する容易な方法の 1 つは、定数と $SERVER 変数を結合することです。具体的に言うと、定数が、すべてのファイル・サーバー・マシンに対して共通のドメイン名サフィックスを指定します。
<P>
<P>ABC Corporation の例では、セル内のすべてのファイル・サーバー・マシンが <B>abc.com</B> ドメイン名サフィックスを共用しており、したがって、<VAR>server</VAR> フィールドが変数と定数を結合して、
<B>$SERVER.abc.com</B> を作成します。この新規ボリュームをマシン <B>fs1.abc.com</B> に入れるには、
<B>-server fs1</B> を <B>uss add</B> コマンドに対する引き数として組み込むか、あるいは、値 <B>fs1</B> をバルク入力ファイルの <B>add</B> 命令の <VAR>server</VAR> フィールドに入れます。
<P><DT><B><VAR>partition</VAR>
</B><DD>ユーザーのボリュームを作成するパーティションを指定します。これは、
<VAR>server</VAR> フィールドで名付けられたファイル・サーバー・マシン上になければなりません。パーティションを完全な名前 (<B>/vicepa</B> など) で指定するか、<A HREF="auagd023.htm#HDRWQ841">省略形と別名を使用するための規則</A> にリストされた省略形を使用します。
<P>
<P>異なるユーザーのボリュームを異なるパーティションに入れるには、$PART 変数をこのフィールド内で使用し、
<B>uss add</B> コマンドに対する <B>-partition</B> 引き数か、または、バルク入力ファイルの <B>add</B> 命令の <VAR>partition</VAR> フィールドかのいずれによって、値をこの変数に与えます。すべての完全なパーティション名は、<B>/vicep</B> 文字列で始まるので、その文字列を定数として $PART 変数と結合させると便利です。
<P>
<P>ABC Corporation のテンプレート例では、定数文字列 <B>/vicep</B> と $PART 変数をこのように結合し、
<B>/vicep$PART</B> としています。
<A NAME="IDX7644"></A>
<A NAME="IDX7645"></A>
<A NAME="IDX7646"></A>
<A NAME="IDX7647"></A>
<P><DT><B><VAR>quota</VAR>
</B><DD>ボリュームがファイル・サーバー・マシンのディスク上で占有できる最大数の K バイトブロックを指定します。この値は整数でなければなりません。同じ割り当て量をすべてのユーザー・ボリュームに割り当てる場合は、定数値を指定します。異なる割り当て量を異なるボリュームに割り当てるには、番号変数 ($1 から $9) の 1 つをこのフィールドに入れ、
<B>uss add</B> コマンドに対する <B>-var</B> 引き数か、または、バルク入力ファイルの <B>add</B> 命令の該当フィールドかのいずれかによって、値をこの番号変数に与えます。
<P>
<P>ABC Corporation の例では、5000 KB の初期割り当て量をすべての新規ユーザーに許可しています。
<A NAME="IDX7648"></A>
<A NAME="IDX7649"></A>
<A NAME="IDX7650"></A>
<A NAME="IDX7651"></A>
<P><DT><B><VAR>mount_point</VAR>
</B><DD>ボリュームに対してマウント・ポイントを作成します。このマウント・ポイントはボリュームのルート・ディレクトリーおよびユーザーのホーム・ディレクトリーとして機能します。規則によって、ユーザーのホーム・ディレクトリー名は、ユーザー名を組み込みます。このユーザー名は、
$USER 変数をこのフィールドに組み込むことによって読み取ることができます。
<P>
<P>読み取り専用のボリュームに新規のマウント・ポイントを作成しようとしたことが原因の障害が起きないように、マウント・ポイントへの読み取り /書き込みパスを指定してください。規則では、パス名の第 2 レベルのセル名の前にピリオドを付けて読み取り / 書き込みパスを示します (<B>/afs/.abc.com</B> など)。このフィールドに $AUTO 変数を使用する場合、それぞれの <B>G</B> 命令によって命名されるディレクトリーは、既に読み取り / 書き込みパスを示しているはずです。ファイル・スペースの読み取り / 書き込みパスと読み取り専用パスの概念の詳細については、<A HREF="auagd010.htm#HDRWQ294">ボリュームの取り付け</A> を参照してください。
<P>
<P>また、マウント・ポイント名のほかの部分がユーザーごとに異なる場合は、$MTPT 変数をこのフィールド内で使用し、
<B>uss add</B> コマンドの <B>-mount</B> 引き数か、または、バルク入力ファイルの <B>add</B> 命令の <VAR>mount_point</VAR> フィールドかによって、値を与えることができます。けれども、$MTPT 変数が、テンプレート内で後に続く命令内 (通常、<B>D</B>、
<B>E</B>、または <B>F</B> 命令内) に表示される場合は、この変数が代わりにこのフィールドの全コンテンツをその値として取ることに注意してください。
<P>
<P>ホーム・ディレクトリーを、
1 つまたは複数の親ディレクトリー内にどのようにグループ化するかというユーザーの決定に基づき、定数と変数を結合します。テンプレートを参照する <B>uss add</B> または <B>uss bulk</B> コマンドを実行する前に、親ディレクトリーがすでに存在していなければならないということに注意してください。ホーム・ディレクトリーをグループ化するための可能性としては、以下の事項があります。
<A NAME="IDX7652"></A>
<P>
<UL>
<LI>すべてのユーザー・ホーム・ディレクトリーを単一の親ディレクトリーに入れる。名前 <B>/afs/</B><VAR>cellname</VAR><B>/usr</B> は、
UNIX の <B>/usr</B> 規則にある AFS 準拠の変数です。この選択は、少数のユーザー・アカウントを持ったセルに対して最も適切です。この選択をインプリメントする最も簡単な方法は、定数文字列と $USER 変数を <B>/afs/.abc.com/usr/$USER</B> のように結合することです。
</LI><LI>ワークプレースの部門に対応していない親ディレクトリーのセットにホーム・ディレクトリーを均等に配布する。この選択は、数万のアカウントを持っているセルに対して適切です。このようなセルでは、すべてのホーム・ディレクトリーが一緒に 1 つの親ディレクトリーに常駐し、かつ、ワークプレースの部門に従った配布が実現可能ではない場合に、ホーム・ディレクトリーの数が大き過ぎてディレクトリー検索を著しくスローダウンします。
<P>
<P>$AUTO 変数は、ホーム・ディレクトリーをこの方法で均等に配布するために設計されています。<A HREF="#HDRWQ636">G 命令によるユーザー・ホーム・ディレクトリーの均等配布</A> で説明したように、
<B>uss</B> コマンド・インタープリターは、先行の <B>G</B> テンプレート命令によって定義され、かつ現在、最も少ない項目を持っているディレクトリーと置換します。ABC Corporation のテンプレート例では、この選択を値 <B>/afs/.abc.com/$AUTO/$USER</B> を使用して説明しています。
</LI><LI>ホーム・ディレクトリーを、大学や企業の部門など、部門を反映する複数のディレクトリーに配布する。おそらく、このスキーマをインプリメントする最も簡単な方法は、$MTPT 変数を使用して、<B>/afs/.ghi.com/usr/$MTPT/$USER</B> のように部門を表すことです。そして、<B>uss add</B> コマンドに <B>-user smith</B> および <B>-mount acctg</B> という引き数を与えて、マウント・ポイント <B> /afs/.ghi.com/usr/acctg/smith</B> を作成します。
</LI><LI>ユーザー名の最初の文字に基づき、<B>usr</B> のアルファベット順のサブディレクトリー (<B>usr/a</B>、<B>usr/b</B> など) にホーム・ディレクトリーを配布する。この利点は、ユーザー名がわかるとホーム・ディレクトリーの位置指定を容易に行えることです。潜在的な欠点は、配布が均等になりそうにないということと、アカウントが多数の場合には、緩慢になったディレクトリー検索が、ポピュラーな文字で始まる名前のユーザーに不公平な影響を与えるということです。
<P>
<P>おそらく、このスキーマをインプリメントする最も簡単な方法は、$MTPT 変数を使用して、<B>/afs/.jkl.com/usr/$MTPT/$USER</B> のように文字を表すことです。そして、<B>uss add</B> コマンドに <B>-user smith</B> および <B>-mount s/m</B> という引き数を与えて、マウント・ポイント <B>/afs/.jkl.com/usr/s/m/smith</B> を作成します。
</LI></UL>
<P><DT><B><VAR>owner</VAR>
</B><DD>UNIX の <B>ls -l</B> コマンドからの出力で、マウント・ポイントの所有者として指定されるユーザーのユーザー名または UID を指定します。ホーム・ディレクトリー所有権に対する標準規則に従うには、ABC Corporation のテンプレート例のように、
$UID 変数をこのフィールドで使用します。この後、保護サーバーは、ユーザーが、
<B>-uid</B> 引き数を <B>uss add</B> コマンドに与えるか、または、バルク入力ファイルの <B>add</B> 命令の <VAR>uid</VAR> フィールドを埋めるかのいずれかを行う場合を除き、自動的に AFS UID を割り当てます。
(既存の UNIX アカウントを変換する場合は、考慮事項の説明をさらに読むために、<A HREF="#HDRWQ614">uss による既存の UNIX アカウントの変換</A> を参照してください。)
<A NAME="IDX7653"></A>
<A NAME="IDX7654"></A>
<A NAME="IDX7655"></A>
<A NAME="IDX7656"></A>
<P><DT><B><VAR>ACL</VAR>
</B><DD>ACL を新規ホーム・ディレクトリー上で設定します。1 つまたは複数のペア値を与えます。各ペアは、AFS ユーザー名またはグループ名、および望ましいアクセス権とで、この順序で構成されている必要があります (グループ名は、使用される保護データベース内にすでに存在していなければなりません)。ペアの 2 つの部分を分離し、また、各ペアを 1 つのスペースで分離します。使用可能なアクセスの説明は、<A HREF="auagd020.htm#HDRWQ783">AFS ACL アクセス権</A> を参照してください。
<P>
<P>このフィールドに、値 <B>$USER all</B> を組み込むことによって、少なくとも、すべてのアクセス権を新規ユーザーに許可します。ファイル・サーバーは、自動的にすべてのアクセス権を <B>system:administrators</B> グループにも許可します。アクセス権を <B>uss</B>コマンドの発行者に対して許可することはできません。なぜなら、アカウント作成の最後のステップとして、<B>uss</B> コマンド・インタープリターは、作成プロセス中に自動的にそのユーザーをすべての ACL セットから削除するからです。
<P>
<P>ABC Corporation の例では、次の値を使用して、新規ユーザーにすべてのアクセス権を許可し、<B>abc:staff</B> グループのメンバーには <B>r</B> (<B>読み取り</B>) および <B>l</B> (<B>ルックアップ</B>) 権限を許可しています。
<P>
<P><B>$USER all abc:staff rl</B>
</DL>
<A NAME="IDX7657"></A>
<A NAME="IDX7658"></A>
<A NAME="IDX7659"></A>
<A NAME="IDX7660"></A>
<A NAME="IDX7661"></A>
<A NAME="IDX7662"></A>
<P><H3><A NAME="HDRWQ638" HREF="auagd002.htm#ToC_558">D 命令によるディレクトリーの作成</A></H3>
<P>テンプレート・ファイル内の各 <B>D</B> 命令が 1 つのディレクトリーを作成します。テンプレート内でのそれらの数には、制限がありません。
<B>D</B> 命令がサブディレクトリーを新規ユーザーのホーム・ディレクトリー内に作成する場合 (その意図された用法)、
<B>D</B> 命令は、<B>V</B> 命令に後続しなければなりません。<B>uss</B> コマンドが実行しているマシンのローカル・ディスク上にディレクトリーを作成することは、お勧めできません。お勧めできない理由については、<A HREF="#HDRWQ634">ローカル・ディスクのディレクトリーとファイルの作成について</A> で概説しています。
<P><B>D</B> 命令内のフィールドについての以下の説明は、
<A HREF="#HDRWQ635">uss テンプレート例</A> からのフルアカウント・テンプレート内の例の 1 つを引用しています。
<PRE>   D $MTPT/Mailbox 0700 $UID $USER all abc:staff none  system:anyuser lik
</PRE>
<P><B>D</B> 命令の構文は以下のとおりです。
<PRE>   D  <VAR>pathname</VAR>  <VAR>mode_bits</VAR>  <VAR>owner</VAR>  <VAR>ACL</VAR>
</PRE>
<P>ここで、
<DL>
<P><DT><B><B>D</B>
</B><DD>ディレクトリー作成の命令を指示します。
<P><DT><B><VAR>pathname</VAR>
</B><DD>ディレクトリーのフルパス名を指定します。ユーザーのホーム・ディレクトリーのサブディレクトリーの場合、$MTPT 変数を使用して、ホーム・ディレクトリーのパス名を指定するのが最も簡単です。
$MTPT 変数が <B>D</B> 命令内に表示される場合、この変数は、値を先行の <B>V</B> 命令の <VAR>mount_point</VAR> フィールドから取ります (この依存性が、なぜ <B>D</B> 命令が <B>V</B> 命令に後続しなければならないかという理由です)。
<P>
<P>読み取り専用のボリュームに新規ディレクトリーを作成しようとしたことが原因の障害が起きないように、ディレクトリーへの読み取り / 書き込みパス名を指定してください。規則では、パス名の第 2 レベルのセル名の前にピリオドを付けて読み取り / 書き込みパスを示します (<B>/afs/.abc.com</B> など)。このフィールドに $MTPT 変数を使用する場合、<B>V</B> 命令の <VAR>mount_point</VAR> フィールドの値は既に読み取り / 書き込みパスを示しているはずです。ファイル・スペースの読み取り / 書き込みパスと読み取り専用パスの概念の詳細については、
<A HREF="auagd010.htm#HDRWQ294">ボリュームの取り付け</A> を参照してください。
<P>
<P>ABC Corporation の例では、値 <B>$MTPT/Mailbox</B> を使用して、
<B>Mailbox</B> サブディレクトリーをユーザーのホーム・ディレクトリーに入れます。
<P><DT><B><VAR>mode_bits</VAR>
</B><DD>ファイルの UNIX モード・ビットを定義します。許容値は、標準のアクセス権の組み合わせに対応する 3 桁または 4 桁の数字です。例 : <B>0755</B> は、<B>rwxr-xr-x</B> に対応し、
<B>0644</B> は、<B>rw-r--r--</B> に対応します。最初の (owner) <B>x</B> ビットは、ディレクトリーに対するアクセスを可能にするためにオンにしなければなりません。
<P>
<P>ABC Corporation の例では、値 <B>0700</B> を使用して、
<B>Mailbox</B> サブディレクトリー上のモード・ビットを <B>rwxr-----</B> に設定します。
<P><DT><B><VAR>owner</VAR>
</B><DD>UNIX の <B>ls -l</B> コマンドからの出力で、ディレクトリーの所有者として指定されるユーザーのユーザー名または UID を指定します。
<P>
<P>ディレクトリーが AFS 内に常駐している場合は、
ABC Corporation のテンプレート例のように $UID 変数をこのフィールド内に入れます。この後、保護サーバーは、ユーザーが、
<B>-uid</B> 引き数を <B>uss add</B> コマンドに与えるか、または、バルク入力ファイルの <B>add</B>命令の <VAR>uid</VAR> フィールドを埋めるかのいずれかを行う場合を除き、自動的に AFS UID を割り当てます。(既存の UNIX アカウントを変換する場合は、考慮事項の説明をさらに読むために、<A HREF="#HDRWQ614">uss による既存の UNIX アカウントの変換</A> を参照してください。)
<P>
<P>ディレクトリーがローカル・ディスクにある場合、<B>uss</B> コマンドを発行しているユーザー名か UNIX UID を指定するのが最も簡単です。別のもう１人のユーザーを指定することから生じる複雑さについての詳細は、
<A HREF="#HDRWQ634">ローカル・ディスクのディレクトリーとファイルの作成について</A> を参照してください。
<A NAME="IDX7663"></A>
<A NAME="IDX7664"></A>
<A NAME="IDX7665"></A>
<A NAME="IDX7666"></A>
<P><DT><B><VAR>ACL</VAR>
</B><DD>ACL を新規ディレクトリー上で設定します。1 つまたは複数のペア値を与えます。各ペアは、AFS ユーザー名またはグループ名、および望ましいアクセス権とで、この順序で構成されている必要があります (グループ名は、使用される保護データベース内にすでに存在していなければなりません)。ペアの 2 つの部分を分離し、また、各ペアを 1 つのスペースで分離します。使用可能なアクセスの説明は、<A HREF="auagd020.htm#HDRWQ783">AFS ACL アクセス権</A> を参照してください。
<P>
<P>値 <B>$USER all</B> を組み込むことによって、少なくとも、すべてのアクセス権を新規ユーザーに許可します。アクセス権を <B>uss</B> コマンドの発行者に対して許可することはできません。なぜなら、アカウント作成の最後のステップとして、<B>uss</B> コマンド・インタープリターは、作成プロセス中に自動的にそのユーザーをすべての ACL セットから削除するからです。
<A HREF="#HDRWQ634">ローカル・ディスクのディレクトリーとファイルの作成について</A> で詳細に説明したように、ディレクトリーがローカル・ディスク上にある場合は、エラー・メッセージが常に表示されます。
<P>
<P>ABC Corporation の例では、次の値を使用して、新規のユーザーにはすべてのアクセス権を許可し、
<B>abc:staff</B> グループのメンバーにはまったく許可を与えず、<B>system:anyuser</B> グループのメンバーには <B>l</B> (<B>ルックアップ</B>)、<B>i</B> (<B>挿入</B>)、および <B>k</B> (<B>ロック</B>) の権限を与えています。
<P>
<P><B>$USER all abc:staff none system:anyuser lik</B>
<P>
<P>この値は、非常に広範なアクセス権を <B>system:anyuser</B> グループに許可し、すべてのシステム・ユーザーに (メール送信・デーモンを含め)、メールを <B>Mailbox</B> ディレクトリーに挿入することを可能にします。<B>r</B> (<B>読み取り</B>)アクセス権の不在は、
<B>system:anyuser</B> グループのメンバーによるメール・ファイルの読み取りを阻止します。
</DL>
<A NAME="IDX7667"></A>
<A NAME="IDX7668"></A>
<A NAME="IDX7669"></A>
<A NAME="IDX7670"></A>
<A NAME="IDX7671"></A>
<A NAME="IDX7672"></A>
<P><H3><A NAME="HDRWQ639" HREF="auagd002.htm#ToC_559">F 命令によるプロトタイプからのファイルの作成</A></H3>
<P>テンプレート・ファイル内の各 <B>F</B> 命令が既存のプロトタイプ・ファイルのコンテンツをコピーすることによって、ファイルを作成します。テンプレート内でのそれらの数には制限がなく、それぞれが、異なるプロトタイプを参照することができます。
<B>F</B> 命令がファイルを、新規ユーザーのホーム・ディレクトリーまたはそのサブディレクトリー内に作成する場合 (その意図された用法)、
<B>F</B> 命令は、親ディレクトリーを作成する <B>V</B> または <B>D</B> 命令に後続しなければなりません。<B>uss</B> コマンドを実行しているマシンのローカル・ディスク上にファイルを作成することは、
<A HREF="#HDRWQ634">ローカル・ディスクのディレクトリーとファイルの作成について</A> で詳細に説明されている理由から、お勧めできません。
<P><B>E</B> 命令もファイルを作成しますが、
2 つのタイプの命令は相補利点を持っています。<B>E</B> 命令で作成されたファイルは、各ユーザーに対してカスタマイズすることができます。なぜなら、ファイルのコンテンツを指定するフィールドに変数を表示できるからです。対照的に、<B>F</B> 命令を使用して作成されたファイルのコンテンツは、すべてのユーザーに対して同じです。<B>E</B> ファイルは、必ず単一行でなければなりませんが、
<B>F</B> ファイルはどのような長さでもかまいません。
<P><B>F</B> 命令内のフィールドについての以下の説明は、
<A HREF="#HDRWQ635">uss テンプレート例</A> からのフルアカウント・テンプレート内の例の 1 つを引用しています。
<PRE>   F $MTPT/.login 0755 $UID /afs/abc.com/admin/user/proto
</PRE>
<P><B>F</B> 命令の構文は以下のとおりです。
<PRE>   F  <VAR>pathname</VAR>  <VAR>mode_bits</VAR>  <VAR>owner</VAR>  <VAR>prototype_file</VAR>
</PRE>
<P>ここで、
<DL>
<P><DT><B><B>F</B>
</B><DD>ファイル作成の命令を指示します。
<P><DT><B><VAR>pathname</VAR>
</B><DD>作成するファイルの完全なパス名を、ファイル名付きで指定します。それがユーザーのホーム・ディレクトリーまたはそのサブディレクトリーに常駐している場合は、
$MTPT 変数を使用して、ホーム・ディレクトリーのパス名を指定するのが最も簡単です。
$MTPT 変数が <B>F</B> 命令内に表示される場合、この変数は、値を先行の <B>V</B> 命令の <VAR>mount_point</VAR> フィールドから取ります (この依存性が、なぜ <B>F</B> 命令が <B>V</B> 命令に後続しなければならないかという理由です)。
<P>
<P>読み取り専用のボリュームに新規ファイルを作成しようとしたことが原因の障害が起きないように、ファイルへの読み取り / 書き込みパス名を指定してください。規則では、パス名の第 2 レベルのセル名の前にピリオドを付けて読み取り / 書き込みパスを示します (<B>/afs/.abc.com</B> など)。このフィールドに $MTPT 変数を使用する場合、<B>V</B> 命令の <VAR>mount_point</VAR> フィールドの値は既に読み取り / 書き込みパスを示しているはずです。ファイル・スペースの読み取り / 書き込みパスと読み取り専用パスの概念の詳細については、<A HREF="auagd010.htm#HDRWQ294">ボリュームの取り付け</A> を参照してください。
<P>
<P>ABC Corporation の例では、値 <B>$MTPT/.login</B> を使用して、<B>.login</B> というファイルをユーザーのホーム・ディレクトリーに入れます。
<P><DT><B><VAR>mode_bits</VAR>
</B><DD>ファイルの UNIX モード・ビットを定義します。許容値は、標準のアクセス権の組み合わせに対応する 3 桁または 4 桁の数字です。例 : <B>0755</B> は、<B>rwxr-xr-x</B> に対応し、
<B>0644</B> は、<B>rw-r--r--</B> に対応します。
<P>
<P>ABC Corporation の例では、値 <B>0755</B> を使用して、
<B>.login</B> ファイル上のモード・ビットを <B>rwxr-xr-x</B> に設定します。
<P><DT><B><VAR>owner</VAR>
</B><DD>UNIX の <B>ls -l</B> コマンドからの出力で、ファイルの所有者として指定されるユーザーのユーザー名または UID を指定します。
<P>
<P>ファイルが AFS 内に常駐している場合は、
ABC Corporation のテンプレート例のように $UID 変数をこのフィールド内に入れます。この後、保護サーバーは、ユーザーが、
<B>-uid</B> 引き数を <B>uss add</B> コマンドに与えるか、または、バルク入力ファイルの <B>add</B>命令の <VAR>uid</VAR> フィールドを埋めるかのいずれかを行う場合を除き、自動的に AFS UID を割り当てます。(既存の UNIX アカウントを変換する場合は、考慮事項の説明をさらに読むために、<A HREF="#HDRWQ614">uss による既存の UNIX アカウントの変換</A> を参照してください。)
<P>
<P>ファイルがローカル・ディスクにある場合、<B>uss</B> コマンドを発行しているユーザー名か UNIX UID を指定するのが最も簡単です。別のもう１人のユーザーを指定することから生じる複雑さについての詳細は、
<A HREF="#HDRWQ634">ローカル・ディスクのディレクトリーとファイルの作成について</A> を参照してください。
<P><DT><B><VAR>prototype_file</VAR>
</B><DD>コピーするプロトタイプ・ファイルを保管している AFS ディレクトリーまたはローカル・ディレクトリーのを指定します。プロトタイプ・ファイル名は、<VAR>pathname</VAR> フィールドの最後の要素と一致しなければなりません。
<P>
<P>ABC Corporation の例では、ディレクトリー <B>/afs/abc.com/admin/user/proto</B> 内の <B>.login</B> と呼ばれるプロトタイプ・ファイルを参照します。
</DL>
<A NAME="IDX7673"></A>
<A NAME="IDX7674"></A>
<A NAME="IDX7675"></A>
<A NAME="IDX7676"></A>
<A NAME="IDX7677"></A>
<A NAME="IDX7678"></A>
<P><H3><A NAME="HDRWQ640" HREF="auagd002.htm#ToC_560">E 命令による 1 行ファイルの作成</A></H3>
<P>テンプレート・ファイル内の各 <B>E</B> 命令は、指定された単一行をテンプレート・ファイルにエコーすることによってファイルを作成します。テンプレート内では、それらの数に制限がありません。
<B>E</B> 命令がファイルを、新規ユーザーのホーム・ディレクトリーまたはそのサブディレクトリー内に作成する場合 (その意図された用法)、
<B>E</B> 命令は、親ディレクトリーを作成する <B>V</B> または <B>D</B> 命令に後続しなければなりません。<B>uss</B> コマンドを実行しているマシンのローカル・ディスク上にファイルを作成することは、
<A HREF="#HDRWQ634">ローカル・ディスクのディレクトリーとファイルの作成について</A> で詳細に説明されている理由から、お勧めできません。
<P><B>F</B> 命令もファイルを作成しますが、
2 つのタイプの命令は相補利点を持っています。<B>E</B> 命令で作成されたファイルは、各ユーザーに対してカスタマイズすることができます。なぜなら、ファイルのコンテンツを指定するフィールドに変数を表示できるからです。コマンド・インタープリターは、ファイルを作成する前に、変数を適切な値に置き換えます。対照的に、<B>F</B> 命令を使用して作成されたファイルのコンテンツは、すべてのユーザーに対して同じです。
<B>E</B> ファイルは、必ず単一行でなければなりませんが、
<B>F</B> ファイルはどのような長さでもかまいません。
<P><B>E</B> 命令は、特に、新規ユーザーに対する項目をセルの共通送信元パスワード・ファイル内で作成するのに適しています。この後、この項目は、クライアント・マシンにコピーされ、ローカル・パスワード・ファイル (<B>/etc/passwd</B> または同等の) としてサーブします。次のフィールドについての説明は、<A HREF="#HDRWQ635">uss テンプレート例</A> の ABC Corporation のフルアカウント・テンプレートにおけるこのタイプの使用例を参照しています。この方法で作成されたファイルを、どのように共通送信元パスワード・ファイルに組み込むかということについての詳細は、
<A HREF="#HDRWQ613">共通送信元パスワード・ファイルの作成</A> を参照してください。
<PRE>   E /afs/.abc.com/common/etc/newaccts/passwd_$USER 0644 root  \
        "$USER:X:$UID:11:$NAME:$MTPT:/bin/csh"
</PRE>
<P><B>E</B> 命令の構文は以下のとおりです。
<PRE>   E  <VAR>pathname</VAR>  <VAR>mode_bits</VAR>  <VAR>owner</VAR>  "<VAR>contents</VAR>"
</PRE>
<P>ここで、
<DL>
<P><DT><B><B>E</B>
</B><DD>ファイル作成の命令を指示します。
<P><DT><B><VAR>pathname</VAR>
</B><DD>作成するファイルの完全なパス名を、ファイル名付きで指定します。これは、変数を組み込むことができます。それがユーザーのホーム・ディレクトリーまたはそのサブディレクトリーに常駐している場合は、
$MTPT 変数を使用して、ホーム・ディレクトリーのパス名を指定するのが最も簡単です。$MTPT 変数が <B>E</B> 命令内に表示される場合、この変数は、値を、先行の <B>V</B> 命令の <VAR>mount_point</VAR> フィールドから取ります (この依存性が、なぜ <B>E</B> 命令が <B>V</B> 命令に後続しなければならないかという理由です)。
<P>
<P>読み取り専用のボリュームに新規ファイルを作成しようとしたことが原因の障害が起きないように、ファイルへの読み取り / 書き込みパス名を指定してください。規則では、パス名の第 2 レベルのセル名の前にピリオドを付けて読み取り / 書き込みパスを示します (<B>/afs/.abc.com</B> など)。このフィールドに $MTPT 変数を使用する場合、<B>V</B> 命令の <VAR>mount_point</VAR> フィールドの値は既に読み取り / 書き込みパスを示しているはずです。ファイル・スペースの読み取り / 書き込みパスと読み取り専用パスの概念の詳細については、<A HREF="auagd010.htm#HDRWQ294">ボリュームの取り付け</A> を参照してください。
<P>
<P>ABC Corporation の例では、<B>E</B> 命令によって作成されたファイルを、以下のように新規ユーザーの名前にちなむ名前で、
<B>/afs/.abc.com/common/etc/newaccts</B> ディレクトリーに書き込みます。
<PRE>   /afs/.abc.com/common/etc/newaccts/passwd_$USER
</PRE>
<P><DT><B><VAR>mode_bits</VAR>
</B><DD>ファイルの UNIX モード・ビットを定義します。許容値は、標準のアクセス権の組み合わせに対応する 3 桁または 4 桁の数字です。例 : <B>0755</B> は、<B>rwxr-xr-x</B> に対応し、
<B>0644</B> は、<B>rw-r--r--</B> に対応します。
<P>
<P>ABC Corporation の例では、値 <B> 0644</B> を使用して、
<B>passwd_</B><VAR>user</VAR> ファイル上のモード・ビットを <B>r-xr--r--</B> に設定します。
<P><DT><B><VAR>owner</VAR>
</B><DD>UNIX の <B>ls -l</B> コマンドからの出力で、ファイルの所有者として指定されるユーザーのユーザー名または UID を指定します。
<P>
<P>ファイルが AFS 内に常駐して、ユーザーに所有される場合は、$UID 変数をこのフィールドに入れます。この後、保護サーバーは、ユーザーが、
<B>-uid</B> 引き数を <B>uss add</B> コマンドに与えるか、または、バルク入力ファイルの <B>add</B>命令の <VAR>uid</VAR> フィールドを埋めるかのいずれかを行う場合を除き、自動的に AFS UID を割り当てます。(既存の UNIX アカウントを変換する場合は、考慮事項の説明をさらに読むために、<A HREF="#HDRWQ614">uss による既存の UNIX アカウントの変換</A> を参照してください。)
<P>
<P>ファイルがローカル・ディスク上に常駐している場合は、
<B>uss</B> コマンドを発行しているユーザー名または UNIX UID を指定します。別のもう１人のユーザーを指定することから生じる複雑さについての詳細は、
<A HREF="#HDRWQ634">ローカル・ディスクのディレクトリーとファイルの作成について</A> を参照してください。
<P>
<P>ABC Corporation の例では、AFS ファイルを、新規ユーザーによる直接使用のためではなく、共通パスワード・ファイルに組み込むために作成しています。したがって、例では、ローカル・スーパーユーザー <B>root</B> を新規ファイルの所有者として指定します。
AFS ファイル上の代替所有者の指定は複雑なことではありません。AFS ファイル上で <B>chown</B> コマンドを発行するには <B>system:administrators</B> グループのメンバーであることが必要ですが、<B>uss</B> コマンドを発行するためには特権管理者として認証されていなければなりません。
<P><DT><B><VAR>contents</VAR>
</B><DD>新規ファイルに書き込む 1 行文字列を指定します。
1 つでもスペースが含まれる場合は、二重引用符で囲みます。この文字列には改行文字を含むことはできませんが、コマンド・インタープリターがファイルを作成するときに解決が可能なあらゆる標準変数を含むことができます。
<P>ABC Corporation の例では、以下の値を <VAR>contents</VAR> フィールドに持って、パスワード・ファイル項目を作成します。
<PRE>   $USER:X:$UID:10:$NAME:$MTPT:/bin/csh
</PRE>
</DL>
<A NAME="IDX7679"></A>
<A NAME="IDX7680"></A>
<A NAME="IDX7681"></A>
<A NAME="IDX7682"></A>
<A NAME="IDX7683"></A>
<A NAME="IDX7684"></A>
<A NAME="IDX7685"></A>
<A NAME="IDX7686"></A>
<A NAME="IDX7687"></A>
<A NAME="IDX7688"></A>
<A NAME="IDX7689"></A>
<P><H3><A NAME="HDRWQ641" HREF="auagd002.htm#ToC_561">L および S 命令によるリンクの作成</A></H3>
<P>テンプレート・ファイル内の各 <B>L</B> 命令は、標準の UNIX <B>ln</B> コマンドによって実行されたように、ハード・リンクを 2 つのファイル間に作成します。<B>S</B> 命令は、標準の UNIX <B>ln -s</B> コマンドによって実行されたように、記号リンクを 2 つのファイル間に作成します。リンクについて説明することは、この本の目的ではありませんが、両方の事例における基本的な有効性は、
2 番目の名前を既存のファイルに対して作成し、その結果、既存のファイルがどちらかの名前でアクセス可能になるということです。リンクを作成しても、ファイルの 2 番目のコピーは作成されません。
<P>テンプレート・ファイル内の <B>L</B> または <B>S</B> 命令の数には、制限がありません。新規ユーザーのホーム・ディレクトリーかサブディレクトリー (意図的な使用) にリンクがある場合、これらの命令は親ディレクトリーを作成する <B>V</B> または <B>D</B> 命令、およびリンクされるファイルを作成する <B>F</B>、<B>E</B>、または <B>X</B> 命令に後続する必要があります。<B>uss</B> コマンドが実行しているマシンのローカル・ディスク上にファイルを作成することは、お勧めできません。お勧めできない理由については、<A HREF="#HDRWQ634">ローカル・ディスクのディレクトリーとファイルの作成について</A> で詳細を説明しています。
<P>AFS は、同じディレクトリーに常駐するファイル間だけにハード・リンクを許可するということに注意してください。この制限は、2 つの潜在的に異なる ACL (2 つのディレクトリーの ACL) に、同じファイルを関連付けることから生じる混乱を除去するために必要です。記号リンクは、異なるディレクトリーに常駐する 2 つのファイル間で正当です。また、それどころか、異なるボリュームに常駐するファイル間でも正当です。実際のファイル上の ACL も同様にリンクに適用されます。
<P>ディレクトリーまたはファイルに対して行うのとは異なり、
<B>L</B> または <B>S</B> 命令で作成されたリンク上では、所有者またはモード・ビットを設定しません。
<B>uss</B> コマンド・インタープリターは、自動的に <B>uss</B> コマンドの発行者の UNIX UID を所有者としてレコードし、モード・ビットを <B>lrwxrwxrwx</B> (777) に設定します。
<P><B>L</B> または <B>S</B> 命令内のフィールドについての以下の説明は、
<A HREF="#HDRWQ635">uss テンプレート例</A> からのフルアカウント・テンプレート内の 1 つの例を引用しています。
<PRE>   S /afs/abc.com/public/$USER $MTPT/public
</PRE>
<P><B>L</B> および <B>S</B> 命令の構文は、以下のとおりです。
<PRE>   L  <VAR>existing_file</VAR>  <VAR>link</VAR>
   S  <VAR>existing_file</VAR>  <VAR>link</VAR>
</PRE>
<P>ここで、
<DL>
<P><DT><B><B>L</B>
</B><DD>ハード・リンク作成の命令を指示します。
<P><DT><B><B>S</B>
</B><DD>記号リンク作成の命令を指示します。
<P><DT><B><VAR>existing_file</VAR>
</B><DD>既存ファイルの完全なパス名を指定します。それがユーザーのホーム・ディレクトリーまたはそのサブディレクトリーに常駐している場合は、
$MTPT 変数を使用して、ホーム・ディレクトリーのパス名を指定するのが最も簡単です。<B>L</B> または <B>S</B>命令で $MTPT 変数を使用する場合、この変数は先行する <B>V</B> 命令の <VAR>mount_point</VAR> フィールドから値を取得します (この命令が <B>V</B> 命令に後続しなければならないのはこの依存関係によります)。
<P>
<P>名前が番号記号 (<B>#</B>) またはパーセント記号 (<B>%</B>) で始まるファイルに対して、記号リンクを作成してはいけません。中身が # または % で始まるシンボリック・リンクを読み取ると、キャッシュ・マネージャーはそれを、それぞれ正規のマウント・ポイントと読み取り / 書き込み可能なマウント・ポイントとして解釈します。
<P>
<P>ABC Corporation の例では、先行の <B>X</B> 命令によって作成とマウントを行われた共用読み取り可能ボリュームに対するリンクを作成します。
<P>
<PRE>   /afs/abc.com/public/$USER
</PRE>
<P><DT><B><VAR>link</VAR>
</B><DD>ファイルに対する 2 番目の名前の完全なパス名を指定します。それがユーザーのホーム・ディレクトリーまたはそのサブディレクトリーに常駐している場合は、
$MTPT 変数を使用して、ホーム・ディレクトリーのパス名を指定するのが最も簡単です。
<P>
<P>読み取り専用のボリュームに新規のリンクを作成しようとしたことが原因の障害が起きないように、リンクへの読み取り / 書き込みパス名を指定してください。規則では、パス名の第 2 レベルのセル名の前にピリオドを付けて読み取り / 書き込みパスを示します (<B>/afs/.abc.com</B> など)。このフィールドに $MTPT 変数を使用する場合、<B>V</B> 命令の <VAR>mount_point</VAR> フィールドの値は既に読み取り / 書き込みパスを示しているはずです。ファイル・スペースの読み取り / 書き込みパスと読み取り専用パスの概念の詳細については、<A HREF="auagd010.htm#HDRWQ294">ボリュームの取り付け</A> を参照してください。
<P>
<P>ABC Corporation の例では、
<B>public</B> と呼ばれるリンクをユーザーのホーム・ディレクトリーに以下のように作成します。
<P>
<PRE>   $MTPT/public
</PRE>
</DL>
<A NAME="IDX7690"></A>
<A NAME="IDX7691"></A>
<A NAME="IDX7692"></A>
<A NAME="IDX7693"></A>
<P><H3><A NAME="HDRWQ642" HREF="auagd002.htm#ToC_562">A 命令によるアカウント・セキュリティーの強化</A></H3>
<P>テンプレート・ファイル内の<B>A</B> 命令は、以下の制限をユーザーのパスワード選択および認証試行に課すことによってセルのセキュリティーを強化します。
<UL>
<LI>ユーザーのパスワード存続時間を制限する。存続時間が有効期限切れになると、ユーザーは、それ以降、認証するためにそのパスワードを使用できず、それを変更しなければなりません。
</LI><LI>ユーザーが最後に使用した 20 のパスワードの再使用を禁止する。
</LI><LI>ユーザーが認証中に誤ったパスワードを連続して入力できる回数を制限し、認証サーバーがその制限回数の超過後どれだけの間認証の試行を拒否するか (<I>アカウント・ロックアウト</I>と呼ばれる) を制限する。たいていのセルの正規ユーザー・アカウントの場合、お勧めするのは、制限が 9 回、ロックアウト時間が 25 分です。
</LI></UL>
<P><B>A</B> 命令内のフィールドについての以下の説明では、
<A HREF="#HDRWQ635">uss テンプレート例</A> からのフルアカウント・テンプレート内の例を引用しています。この例では、パスワード存続時間を 250 日に設定し、パスワードの再使用を禁止し、認証試行の失敗回数を 9 回に制限し、この認証試行の失敗が制限回数を超えた場合、ロックアウト時間を 25 分に設定します。
<PRE>   A $USER 250 noreuse 9 25
</PRE>
<P><B>A</B> 命令の構文は以下のとおりです。
<PRE>   A  <VAR>username</VAR>  <VAR>password_lifetime</VAR>  <VAR>password_reuse</VAR>  <VAR>failures</VAR>  <VAR>locktime</VAR>
</PRE>
<P>ここで、
<DL>
<P><DT><B><B>A</B>
</B><DD>セキュリティー強化の命令を指示します。
<P><DT><B><VAR>username</VAR>
</B><DD>セキュリティー制限を課す認証データベース項目に名前を付けます。
$USER 変数を使用して、<B>uss add</B> コマンドの <B>-user</B> 引き数か、バルク入力ファイルの <B>add</B> 命令の <VAR>username</VAR> フィールドからユーザー名を読み取ります。ABC Corporation の例では、この値を使用します。
<P><DT><B><VAR>password_lifetime</VAR>
</B><DD>ユーザーのパスワードが変更された後、それが有効であり続ける日数を設定します。パスワードが無効になる (有効期限切れになる) と、ユーザーは、認証できなくなりますが、その後 30 日間は、
<B>kpasswd</B> コマンドを発行してパスワードを変更できます (それ以降は、パスワードを変更できるのは、管理者だけです)。
<P>
<P><B>1</B> から <B>254</B> の範囲から整数を指定して、有効期限切れまでの日数を指定し、値 <B>0</B> を指定して、パスワードが決して有効期限切れにならないことを指示し、または、値 $PWEXPIRES を指定して、
<B>uss add</B> または <B>uss bulk</B> コマンドの <B>-pwexpires</B> 引き数から日数を読み取ります。<B>A</B> 命令がテンプレート・ファイル内に表示されない場合、デフォルトでは、ユーザーのパスワードは決して有効期限切れになりません。
<P>
<P>ABC Corporation の例では、250 日のパスワード存続時間を設定します。
<P><DT><B><VAR>password_reuse</VAR>
</B><DD>ユーザーが自分のパスワードを (<B>kpasswd</B> または <B>kas setpassword</B> コマンドを使用して) 自分が最後に使用した 20 のパスワードに似たパスワードに変更するのを、可能にするかどうかを決定する。許容値は、再使用を許可する <B>reuse</B> 、および再使用を禁止する <B>noreuse</B> です。<B>A</B> 命令がテンプレート・ファイル内に表示されない場合、デフォルトは、パスワードの再使用を許可します。
<P>
<P>ABC Corporation の例では、パスワードの再使用を禁止します。
<P><DT><B><VAR>failures</VAR>
</B><DD>ユーザーが認証中に、誤ったパスワードを提示できる連続回数を設定します (<B>klog</B> コマンドまたは AFS トークンを許可するログイン・ユーティリティーを使用して)。ユーザーが制限を超過すると、認証サーバーは、
<VAR>locktime</VAR> フィールド内に指定された時間にわたって、以降の認証試行を拒絶します。
<P>
<P><B>1</B> から <B>254</B> の範囲から整数を指定して、許可される失敗回数を指定するか、または、値 <B>0</B> を指定して、失敗回数に制限がないということを指示します。
<B>A</B> 命令がテンプレート・ファイル内に表示されない場合、デフォルトは、無制限の失敗回数を許可します。
<P>
<P>ABC Corporation の例では、失敗試行の制限回数を 9 回に設定します。
<P><DT><B><VAR>locktime</VAR>
</B><DD><VAR>failures</VAR> フィールド内に設定された失敗の制限回数を超過したユーザーからの認証試行を、認証サーバーがどれほど長く拒絶するかということを指定します。
<P>
<P>時間と分の数 (<VAR>hh</VAR>:<VAR>mm</VAR>) または分だけ (<VAR>mm</VAR>) を、
<B>01</B> (1 分) から <B> 36:00</B> (36 時間) の範囲から指定します。認証サーバーは、自動的に、<B>36:00</B> よりも大きいすべての値を <B>36:00</B> に削減し、また、すべての非ゼロ値を 8.5 分の倍数で、次に高い最初の値に切り上げます。値 <B>0</B> (ゼロ) により、ロックアウト時間は無限に設定されます。この場合、管理者は常に <B>kas unlock</B> コマンドを発行してアカウントのロックを解除しなければなりません。
<P>
<P>ABC Corporation の例では、ロックアウト時間を 25 分に設定します。これは、25 分 30 秒 に切り上げられます (8.5 分の、次に高い倍数)。
</DL>
<A NAME="IDX7694"></A>
<A NAME="IDX7695"></A>
<A NAME="IDX7696"></A>
<A NAME="IDX7697"></A>
<A NAME="IDX7698"></A>
<A NAME="IDX7699"></A>
<P><H3><A NAME="HDRWQ643" HREF="auagd002.htm#ToC_563">X 命令によるコマンド実行</A></H3>
<P>テンプレート・ファイル内の <B>X</B> 命令は、標準の UNIX コマンド、シェル・スクリプトやプログラム、AFS コマンドなどのコマンドを実行します。コマンド文字列は、標準のテンプレート変数を組み込むことができ、
<B>X</B> 命令は、いくつでもテンプレート・ファイル内に表示できます。命令が、別の命令によって作成された要素を操作する場合、その要素は命令の後に表示されねばなりません。
<P><B>X</B> 命令内のフィールドについての以下の説明は、
<A HREF="#HDRWQ635">uss テンプレート例</A> からのフルアカウント・テンプレート内の例を引用しています。
<PRE>   X "create_public_vol $USER $1 $2"
</PRE>
<P><B>X</B> 命令の構文は以下のとおりです。
<PRE>   X "<VAR>command</VAR>"
</PRE>
<P>ここで、<VAR>command</VAR> は、実行するコマンドを指定しています。1 行文字列がスペースを含んでいる場合は、二重引用符で囲みます。コマンド文字列は、
<B>uss</B> コマンド・インタープリターがコマンドを適切なほかのコマンド・インタープリターに渡す前に解決するどの標準変数でも含むことができます。しかし、改行文字を含むことはできません。
<P>ABC Corporation の例では、<B>create_public_vol</B> と呼ばれるスクリプトを起動します。このスクリプトは、新規ユーザーと関連した別のボリュームを作成し、それを ABC Corporation のファイル・スペースの共通読み取り可能部分にマウントします。
<PRE>   "create_public_vol $USER $1 $2"
</PRE>
<P>これは、$USER 変数を使用してユーザー名を読み取り、それをボリューム名およびマウント・ポイント名の両方の一部にします。<B>uss</B> コマンドの発行者は、新規ボリューム対するサイトを指定するために、
$1 変数に対して、ファイル・サーバー・マシン名を、$2 変数に対して、パーティション名を与えます。
<A NAME="IDX7700"></A>
<A NAME="IDX7701"></A>
<A NAME="IDX7702"></A>
<A NAME="IDX7703"></A>
<A NAME="IDX7704"></A>
<A NAME="IDX7705"></A>
<A NAME="IDX7706"></A>
<A NAME="IDX7707"></A>
<A NAME="IDX7708"></A>
<A NAME="IDX7709"></A>
<A NAME="IDX7710"></A>
<HR><H2><A NAME="HDRWQ644" HREF="auagd002.htm#ToC_564">uss add コマンドによる個別アカウントの作成</A></H2>
<P>テンプレート・ファイルを作成した後、
<B>uss add</B> コマンドを発行することによって、個別のアカウントを作成できます (テンプレート作成命令については、<A HREF="#HDRWQ618">uss テンプレート・ファイルの作成</A>を参照してください)。コマンドを発行すると、<B>uss</B> コマンド・インタープリターは AFS サーバーと交信して、以下の事項を行います。
<UL>
<LI>保護データベース項目を作成する。デフォルトでは、保護サーバーは、テンプレートにおいて使用される $UID 変数の値になる AFS UID を割り当てます。
</LI><LI>認証データベース項目を作成し、初期パスワードの暗号化されたバージョンをレコードする。
</LI><LI>指定したテンプレートに定義されたアカウント・コンポーネントを作成し、必要に応じて、ファイル・サーバー、ボリューム・サーバー、およびボリューム・ロケーション (VL) サーバーと交信します。
</LI></UL>
<P>異なるファイル・システム・オブジェクトを作成するために、どのタイプの命令をテンプレート内に組み込むかということを確認するには、
<A HREF="#HDRWQ618">uss テンプレート・ファイルの作成</A> を参照してください。テンプレートが空の場合に、<B>uss add</B> コマンドを実行すると、保護データベースと認証データベース項目だけが作成されます。
<P><B>uss add</B> コマンドを発行するとき、テンプレート・ファイル内の各変数に対して、対応する引き数をコマンド行に組み込むことによって、値を与えてください。変数に対して値を与えることに失敗すると、<B>uss</B> コマンド・インタープリターは、空文字列と置換します。通常、これが原因で、アカウントの作成が失敗します。対応する変数がテンプレート内に表示されないコマンド行引き数を組み込むと、それは無視されます。
<P>変数と <B>uss add</B> コマンドに対する引き数の間のマッピングは、<A HREF="#TBLWQ645">表 4</A> に要約されています。この要約は、<A HREF="#TBLWQ621">表 3</A> から適合させましたが、値をコマンド行引き数から取る変数だけを含めました。
<BR>
<P><B><A NAME="TBLWQ645" HREF="auagd004.htm#FT_TBLWQ645">表 4. uss テンプレート変数のコマンド行引き数の送信元</A></B><BR>
<TABLE WIDTH="100%" BORDER>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%"><B>変数</B>
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%"><B>コマンド行引き数</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$MTPT
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%"><B>-mount</B> (<B>V</B> 命令に使用される場合)
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$NAME
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%">与えられていれば <B>-realname</B>、それ以外の場合は <B>-user</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$PART
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%"><B>-partition</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$PWEXPIRES
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%"><B>-pwexpires</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$SERVER
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%"><B>-server</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$UID
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%">与えられていれば <B>-uid</B>、それ以外の場合は保護サーバーによる自動割り当て
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$USER
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%"><B>-user</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="20%">$1 から $9
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="80%"><B>-var</B>
</TD></TR></TABLE>
<P><H3><A NAME="HDRWQ655" HREF="auagd002.htm#ToC_565">uss add コマンドにより AFS アカウントを作成するには</A></H3>
<OL TYPE=1>
<LI>以下の特権のすべてを持つ AFS ID として認証します。標準構成では、<B>admin</B> ユーザー・アカウントがこれらすべての特権を持っています。または、またはユーザーが個人的な管理アカウントを持っている可能性があります (セルのセキュリティーを向上させるには、管理手順を実行するときだけ、特別な特権アカウントを作成して使用するとよいでしょう。詳細は、
<A HREF="auagd021.htm#HDRWQ807">管理権限の概要</A> を参照してください)。必要な場合、認証するために <B>klog</B> コマンドを発行します。
<P>
<PRE>   % <B>klog</B> <VAR>admin_user</VAR>
   Password: <VAR>admin_password</VAR>
</PRE>
<P>
<P>次のリストは、必要な特権とそれを持っているかどうかの確認方法を示しています。
<UL>
<LI><B>system:administrators</B> グループのメンバーシップ。必要な場合には、<B>pts membership</B> コマンドを発行してください。このコマンドの詳細は、<A HREF="auagd021.htm#HDRWQ810">system:administrators グループのメンバーの表示</A> を参照してください。
<P>
<PRE>   % <B>pts membership system:administrators</B>
   
</PRE>
</LI><LI><B>/usr/afs/etc/UserList</B> ファイルに組み込まれていること。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、
<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>認証データベース項目の <TT>ADMIN</TT> フラグ。ただし、認証サーバーでは、固有の認証を実行するために常にパスワードの入力のためのプロンプトを出します。以下の説明では、
<B>uss</B> コマンド行自体に管理識別を指定するように指示しています。
</LI><LI>ユーザーのボリュームをマウントしているディレクトリーの ACL に対する <B>i</B> (<B>挿入</B>) および <B> l</B> (<B>ルックアップ</B>)アクセス権。必要に応じて、<B>fs listacl</B> コマンドを発行します。これについては、<A HREF="auagd020.htm#HDRWQ788">ACL の表示</A> で詳しく説明しています。
<P>
<PRE>   % <B>fs listacl</B> [&lt;<VAR>dir/file path</VAR>>]
</PRE>
<P>
<P><B>system:administrators</B> グループのメンバーは、<B>a</B> (<B>管理</B>)、および、デフォルトで <B>l</B> (<B>検索</B>) アクセス権を、常にすべての ACL に暗黙的に持っています。また、必要に応じて <B>fs setacl</B> コマンドを使用して、他の権限を付与することができます。
</LI></UL>
</LI><LI><B>(オプション)</B> ローカルのスーパー・ユーザー <B>root</B> としてログインする。このことは、新規のファイルまたはディレクトリーをローカル・ファイル・システム内に作成していて、オブジェクトが作成されるときに、代替所有者を指定したい場合にだけ必要です。これに関する問題の詳細は、<A HREF="#HDRWQ634">ローカル・ディスクのディレクトリーとファイルの作成について</A> を参照してください。
</LI><LI>使用しているテンプレート・ファイルの場所と機能を確認します。
<B>uss</B> コマンド・インタープリターがどこでテンプレートを見つけることを予期しているかということについての説明は、<A HREF="#HDRWQ632">テンプレート・ファイルを入れる場所</A> を参照してください。代替パス名を与えたい場合は常に与えることができます。また、テンプレートで使用される変数に注意し、<B>uss</B> コマンド行で、対応する引き数を指定するようにしてください。
</LI><LI><A NAME="LIWQ656"></A><B>(オプション)</B> テンプレートのあるディレクトリーへのディレクトリーを変更する。これを行うと、<A HREF="#LIWQ657">6</A> のステップでタイプしなければならないパス名のタイプに影響します。
<P>
<PRE>   % <B>cd</B> <VAR>template_directory</VAR>
</PRE>
</LI><LI><B>(オプション)</B> <B>uss add</B> コマンドを <B>-dryrun</B> フラグ付きで実行して、アカウントの作成をプリビューする。エラー・メッセージに注意し、もしあれば、原因を訂正してから、このコマンドを <B>-dryrun</B> フラグを付けずに再発行します。次のステップでは、<B>uss add</B> コマンドの構文を説明します。<B>-dryrun</B> フラグについて詳しくは、<A HREF="#HDRWQ609">操作のエラーおよび中断の回避と回復</A> を参照してください。
<A NAME="IDX7711"></A>
<A NAME="IDX7712"></A>
</LI><LI><A NAME="LIWQ657"></A><B>uss add</B> コマンドを発行してアカウントを作成します。
1 つの行にコマンドを入力します。ここで、コマンドが複数行に表示されているのは、読みやすくするためです。
<P>
<P><B>uss add</B> オペレーションによって、認証データベース項目を作成します。認証サーバーは、既存の AFS トークンを受け入れるのではなく、独自の認証を実行します。デフォルトでは、認証サーバーは、管理者のローカル (UNIX) 識別を認証します。この識別は AFS 特権管理者に対応しません。
<B>-admin</B> 引き数を組み込み、認証データベース項目に <TT>ADMIN</TT> フラグを持つ識別を指定します。項目にフラグがあることを確認するには、<A HREF="auagd021.htm#HDRWQ813">ADMIN フラグがオンになっていることを確認する</A>で説明するように、<B>kas  examine</B> コマンドを発行します。
<P>
<PRE>   % <B>uss add</B> <B>-user</B> &lt;<VAR>login name</VAR>>  <B>-admin</B> &lt;<VAR>administrator to authenticate</VAR>>   \
             [<B>-realname</B> &lt;<VAR>full name in quotes</VAR>>] [<B>-pass</B> &lt;<VAR>initial passwd</VAR>>]   \
             [<B>-pwexpires</B> &lt;<VAR>password expires in [0..254] days (0 => never)</VAR>>]  \
             [<B>-server</B> &lt;<VAR>FileServer for home volume</VAR>>]  \
             [<B>-partition</B> &lt;<VAR>FileServer's disk partition for home volume</VAR>>]  \
             [<B>-mount</B> &lt;<VAR>home directory mount point</VAR>>]  \
             [<B>-uid</B> &lt;<VAR>uid to assign the user</VAR>>]  \
             [<B>-template</B> &lt;<VAR>pathname of template file</VAR>>]  \
             [<B>-var</B> &lt;<VAR>auxiliary argument pairs (Numval)</VAR>><SUP>+</SUP>] [<B>-dryrun</B>] \
             [<B>-overwrite</B>] 
    Administrator's (<VAR>admin_user</VAR>) password: <VAR>admin_password</VAR>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>ad
</B><DD>は、<B>add</B> の受け入れ可能な省略形です。
<P><DT><B>-user
</B><DD>ユーザーの認証データベースおよび保護データベースの項目に名前を付けます。この名前は、ユーザー名 (ユーザーがログインする名前) になりますので、多くのオペレーティング・システムによってユーザー名 (通常、
8 つ以内の小文字を含む) に課される制約事項に従わなければなりません。また、以下の文字の使用を避けます。コロン (<B>:</B>)、セミコロン (<B>;</B>)、コンマ (<B>,</B>)、単価記号 (<B>@</B>)、スペース、改行、およびピリオド (<B>.</B>)。これは、一般に特殊な管理用の名前に使用します。
<P>
<P>この引き数は、テンプレート・ファイル内の $USER 変数に値を与えます。ユーザー名の標準化に関する提案については、
<A HREF="auagd007.htm#HDRWQ74">ユーザー名の選択とほかのアカウント・コンポーネントの命名</A>を参照してください。
<P><DT><B>-admin
</B><DD>認証データベースの項目に <TT>ADMIN</TT>フラグを持つ、<B>admin</B> などの管理アカウントを指定します。
password プロンプトはアカウントを <VAR>admin_user</VAR> として表示します。適切なパスワードを、<VAR>admin_password</VAR> として入力します。
<P><DT><B>-realname
</B><DD>ユーザーの実際のフルネームを指定します。ユーザーのフルネームがスペースまたは句読点を含んでいる場合は、二重引用符で囲みます。ユーザーのフルネームを与えなければ、それは、
<B>-user</B> 引き数で与えられたユーザー名にデフォルトします。
<P>
<P>この引き数は、テンプレート・ファイル内の $NAME 変数に値を与えます。
<B>/etc/passwd</B> などのローカル・パスワード・ファイル内に項目を作成するための自動プロセスの一部として、この引き数と変数をどのように使用するかについて詳しくは<A HREF="#HDRWQ613">共通送信元パスワード・ファイルの作成</A>を参照してください。
<P><DT><B>-pass
</B><DD>ユーザーの初期パスワードを指定します。パスワードを処理する AFS コマンドは、実際には、無制限の長さの文字列を受け入れますが、
8 つまたはそれ以下の文字数のパスワードを使用するのが最良です。8つの文字数は、多くのアプリケーションやユーティリティーが受け入れる最大長です。
<P>
<P>初期パスワードの選択で、考えられる候補には、ユーザー名、社会保障番号などからの数字の文字列、または <B>changeme</B> などの標準文字列が含まれます。<B>changeme</B>は、この引き数を与えなかった場合のデフォルトです。テンプレート・ファイル内に、対応する変数がありません。
<P>
<P>ユーザーが初めて AFS で認証した後すぐに、パスワードを本当の秘密の文字列に変更することを、ユーザーに指示してください。<I>AFS 使用者の手引き</I> では、AFS パスワードを変更するための <B>kpasswd</B> コマンドの使用方法を説明しています。
<P><DT><B>-pwexpires
</B><DD>ユーザーのパスワードが変更された後、それが有効であり続ける日数を設定します。<B>1</B> から <B>254</B>の範囲から整数を与えて、有効期限までの日数を指定するか、または、値 <B>0</B> を指定して、パスワードが決して有効期限切れにならない (この引き数を与えない場合、デフォルト) ということを指示します。パスワードが無効になる (有効期限切れになる) と、ユーザーは、認証できなくなりますが、その後 30 日間は、
<B>kpasswd</B> コマンドを発行してパスワードを変更できます。それ以降は、パスワードを変更できるのは、管理者だけです。
<P>
<P>この引き数は、テンプレート・ファイル内の $PWEXPIRES 変数に値を与えます。
<P><DT><B>-server
</B><DD>新規ユーザーのボリュームを作成するファイル・サーバー・マシンに名前を付けます。完全に修飾されたホスト名 (たとえば、<B>fs1.abc.com</B>) を与えることが最も望ましいですが、省略形式も許容されます。ただし、<B>uss add</B> コマンドを発行するときに、省略形式を解決する、セルの命名サービスが使用可能でなければなりません。
<P>
<P>この引き数は、テンプレート・ファイル内の $SERVER 変数に値を与えます。完全に修飾されたホスト名をコマンド行にタイプしなければならないことを避けるには、
$SERVER 変数と定数 (たとえば、セルのドメイン名) とを、テンプレート・ファイル内の <B>V</B> 命令の <VAR>server</VAR> フィールドで結合します。例については、<A HREF="#HDRWQ637">V 命令によるボリュームの作成</A> を参照してください。
<P><DT><B>-partition
</B><DD>ユーザーのホーム・ボリュームを作成するパーティションを指定します。これは、
<B>-server</B> 引き数によって名付けられたファイル・サーバー・マシン上になければなりません。パーティションをその完全な名前 (たとえば、<B>/vicepa</B>) によって識別するか、あるいは、
<A HREF="auagd023.htm#HDRWQ841">省略形と別名を使用するための規則</A> にリストされた省略形の 1 つを使用します。
<P>
<P>この引き数は、テンプレート・ファイル内の $PART 変数に値を与えます。
<P><DT><B>-mount
</B><DD>セルの読み取り / 書き込みファイル・スペース内のユーザーのホーム・ディレクトリーのパスを指定します。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。
<P>
<P>この引き数は、テンプレート・ファイル内の $MTPT 変数に値を与えますが、
<B>V</B> 命令の <VAR>mount_point</VAR> フィールドに表示される値だけしか与えません。$MTPT 変数が以降の命令のどれかに表示される場合、それは、値を、この引き数から直接に取るのではなく、
<B>V</B> 命令の <VAR>mount_point</VAR> フィールドから取ります。この引き数と $MTPT 変数の使用方法についての詳細は、<A HREF="#HDRWQ637">V 命令によるボリュームの作成</A> を参照してください。
<P><DT><B>-uid
</B><DD><B>0</B> (ゼロ) 以外の正の整数を指定して、ユーザーの AFS UID として割り当てます。この引き数は、省略するのが最良で、保護サーバーに <TT>max user id</TT> カウンターの現在値よりも 1 つだけ大きい AFS UID を割り当てるのを許可します。(カウンターを表示するには、
<A HREF="auagd019.htm#HDRWQ772">AFS ID カウンターを表示する</A>に説明するように、<B>pts listmax</B> を使用します)
<P>
<P>この引き数を使用しなければならない理由がある場合 (おそらく、ユーザーがすでに UNIX UIDを所有しているので)、最初に、<B>pts examine</B> コマンドを使用して、どの既存アカウントも、望ましい AFS UID をまだ所有していないということを検査します。もし、所有しているアカウントが 1 つでもあれば、アカウント作成のプロセスは、エラーで終了します。
<P>
<P>この引き数は、テンプレート・ファイル内の $UID 変数に値を与えます。
<P><DT><B>-template
</B><DD>テンプレート・ファイルのパス名を指定します。この引き数を省略すると、コマンド・インタープリターは次の各ディレクトリー順に <B>uss.template</B> という名前のファイルを検索します。
<OL TYPE=a>
<LI>現行作業ディレクトリー
</LI><LI><B>/afs/</B><VAR>cellname</VAR><B>/common/uss</B>、ここで、<VAR>cellname</VAR> は、ローカル・セルに名前を付けます
</LI><LI><B>/etc</B>
</LI></OL>
<P>
<P>
<P><B>uss.template</B> 以外のファイル名を、パス名なしで指定すると、コマンド・インタープリターは、そのファイル名を求めて、指示されたディレクトリーを検索します。フルパス名または部分パス名を指定すると、コマンド・インタープリターは、指定されたファイルだけと交信します。コマンド・インタープリターでは、パス名の一部は現行作業ディレクトリーとの関連で解釈されます。
<P>
<P>指定されたテンプレート・ファイルが空 (ゼロ長) の場合、このコマンドは、保護および認証データベース項目だけを作成します。
<P>
<P>テンプレート・ファイルの構成の仕方を学ぶには、<A HREF="#HDRWQ618">uss テンプレート・ファイルの作成</A> を参照してください。
<P><DT><B>-var
</B><DD>テンプレート・ファイル内に表示され得る $1 から $9 までの番号変数のそれぞれに値を指定します 番号変数を使用して、標準セットの一部ではない <B>uss</B> テンプレート・ファイル内の変数に値を割り当てることができます。
<P>
<P>この引き数の各インスタンスに対して、以下の 2 つの部分を、指示された順序で、スペースで分離して与えます。
<UL>
<LI>テンプレート・ファイル内の変数と一致する <B>1</B> から <B> 9</B> の範囲からの整数。ドル記号は、付けてはいけません。
</LI><LI>変数の値として割り当てる英数字の文字列。
</LI></UL>
<P>
<P>
<P>番号変数の使い方を学ぶには、
<A HREF="#HDRWQ637">V 命令によるボリュームの作成</A> の <B>V</B> 命令の <VAR>quota</VAR> フィールドについての説明を参照してください。
<P><DT><B>-dryrun
</B><DD>コマンド・インタープリターがコマンドを実行する際に行うアクションを、実際には行わずに、レポートします。
<P><DT><B>-overwrite
</B><DD>ファイル・システム内に存在し、かつ、
<B>-template</B> 引き数によって名付けられたテンプレート・ファイル内の <B>D</B>、
<B>E</B>、<B>F</B>、<B>L</B>、または <B>S</B> 命令内に定義されている、ディレクトリー、ファイル、およびリンクを上書きします。このフラグを省略すると、コマンド・インタープリターは、各要素ごとにプロンプトを出して、それらのすべての要素を上書きするかどうかを尋ねます。
</DL>
</LI><LI>新規ユーザーのホーム・ディレクトリーが複写されたボリュームにある場合、<A HREF="auagd010.htm#HDRWQ280">読み取り / 書き込みボリュームの複写 (読み取り専用ボリュームの作成)</A> で説明されているように <B>vos release</B> コマンドを使用してそのボリュームをリリースしてください。
<P>
<PRE>   
   % <B>vos release</B> &lt;<VAR>volume name or ID</VAR>>
   
</PRE>
<P>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">このステップは、ホーム・ディレクトリーの親ディレクトリー自身が複写されたボリュームのマウント・ポイントでない場合 (その方が管理しやすい) にも必要です。たとえば、ABC Corporation のテンプレートがユーザー・ボリュームのマウント・ポイントを <B>/afs/abc.com/usr</B> ディレクトリーにするとします。このディレクトリーはマウント・ポイントではなく、通常のディレクトリーであるため、<B>/afs/abc.com</B> ディレクトリーにマウントされた <B>root.cell</B> ボリュームに存在します。このボリュームは複写されているため、管理者は、新規のマウント・ポイントを作成して変更を行った後で <B>vos release</B> コマンドを発行しなければなりません。
</TD></TR></TABLE>
</LI><LI>ユーザーがログインできる各 AFS クライアント・マシンのローカル・パスワード・ファイル (<B>/etc/passwd</B> またはそれに相当するもの) にある新規ユーザー用の項目を作成します。このステップの自動化に関する提案については、<A HREF="#HDRWQ613">共通送信元パスワード・ファイルの作成</A>を参照してください。
<P>
<P>自動化メソッドを使用しない場合でも、保護サーバーによって自動的に割り当てるか、または、<B>-uid</B> 引き数を使って割り当てて、ユーザーの UNIX UID を AFS UID に一致するように設定します。新規ユーザーの AFS UID は <B>uss add</B> 出力によって生成されるトレースに表示されますが、<A HREF="auagd019.htm#HDRWQ748">保護データベース項目を表示する</A> で説明されているように <B>pts examine</B> コマンドを使用して表示することもできます。
</LI></OL>
<A NAME="IDX7713"></A>
<A NAME="IDX7714"></A>
<A NAME="IDX7715"></A>
<A NAME="IDX7716"></A>
<A NAME="IDX7717"></A>
<A NAME="IDX7718"></A>
<A NAME="IDX7719"></A>
<HR><H2><A NAME="HDRWQ658" HREF="auagd002.htm#ToC_566">uss delete コマンドによる個別アカウントの削除</A></H2>
<P><B>uss delete</B> コマンドは、コマンド行に与える引き数に従って AFS ユーザー・アカウントを削除します。このコマンドは、
<B>uss add</B> コマンドとは違って、テンプレート・ファイルを使用しません。コマンドを発行すると、<B>uss</B>コマンド・インタープリターは AFS サーバーと交信して、以下の事項を行います。
<UL>
<LI>ユーザーのホーム・ボリュームに対するマウント・ポイントを削除する。
</LI><LI><B>-savevolume</B> フラグを組み込んでいなければ、ユーザーのホーム・ボリュームと関連する VLDB 項目を削除する。
</LI><LI>ユーザーの認証データベース項目を削除する。
</LI><LI>ユーザーの保護データベース項目を削除する。
</LI></UL>
<P><B>uss delete</B> コマンドを発行する前に、以下のオプション・タスクを実行することもできます。
<UL>
<LI>ユーザーのホーム・ボリュームをテープまたは他の永久媒体にコピーして、ユーザー名および UID を予約済みリストに記録します。この情報により、ユーザーがユーザーのセルに戻った場合に、そのユーザーのアカウントを容易に復元することができます。ボリュームをバックアップする AFS バックアップ・システムの使用についての詳細は、
<A HREF="auagd011.htm#HDRWQ334">AFS バックアップ・システムの構成</A> および <A HREF="auagd012.htm#HDRWQ383">AFS データのバックアップと復元</A> を参照してください。
</LI><LI>ユーザーが、なにかほかのボリュームの専用使用 (たとえば、プロジェクトに関連したデータを保管するためのボリュームなど) を持っている場合、それぞれのボリュームのバックアップ・コピーを作成し、その後、<A HREF="auagd010.htm#HDRWQ321">ボリュームおよびそのマウント・ポイントの除去</A>に説明するように、ボリュームおよびそのマウント・ポイントを手動で除去しなければならない。
</LI><LI><B>pts listowned</B> 使用して、ユーザーが所有する任意のグループを表示する。<A HREF="auagd019.htm#HDRWQ751">ユーザーまたはグループが所有しているグループをリストする</A>に、その説明があります。
<B>pts delete</B> コマンドを使用してグループを移動するか、または <B>pts chown</B> コマンドを使用して所有権をほかのユーザーまたはグループに転送するかを決めます。これについての説明は、<A HREF="auagd019.htm#HDRWQ764">保護データベース項目を削除するには</A> および <A HREF="auagd019.htm#HDRWQ766">グループの所有者を変更する</A> にあります。または、終了する前に、ユーザーにグループの所有権を削除または転送させることができます。所有者がデータベースから削除された後、保護データベースに残っているグループは、<VAR>オーファン</VAR>と呼ばれ、
<B>system:administrators</B> グループのメンバーだけがそれを管理できます。
</LI></UL>
<P>バルク入力ファイルに <B>exec</B> 命令を組み込み、
<B>uss bulk</B> コマンドを使用してアカウントを削除することにより、これらのタスクの一部を自動化することができます。<A HREF="#HDRWQ660">uss bulk コマンドによる複数のアカウントの作成と削除</A> を参照してください。
<P><H3><A NAME="HDRWQ659" HREF="auagd002.htm#ToC_567">AFS アカウントを削除するには</A></H3>
<OL TYPE=1>
<LI>以下の特権のすべてを持つ AFS ID として認証します。標準構成では、<B>admin</B> ユーザー・アカウントがこれらすべての特権を持っています。または、またはユーザーが個人的な管理アカウントを持っている可能性があります (セルのセキュリティーを向上させるには、管理手順を実行するときだけ、特別な特権アカウントを作成して使用するとよいでしょう。詳細は、
<A HREF="auagd021.htm#HDRWQ807">管理権限の概要</A> を参照してください)。必要な場合、認証するために <B>klog</B> コマンドを発行します。
<P>
<PRE>   % <B>klog</B> <VAR>admin_user</VAR>
   Password: <VAR>admin_password</VAR>
</PRE>
<P>
<P>次のリストは、必要な特権とそれを持っているかどうかの確認方法を示しています。
<UL>
<LI><B>system:administrators</B> グループのメンバーシップ。必要な場合には、<B>pts membership</B> コマンドを発行してください。このコマンドの詳細は、<A HREF="auagd021.htm#HDRWQ810">system:administrators グループのメンバーの表示</A> を参照してください。
<P>
<PRE>   % <B>pts membership system:administrators</B>
   
</PRE>
</LI><LI><B>/usr/afs/etc/UserList</B> ファイルに組み込まれていること。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、
<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>認証データベース項目の <TT>ADMIN</TT> フラグ。ただし、認証サーバーでは、固有の認証を実行するために常にパスワードの入力のためのプロンプトを出します。以下の説明では、
<B>uss</B> コマンド行自体に管理識別を指定するように指示しています。
</LI><LI>ユーザーのホーム・ディレクトリーが存在するディレクトリーの ACL に対する <B>d</B> (<B>削除</B>) アクセス権。必要に応じて、<B>fs listacl</B> コマンドを発行します。これについては、<A HREF="auagd020.htm#HDRWQ788">ACL の表示</A> で詳しく説明しています。
<P>
<PRE>   % <B>fs listacl</B> [&lt;<VAR>dir/file path</VAR>>]
</PRE>
<P>
<P><B>system:administrators</B> グループのメンバーは、<B>a</B> (<B>管理</B>)、および、デフォルトで <B>l</B> (<B>検索</B>) アクセス権を、常にすべての ACL に暗黙的に持っています。また、必要に応じて <B>fs setacl</B> コマンドを使用して、他の権限を付与することができます。
</LI></UL>
</LI><LI>それぞれ削除された、ユーザーのアカウント情報、所有されたグループ、およびボリュームの継続保守に関して、この機能グループの概要の部分で説明した問題を考慮し、解決する。
</LI><LI><B>(オプション)</B> <B>uss delete</B> コマンドを <B>-dryrun</B> フラグ付きで実行して、アカウントの削除をプリビューする。エラー・メッセージに注意し、もしあれば、原因を訂正してから、このコマンドを <B>-dryrun</B> フラグを付けずに再発行します。次のステップでは、<B>uss delete</B> コマンドの構文を説明します。
<A NAME="IDX7720"></A>
<A NAME="IDX7721"></A>
</LI><LI><B>uss delete</B> コマンドを発行して、アカウントを削除します。
1 つの行にコマンドを入力します。ここで、コマンドが複数行に表示されているのは、読みやすくするためです。
<P>
<P>削除オペレーションによって、常にユーザーの項目は認証データベースから削除されます。認証サーバーは、既存の AFS トークンを受け入れるのではなく、独自の認証を実行します。デフォルトでは、認証サーバーは、管理者のローカル (UNIX) 識別を認証します。この識別は AFS 特権管理者に対応しません。
<B>-admin</B> 引き数を組み込み、認証データベース項目に <TT>ADMIN</TT> フラグを持つ識別を指定します。項目にフラグがあることを確認するには、
<A HREF="auagd021.htm#HDRWQ813">ADMIN フラグがオンになっていることを確認する</A>で説明するように、<B>kas  examine</B> コマンドを発行します。
<P>
<PRE>   % <B>uss delete</B> <B>-user</B> &lt;<VAR>login name</VAR>>  \
                <B>-mountpoint</B> &lt;<VAR>mountpoint for user's volume</VAR>>  \
                [<B>-savevolume</B>]  <B>-admin </B> &lt;<VAR>administrator to authenticate</VAR>>  \
                [<B>-dryrun</B>] 
    Administrator's (<VAR>admin_user</VAR>) password: <VAR>admin_password</VAR>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>d
</B><DD><B>delete</B> の受け入れ可能な最も短い省略形です。
<P><DT><B>-user
</B><DD>保護データベースおよび認証データベースから削除する項目に名前を付けます。
<P><DT><B>-mountpoint
</B><DD>削除するマウント・ポイント (ユーザーのホーム・ディレクトリー) のパス名を指定します。<B>-savevolume</B> 引き数が組み込まれていない限り、そこにマウントされたボリュームも、
VLDB からのそのレコードと同様に、それが常駐しているファイル・サーバー・マシンから削除されます。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。
<P>
<P>読み取り専用のボリュームからマウント・ポイントを削除しようとしたことが原因の障害が起きないように、マウント・ポイントへの読み取り /書き込みパスを指定してください。規則では、パス名の第 2 レベルのセル名の前にピリオドを付けて読み取り / 書き込みパスを示します (<B>/afs/.abc.com</B> など)。ファイル・スペースの読み取り / 書き込みパスと読み取り専用パスの概念の詳細については、
<A HREF="auagd010.htm#HDRWQ294">ボリュームの取り付け</A> を参照してください。
<P><DT><B>-savevolume
</B><DD>ユーザーのボリュームおよび VLDB 項目を保存します。
<P><DT><B>-admin
</B><DD>認証データベースの項目に <TT>ADMIN</TT>フラグを持つ、<B>admin</B> などの管理アカウントを指定します。
password プロンプトはアカウントを <VAR>admin_user</VAR> として表示します。適切なパスワードを、<VAR>admin_password</VAR> として入力します。
<P><DT><B>-dryrun
</B><DD>コマンド・インタープリターがコマンドを実行する際に行うアクションを、実際には行わずに、レポートします。
</DL>
</LI><LI>削除されたユーザーのホーム・ディレクトリーが複写されたボリュームにあった場合、<A HREF="auagd010.htm#HDRWQ280">読み取り / 書き込みボリュームの複写 (読み取り専用ボリュームの作成)</A> で説明されているように <B>vos release</B> コマンドを使用してそのボリュームをリリースしてください。
<P>
<PRE>   
   % <B>vos release</B> &lt;<VAR>volume name or ID</VAR>>
   
</PRE>
<P>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">このステップは、ホーム・ディレクトリーの親ディレクトリー自身が複写されたボリュームのマウント・ポイントでない場合 (その方が管理しやすい) にも必要です。たとえば、ABC Corporation のテンプレートがユーザー・ボリュームのマウント・ポイントを <B>/afs/abc.com/usr</B> ディレクトリーにするとします。このディレクトリーはマウント・ポイントではなく、通常のディレクトリーであるため、<B>/afs/abc.com</B> ディレクトリーにマウントされた <B>root.cell</B> ボリュームに存在します。このボリュームは複写されているため、管理者は、マウント・ポイントを削除して変更を行った後で <B>vos release</B> コマンドを発行しなければなりません。
</TD></TR></TABLE>
</LI><LI>各クライアント・マシンのローカル・パスワード・ファイル (<B>/etc/passwd</B> または同等の) からユーザーの項目を削除します。AFS <B>package</B> ユーティリティーを使用する場合は、項目を共通送信元バージョンのファイルから除去するだけで十分です。将来、ユーザーのアカウントを再活動化する意図がある場合は、項目をコメント化するか、または、パスワード・フィールドにアスタリスク (*) を入れるほうが簡単です。
</LI></OL>
<A NAME="IDX7722"></A>
<A NAME="IDX7723"></A>
<A NAME="IDX7724"></A>
<A NAME="IDX7725"></A>
<A NAME="IDX7726"></A>
<HR><H2><A NAME="HDRWQ660" HREF="auagd002.htm#ToC_568">uss bulk コマンドによる複数のアカウントの作成と削除</A></H2>
<P><B>uss bulk</B> コマンドを使用すると、多くのアカウントを同時に作成したり、削除したりできます。このコマンドを実行する前に、以下の事項を行わなければなりません。
<UL>
<LI>アカウントを作成しようとしている場合は、
<B>uss add</B> コマンドを実行する前に行わなければならないのと同様に、テンプレートを構成する。同じテンプレートが、単一の <B>uss bulk</B> コマンドによって作成されたすべてのアカウントに適用されます。
</LI><LI><A HREF="#HDRWQ661">バルク入力ファイルの組み立て</A> で説明したように、アカウントの作成と削除を行い、関連したコマンドを実行する命令のバルク入力ファイルを構成する。
</LI></UL>
<A NAME="IDX7727"></A>
<A NAME="IDX7728"></A>
<P><H3><A NAME="HDRWQ661" HREF="auagd002.htm#ToC_569">バルク入力ファイルの組み立て</A></H3>
<P>5 つのタイプの命令をバルク入力ファイルに組み込むことができます。つまり、
<B>add</B>、<B>delete</B>、<B>exec</B>、
<B>savevolume</B>、および <B>delvolume</B> です。以下に、それらの用法を説明します。
<P><B>add 命令によるユーザー・アカウントの作成</B>
<P>各 <B>add</B> 命令が単一のユーザー・アカウントを作成します。したがって、基本的には、
1 つの <B>uss add</B> コマンドを発行するのと同じです。バルク入力ファイル内の <B>add</B> 命令の数には、制限がありません。
<P>以下の構文ステートメントによって示されるように、命令のフィールドの順序は、
<B>uss add</B> コマンドに対する引き数の順序に一致します (コマンドの引き数によっては、対応するフィールドを持っていませんが)。
<B>uss add</B> コマンドの引き数のように、多くのフィールドは、
<B>uss</B> テンプレート・ファイル内の変数に対して値を与えます。各命令は、ファイル内で単一行でなければなりません (改行文字は、末尾だけに置けます)。ここで、改行文字が複数行に表示されているのは、ただ、読みやすくするためです。
<PRE>   <B>add</B> <VAR>username</VAR>[<B>:</B><VAR>full_name</VAR>][<B>:</B><VAR>initial_password</VAR>][<B>:</B><VAR>password_expires</VAR>]
   [<B>:</B><VAR>file_server</VAR>][<B>:</B><VAR>partition</VAR>][<B>:</B><VAR>mount_point</VAR>][<B>:</B><VAR>uid</VAR>]
   [<B>:</B><VAR>var1</VAR>][<B>:</B><VAR>var2</VAR>][<B>:</B><VAR>var3</VAR>][<B>:</B><VAR>var4</VAR>][<B>:</B><VAR>var5</VAR>][<B>:</B><VAR>var6</VAR>][<B>:</B><VAR>var7</VAR>][<B>:</B><VAR>var8</VAR>][<B>:</B><VAR>var9</VAR>][<B>:</B>]
</PRE>
<P>各フィールドにおける許容値については、<I>AFS Administration Reference</I> の <B>uss バルク入力ファイル</B>の参照ページか、<A HREF="#HDRWQ655">uss add コマンドにより AFS アカウントを作成するには</A>の <B>uss add</B> コマンドの対応する引き数の説明を参照してください。いくつかの基本事項を以下に掲げます。
<UL>
<LI>行を文字列 <B>add</B> だけで開始する。<B>uss add</B> ではない。
</LI><LI>最初の引き数 <VAR>username</VAR> だけが必要。この引き数は、<B>uss add</B> コマンドに対する <B>-user</B>引き数に対応します。
</LI><LI><VAR>uss add</VAR> コマンドに対する <B>-realname</B> 引き数の値は、二重引用符で囲まなければならないが、<B>full_name</B> 値を二重引用符で囲ってはいけない。
</LI><LI>引き数に対する値を省略する場合は、間に何も入っていない 2 つのコロンで空のフィールドを指示する。対応するコマンド行引き数がオプションであるか、または対応する変数がテンプレート・ファイル内に表示されない場合は、フィールドを空のままにしておくことができます。最後のフィールド以外で実際の値を割り当てるすべてのフィールドには、値を与えるか、空のフィールドを指示するかしなければなりません。値を割り当てた最後のフィールドより後に空のフィールドを指示してもかまいませんが、必要ではありません。
</LI><LI>最後のフィールドの後、行をコロンと改行文字 (<B>&lt;Return></B>)か、または改行だけで終了する。
</LI><LI>最後の 9 つのフィールドは、番号変数 ($1 から $9) に値を割り当てるためのフィールドであり、昇順でリストされている。変数番号ではなく、値だけを指定します。
</LI></UL>
<P><B>delete 命令によるユーザー・アカウントの削除</B>
<P>各 <B>delete</B> 命令が単一のユーザー・アカウントを削除します。したがって、基本的には、1 つの <B>uss delete</B> コマンドを発行するのと同じです。バルク入力ファイル内の <B>delete</B> 命令の数には、制限がありません。
<P>表示画面上では、複数の行にわたることがありますが、バルク入力ファイル内のすべての命令と同様に、各 <B>delete</B> 命令は、ファイル内で単一行でなければなりません (改行文字は、末尾だけに置けます)。中括弧 (<B>{  }</B>) は、相互に排他的な 2 つの選択項目を示します。
<PRE>      <B>delete</B> <VAR>username</VAR><B>:</B><VAR>mount_point_path</VAR>[:{ <B>savevolume</B> | <B>delvolume</B> }][<B>:</B>]
</PRE>
<P>各フィールドにおける許容値については、<I>AFS Administration Reference</I> の <B>uss バルク入力ファイル</B>の参照ページか、
<A HREF="#HDRWQ659">AFS アカウントを削除するには</A> の <B>uss delete</B> コマンドの対応する引き数の説明を参照してください。いくつかの基本事項を以下に掲げます。
<UL>
<LI>行を文字列 <B>delete</B> だけで開始する。<B>uss delete</B> ではない。
</LI><LI>最初の 2 つの引き数 <VAR>username</VAR> および <VAR> mount_point_path</VAR> が必要。これらは、<B>uss delete</B> コマンドに対する <B>-user</B> および <B>-mountpoint</B> 引き数に対応します。
</LI><LI>3 番目のフィールドは、オプションであるが、ユーザーのホーム・ボリュームを、常駐しているファイル・サーバーから、対応する VLDB 項目と一緒に除去するかどうかを制御する。以下の 3 つの値が可能です。
<UL>
<LI>支配的なデフォルトに従って、ボリュームおよび VLDB 項目を処理する値がない。この支配的なデフォルトは、テンプレート・ファイル内の先行している <B>savevolume</B> または <B>delvolume</B> 命令によって確立される。デフォルトの設定方法については、それらの命令についての次の説明を参照してください。
</LI><LI>文字列 <B>savevolume</B> は、デフォルトを上書きして、ボリュームおよび VLDB 項目を保存する。
</LI><LI>文字列 <B>delvolume</B> は、デフォルトを上書きして、ボリュームおよび VLDB 項目を除去する。
</LI></UL>
</LI><LI>最後のフィールドの後、行をコロンと改行文字 (<B>&lt;Return></B>)か、または改行だけで終了する。
</LI></UL>
<P><B>exec 命令によるコマンドまたはスクリプトの実行</B>
<P><B>exec</B> 命令は、指示された AFS コマンド、コンパイル・プログラム、または UNIX シェル・スクリプトかコマンドを実行します。コマンド・プロセッサーは、<B>uss bulk</B> コマンドの発行者について、
AFS およびローカルの識別を想定します。このコマンドの発行者は、そのコマンドを実行するのに必要な特権を持っているはずです。
<P>この命令の構文は、以下のとおりです。
<PRE>   <B>exec</B> <VAR>command</VAR>
</PRE>
<P><VAR>command</VAR> 文字列を二重引用符 (" ") またはほかの区切り文字で囲む必要はありません。
<P><B>delvolume および savevolume 命令によるボリュームのデフォルト処理の設定</B>
<P><B>savevolume</B> および <B>delvolume</B> 命令は、バルク入力ファイル内で後続する <B>delete</B> 命令によって参照されたボリュームのデフォルト処理を設定します。それらの構文は、以下のとおりです。
<PRE>   <B>savevolume</B>
   <B>delvolume</B>
</PRE>
<P>両方の命令は、オプションであり、引き数も取りません。バルク入力ファイル内にどちらも表示されない場合、デフォルトによって、
<B>delete</B> 命令によって参照されたすべてのボリュームと VLDB 項目が除去されます。ファイルに <B>savevolume</B> 命令がある場合、この命令はファイル内の以降のすべての <B>delete</B> 命令によって参照されたボリュームと VLDB 項目の除去を防止します。<B>delvolume</B> 命令は、以降の <B>delete</B> 命令に対して明示的にデフォルト (削除) を設定します。
<P>どちらの命令の効力も、バルク入力ファイルが終了するまでか、またはその反対の命令が表示されるまで続きます。特定の <B>delete</B> 命令に対する支配的デフォルトを上書きするには、
<B>savevolume</B> または <B>delvolume</B> 文字列を命令の 3 番目のフィールドに書き込みます。
(また、<B>savevolume</B> と <B>delvolume</B> 命令の複数のインスタンスを使用して、デフォルトの削除とボリューム保存を交互に切り替えることができます。)
<P><H3><A NAME="Header_570" HREF="auagd002.htm#ToC_570">バルク入力ファイル命令の例</A></H3>
<P>認証専用のアカウントを作成するには、次の例のように最初の (<VAR>username</VAR>) 引き数だけを組み込んで <B>add</B> 命令を使用します。ユーザーの実名は、ユーザー名 (<B>anderson</B>) に一致するように設定され、初期パスワードは、文字列 <B>changeme</B> に設定されます。
<PRE>   add anderson 
</PRE>
<P>また、以下の例も認証専用のアカウントを作成しますが、実名および初期パスワードに対して非デフォルト値を設定します。
<PRE>   add smith:John Smith:js_pswd
</PRE>
<P>次の 2 つの <B>add</B> 命令の例では、ABC Corporation セル (<B>abc.com</B>) の管理者が次の <B>V</B> 命令を含む <B>uss</B> テンプレート・ファイルを作成していることが必要となります。
<PRE>   V user.$USER $SERVER.abc.com /vicep$PART 10000 /afs/.abc.com/usr/$3/$USER \
       $UID $USER all
</PRE>
<P>販売部の John Smith と、財務部の Pat Jones の ２ 人のユーザーに対してアカウントを作成するには、バルク入力ファイル内の適切な <B>add</B> 命令は、以下のとおりです。
<PRE>   add smith:John Smith:::fs1:a:::::marketing
   add jones:Pat Jones:::fs3:c:::::finance
</PRE>
<P>Smith に対する新規アカウントは、<B>smith</B> と呼ばれる、保護および認証データベース項目で構成されています。彼の初期パスワードは、デフォルトの文字列 <B>changeme</B> であり、保護サーバーが彼の AFS UID を生成します。彼のホーム・ボリュームは <B>user.smith</B> という名前で、10,000 KB の割り当て量を持ち、ファイル・サーバー・マシン <B>fs1.abc.com</B> のパーティション <B>/vicepa</B> 上に存在し、
<B>/afs/.abc.com/usr/marketing/smith</B> にマウントされています。<B>V</B> 命令の末尾の <B>$UID $USER all</B> の部分が、彼に自分のホーム・ディレクトリーの所有権およびその ACL 上のすべてのアクセス権を与えています。<B>jones</B> のアカウントも同様ですが、ファイル・サーバー・マシン <B>fs3.abc.com</B> のパーティション <B>/vicepc</B> に存在し、<B>/afs/.abc.com/usr/finance/jones</B> にマウントされている点だけが異なります。
<P><VAR>mount_point</VAR>、<VAR>uid</VAR>、<VAR>var1</VAR>、および <VAR>var2</VAR> に対応するフィールドが空 (最初の例の値 <TT>a</TT> と
<TT>marketing</TT> の間) になることに注意してください。これは、テンプレート・ファイルの <B>V</B>命令に対応する値が与えられていないからです。<VAR>initial_passwd</VAR> フィールドと <VAR>password_expires</VAR> フィールドも空になります。
<P>お望みならば、<B>add</B> 命令内の 9 つすべての番号変数に対して、値または空のフィールドを指定できます。その場合、バルク入力ファイル命令は次のようになります。
<PRE>   add smith:John Smith:::fs1:a:::::marketing::::::
   add jones:Pat Jones:::fs3:c:::::finance::::::
</PRE>
<P>以下の例は、いくつかの <B>delete</B> 命令と <B>savevolume</B> 命令を持ったバルク入力ファイルの機能グループです。最初の 3 つの命令が <B>savevolume</B> 命令の前に表示され、それらの 3 番目のフィールドがブランクであるので、対応するボリュームと VLDB 項目が除去されます。<B>terry</B> に対する <B>delete</B> 命令が <B>savevolume</B> 命令に後続しています。したがって、彼女のボリュームは、除去されません。しかし、
<B>johnson</B> に対するボリュームは、除去されます。なぜなら、<B>delete</B> 命令の 3 番目のフィールド内の <B>delvolume</B> 文字列が現行のデフォルトを上書きするからです。
<PRE>   delete smith:/afs/abc.com/usr/smith
   delete pat:/afs/abc.com/usr/pat
   delete rogers:/afs/abc.com/usr/rogers
   savevolume
   delete terry:/afs/abc.com/usr/terry
   delete johnson:/afs/abc.com/usr/johnson:delvolume
</PRE>
<P>以下の <B>exec</B> 命令の例は、セットの <B>add</B> 命令とセットの <B>delete</B> 命令の間の区切り記号として有用です。この命令は、<B>uss bulk</B> コマンドの進行について知らせてくれるメッセージを標準出力ストリーム上に生成します。
<PRE>   exec echo "Additions completed; beginning deletions..."
</PRE>
<P><H3><A NAME="Header_571" HREF="auagd002.htm#ToC_571">複数の AFS ユーザー・アカウントの作成と削除を行うには</A></H3>
<OL TYPE=1>
<LI>以下の特権のすべてを持つ AFS ID として認証します。標準構成では、<B>admin</B> ユーザー・アカウントがこれらすべての特権を持っています。または、またはユーザーが個人的な管理アカウントを持っている可能性があります (セルのセキュリティーを向上させるには、管理手順を実行するときだけ、特別な特権アカウントを作成して使用するとよいでしょう。詳細は、
<A HREF="auagd021.htm#HDRWQ807">管理権限の概要</A>を参照してください)。必要な場合、認証するために <B>klog</B> コマンドを発行します。
<P>
<PRE>   % <B>klog</B> <VAR>admin_user</VAR>
   Password: <VAR>admin_password</VAR>
</PRE>
<P>
<P>次のリストは、必要な特権とそれを持っているかどうかの確認方法を示しています。
<UL>
<LI><B>system:administrators</B> グループのメンバーシップ。必要な場合には、<B>pts membership</B> コマンドを発行してください。このコマンドの詳細は、<A HREF="auagd021.htm#HDRWQ810">system:administrators グループのメンバーの表示</A> を参照してください。
<P>
<PRE>   % <B>pts membership system:administrators</B>
   
</PRE>
</LI><LI><B>/usr/afs/etc/UserList</B> ファイルに組み込まれていること。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、
<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>認証データベース項目の <TT>ADMIN</TT> フラグ。ただし、認証サーバーでは、固有の認証を実行するために常にパスワードの入力のためのプロンプトを出します。以下の説明では、
<B>uss</B> コマンド行自体に管理識別を指定するように指示しています。
</LI><LI>各ボリューム・マウント・ポイントの親ディレクトリーの ACL に対する <B>d</B> (<B>削除</B>)、
<B>i</B> (<B>挿入</B>) および <B>l</B> (<B>ルックアップ</B>) アクセス権。必要に応じて、<B>fs listacl</B> コマンドを発行します。これについては、<A HREF="auagd020.htm#HDRWQ788">ACL の表示</A> で詳しく説明しています。
<P>
<PRE>   % <B>fs listacl</B> [&lt;<VAR>dir/file path</VAR>>]
</PRE>
<P>
<P><B>system:administrators</B> グループのメンバーは、<B>a</B> (<B>管理</B>)、および、デフォルトで <B>l</B> (<B>検索</B>) アクセス権を、常にすべての ACL に暗黙的に持っています。また、必要に応じて <B>fs setacl</B> コマンドを使用して、他の権限を付与することができます。
</LI></UL>
</LI><LI><B>(オプション)</B> ローカル・スーパーユーザー <B>root</B> としてログインしている。このことは、新規のファイルまたはディレクトリーをローカル・ファイル・システム内に作成していて、オブジェクトが作成されるときに、代替所有者を指定したい場合にだけ必要です。これに関する問題の詳細は、<A HREF="#HDRWQ634">ローカル・ディスクのディレクトリーとファイルの作成について</A> を参照してください。
</LI><LI>バルク入力ファイルが <B>add</B> 命令を組み込む場合は、使用しているテンプレート・ファイルの場所と機能を確認します。<B>uss</B> コマンド・インタープリターがどこでテンプレートを見つけることを予期しているかということについての説明は、<A HREF="#HDRWQ632">テンプレート・ファイルを入れる場所</A> を参照してください。代替パス名を与えたい場合は常に与えることができます。また、テンプレートにどの変数が表示されるかに注意し、<B>add</B> 命令または <B>uss bulk</B> コマンド行に、対応する引き数を与えるようにしてください。
</LI><LI><A HREF="#HDRWQ661">バルク入力ファイルの組み立て</A> 内の規則に従ったバルク入力ファイルを作成する。これから使用しようとしているテンプレートと同じディレクトリーにファイルを書き込むと、最も簡単です。
</LI><LI><B>(オプション)</B> バルク入力ファイルおよびテンプレート・ファイルが常駐するディレクトリーに変更する。
<P>
<PRE>   % <B>cd</B> <VAR>template_directory</VAR>
</PRE>
<A NAME="IDX7729"></A>
<A NAME="IDX7730"></A>
</LI><LI><A NAME="LIWQ662"></A><B>uss bulk</B> コマンドを発行して、アカウントを作成または削除 (あるいはその両方) する。1 つの行にコマンドを入力します。ここで、コマンドが複数行に表示されているのは、読みやすくするためです。
<P>
<P>バルク・オペレーションは、常に認証データベースのユーザー項目を操作します。認証サーバーは、既存の AFS トークンを受け入れるのではなく、独自の認証を実行します。デフォルトでは、認証サーバーは、管理者のローカル (UNIX) 識別を認証します。この識別は AFS 特権管理者に対応しません。
<B>-admin</B> 引き数を組み込み、認証データベース項目に <TT>ADMIN</TT> フラグを持つ識別を指定します。項目にフラグがあることを確認するには、<A HREF="auagd021.htm#HDRWQ813">ADMIN フラグがオンになっていることを確認する</A>で説明するように、<B>kas  examine</B> コマンドを発行します。
<P>
<PRE>   % <B>uss bulk</B> &lt;<VAR>bulk input file</VAR>>  \
              [<B>-template</B> &lt;<VAR>pathname of template file</VAR>>]  \
              <B>-admin</B> &lt;<VAR>administrator to authenticate</VAR>>  \
              [<B>-dryrun</B>] [<B>-overwrite</B>]  \
              [<B>-pwexpires</B> &lt;<VAR>password expires in [0..254] days (0 => never)></VAR>]  \
              [<B>-pipe</B>]
    Administrator's (<VAR>admin_user</VAR>) password: <VAR>admin_password</VAR>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B><B>b</B>
</B><DD>は、<B>bulk</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>bulk input file</VAR>
</B><DD>バルク入力ファイルのパス名を指定します。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。必要なファイル形式の説明については、<A HREF="#HDRWQ661">バルク入力ファイルの組み立て</A> を参照してください。
<P><DT><B>-template
</B><DD>バルク入力ファイル内に表示される <B>uss add</B> コマンドに対するテンプレート・ファイルのパス名を指定します。パス名の一部は、現行作業ディレクトリーとの関連で解釈されます。必要なファイル形式の説明については、<A HREF="#HDRWQ618">uss テンプレート・ファイルの作成</A> を参照してください。
<P><DT><B>-admin
</B><DD>認証データベースの項目に <TT>ADMIN</TT>フラグを持つ、<B>admin</B> などの管理アカウントを指定します。
password プロンプトはアカウントを <VAR>admin_user</VAR> として表示します。適切なパスワードを、<VAR>admin_password</VAR> として入力します。
<P><DT><B>-dryrun
</B><DD>コマンド・インタープリターがコマンドを実行する際に行うアクションを、実際には行わずに、レポートします。
<P><DT><B><B>-overwrite</B>
</B><DD>ファイル・システム内に存在し、かつ <B>-template</B> 引き数によって指定されたテンプレート・ファイル内の <B>D</B>、<B>E</B>、<B>F</B>、<B>L</B>、または <B>S</B>
命令の対象となっているディレクトリー、ファイル、およびリンクを上書きします。このフラグが省略されると、コマンド・インタープリターは、バルク入力ファイル内の各 <B>add</B> 命令に対して、そのような要素を上書きすべきかどうかを確認するために、プロンプトを出します。バルク入力ファイルが <B>add</B> 命令を含んでいない場合は、このフラグを組み込まないでください。
<P><DT><B><B>-pwexpires</B>
</B><DD>バルク入力ファイル内の <B>add</B> 命令によって名付けられた各ユーザーに対して、ユーザーのパスワードが変更された後、有効であり続ける日数を設定します。<B>1</B> から <B>254</B> の範囲から整数を与えて、有効期限までの日数を指定するか、または、値 <B>0</B> を指定して、パスワードが決して有効期限切れにならない (デフォルト) ということを指示します。
<P>
<P>パスワードが無効になる (有効期限切れになる) と、ユーザーは、認証できなくなりますが、その後 30 日間は、
<B>kpasswd</B> コマンドを発行してパスワードを変更できます (それ以降は、パスワードを変更できるのは、管理者だけです)。
<P><DT><B><B>-pipe</B>
</B><DD><B>-admin</B> 引き数によって名付けられた発行者またはユーザーのパスワードに対して、認証サーバーのプロンプトを抑制します (認証サーバーは、常に、認証データベース内で項目を作成または削除しているユーザーを別々に認証します)。その代わり、コマンド・インタープリターは、パスワードを別のプログラムからのパイプ入力として受け入れ、
<B>uss bulk</B> コマンドを不在バッチ・ジョブで実行することを可能にします。
</DL>
</LI><LI>新規作成または削除されたユーザーのホーム・ディレクトリーが複写されたボリュームにある場合、
<A HREF="auagd010.htm#HDRWQ280">読み取り / 書き込みボリュームの複写 (読み取り専用ボリュームの作成)</A> で説明されているように <B>vos release</B> コマンドを使用してそのボリュームをリリースしてください。
<P>
<PRE>   
   % <B>vos release</B> &lt;<VAR>volume name or ID</VAR>>
   
</PRE>
<P>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">このステップは、ホーム・ディレクトリーの親ディレクトリー自身が複写されたボリュームのマウント・ポイントでない場合 (その方が管理しやすい) にも必要です。たとえば、ABC Corporation のテンプレートがユーザー・ボリュームのマウント・ポイントを <B>/afs/abc.com/usr</B> ディレクトリーにするとします。このディレクトリーはマウント・ポイントではなく、通常のディレクトリーであるため、<B>/afs/abc.com</B> ディレクトリーにマウントされた <B>root.cell</B> ボリュームに存在します。このボリュームは複写されているため、管理者は、マウント・ポイントを作成または削除して変更を行った後で <B>vos release</B> コマンドを発行しなければなりません。
</TD></TR></TABLE>
</LI><LI>アカウントを作成する場合は、ユーザーがログインできる各 AFS クライアント・マシンのローカル・パスワード・ファイル (<B>/etc/passwd</B> またはそれに相当するもの) にある新規ユーザー用の項目を作成します。このステップの自動化に関する提案については、<A HREF="#HDRWQ613">共通送信元パスワード・ファイルの作成</A>を参照してください。
<P>
<P>自動化メソッドを使用しない場合でも、保護サーバーによって自動的に割り当てるか、または、<B>-uid</B> 引き数を使って割り当てて、ユーザーの UNIX UID を AFS UID に一致するように設定します。新規ユーザーの AFS UID は <B>uss add</B> 出力によって生成されるトレースに表示されますが、<A HREF="auagd019.htm#HDRWQ748">保護データベース項目を表示する</A> で説明されているように <B>pts examine</B> コマンドを使用して表示することもできます。
</LI><LI>アカウントを削除する場合は、各クライアント・マシンのローカル・パスワード・ファイル (<B>/etc/passwd</B> または同等の) からユーザーの項目を削除します。
AFS <B>package</B> ユーティリティーを使用する場合は、項目を共通送信元バージョンのファイルから除去するだけで十分です。将来、ユーザーのアカウントを再活動化する意図がある場合は、項目をコメント化するか、または、パスワード・フィールドにアスタリスク (*) を入れるほうが簡単です。
</LI></OL>
<P><HR><B>&#91; <A HREF="#Top_Of_Page">ページのトップ</A> &#124; <A HREF="auagd016.htm">前ページ</A> &#124; <A HREF="auagd018.htm">次ページ</A> &#124; <A HREF="auagd002.htm#ToC">目次</A> &#124; <A HREF="auagd026.htm#HDRINDEX">索引</A> &#93;</B> 
<!-- Begin Footer Records  ========================================== -->
<P><HR><B> 
<br>(C) <A HREF="http://www.ibm.com/">IBM Corporation 2000.</A>  All Rights Reserved<!-- 991224 --> 
</B> 
<!-- End Footer Records  ============================================ -->
<A NAME="Bot_Of_Page"></A>
</BODY></HTML>
