<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Installing Additional Server Machines</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REL="HOME"
TITLE="AFS Quick Beginnings"
HREF="book1.html"><LINK
REL="PREVIOUS"
TITLE="Installing the First AFS Machine"
HREF="c371.html"><LINK
REL="NEXT"
TITLE="Installing Additional Client Machines"
HREF="c8044.html"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>AFS Quick Beginnings: Version 3.6</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="c371.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="c8044.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="HDRWQ99"
></A
>Chapter 3. Installing Additional Server Machines</H1
><P
>Instructions for the following procedures appear in the indicated section of this chapter. <UL
><LI
><P
><A
HREF="c5467.html#HDRWQ100"
>Installing an Additional File Server Machine</A
></P
></LI
><LI
><P
><A
HREF="c5467.html#HDRWQ114"
>Installing Database Server Functionality</A
></P
></LI
><LI
><P
><A
HREF="c5467.html#HDRWQ125"
>Removing Database Server Functionality</A
></P
></LI
></UL
></P
><P
>The instructions make the following assumptions. <UL
><LI
><P
>You have already installed your cell's first file server machine by following the instructions in <A
HREF="c371.html"
>Installing the First AFS Machine</A
></P
></LI
><LI
><P
>You are logged in as the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
></P
></LI
><LI
><P
>You are working at the console</P
></LI
><LI
><P
>A standard version of one of the operating systems supported by the current version of AFS is running on the
        machine</P
></LI
><LI
><P
>You can access the data on the AFS CD-ROMs, either through a local CD-ROM drive or via an NFS mount of a CD-ROM drive
        attached to a machine that is accessible by network</P
></LI
></UL
></P
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ100"
>Installing an Additional File Server Machine</A
></H1
><P
>The procedure for installing a new file server machine is similar to installing the first file server machine in your
    cell. There are a few parts of the installation that differ depending on whether the machine is the same AFS system type as an
    existing file server machine or is the first file server machine of its system type in your cell. The differences mostly concern
    the source for the needed binaries and files, and what portions of the Update Server you install: <UL
><LI
><P
>On a new system type, you must load files and binaries from the AFS CD-ROM. You install the server portion of the
          Update Server to make this machine the binary distribution machine for its system type.</P
></LI
><LI
><P
>On an existing system type, you can copy files and binaries from a previously installed file server machine, rather
          than from the CD-ROM. You install the client portion of the Update Server to accept updates of binaries, because a
          previously installed machine of this type was installed as the binary distribution machine.</P
></LI
></UL
></P
><P
>These instructions are brief; for more detailed information, refer to the corresponding steps in <A
HREF="c371.html"
>Installing the First AFS Machine</A
>. </P
><P
>To install a new file server machine, perform the following procedures: <OL
TYPE="1"
><LI
><P
>Copy needed binaries and files onto this machine's local disk</P
></LI
><LI
><P
>Incorporate AFS modifications into the kernel</P
></LI
><LI
><P
>Configure partitions for storing volumes</P
></LI
><LI
><P
>Replace the standard <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> utility with the AFS-modified version on some system
          types</P
></LI
><LI
><P
>Start the Basic OverSeer (BOS) Server</P
></LI
><LI
><P
>Start the appropriate portion of the Update Server</P
></LI
><LI
><P
>Start the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs</B
></SPAN
> process, which incorporates three component processes: the File
          Server, Volume Server, and Salvager</P
></LI
><LI
><P
>Start the controller process (called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp</B
></SPAN
>) for the Network Time Protocol Daemon,
          which synchronizes clocks</P
></LI
></OL
></P
><P
>After completing the instructions in this section, you can install database server functionality on the machine according
    to the instructions in <A
HREF="c5467.html#HDRWQ114"
>Installing Database Server Functionality</A
>.             </P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="Header_99"
>Creating AFS Directories and Performing Platform-Specific Procedures</A
></H2
><P
>Create the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directories on
      the local disk. Subsequent instructions copy files from the AFS distribution CD-ROM into them, at the appropriate point for
      each system type.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /usr/afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /usr/afs/bin</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /usr/vice</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /cdrom</B
></SPAN
>     
</PRE
><P
>As on the first file server machine, the initial procedures in installing an additional file server machine vary a good
      deal from platform to platform. For convenience, the following sections group together all of the procedures for a system
      type. Most of the remaining procedures are the same on every system type, but differences are noted as appropriate. The
      initial procedures are the following. <UL
><LI
><P
>Incorporate AFS modifications into the kernel, either by using a dynamic kernel loader program or by building a
            new static kernel</P
></LI
><LI
><P
>Configure server partitions to house AFS volumes</P
></LI
><LI
><P
>Replace the operating system vendor's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program with a version that recognizes
            AFS data </P
></LI
><LI
><P
>If the machine is to remain an AFS client machine, modify the machine's authentication system so that users obtain
            an AFS token as they log into the local file system. (For this procedure only, the instructions direct you to the
            platform-specific section in <A
HREF="c371.html"
>Installing the First AFS Machine</A
>.)</P
></LI
></UL
></P
><P
>To continue, proceed to the section for this system type: <UL
><LI
><P
><A
HREF="c5467.html#HDRWQ101"
>Getting Started on AIX Systems</A
></P
></LI
><LI
><P
><A
HREF="c5467.html#HDRWQ102"
>Getting Started on Digital UNIX Systems</A
></P
></LI
><LI
><P
><A
HREF="c5467.html#HDRWQ103"
>Getting Started on HP-UX Systems</A
></P
></LI
><LI
><P
><A
HREF="c5467.html#HDRWQ104"
>Getting Started on IRIX Systems</A
></P
></LI
><LI
><P
><A
HREF="c5467.html#HDRWQ106"
>Getting Started on Linux Systems</A
></P
></LI
><LI
><P
><A
HREF="c5467.html#HDRWQ107"
>Getting Started on Solaris Systems</A
></P
></LI
></UL
></P
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="HDRWQ101"
>Getting Started on AIX Systems</A
></H3
><P
>Begin by running the AFS initialization script to call the AIX kernel extension facility, which dynamically loads AFS
        modifications into the kernel. Then configure partitions and replace the AIX <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program
        with a version that correctly handles AFS volumes. <OL
TYPE="1"
><LI
><P
>Mount the AFS CD-ROM for AIX on the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory. For instructions on
              mounting CD-ROMs (either locally or remotely via NFS), see your AIX documentation. Then change directory as indicated.
              <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd  /cdrom/rs_aix42/root.client/usr/vice/etc</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS kernel library files to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/dkload</B
></SPAN
> directory,
              and the AFS initialization script to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc</B
></SPAN
> directory. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -rp  dkload  /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p  rc.afs  /etc/rc.afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Edit the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.afs</B
></SPAN
> script, setting the <SAMP
CLASS="computeroutput"
>NFS</SAMP
>
              variable as indicated.</P
><P
>If the machine is not to function as an NFS/AFS Translator, set the <SAMP
CLASS="computeroutput"
>NFS</SAMP
>
              variable as follows.</P
><PRE
CLASS="programlisting"
>&#13;   NFS=$NFS_NONE
</PRE
><P
>If the machine is to function as an NFS/AFS Translator and is running AIX 4.2.1 or higher, set the
              <SAMP
CLASS="computeroutput"
>NFS</SAMP
> variable as follows. Note that NFS must already be loaded into the kernel, which
              happens automatically on systems running AIX 4.1.1 and later, as long as the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/exports</B
></SPAN
> exists.</P
><PRE
CLASS="programlisting"
>&#13;   NFS=$NFS_IAUTH
</PRE
></LI
><LI
><P
>Invoke the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.afs</B
></SPAN
> script to load AFS modifications into the kernel. You
              can ignore any error messages about the inability to start the BOS Server or the Cache Manager or AFS client.
              <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.afs</B
></SPAN
>
</PRE
>    </P
></LI
><LI
><P
>Create a directory called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> for each AFS
              server partition you are configuring (there must be at least one). Repeat the command for each partition.
              <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>
</PRE
></P
></LI
><LI
><P
>Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SMIT</B
></SPAN
> program to create a journaling file system on each partition to be
              configured as an AFS server partition.</P
></LI
><LI
><P
>Mount each partition at one of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>
              directories. Choose one of the following three methods: <UL
><LI
><P
>Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SMIT</B
></SPAN
> program</P
></LI
><LI
><P
>Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount -a</B
></SPAN
> command to mount all partitions at once</P
></LI
><LI
><P
>Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount</B
></SPAN
> command on each partition in turn</P
></LI
></UL
></P
><P
>Also configure the partitions so that they are mounted automatically at each reboot. For more information, refer
              to the AIX documentation.    </P
></LI
><LI
><P
>Move the AIX <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program helper to a safe location and install the version
              from the AFS distribution in its place. The AFS CD-ROM must still be mounted at the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /sbin/helpers</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mv v3fshelper v3fshelper.noafs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p /cdrom/rs_aix42/root.server/etc/v3fshelper v3fshelper</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>If the machine is to remain an AFS client, incorporate AFS into its authentication system, following the
              instructions in <A
HREF="c371.html#HDRWQ25"
>Enabling AFS Login on AIX Systems</A
>.</P
></LI
><LI
><P
>Proceed to <A
HREF="c5467.html#HDRWQ108"
>Starting Server Programs</A
>.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="HDRWQ102"
>Getting Started on Digital UNIX Systems</A
></H3
><P
>Begin by building AFS modifications into the kernel, then configure server partitions and replace the Digital UNIX
        <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program with a version that correctly handles AFS volumes.</P
><P
>If the machine's hardware and software configuration exactly matches another Digital UNIX machine on which AFS is
        already built into the kernel, you can copy the kernel from that machine to this one. In general, however, it is better to
        build AFS modifications into the kernel on each machine according to the following instructions. <OL
TYPE="1"
><LI
><P
>Create a copy called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>AFS</B
></SPAN
> of the basic kernel configuration file included in the
              Digital UNIX distribution as <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/sys/conf/</B
></SPAN
><VAR
CLASS="replaceable"
>machine_name</VAR
>,
              where <VAR
CLASS="replaceable"
>machine_name</VAR
> is the machine's hostname in all uppercase letters. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/sys/conf</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp</B
></SPAN
> <VAR
CLASS="replaceable"
>machine_name</VAR
> <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>AFS</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Add AFS to the list of options in the configuration file you created in the previous step, so that the result
              looks like the following: <PRE
CLASS="programlisting"
>&#13;          .                   .
          .                   .
       options               UFS
       options               NFS
       options               AFS
          .                   .
          .                   .
</PRE
></P
></LI
><LI
><P
>Add an entry for AFS to two places in the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/sys/conf/files</B
></SPAN
>.
              <UL
><LI
><P
>Add a line for AFS to the list of <SAMP
CLASS="computeroutput"
>OPTIONS</SAMP
>, so that the result looks like
                    the following: <PRE
CLASS="programlisting"
>&#13;             .                .      .
             .                .      .
      OPTIONS/nfs          optional nfs 
      OPTIONS/afs          optional afs 
      OPTIONS/nfs_server   optional nfs_server
             .                .      .
             .                .      .
</PRE
></P
></LI
><LI
><P
>Add an entry for AFS to the list of <SAMP
CLASS="computeroutput"
>MODULES</SAMP
>, so that the result looks
                    like the following: <PRE
CLASS="programlisting"
>&#13;             .                  .        .          .
             .                  .        .          .
      #
      MODULE/nfs_server     optional nfs_server Binary
      nfs/nfs_server.c      module nfs_server optimize -g3
      nfs/nfs3_server.c     module nfs_server optimize -g3
      #
      MODULE/afs            optional afs Binary
      afs/libafs.c          module afs
      #
</PRE
></P
></LI
></UL
></P
></LI
><LI
><P
>Add an entry for AFS to two places in the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/sys/vfs/vfs_conf.c</B
></SPAN
>.
              <UL
><LI
><P
>Add AFS to the list of defined file systems, so that the result looks like the following: <PRE
CLASS="programlisting"
>&#13;        .       .              
        .       .              
     #include &#60;afs.h&#62;
     #if defined(AFS) &#38;&#38; AFS
            extern struct vfsops afs_vfsops;
     #endif  
        .       .              
        .       .              
</PRE
></P
></LI
><LI
><P
>Put a declaration for AFS in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vfssw[]</B
></SPAN
> table's MOUNT_ADDON slot, so
                    that the result looks like the following: <PRE
CLASS="programlisting"
>&#13;        .                          .              .
        .                          .              .
      &#38;fdfs_vfsops,         "fdfs",   /* 12 = MOUNT_FDFS */
   #if  defined(AFS)
      &#38;afs_vfsops,          "afs",
   #else
      (struct vfsops *)0,   "",       /* 13 = MOUNT_ADDON */
   #endif
   #if NFS &#38;&#38; INFS_DYNAMIC   
       &#38;nfs3_vfsops,        "nfsv3",  /* 14 = MOUNT_NFS3 */         
</PRE
></P
></LI
></UL
></P
></LI
><LI
><P
>Mount the AFS CD-ROM for Digital UNIX on the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory. For
              instructions on mounting CD-ROMs (either locally or remotely via NFS), see your Digital UNIX documentation. Then
              change directory as indicated. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /cdrom/alpha_dux40/root.client</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS initialization script to the local directory for initialization files (by convention, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d</B
></SPAN
> on Digital UNIX machines). Note the removal of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.rc</B
></SPAN
> extension as you copy the script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp usr/vice/etc/afs.rc  /sbin/init.d/afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS kernel module to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/sys/BINARY</B
></SPAN
> directory.</P
><P
>If the machine's kernel supports NFS server functionality:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp bin/libafs.o /usr/sys/BINARY/afs.mod</B
></SPAN
>   
</PRE
><P
>If the machine's kernel does not support NFS server functionality:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp bin/libafs.nonfs.o /usr/sys/BINARY/afs.mod</B
></SPAN
>
</PRE
></LI
><LI
><P
>Configure and build the kernel. Respond to any prompts by pressing &#60;<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Return</B
></SPAN
>&#62;. The resulting kernel resides in the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sys/AFS/vmunix</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>doconfig -c AFS</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Rename the existing kernel file and copy the new, AFS-modified file to the standard location. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mv /vmunix /vmunix_noafs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp /sys/AFS/vmunix /vmunix</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Reboot the machine to start using the new kernel, and login again as the superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown -r now</B
></SPAN
>
   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
>    </P
></LI
><LI
><P
>Create a directory called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> for each AFS
              server partition you are configuring (there must be at least one). Repeat the command for each partition.
              <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>
</PRE
></P
></LI
><LI
><P
>Add a line with the following format to the file systems registry file, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/fstab</B
></SPAN
>, for each directory just created. The entry maps the directory name to the disk
              partition to be mounted on it. <PRE
CLASS="programlisting"
>&#13;   /dev/<VAR
CLASS="replaceable"
>disk</VAR
> /vicep<VAR
CLASS="replaceable"
>xx</VAR
> ufs rw 0 2
</PRE
></P
><P
>The following is an example for the first partition being configured.</P
><PRE
CLASS="programlisting"
>&#13;   /dev/rz3a /vicepa ufs rw 0 2
</PRE
></LI
><LI
><P
>Create a file system on each partition that is to be mounted at a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> directory. The following command is probably appropriate,
              but consult the Digital UNIX documentation for more information. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>newfs -v /dev/</B
></SPAN
><VAR
CLASS="replaceable"
>disk</VAR
>
</PRE
></P
></LI
><LI
><P
>Mount each partition by issuing either the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount -a</B
></SPAN
> command to mount all
              partitions at once or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount</B
></SPAN
> command to mount each partition in turn.    </P
></LI
><LI
><P
>Install the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vfsck</B
></SPAN
> binary to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin</B
></SPAN
> and
              <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/sbin</B
></SPAN
> directories. The AFS CD-ROM must still be mounted at the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /cdrom/alpha_dux40/root.server/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp vfsck /sbin/vfsck</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp vfsck /usr/sbin/vfsck</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Rename the Digital UNIX <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> binaries and create symbolic links to the
              <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vfsck</B
></SPAN
> program. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /sbin</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mv ufs_fsck ufs_fsck.noafs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s vfsck ufs_fsck</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/sbin</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mv ufs_fsck ufs_fsck.noafs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s vfsck ufs_fsck</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>If the machine is to remain an AFS client, incorporate AFS into its authentication system, following the
              instructions in <A
HREF="c371.html#HDRWQ30"
>Enabling AFS Login on Digital UNIX Systems</A
>.</P
></LI
><LI
><P
>Proceed to <A
HREF="c5467.html#HDRWQ108"
>Starting Server Programs</A
>.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="HDRWQ103"
>Getting Started on HP-UX Systems</A
></H3
><P
>Begin by building AFS modifications into the kernel, then configure server partitions and replace the HP-UX <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program with a version that correctly handles AFS volumes.</P
><P
>If the machine's hardware and software configuration exactly matches another HP-UX machine on which AFS is already
        built into the kernel, you can copy the kernel from that machine to this one. In general, however, it is better to build AFS
        modifications into the kernel on each machine according to the following instructions. <OL
TYPE="1"
><LI
><P
>Move the existing kernel-related files to a safe location. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp /stand/vmunix /stand/vmunix.noafs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp /stand/system /stand/system.noafs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Mount the AFS CD-ROM for HP-UX on the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory. For instructions
              on mounting CD-ROMs (either locally or remotely via NFS), see your HP-UX documentation. Then change directory as
              indicated. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /cdrom/hp_ux110/root.client</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS initialization file to the local directory for initialization files (by convention, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d</B
></SPAN
> on HP-UX machines). Note the removal of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.rc</B
></SPAN
>
              extension as you copy the file. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp usr/vice/etc/afs.rc  /sbin/init.d/afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs.driver</B
></SPAN
> to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/conf/master.d</B
></SPAN
> directory, changing its name to <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs</B
></SPAN
> as you
              do. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp  usr/vice/etc/afs.driver  /usr/conf/master.d/afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS kernel module to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/conf/lib</B
></SPAN
> directory.</P
><P
>If the machine's kernel supports NFS server functionality:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp bin/libafs.a /usr/conf/lib</B
></SPAN
>   
</PRE
><P
>If the machine's kernel does not support NFS server functionality, change the file's name as you copy it:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp bin/libafs.nonfs.a /usr/conf/lib/libafs.a</B
></SPAN
>
</PRE
></LI
><LI
><P
>Incorporate the AFS driver into the kernel, either using the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SAM</B
></SPAN
> program or a
              series of individual commands. <UL
><LI
><P
>To use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SAM</B
></SPAN
> program: <OL
TYPE="a"
><LI
><P
>Invoke the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SAM</B
></SPAN
> program, specifying the hostname of the local
                          machine as <VAR
CLASS="replaceable"
>local_hostname</VAR
>. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SAM</B
></SPAN
> graphical
                          user interface pops up. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>sam -display</B
></SPAN
> <VAR
CLASS="replaceable"
>local_hostname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>:0</B
></SPAN
> 
</PRE
></P
></LI
><LI
><P
>Choose the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Kernel Configuration</B
></SPAN
> icon, then the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Drivers</B
></SPAN
> icon. From the list of drivers, select <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs</B
></SPAN
>.</P
></LI
><LI
><P
>Open the pull-down <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Actions</B
></SPAN
> menu and choose the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Add Driver to Kernel</B
></SPAN
> option.</P
></LI
><LI
><P
>Open the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Actions</B
></SPAN
> menu again and choose the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Create a New Kernel</B
></SPAN
> option.</P
></LI
><LI
><P
>Confirm your choices by choosing <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Yes</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>OK</B
></SPAN
> when prompted by subsequent pop-up windows. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SAM</B
></SPAN
> program builds the kernel and reboots the system.</P
></LI
><LI
><P
>Login again as the superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
></P
></LI
></OL
></P
></LI
><LI
><P
>To use individual commands: <OL
TYPE="a"
><LI
><P
>Edit the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/stand/system</B
></SPAN
>, adding an entry for <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs</B
></SPAN
> to the <SAMP
CLASS="computeroutput"
>Subsystems</SAMP
> section.</P
></LI
><LI
><P
>Change to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/stand/build</B
></SPAN
> directory and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mk_kernel</B
></SPAN
> command to build the kernel. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /stand/build</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mk_kernel</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Move the new kernel to the standard location (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/stand/vmunix</B
></SPAN
>),
                          reboot the machine to start using it, and login again as the superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mv /stand/build/vmunix_test /stand/vmunix</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown -r now</B
></SPAN
>             
   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
></P
></LI
></OL
></P
></LI
></UL
></P
></LI
><LI
><P
>Create a directory called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> for each AFS
              server partition you are configuring (there must be at least one). Repeat the command for each partition.
              <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>
</PRE
></P
></LI
><LI
><P
>Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SAM</B
></SPAN
> program to create a file system on each partition. For
              instructions, consult the HP-UX documentation.</P
></LI
><LI
><P
>On some HP-UX systems that use logical volumes, the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SAM</B
></SPAN
> program automatically
              mounts the partitions. If it has not, mount each partition by issuing either the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount
              -a</B
></SPAN
> command to mount all partitions at once or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount</B
></SPAN
> command to mount
              each partition in turn.    </P
></LI
><LI
><P
>Create the command configuration file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/lib/mfsconfig.d/afs</B
></SPAN
>. Use a text
              editor to place the indicated two lines in it: <PRE
CLASS="programlisting"
>&#13;   format_revision 1
   fsck            0        m,P,p,d,f,b:c:y,n,Y,N,q,
</PRE
></P
></LI
><LI
><P
>Create and change directory to an AFS-specific command directory called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/fs/afs</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /sbin/fs/afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd  /sbin/fs/afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS-modified version of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vfsck</B
></SPAN
> binary) and related files from the distribution directory to the new AFS-specific command
              directory. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p /cdrom/hp_ux110/root.server/etc/*  .</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Change the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vfsck</B
></SPAN
> binary's name to <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> and set
              the mode bits appropriately on all of the files in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/fs/afs</B
></SPAN
> directory.
              <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mv  vfsck  fsck</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>chmod  755  *</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Edit the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/fstab</B
></SPAN
> file, changing the file system type for each AFS server
              partition from <SAMP
CLASS="computeroutput"
>hfs</SAMP
> to <SAMP
CLASS="computeroutput"
>afs</SAMP
>. This ensures that the
              AFS-modified <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program runs on the appropriate partitions.</P
><P
>The sixth line in the following example of an edited file shows an AFS server partition, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicepa</B
></SPAN
>.</P
><PRE
CLASS="programlisting"
>&#13;   /dev/vg00/lvol1 / hfs defaults 0 1
   /dev/vg00/lvol4 /opt hfs defaults 0 2
   /dev/vg00/lvol5 /tmp hfs defaults 0 2
   /dev/vg00/lvol6 /usr hfs defaults 0 2
   /dev/vg00/lvol8 /var hfs defaults 0 2
   /dev/vg00/lvol9 /vicepa afs defaults 0 2
   /dev/vg00/lvol7 /usr/vice/cache hfs defaults 0 2
</PRE
></LI
><LI
><P
>If the machine is to remain an AFS client, incorporate AFS into its authentication system, following the
              instructions in <A
HREF="c371.html#HDRWQ35"
>Enabling AFS Login on HP-UX Systems</A
>.</P
></LI
><LI
><P
>Proceed to <A
HREF="c5467.html#HDRWQ108"
>Starting Server Programs</A
>.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="HDRWQ104"
>Getting Started on IRIX Systems</A
></H3
><P
>Begin by incorporating AFS modifications into the kernel. Either use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ml</B
></SPAN
> dynamic
        loader program, or build a static kernel. Then configure partitions to house AFS volumes. AFS supports use of both EFS and
        XFS partitions for housing AFS volumes. SGI encourages use of XFS partitions.  </P
><P
>You do not need to replace IRIX <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program, because the version that SGI
        distributes handles AFS volumes properly. <OL
TYPE="1"
><LI
><P
>Prepare for incorporating AFS into the kernel by performing the following procedures. <OL
TYPE="a"
><LI
><P
>Mount the AFS CD-ROM for IRIX on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory. For instructions
                    on mounting CD-ROMs (either locally or remotely via NFS), see your IRIX documentation. Then change directory as
                    indicated. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd  /cdrom/sgi_65/root.client</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS initialization script to the local directory for initialization files (by convention,
                    <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d</B
></SPAN
> on IRIX machines). Note the removal of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.rc</B
></SPAN
> extension as you copy the script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p   usr/vice/etc/afs.rc  /etc/init.d/afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>uname -m</B
></SPAN
> command to determine the machine's CPU board type. The
                    <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>IP</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> value in the output must match one of the
                    supported CPU board types listed in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Release Notes</I
></SPAN
> for the current version of
                    AFS. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>uname -m</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
></LI
><LI
><P
>Incorporate AFS into the kernel, either using the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ml</B
></SPAN
> program or by building AFS
              modifications into a static kernel. <UL
><LI
><P
>To use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ml</B
></SPAN
> program:       <OL
TYPE="a"
><LI
><P
>Create the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/sgiload</B
></SPAN
> directory to house the AFS
                          kernel library file. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /usr/vice/etc/sgiload</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the appropriate AFS kernel library file to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/sgiload</B
></SPAN
> directory. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>IP</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> portion of the library file name must match the
                          value previously returned by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>uname -m</B
></SPAN
> command. Also choose the file
                          appropriate to whether the machine's kernel supports NFS server functionality (NFS must be supported for
                          the machine to act as an NFS/AFS Translator). Single- and multiprocessor machines use the same library
                          file.</P
><P
>(You can choose to copy all of the kernel library files into the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/sgiload</B
></SPAN
> directory, but they require a significant amount of
                          space.)</P
><P
>If the machine's kernel supports NFS server functionality:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p  usr/vice/etc/sgiload/libafs.IP</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.o  /usr/vice/etc/sgiload</B
></SPAN
>   
</PRE
><P
>If the machine's kernel does not support NFS server functionality:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p  usr/vice/etc/sgiload/libafs.IP</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.nonfs.o</B
></SPAN
>   \
                   <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/sgiload</B
></SPAN
>
</PRE
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>chkconfig</B
></SPAN
> command to activate the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsml</B
></SPAN
> configuration variable. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/chkconfig -f afsml on</B
></SPAN
>   
</PRE
></P
><P
>If the machine is to function as an NFS/AFS Translator and the kernel supports NFS server
                          functionality, activate the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsxnfs</B
></SPAN
> variable.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/chkconfig -f afsxnfs on</B
></SPAN
>
</PRE
></LI
><LI
><P
>Run the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d/afs</B
></SPAN
> script to load AFS extensions into the
                          kernel. The script invokes the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ml</B
></SPAN
> command, automatically determining
                          which kernel library file to use based on this machine's CPU type and the activation state of the
                          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsxnfs</B
></SPAN
> variable.</P
><P
>You can ignore any error messages about the inability to start the BOS Server or the Cache Manager
                          or AFS client.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d/afs start</B
></SPAN
>
</PRE
></LI
><LI
><P
>Proceed to Step <A
HREF="c5467.html#LIWQ105"
>3</A
>.</P
></LI
></OL
></P
></LI
><LI
><P
>If you prefer to build a kernel, and the machine's hardware and software configuration exactly matches
                    another IRIX machine on which AFS is already built into the kernel, you can copy the kernel from that machine to
                    this one. In general, however, it is better to build AFS modifications into the kernel on each machine according
                    to the following instructions. <OL
TYPE="a"
><LI
><P
>Copy the kernel initialization file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs.sm</B
></SPAN
> to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/var/sysgen/system</B
></SPAN
> directory, and the kernel master file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs</B
></SPAN
> to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/var/sysgen/master.d</B
></SPAN
> directory.
                          <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p  bin/afs.sm  /var/sysgen/system</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p  bin/afs  /var/sysgen/master.d</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the appropriate AFS kernel library file to the local file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/var/sysgen/boot/afs.a</B
></SPAN
>; the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>IP</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> portion of the library file name must match the
                          value previously returned by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>uname -m</B
></SPAN
> command. Also choose the file
                          appropriate to whether the machine's kernel supports NFS server functionality (NFS must be supported for
                          the machine to act as an NFS/AFS Translator). Single- and multiprocessor machines use the same library
                          file.</P
><P
>If the machine's kernel supports NFS server functionality:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p   bin/libafs.IP</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.a   /var/sysgen/boot/afs.a</B
></SPAN
>   
</PRE
><P
>If the machine's kernel does not support NFS server functionality:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p  bin/libafs.IP</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.nonfs.a  /var/sysgen/boot/afs.a</B
></SPAN
>
</PRE
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>chkconfig</B
></SPAN
> command to deactivate the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsml</B
></SPAN
> configuration variable. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/chkconfig -f afsml off</B
></SPAN
>   
</PRE
></P
><P
>If the machine is to function as an NFS/AFS Translator and the kernel supports NFS server
                          functionality, activate the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsxnfs</B
></SPAN
> variable.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/chkconfig -f afsxnfs on</B
></SPAN
>
</PRE
></LI
><LI
><P
>Copy the existing kernel file, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/unix</B
></SPAN
>, to a safe location. Compile
                          the new kernel, which is created in the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/unix.install</B
></SPAN
>. It overwrites
                          the existing <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/unix</B
></SPAN
> file when the machine reboots in the next step.
                          <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp /unix /unix_noafs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>autoconfig</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Reboot the machine to start using the new kernel, and login again as the superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown -i6 -g0 -y</B
></SPAN
>
   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
></P
></LI
></OL
></P
></LI
></UL
></P
></LI
><LI
><P
><A
NAME="LIWQ105"
></A
>Create a directory called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> for each AFS server partition you are configuring (there
              must be at least one). Repeat the command for each partition. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>
</PRE
></P
></LI
><LI
><P
>Add a line with the following format to the file systems registry file, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/fstab</B
></SPAN
>, for each partition (or logical volume created with the XLV volume manager) to be
              mounted on one of the directories created in the previous step.</P
><P
>For an XFS partition or logical volume:</P
><PRE
CLASS="programlisting"
>&#13;   /dev/dsk/<VAR
CLASS="replaceable"
>disk</VAR
>  /vicep<VAR
CLASS="replaceable"
>xx</VAR
>  xfs  rw,raw=/dev/rdsk/<VAR
CLASS="replaceable"
>disk</VAR
>  0  0   
</PRE
><P
>For an EFS partition:</P
><PRE
CLASS="programlisting"
>&#13;   /dev/dsk/<VAR
CLASS="replaceable"
>disk</VAR
>  /vicep<VAR
CLASS="replaceable"
>xx</VAR
>  efs  rw,raw=/dev/rdsk/<VAR
CLASS="replaceable"
>disk</VAR
>  0  0   
</PRE
><P
>The following are examples of an entry for each file system type:</P
><PRE
CLASS="programlisting"
>&#13;   /dev/dsk/dks0d2s6 /vicepa  xfs rw,raw=/dev/rdsk/dks0d2s6  0 0
   /dev/dsk/dks0d3s1 /vicepb  efs rw,raw=/dev/rdsk/dks0d3s1  0 0
</PRE
></LI
><LI
><P
>Create a file system on each partition that is to be mounted on a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> directory. The following commands are probably appropriate,
              but consult the IRIX documentation for more information. In both cases, <VAR
CLASS="replaceable"
>raw_device</VAR
> is a raw
              device name like <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/dev/rdsk/dks0d0s0</B
></SPAN
> for a single disk partition or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/dev/rxlv/xlv0</B
></SPAN
> for a logical volume.</P
><P
>For XFS file systems, include the indicated options to configure the partition or logical volume with inodes
              large enough to accommodate AFS-specific information:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkfs -t xfs -i size=512 -l size=4000b</B
></SPAN
> <VAR
CLASS="replaceable"
>raw_device</VAR
>   
</PRE
><P
>For EFS file systems:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkfs -t efs</B
></SPAN
> <VAR
CLASS="replaceable"
>raw_device</VAR
>
</PRE
></LI
><LI
><P
>Mount each partition by issuing either the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount -a</B
></SPAN
> command to mount all
              partitions at once or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount</B
></SPAN
> command to mount each partition in turn.</P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> If you have configured partitions or logical volumes to use XFS,
              issue the following command to verify that the inodes are configured properly (are large enough to accommodate
              AFS-specific information). If the configuration is correct, the command returns no output. Otherwise, it specifies the
              command to run in order to configure each partition or logical volume properly. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/xfs_size_check</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>If the machine is to remain an AFS client, incorporate AFS into its authentication system, following the
              instructions in <A
HREF="c371.html#HDRWQ40"
>Enabling AFS Login on IRIX Systems</A
>.</P
></LI
><LI
><P
>Proceed to <A
HREF="c5467.html#HDRWQ108"
>Starting Server Programs</A
>.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="HDRWQ106"
>Getting Started on Linux Systems</A
></H3
><P
>Begin by running the AFS initialization script to call the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>insmod</B
></SPAN
> program, which
        dynamically loads AFS modifications into the kernel. Then create partitions for storing AFS volumes. You do not need to
        replace the Linux <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program. <OL
TYPE="1"
><LI
><P
>Mount the AFS CD-ROM for Linux on the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory. For instructions
              on mounting CD-ROMs (either locally or remotely via NFS), see your Linux documentation. Then change directory as
              indicated. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd  /cdrom/i386_linux22/root.client/usr/vice/etc</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS kernel library files to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/modload</B
></SPAN
> directory.
              The filenames for the libraries have the format <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>libafs-</B
></SPAN
><VAR
CLASS="replaceable"
>version</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.o</B
></SPAN
>, where
              <VAR
CLASS="replaceable"
>version</VAR
> indicates the kernel build level. The string <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.mp</B
></SPAN
>
              in the <VAR
CLASS="replaceable"
>version</VAR
> indicates that the file is appropriate for machines running a multiprocessor
              kernel. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -rp  modload  /usr/vice/etc</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS initialization script to the local directory for initialization files (by convention, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.d/init.d</B
></SPAN
> on Linux machines). Note the removal of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.rc</B
></SPAN
> extension as you copy the script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p   afs.rc  /etc/rc.d/init.d/afs</B
></SPAN
> 
</PRE
></P
></LI
><LI
><P
>Run the AFS initialization script to load AFS extensions into the kernel. You can ignore any error messages
              about the inability to start the BOS Server or the Cache Manager or AFS client. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.d/init.d/afs  start</B
></SPAN
>
</PRE
>    </P
></LI
><LI
><P
>Create a directory called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> for each AFS
              server partition you are configuring (there must be at least one). Repeat the command for each partition.
              <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>
</PRE
></P
></LI
><LI
><P
>Add a line with the following format to the file systems registry file, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/fstab</B
></SPAN
>, for each directory just created. The entry maps the directory name to the disk
              partition to be mounted on it. <PRE
CLASS="programlisting"
>&#13;   /dev/<VAR
CLASS="replaceable"
>disk</VAR
>  /vicep<VAR
CLASS="replaceable"
>xx</VAR
>  ext2  defaults  0  2   
</PRE
></P
><P
>The following is an example for the first partition being configured.</P
><PRE
CLASS="programlisting"
>&#13;   /dev/sda8 /vicepa ext2 defaults 0 2
</PRE
></LI
><LI
><P
>Create a file system on each partition that is to be mounted at a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> directory. The following command is probably appropriate,
              but consult the Linux documentation for more information. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkfs -v /dev/</B
></SPAN
><VAR
CLASS="replaceable"
>disk</VAR
>
</PRE
></P
></LI
><LI
><P
>Mount each partition by issuing either the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount -a</B
></SPAN
> command to mount all
              partitions at once or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount</B
></SPAN
> command to mount each partition in turn.</P
></LI
><LI
><P
>If the machine is to remain an AFS client, incorporate AFS into its authentication system, following the
              instructions in <A
HREF="c371.html#HDRWQ44"
>Enabling AFS Login on Linux Systems</A
>.</P
></LI
><LI
><P
>Proceed to <A
HREF="c5467.html#HDRWQ108"
>Starting Server Programs</A
>.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="HDRWQ107"
>Getting Started on Solaris Systems</A
></H3
><P
>Begin by running the AFS initialization script to call the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>modload</B
></SPAN
> program, which
        dynamically loads AFS modifications into the kernel. Then configure partitions and replace the Solaris <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program with a version that correctly handles AFS volumes. <OL
TYPE="1"
><LI
><P
>Mount the AFS CD-ROM for Solaris on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory. For instructions on
              mounting CD-ROMs (either locally or remotely via NFS), see your Solaris documentation. Then change directory as
              indicated. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd  /cdrom/sun4x_56/root.client/usr/vice/etc</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS initialization script to the local directory for initialization files (by convention, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d</B
></SPAN
> on Solaris machines). Note the removal of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.rc</B
></SPAN
>
              extension as you copy the script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p  afs.rc  /etc/init.d/afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the appropriate AFS kernel library file to the local file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/kernel/fs/afs</B
></SPAN
>.</P
><P
>If the machine is running Solaris 2.6 or the 32-bit version of Solaris 7, its kernel supports NFS server
              functionality, and the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>nfsd</B
></SPAN
> process is running:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p modload/libafs.o /kernel/fs/afs</B
></SPAN
>   
</PRE
><P
>If the machine is running Solaris 2.6 or the 32-bit version of Solaris 7, and its kernel does not support NFS
              server functionality or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>nfsd</B
></SPAN
> process is not running:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p modload/libafs.nonfs.o /kernel/fs/afs</B
></SPAN
>   
</PRE
><P
>If the machine is running the 64-bit version of Solaris 7, its kernel supports NFS server functionality, and the
              <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>nfsd</B
></SPAN
> process is running:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p modload/libafs64.o /kernel/fs/sparcv9/afs</B
></SPAN
>   
</PRE
><P
>If the machine is running the 64-bit version of Solaris 7, and its kernel does not support NFS server
              functionality or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>nfsd</B
></SPAN
> process is not running:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p modload/libafs64.nonfs.o /kernel/fs/sparcv9/afs</B
></SPAN
>
</PRE
></LI
><LI
><P
>Run the AFS initialization script to load AFS modifications into the kernel. You can ignore any error messages
              about the inability to start the BOS Server or the Cache Manager or AFS client. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d/afs start</B
></SPAN
>   
</PRE
></P
><P
>When an entry called <SAMP
CLASS="computeroutput"
>afs</SAMP
> does not already exist in the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/name_to_sysnum</B
></SPAN
> file, the script automatically creates it and reboots the machine to start
              using the new version of the file. If this happens, log in again as the superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
> after the reboot and run the initialization script again. This time the required entry
              exists in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/name_to_sysnum</B
></SPAN
> file, and the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>modload</B
></SPAN
> program runs.</P
><PRE
CLASS="programlisting"
>&#13;   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d/afs start</B
></SPAN
>
</PRE
></LI
><LI
><P
>Create the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/lib/fs/afs</B
></SPAN
> directory to house the AFS-modified <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program and related files. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /usr/lib/fs/afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/lib/fs/afs</B
></SPAN
>  
</PRE
></P
></LI
><LI
><P
>Copy the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vfsck</B
></SPAN
> binary to the newly created directory, changing the name as you
              do so. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp  /cdrom/sun4x_56/root.server/etc/vfsck  fsck</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Working in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/lib/fs/afs</B
></SPAN
> directory, create the following links to Solaris
              libraries: <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/clri</B
></SPAN
>  
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/df</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/edquota</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/ff</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/fsdb</B
></SPAN
>  
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/fsirand</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/fstyp</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/labelit</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/lockfs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/mkfs</B
></SPAN
>  
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/mount</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/ncheck</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/newfs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/quot</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/quota</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/quotaoff</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/quotaon</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/repquota</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/tunefs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/ufsdump</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/ufsrestore</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/volcopy</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Append the following line to the end of the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/dfs/fstypes</B
></SPAN
>.
              <PRE
CLASS="programlisting"
>&#13;   afs AFS Utilities
</PRE
></P
></LI
><LI
><P
>Edit the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/mountall</B
></SPAN
> file, making two changes. <UL
><LI
><P
>Add an entry for AFS to the <SAMP
CLASS="computeroutput"
>case</SAMP
> statement for option 2, so that it reads
                    as follows: <PRE
CLASS="programlisting"
>&#13;   case "$2" in
   ufs)    foptions="-o p"
           ;;
   afs)    foptions="-o p"
           ;;
   s5)     foptions="-y -t /var/tmp/tmp$$ -D"
           ;;
   *)      foptions="-y"
           ;;
</PRE
></P
></LI
><LI
><P
>Edit the file so that all AFS and UFS partitions are checked in parallel. Replace the following section of
                    code: <PRE
CLASS="programlisting"
>&#13;   # For  fsck purposes, we make a distinction between ufs and
   # other file systems
   #
   if [ "$fstype" = "ufs" ]; then
        ufs_fscklist="$ufs_fscklist $fsckdev"
        saveentry $fstype "$OPTIONS" $special $mountp
        continue
   fi  
</PRE
></P
><P
>with the following section of code:</P
><PRE
CLASS="programlisting"
>&#13;   # For fsck purposes, we make a distinction between ufs/afs
   # and other file systems.
   #
   if [ "$fstype" = "ufs" -o "$fstype" = "afs" ]; then
        ufs_fscklist="$ufs_fscklist $fsckdev"
        saveentry $fstype "$OPTIONS" $special $mountp
        continue
   fi
</PRE
></LI
></UL
></P
></LI
><LI
><P
>Create a directory called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> for each AFS
              server partition you are configuring (there must be at least one). Repeat the command for each partition.
              <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>
</PRE
></P
></LI
><LI
><P
>Add a line with the following format to the file systems registry file, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/vfstab</B
></SPAN
>, for each partition to be mounted on a directory created in the previous step. Note
              the value <SAMP
CLASS="computeroutput"
>afs</SAMP
> in the fourth field, which tells Solaris to use the AFS-modified
              <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program on this partition. <PRE
CLASS="programlisting"
>&#13;   /dev/dsk/<VAR
CLASS="replaceable"
>disk</VAR
>   /dev/rdsk/<VAR
CLASS="replaceable"
>disk</VAR
>   /vicep<VAR
CLASS="replaceable"
>xx</VAR
>   afs   <VAR
CLASS="replaceable"
>boot_order</VAR
>  yes  
</PRE
></P
><P
>The following is an example for the first partition being configured.</P
><PRE
CLASS="programlisting"
>&#13;   /dev/dsk/c0t6d0s1 /dev/rdsk/c0t6d0s1 /vicepa afs 3 yes
</PRE
></LI
><LI
><P
>Create a file system on each partition that is to be mounted at a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> directory. The following command is probably appropriate,
              but consult the Solaris documentation for more information. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>newfs -v /dev/rdsk/</B
></SPAN
><VAR
CLASS="replaceable"
>disk</VAR
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mountall</B
></SPAN
> command to mount all partitions at once.</P
></LI
><LI
><P
>If the machine is to remain an AFS client, incorporate AFS into its authentication system, following the
              instructions in <A
HREF="c371.html#HDRWQ49"
>Enabling AFS Login and Editing the File Systems Clean-up Script on Solaris
              Systems</A
>.</P
></LI
><LI
><P
>Proceed to <A
HREF="c5467.html#HDRWQ108"
>Starting Server Programs</A
>.</P
></LI
></OL
></P
></DIV
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ108"
>Starting Server Programs</A
></H2
><P
>In this section you initialize the BOS Server, the Update Server, the controller process for NTPD, and the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs</B
></SPAN
> process. You begin by copying the necessary server files to the local disk. <OL
TYPE="1"
><LI
><P
>Copy file server binaries to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
> directory. <UL
><LI
><P
>On a machine of an existing system type, you can either load files from the AFS CD-ROM or use a remote file
                  transfer protocol to copy files from an existing server machine of the same system type. To load from the CD-ROM,
                  see the instructions just following for a machine of a new system type. If using a remote file transfer protocol,
                  copy the complete contents of the existing server machine's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
>
                  directory.</P
></LI
><LI
><P
>On a machine of a new system type, you must use the following instructions to copy files from the AFS
                  CD-ROM. <OL
TYPE="a"
><LI
><P
>On the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory, mount the AFS CD-ROM for this
                        machine's system type, if it is not already. For instructions on mounting CD-ROMs (either locally or
                        remotely via NFS), consult the operating system documentation.</P
></LI
><LI
><P
>Copy files from the CD-ROM to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs</B
></SPAN
> directory.
                        <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /cdrom/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/root.server/usr/afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -rp  *  /usr/afs</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
></LI
></UL
></P
></LI
><LI
><P
>Copy the contents of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc</B
></SPAN
> directory from an existing file server
            machine, using a remote file transfer protocol such as <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ftp</B
></SPAN
> or NFS. If you use a system
            control machine, it is best to copy the contents of its <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc</B
></SPAN
> directory. If you
            choose not to run a system control machine, copy the directory's contents from any existing file server machine.
                 </P
></LI
><LI
><P
>Change to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
> directory and start the BOS Server (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bosserver</B
></SPAN
> process). Include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
> flag to prevent the AFS
            processes from performing authorization checking. This is a grave compromise of security; finish the remaining
            instructions in this section in an uninterrupted pass. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/afs/bin</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bosserver -noauth &#38;</B
></SPAN
>
</PRE
>      </P
></LI
><LI
><P
><A
NAME="LIWQ109"
></A
>If you run a system control machine, create the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upclientetc</B
></SPAN
> process as an instance of the client portion of the Update Server. It accepts updates
            of the common configuration files stored in the system control machine's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc</B
></SPAN
>
            directory from the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upserver</B
></SPAN
> process (server portion of the Update Server) running on
            that machine. The cell's first file server machine was installed as the system control machine in <A
HREF="c371.html#HDRWQ61"
>Starting the Server Portion of the Update Server</A
>. (If you do not run a system control machine,
            you must update the contents of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc</B
></SPAN
> directory on each file server machine,
            using the appropriate <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos</B
></SPAN
> commands.)</P
><P
>By default, the Update Server performs updates every 300 seconds (five minutes). Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-t</B
></SPAN
> argument to specify a different number of seconds. For the
            <VAR
CLASS="replaceable"
>machinename</VAR
> argument, substitute the name of the machine you are installing. The
            command appears on multiple lines here only for legibility reasons.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos create</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upclientetc simple</B
></SPAN
>  \ 
         <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>"/usr/afs/bin/upclient</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>system control machine</VAR
>&#62;  \  
         [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-t</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>time</VAR
>&#62;]  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc" -cell</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
</PRE
></LI
><LI
><P
><A
NAME="LIWQ110"
></A
>Create an instance of the Update Server to handle distribution of the file server binaries
            stored in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
> directory. <UL
><LI
><P
>If this is the first file server machine of its AFS system type, create the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upserver</B
></SPAN
> process as an instance of the server portion of the Update Server. It distributes
                  its copy of the file server process binaries to the other file server machines of this system type that you
                  install in future. Creating this process makes this machine the binary distribution machine for its type.
                  <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos create</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upserver  simple</B
></SPAN
>  \ 
         <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>"/usr/afs/bin/upserver -clear /usr/afs/bin"</B
></SPAN
>   \
         <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>If this machine is an existing system type, create the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upclientbin</B
></SPAN
> process
                  as an instance of the client portion of the Update Server. It accepts updates of the AFS binaries from the
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upserver</B
></SPAN
> process running on the binary distribution machine for its system type.
                  For distribution to work properly, the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upserver</B
></SPAN
> process must already by running
                  on that machine.</P
><P
>Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-clear</B
></SPAN
> argument to specify that the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upclientbin</B
></SPAN
> process requests unencrypted transfer of the binaries in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
> directory. Binaries are not sensitive and encrypting them is
                  time-consuming.</P
><P
>By default, the Update Server performs updates every 300 seconds (five minutes). Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-t</B
></SPAN
> argument to specify an different number of seconds.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos create</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upclientbin simple</B
></SPAN
>  \ 
        <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>"/usr/afs/bin/upclient</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>binary distribution machine</VAR
>&#62;   \
        [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-t</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>time</VAR
>&#62;] <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-clear /usr/afs/bin" -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
</PRE
></LI
></UL
></P
></LI
><LI
><P
>Start the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp</B
></SPAN
> process, which configures the Network Time Protocol Daemon
            (NTPD) to choose a database server machine chosen randomly from the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/CellServDB</B
></SPAN
> file as its time source. In the standard configuration, the first
            database server machine installed in your cell refers to a time source outside the cell, and serves as the basis for
            clock synchronization on all server machines. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos create</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp simple</B
></SPAN
>  \ 
         <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/runntp -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
</PRE
></P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>Do not run the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp</B
></SPAN
> process if NTPD or another time synchronization protocol
              is already running on the machine. Some versions of some operating systems run a time synchronization program by
              default, as detailed in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Release Notes</I
></SPAN
>.</P
><P
>Attempting to run multiple instances of the NTPD causes an error. Running NTPD together with another time
              synchronization protocol is unnecessary and can cause instability in the clock setting.</P
></BLOCKQUOTE
></DIV
></LI
><LI
><P
>Start the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs</B
></SPAN
> process, which binds together the File Server, Volume Server, and
            Salvager. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos create</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs fs</B
></SPAN
>   \ 
         <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/fileserver /usr/afs/bin/volserver</B
></SPAN
>  \ 
         <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/salvager -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ111"
>Installing Client Functionality</A
></H2
><P
>If you want this machine to be a client as well as a server, follow the instructions in this section. Otherwise, skip to
      <A
HREF="c5467.html#HDRWQ112"
>Completing the Installation</A
>.</P
><P
>Begin by loading the necessary client files to the local disk. Then create the necessary configuration files and start
      the Cache Manager. For more detailed explanation of the procedures involved, see the corresponding instructions in <A
HREF="c371.html"
>Installing the First AFS Machine</A
> (in the sections following <A
HREF="c371.html#HDRWQ63"
>Overview:
      Installing Client Functionality</A
>).</P
><P
>If another AFS machine of this machine's system type exists, the AFS binaries are probably already accessible in your
      AFS filespace (the conventional location is <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws</B
></SPAN
>). If not, or if this is
      the first AFS machine of its type, copy the AFS binaries for this system type into an AFS volume by following the instructions
      in <A
HREF="c371.html#HDRWQ83"
>Storing AFS Binaries in AFS</A
>. Because this machine is not yet an AFS client, you must perform
      the procedure on an existing AFS machine. However, remember to perform the final step (linking the local directory <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws</B
></SPAN
> to the appropriate location in the AFS file tree) on this machine itself. If you also want
      to create AFS volumes to house UNIX system binaries for the new system type, see <A
HREF="c371.html#HDRWQ88"
>Storing System
      Binaries in AFS</A
>.    <OL
TYPE="1"
><LI
><P
>Copy client binaries and files to the local disk. <UL
><LI
><P
>On a machine of an existing system type, you can either load files from the AFS CD-ROM or use a remote file
                  transfer protocol to copy files from an existing server machine of the same system type. To load from the CD-ROM,
                  see the instructions just following for a machine of a new system type. If using a remote file transfer protocol,
                  copy the complete contents of the existing client machine's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
>
                  directory.</P
></LI
><LI
><P
>On a machine of a new system type, you must use the following instructions to copy files from the AFS
                  CD-ROM. <OL
TYPE="a"
><LI
><P
>On the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory, mount the AFS CD-ROM for this
                        machine's system type, if it is not already. For instructions on mounting CD-ROMs (either locally or
                        remotely via NFS), consult the operating system documentation.</P
></LI
><LI
><P
>Copy files to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory.</P
><P
>This step places a copy of the AFS initialization script (and related files, if applicable) into the
                        <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory. In the preceding instructions for incorporating
                        AFS into the kernel, you copied the script directly to the operating system's conventional location for
                        initialization files. When you incorporate AFS into the machine's startup sequence in a later step, you can
                        choose to link the two files.</P
><P
>On some system types that use a dynamic kernel loader program, you previously copied AFS library files
                        into a subdirectory of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory. On other system types,
                        you copied the appropriate AFS library file directly to the directory where the operating system accesses
                        it. The following commands do not copy or recopy the AFS library files into the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory, because on some system types the library files consume a
                        large amount of space. If you want to copy them, add the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-r</B
></SPAN
> flag to the
                        first <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp</B
></SPAN
> command and skip the second <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp</B
></SPAN
>
                        command.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /cdrom/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/root.client/usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p  *  /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -rp  C  /usr/vice/etc</B
></SPAN
>
</PRE
></LI
></OL
></P
></LI
></UL
></P
></LI
><LI
><P
>Change to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory and create the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ThisCell</B
></SPAN
> file as a copy of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/ThisCell</B
></SPAN
> file. You
            must first remove the symbolic link to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/ThisCell</B
></SPAN
> file that the BOS
            Server created automatically in <A
HREF="c5467.html#HDRWQ108"
>Starting Server Programs</A
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd  /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm  ThisCell</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp  /usr/afs/etc/ThisCell  ThisCell</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Remove the symbolic link to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/CellServDB</B
></SPAN
> file. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm  CellServDB</B
></SPAN
>
</PRE
>   </P
></LI
><LI
><P
>Create the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/CellServDB</B
></SPAN
> file. Use a network file transfer program
            such as <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ftp</B
></SPAN
> or NFS to copy it from one of the following sources, which are listed in
            decreasing order of preference: <UL
><LI
><P
>Your cell's central <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> source file (the conventional location is
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/common/etc/CellServDB</B
></SPAN
>)</P
></LI
><LI
><P
>The global <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file maintained by the AFS Product Support
                  group</P
></LI
><LI
><P
>An existing client machine in your cell</P
></LI
><LI
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB.sample</B
></SPAN
> file included in the
                  <VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/root.client/usr/vice/etc</B
></SPAN
> directory of each AFS
                  CD-ROM; add an entry for the local cell by following the instructions in <A
HREF="c371.html#HDRWQ66"
>Creating the
                  Client CellServDB File</A
></P
></LI
></UL
></P
></LI
><LI
><P
>Create the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cacheinfo</B
></SPAN
> file for either a disk cache or a memory cache. For a
            discussion of the appropriate values to record in the file, see <A
HREF="c371.html#HDRWQ67"
>Configuring the
            Cache</A
>.</P
><P
>To configure a disk cache, issue the following commands. If you are devoting a partition exclusively to caching,
            as recommended, you must also configure it, make a file system on it, and mount it at the directory created in this
            step.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /usr/vice/cache</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>echo "/afs:/usr/vice/cache:</B
></SPAN
><VAR
CLASS="replaceable"
>#blocks</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>" &#62; cacheinfo</B
></SPAN
>   
</PRE
><P
>To configure a memory cache:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>echo "/afs:/usr/vice/cache:</B
></SPAN
><VAR
CLASS="replaceable"
>#blocks</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>" &#62; cacheinfo</B
></SPAN
>
</PRE
></LI
><LI
><P
>Create the local directory on which to mount the AFS filespace, by convention <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs</B
></SPAN
>. If the directory already exists, verify that it is empty. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>On AIX systems, add the following line to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/vfs</B
></SPAN
> file. It enables AIX to
            unmount AFS correctly during shutdown. <PRE
CLASS="programlisting"
>&#13;   afs     4     none     none
</PRE
></P
></LI
><LI
><P
>On Linux systems, copy the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> options file from the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/sysconfig</B
></SPAN
> directory,
            removing the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.conf</B
></SPAN
> extension as you do so. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp /usr/vice/etc/afs.conf /etc/sysconfig/afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Edit the machine's AFS initialization script or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> options file to set
            appropriate values for <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> command parameters. The script resides in the indicated
            location on each system type: <UL
><LI
><P
>On AIX systems, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.afs</B
></SPAN
></P
></LI
><LI
><P
>On Digital UNIX systems, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d/afs</B
></SPAN
></P
></LI
><LI
><P
>On HP-UX systems, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d/afs</B
></SPAN
></P
></LI
><LI
><P
>On IRIX systems, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d/afs</B
></SPAN
></P
></LI
><LI
><P
>On Linux systems, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/sysconfig/afs</B
></SPAN
> (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> options file)</P
></LI
><LI
><P
>On Solaris systems, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d/afs</B
></SPAN
></P
></LI
></UL
></P
><P
>Use one of the methods described in <A
HREF="c371.html#HDRWQ70"
>Configuring the Cache Manager</A
> to add the
            following flags to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> command line. If you intend for the machine to remain an
            AFS client, also set any performance-related arguments you wish. <UL
><LI
><P
>Add the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-nosettime</B
></SPAN
> flag, because this is a file server machine that is also
                  a client.</P
></LI
><LI
><P
>Add the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-memcache</B
></SPAN
> flag if the machine is to use a memory cache.</P
></LI
><LI
><P
>Add the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-verbose</B
></SPAN
> flag to display a trace of the Cache Manager's
                  initialization on the standard output stream.</P
></LI
></UL
></P
></LI
><LI
><P
>If appropriate, follow the instructions in <A
HREF="c371.html#HDRWQ83"
>Storing AFS Binaries in AFS</A
> to copy the
            AFS binaries for this system type into an AFS volume. See the introduction to this section for further
            discussion.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ112"
>Completing the Installation</A
></H2
><P
>At this point you run the machine's AFS initialization script to verify that it correctly loads AFS modifications into
      the kernel and starts the BOS Server, which starts the other server processes. If you have installed client files, the script
      also starts the Cache Manager. If the script works correctly, perform the steps that incorporate it into the machine's startup
      and shutdown sequence. If there are problems during the initialization, attempt to resolve them. The AFS Product Support group
      can provide assistance if necessary.</P
><P
>If the machine is configured as a client using a disk cache, it can take a while for the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> program to create all of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>V</B
></SPAN
><VAR
CLASS="replaceable"
>n</VAR
> files
      in the cache directory. Messages on the console trace the initialization process. <OL
TYPE="1"
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos shutdown</B
></SPAN
> command to shut down the AFS server processes other than
            the BOS Server. Include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-wait</B
></SPAN
> flag to delay return of the command shell prompt
            until all processes shut down completely. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/bos shutdown</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-wait</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ps</B
></SPAN
> command to learn the BOS Server's process ID number (PID), and then
            the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kill</B
></SPAN
> command to stop the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bosserver</B
></SPAN
> process.
            <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ps</B
></SPAN
> <VAR
CLASS="replaceable"
>appropriate_ps_options</VAR
> <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>| grep bosserver</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kill</B
></SPAN
> <VAR
CLASS="replaceable"
>bosserver_PID</VAR
>
</PRE
>      </P
></LI
><LI
><P
>Run the AFS initialization script by issuing the appropriate commands for this system type.</P
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>On AIX systems:</B
></SPAN
> <OL
TYPE="a"
><LI
><P
>Reboot the machine and log in again as the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>.
                  <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown -r now</B
></SPAN
>
   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
></P
></LI
><LI
><P
>Run the AFS initialization script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Edit the AIX initialization file, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/inittab</B
></SPAN
>, adding the following line
                  to invoke the AFS initialization script. Place it just after the line that starts NFS daemons. <PRE
CLASS="programlisting"
>&#13;   rcafs:2:wait:/etc/rc.afs &#62; /dev/console 2&#62;&#38;1 # Start AFS services
</PRE
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> There are now copies of the AFS initialization file in both the
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc</B
></SPAN
> directories. If you want
                  to avoid potential confusion by guaranteeing that they are always the same, create a link between them. You can
                  always retrieve the original script from the AFS CD-ROM if necessary. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd  /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm  rc.afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  /etc/rc.afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Proceed to Step <A
HREF="c5467.html#LIWQ113"
>4</A
>.</P
></LI
></OL
></P
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>On Digital UNIX systems:</B
></SPAN
> <OL
TYPE="a"
><LI
><P
>Run the AFS initialization script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d/afs  start</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Change to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d</B
></SPAN
> directory and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln
                  -s</B
></SPAN
> command to create symbolic links that incorporate the AFS initialization script into the Digital
                  UNIX startup and shutdown sequence. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd  /sbin/init.d</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  ../init.d/afs  /sbin/rc3.d/S67afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  ../init.d/afs  /sbin/rc0.d/K66afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> There are now copies of the AFS initialization file in both the
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d</B
></SPAN
> directories. If
                  you want to avoid potential confusion by guaranteeing that they are always the same, create a link between them.
                  You can always retrieve the original script from the AFS CD-ROM if necessary. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm afs.rc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  /sbin/init.d/afs  afs.rc</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Proceed to Step <A
HREF="c5467.html#LIWQ113"
>4</A
>.</P
></LI
></OL
></P
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>On HP-UX systems:</B
></SPAN
> <OL
TYPE="a"
><LI
><P
>Run the AFS initialization script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d/afs  start</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Change to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d</B
></SPAN
> directory and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln
                  -s</B
></SPAN
> command to create symbolic links that incorporate the AFS initialization script into the HP-UX
                  startup and shutdown sequence. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /sbin/init.d</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s ../init.d/afs /sbin/rc2.d/S460afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s ../init.d/afs /sbin/rc2.d/K800afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> There are now copies of the AFS initialization file in both the
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d</B
></SPAN
> directories. If
                  you want to avoid potential confusion by guaranteeing that they are always the same, create a link between them.
                  You can always retrieve the original script from the AFS CD-ROM if necessary. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm afs.rc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  /sbin/init.d/afs  afs.rc</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Proceed to Step <A
HREF="c5467.html#LIWQ113"
>4</A
>.</P
></LI
></OL
></P
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>On IRIX systems:</B
></SPAN
> <OL
TYPE="a"
><LI
><P
>If you have configured the machine to use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ml</B
></SPAN
> dynamic loader program,
                  reboot the machine and log in again as the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown -i6 -g0 -y</B
></SPAN
>
   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>chkconfig</B
></SPAN
> command to activate the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsserver</B
></SPAN
> configuration variable. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/chkconfig -f afsserver on</B
></SPAN
>   
</PRE
></P
><P
>If you have configured this machine as an AFS client and want to it remain one, also issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>chkconfig</B
></SPAN
> command to activate the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsclient</B
></SPAN
> configuration
                  variable.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/chkconfig -f afsclient on</B
></SPAN
> 
</PRE
></LI
><LI
><P
>Run the AFS initialization script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d/afs  start</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Change to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d</B
></SPAN
> directory and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln
                  -s</B
></SPAN
> command to create symbolic links that incorporate the AFS initialization script into the IRIX
                  startup and shutdown sequence. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /etc/init.d</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s ../init.d/afs /etc/rc2.d/S35afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s ../init.d/afs /etc/rc0.d/K35afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> There are now copies of the AFS initialization file in both the
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d</B
></SPAN
> directories. If
                  you want to avoid potential confusion by guaranteeing that they are always the same, create a link between them.
                  You can always retrieve the original script from the AFS CD-ROM if necessary. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm afs.rc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  /etc/init.d/afs  afs.rc</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Proceed to Step <A
HREF="c5467.html#LIWQ113"
>4</A
>.</P
></LI
></OL
></P
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>On Linux systems:</B
></SPAN
> <OL
TYPE="a"
><LI
><P
>Reboot the machine and log in again as the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>.
                  <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown -r now</B
></SPAN
>
   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
></P
></LI
><LI
><P
>Run the AFS initialization script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.d/init.d/afs  start</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>chkconfig</B
></SPAN
> command to activate the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs</B
></SPAN
> configuration variable. Based on the instruction in the AFS initialization file that
                  begins with the string <SAMP
CLASS="computeroutput"
>#chkconfig</SAMP
>, the command automatically creates the symbolic
                  links that incorporate the script into the Linux startup and shutdown sequence. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/chkconfig  --add afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> There are now copies of the AFS initialization file in both the
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.d/init.d</B
></SPAN
> directories,
                  and copies of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> options file in both the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/sysconfig</B
></SPAN
> directories. If you want
                  to avoid potential confusion by guaranteeing that the two copies of each file are always the same, create a link
                  between them. You can always retrieve the original script or options file from the AFS CD-ROM if necessary.
                  <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm afs.rc afs.conf</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  /etc/rc.d/init.d/afs  afs.rc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  /etc/sysconfig/afs  afs.conf</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Proceed to Step <A
HREF="c5467.html#LIWQ113"
>4</A
>.</P
></LI
></OL
></P
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>On Solaris systems:</B
></SPAN
> <OL
TYPE="a"
><LI
><P
>Reboot the machine and log in again as the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>.
                  <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown -i6 -g0 -y</B
></SPAN
>
   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
></P
></LI
><LI
><P
>Run the AFS initialization script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d/afs  start</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Change to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d</B
></SPAN
> directory and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln
                  -s</B
></SPAN
> command to create symbolic links that incorporate the AFS initialization script into the Solaris
                  startup and shutdown sequence. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /etc/init.d</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s ../init.d/afs /etc/rc3.d/S99afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s ../init.d/afs /etc/rc0.d/K66afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> There are now copies of the AFS initialization file in both the
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d</B
></SPAN
> directories. If
                  you want to avoid potential confusion by guaranteeing that they are always the same, create a link between them.
                  You can always retrieve the original script from the AFS CD-ROM if necessary. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm afs.rc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  /etc/init.d/afs  afs.rc</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
></LI
><LI
><P
><A
NAME="LIWQ113"
></A
>Verify that <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs</B
></SPAN
> and its subdirectories on the new
            file server machine meet the ownership and mode bit requirements outlined in <A
HREF="c371.html#HDRWQ96"
>Protecting
            Sensitive AFS Directories</A
>. If necessary, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>chmod</B
></SPAN
> command to correct the
            mode bits.</P
></LI
><LI
><P
>To configure this machine as a database server machine, proceed to <A
HREF="c5467.html#HDRWQ114"
>Installing Database
            Server Functionality</A
>.</P
></LI
></OL
></P
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ114"
>Installing Database Server Functionality</A
></H1
><P
>This section explains how to install database server functionality. Database server machines have two defining
    characteristics. First, they run the Authentication Server, Protection Server, and Volume Location (VL) Server processes. They
    also run the Backup Server if the cell uses the AFS Backup System, as is assumed in these instructions. Second, they appear in
    the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file of every machine in the cell (and of client machines in foreign cells, if
    they are to access files in this cell).</P
><P
>Note the following requirements for database server machines. <UL
><LI
><P
>In the conventional configuration, database server machines also serve as file server machines (run the File Server,
          Volume Server and Salvager processes). If you choose not to run file server functionality on a database server machine,
          then the kernel does not have to incorporate AFS modifications, but the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs</B
></SPAN
>
          directory must house most of the standard files and subdirectories. In particular, the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/KeyFile</B
></SPAN
> file must contain the same keys as all other server machines in the cell. If
          you run a system control machine, run the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upclientetc</B
></SPAN
> process on every database server
          machine other than the system control machine; if you do not run a system control machine, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos addkey</B
></SPAN
> command as instructed in the chapter in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration
          Guide</I
></SPAN
> about maintaining server encryption keys.</P
><P
>The instructions in this section assume that the machine on which you are installing database server functionality
          is already a file server machine. Contact the AFS Product Support group to learn how to install database server
          functionality on a non-file server machine.</P
></LI
><LI
><P
>During the installation of database server functionality, you must restart all of the database server machines to
          force the election of a new Ubik coordinator (synchronization site) for each database server process. This can cause a
          system outage, which usually lasts less than 5 minutes.</P
></LI
><LI
><P
>Updating the kernel memory list of database server machines on each client machine is generally the most
          time-consuming part of installing a new database server machine. It is, however, crucial for correct functioning in your
          cell. Incorrect knowledge of your cell's database server machines can prevent your users from authenticating, accessing
          files, and issuing AFS commands.</P
><P
>You update a client's kernel memory list by changing the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/CellServDB</B
></SPAN
>
          file and then either rebooting or issuing the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs newcell</B
></SPAN
> command. For instructions, see
          the chapter in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Guide</I
></SPAN
> about administering client machines.</P
><P
>The point at which you update your clients' knowledge of database server machines depends on which of the database
          server machines has the lowest IP address. The following instructions indicate the appropriate place to update your client
          machines in either case. <UL
><LI
><P
>If the new database server machine has a lower IP address than any existing database server machine, update
                the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file on every client machine before restarting the database server
                processes. If you do not, users can become unable to update (write to) any of the AFS databases. This is because the
                machine with the lowest IP address is usually elected as the Ubik coordinator, and only the Coordinator accepts
                database writes. On client machines that do not have the new list of database server machines, the Cache Manager
                cannot locate the new coordinator. (Be aware that if clients contact the new coordinator before it is actually in
                service, they experience a timeout before contacting another database server machine. This is a minor, and
                temporary, problem compared to being unable to write to the database.)</P
></LI
><LI
><P
>If the new database server machine does not have the lowest IP address of any database server machine, then it
                is better to update clients after restarting the database server processes. Client machines do not start using the
                new database server machine until you update their kernel memory list, but that does not usually cause timeouts or
                update problems (because the new machine is not likely to become the coordinator).</P
></LI
></UL
></P
></LI
></UL
></P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="Header_110"
>Summary of Procedures</A
></H2
><P
>To install a database server machine, perform the following procedures. <OL
TYPE="1"
><LI
><P
>Install the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos</B
></SPAN
> suite of commands locally, as a precaution</P
></LI
><LI
><P
>Add the new machine to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/CellServDB</B
></SPAN
> file on existing file server
            machines</P
></LI
><LI
><P
>Update your cell's central <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> source file and the file you make available
            to foreign cells</P
></LI
><LI
><P
>Update every client machine's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/CellServDB</B
></SPAN
> file and kernel memory
            list of database server machines</P
></LI
><LI
><P
>Start the database server processes (Authentication Server, Backup Server, Protection Server, and Volume Location
            Server)</P
></LI
><LI
><P
>Restart the database server processes on every database server machine</P
></LI
><LI
><P
>Notify the AFS Product Support group that you have installed a new database server machine</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="Header_111"
>Instructions</A
></H2
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>It is assumed that your PATH environment variable includes the directory that houses the AFS command binaries. If not,
        you possibly need to precede the command names with the appropriate pathname.</P
></BLOCKQUOTE
></DIV
><OL
TYPE="1"
><LI
><P
>You can perform the following instructions on either a server or client machine. Login as an AFS administrator who
          is listed in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
> file on all server machines. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>klog</B
></SPAN
> <VAR
CLASS="replaceable"
>admin_user</VAR
>
   Password: <VAR
CLASS="replaceable"
>admin_password</VAR
>
</PRE
></P
></LI
><LI
><P
>If you are working on a client machine configured in the conventional manner, the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos</B
></SPAN
> command suite resides in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws/bin</B
></SPAN
> directory, a
          symbolic link to an AFS directory. An error during installation can potentially block access to AFS, in which case it is
          helpful to have a copy of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos</B
></SPAN
> binary on the local disk. This step is not necessary if
          you are working on a server machine, where the binary resides in the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
>
          directory. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp  /usr/afsws/bin/bos   /tmp</B
></SPAN
>
</PRE
>     </P
></LI
><LI
><P
><A
NAME="LIWQ115"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos addhost</B
></SPAN
> command to add the new database server
          machine to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/CellServDB</B
></SPAN
> file on existing server machines (as well as the
          new database server machine itself).</P
><P
>Substitute the new database server machine's fully-qualified hostname for the <VAR
CLASS="replaceable"
>host name</VAR
>
          argument. If you run a system control machine, substitute its fully-qualified hostname for the
          <VAR
CLASS="replaceable"
>machinename</VAR
> argument. If you do not run a system control machine, repeat the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos addhost</B
></SPAN
> command once for each server machine in your cell (including the new database server
          machine itself), by substituting each one's fully-qualified hostname for the <VAR
CLASS="replaceable"
>machinename</VAR
>
          argument in turn.</P
><PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos addhost</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62;  &#60;<VAR
CLASS="replaceable"
>host name</VAR
>&#62;   
</PRE
><P
>If you run a system control machine, wait for the Update Server to distribute the new <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file, which takes up to five minutes by default. If you are issuing individual <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos addhost</B
></SPAN
> commands, attempt to issue all of them within five minutes.</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>It is best to maintain a one-to-one mapping between hostnames and IP addresses on a multihomed database server
            machine (the conventional configuration for any AFS machine). The BOS Server uses the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>gethostbyname()</B
></SPAN
> routine to obtain the IP address associated with the <VAR
CLASS="replaceable"
>host
            name</VAR
> argument. If there is more than one address, the BOS Server records in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> entry the one that appears first in the list of addresses returned by the routine. The
            routine possibly returns addresses in a different order on different machines, which can create inconsistency.</P
></BLOCKQUOTE
></DIV
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listhosts</B
></SPAN
> command on each
          server machine to verify that the new database server machine appears in its <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
>
          file. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listhosts</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62;
</PRE
></P
></LI
><LI
><P
><A
NAME="LIWQ116"
></A
>Add the new database server machine to your cell's central <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> source file, if you use one. The standard location is <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/common/etc/CellServDB</B
></SPAN
>.</P
><P
>If you are willing to make your cell accessible to users in foreign cells, add the new database server machine to
          the file that lists your cell's database server machines. The conventional location is <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/service/etc/CellServDB.local</B
></SPAN
>.   </P
></LI
><LI
><P
><A
NAME="LIWQ117"
></A
>If this machine's IP address is lower than any existing database server machine's, update
          every client machine's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/CellServDB</B
></SPAN
> file and kernel memory list to include
          this machine. (If this machine's IP address is not the lowest, it is acceptable to wait until Step <A
HREF="c5467.html#LIWQ123"
>12</A
>.)</P
><P
>There are several ways to update the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file on client machines, as
          detailed in the chapter of the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Guide</I
></SPAN
> about administering client machines. One
          option is to copy over the central update source (which you updated in Step <A
HREF="c5467.html#LIWQ116"
>5</A
>), with or
          without using the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>package</B
></SPAN
> program. To update the machine's kernel memory list, you can
          either reboot after changing the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file or issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs
          newcell</B
></SPAN
> command.     </P
></LI
><LI
><P
><A
NAME="LIWQ118"
></A
>Start the Authentication Server (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kaserver</B
></SPAN
> process).
          <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos create</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kaserver simple /usr/afs/bin/kaserver</B
></SPAN
>
</PRE
>  </P
></LI
><LI
><P
><A
NAME="LIWQ119"
></A
>Start the Backup Server (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>buserver</B
></SPAN
> process). You must
          perform other configuration procedures before actually using the AFS Backup System, as detailed in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS
          Administration Guide</I
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos create</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>buserver simple /usr/afs/bin/buserver</B
></SPAN
>
</PRE
>  </P
></LI
><LI
><P
><A
NAME="LIWQ120"
></A
>Start the Protection Server (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ptserver</B
></SPAN
> process).
          <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos create</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ptserver simple /usr/afs/bin/ptserver</B
></SPAN
>
</PRE
>  </P
></LI
><LI
><P
><A
NAME="LIWQ121"
></A
>Start the Volume Location (VL) Server (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vlserver</B
></SPAN
>
          process). <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos create</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vlserver simple /usr/afs/bin/vlserver</B
></SPAN
>
</PRE
>    </P
></LI
><LI
><P
><A
NAME="LIWQ122"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos restart</B
></SPAN
> command on every database server
          machine in the cell, including the new machine. The command restarts the Authentication, Backup, Protection, and VL
          Servers, which forces an election of a new Ubik coordinator for each process. The new machine votes in the election and is
          considered as a potential new coordinator.</P
><P
>A cell-wide service outage is possible during the election of a new coordinator for the VL Server, but it normally
          lasts less than five minutes. Such an outage is particularly likely if you are installing your cell's second database
          server machine. Messages tracing the progress of the election appear on the console.</P
><P
>Repeat this command on each of your cell's database server machines in quick succession. Begin with the machine with
          the lowest IP address.</P
><PRE
CLASS="programlisting"
>&#13;   %  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos restart</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kaserver buserver ptserver vlserver</B
></SPAN
>    
</PRE
><P
>If an error occurs, restart all server processes on the database server machines again by using one of the following
          methods: <UL
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos restart</B
></SPAN
> command with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-bosserver</B
></SPAN
> flag for each database server machine</P
></LI
><LI
><P
>Reboot each database server machine, either using the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos exec</B
></SPAN
> command or at
                its console</P
></LI
></UL
></P
></LI
><LI
><P
><A
NAME="LIWQ123"
></A
>If you did not update the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file on client machines
          in Step <A
HREF="c5467.html#LIWQ117"
>6</A
>, do so now.</P
></LI
><LI
><P
><A
NAME="LIWQ124"
></A
>Send the new database server machine's name and IP address to the AFS Product Support
          group.</P
><P
>If you wish to participate in the AFS global name space, your cell's entry appear in a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file that the AFS Product Support group makes available to all AFS sites. Otherwise,
          they list your cell in a private file that they do not share with other AFS sites.</P
></LI
></OL
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ125"
>Removing Database Server Functionality</A
></H1
><P
>Removing database server machine functionality is nearly the reverse of installing it.</P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="Header_113"
>Summary of Procedures</A
></H2
><P
>To decommission a database server machine, perform the following procedures. <OL
TYPE="1"
><LI
><P
>Install the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos</B
></SPAN
> suite of commands locally, as a precaution</P
></LI
><LI
><P
>Notify the AFS Product Support group that you are decommissioning a database server machine</P
></LI
><LI
><P
>Update your cell's central <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> source file and the file you make available
            to foreign cells</P
></LI
><LI
><P
>Update every client machine's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/CellServDB</B
></SPAN
> file and kernel memory
            list of database server machines</P
></LI
><LI
><P
>Remove the machine from the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/CellServDB</B
></SPAN
> file on file server
            machines</P
></LI
><LI
><P
>Stop the database server processes and remove them from the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/local/BosConfig</B
></SPAN
> file if desired</P
></LI
><LI
><P
>Restart the database server processes on the remaining database server machines</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="Header_114"
>Instructions</A
></H2
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>It is assumed that your PATH environment variable includes the directory that houses the AFS command binaries. If not,
        you possibly need to precede the command names with the appropriate pathname.</P
></BLOCKQUOTE
></DIV
><OL
TYPE="1"
><LI
><P
>You can perform the following instructions on either a server or client machine. Login as an AFS administrator who
          is listed in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
> file on all server machines. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>klog</B
></SPAN
> <VAR
CLASS="replaceable"
>admin_user</VAR
>
   Password: <VAR
CLASS="replaceable"
>admin_password</VAR
>
</PRE
></P
></LI
><LI
><P
>If you are working on a client machine configured in the conventional manner, the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos</B
></SPAN
> command suite resides in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws/bin</B
></SPAN
> directory, a
          symbolic link to an AFS directory. An error during installation can potentially block access to AFS, in which case it is
          helpful to have a copy of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos</B
></SPAN
> binary on the local disk. This step is not necessary if
          you are working on a server machine, where the binary resides in the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
>
          directory. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp  /usr/afsws/bin/bos   /tmp</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
><A
NAME="LIWQ126"
></A
>Send the revised list of your cell's database server machines to the AFS Product Support
          group.</P
><P
>This step is particularly important if your cell is included in the global <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file. If the administrators in foreign cells do not learn about the change in your cell,
          they cannot update the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file on their client machines. Users in foreign cells
          continue to send database requests to the decommissioned machine, which creates needless network traffic and activity on
          the machine. Also, the users experience time-out delays while their request is forwarded to a valid database server
          machine.</P
></LI
><LI
><P
><A
NAME="LIWQ127"
></A
>Remove the decommissioned machine from your cell's central <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> source file, if you use one. The conventional location is <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/common/etc/CellServDB</B
></SPAN
>.</P
><P
>If you maintain a file that users in foreign cells can access to learn about your cell's database server machines,
          update it also. The conventional location is <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/service/etc/CellServDB.local</B
></SPAN
>.    </P
></LI
><LI
><P
><A
NAME="LIWQ128"
></A
>Update every client machine's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/CellServDB</B
></SPAN
> file
          and kernel memory list to exclude this machine. Altering the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file and kernel
          memory list before stopping the actual database server processes avoids possible time-out delays that result when users
          send requests to a decommissioned database server machine that is still listed in the file.</P
><P
>There are several ways to update the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file on client machines, as
          detailed in the chapter of the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Guide</I
></SPAN
> about administering client machines. One
          option is to copy over the central update source (which you updated in Step <A
HREF="c5467.html#LIWQ116"
>5</A
>), with or
          without using the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>package</B
></SPAN
> program. To update the machine's kernel memory list, you can
          either reboot after changing the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file or issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs
          newcell</B
></SPAN
> command.    </P
></LI
><LI
><P
><A
NAME="LIWQ129"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos removehost</B
></SPAN
> command to remove the
          decommissioned database server machine from the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/CellServDB</B
></SPAN
> file on server
          machines.</P
><P
>Substitute the decommissioned database server machine's fully-qualified hostname for the <VAR
CLASS="replaceable"
>host
          name</VAR
> argument. If you run a system control machine, substitute its fully-qualified hostname for the
          <VAR
CLASS="replaceable"
>machinename</VAR
> argument. If you do not run a system control machine, repeat the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos removehost</B
></SPAN
> command once for each server machine in your cell (including the decommissioned
          database server machine itself), by substituting each one's fully-qualified hostname for the
          <VAR
CLASS="replaceable"
>machinename</VAR
> argument in turn.</P
><PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos removehost</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62;  &#60;<VAR
CLASS="replaceable"
>host name</VAR
>&#62;   
</PRE
><P
>If you run a system control machine, wait for the Update Server to distribute the new <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file, which takes up to five minutes by default. If issuing individual <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos removehost</B
></SPAN
> commands, attempt to issue all of them within five minutes.</P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listhosts</B
></SPAN
> command on each
          server machine to verify that the decommissioned database server machine no longer appears in its <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listhosts</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62;
</PRE
>       </P
></LI
><LI
><P
><A
NAME="LIWQ130"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos stop</B
></SPAN
> command to stop the database server
          processes on the machine, by substituting its fully-qualified hostname for the
          <VAR
CLASS="replaceable"
>machinename</VAR
> argument. The command changes each process's status in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/local/BosConfig</B
></SPAN
> file to <SAMP
CLASS="computeroutput"
>NotRun</SAMP
>, but does not remove its
          entry from the file. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos stop</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kaserver buserver ptserver vlserver</B
></SPAN
>
</PRE
>     </P
></LI
><LI
><P
><A
NAME="LIWQ131"
></A
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos
          delete</B
></SPAN
> command to remove the entries for database server processes from the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>BosConfig</B
></SPAN
> file. This step is unnecessary if you plan to restart the database server functionality
          on this machine in future. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos delete</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kaserver buserver ptserver vlserver</B
></SPAN
>
</PRE
>    </P
></LI
><LI
><P
><A
NAME="LIWQ132"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos restart</B
></SPAN
> command on every database server
          machine in the cell, to restart the Authentication, Backup, Protection, and VL Servers. This forces the election of a Ubik
          coordinator for each process, ensuring that the remaining database server processes recognize that the machine is no
          longer a database server.</P
><P
>A cell-wide service outage is possible during the election of a new coordinator for the VL Server, but it normally
          lasts less than five minutes. Messages tracing the progress of the election appear on the console.</P
><P
>Repeat this command on each of your cell's database server machines in quick succession. Begin with the machine with
          the lowest IP address.</P
><PRE
CLASS="programlisting"
>&#13;   %  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos restart</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kaserver buserver ptserver vlserver</B
></SPAN
>    
</PRE
><P
>If an error occurs, restart all server processes on the database server machines again by using one of the following
          methods: <UL
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos restart</B
></SPAN
> command with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-bosserver</B
></SPAN
> flag for each database server machine</P
></LI
><LI
><P
>Reboot each database server machine, either using the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos exec</B
></SPAN
> command or at
                its console</P
></LI
></UL
></P
></LI
></OL
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="c371.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="c8044.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Installing the First AFS Machine</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Installing Additional Client Machines</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>